"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[653],{22653:(e,t,n)=>{n.d(t,{mcf:()=>e_,OpF:()=>d,BRs:()=>tl,bNj:()=>eJ,KWQ:()=>l,pYA:()=>c});var r=n(7620),i=n(54568),o=n(64806),s=(0,r.createContext)(void 0);function a(){return(0,r.useContext)(s)}function l(){return a().medplum}function c(){return a().profile}var u=["change","storageInitialized","storageInitFailed","profileRefreshing","profileRefreshed"];function d(e){var t;let n=e.medplum,o=null!=(t=e.navigate)?t:f,[a,l]=(0,r.useState)({profile:n.getProfile(),loading:n.isLoading()});(0,r.useEffect)(()=>{function e(){l(e=>({...e,profile:n.getProfile(),loading:n.isLoading()}))}for(let t of u)n.addEventListener(t,e);return()=>{for(let t of u)n.removeEventListener(t,e)}},[n]);let c=(0,r.useMemo)(()=>({...a,medplum:n,navigate:o}),[a,n,o]);return(0,i.jsx)(s.Provider,{value:c,children:e.children})}function f(e){window.location.assign(e)}var h=new Map,p=e=>(0,r.useMemo)(()=>{let t;if(!e)return;let n=e.split("?")[0];if(!n)return e;try{t=new URLSearchParams(new URL(e).search)}catch(t){return e}if(!t.has("Key-Pair-Id")||!t.has("Signature"))return e;let r=t.get("Expires");if(!r||r.length>13)return e;let i=h.get(n);if(i){let e=new URLSearchParams(new URL(i).search).get("Expires");if(e&&1e3*Number.parseInt(e,10)-5e3>Date.now())return i}return h.set(n,e),e},[e]);function y(e,t){let n=l(),[i,s]=(0,r.useState)(()=>m(n,e)),a=(0,r.useCallback)(e=>{(0,o.c2A)(e,i)||s(e)},[i]);return(0,r.useEffect)(()=>{let r=!0,i=m(n,e);return!i&&(0,o.A_h)(e)?n.readReference(e).then(e=>{r&&a(e)}).catch(e=>{r&&(a(void 0),t&&t((0,o.ZrK)(e)))}):a(i),()=>r=!1},[n,e,a,t]),i}function m(e,t){if(t){if((0,o.NCg)(t))return t;if((0,o.A_h)(t))return e.getCachedReference(t)}}var g={boolean:"boolean",decimal:"decimal",integer:"integer",date:"date",dateTime:"dateTime",time:"time",url:"url",attachment:"attachment",reference:"reference",quantity:"quantity"};o.ypx,o.ypx,o.ypx,o.ypx,o.ypx,o.ypx,o.ypx,o.ypx,g.boolean,o.UtL.boolean,g.date,o.UtL.date,g.dateTime,o.UtL.dateTime,g.time,o.UtL.time,g.url,o.UtL.string,o.UtL.uri,o.UtL.url,g.attachment,o.UtL.Attachment,g.reference,o.UtL.Reference,g.quantity,o.UtL.Quantity,g.decimal,o.UtL.decimal,o.UtL.integer,g.integer,o.UtL.decimal,o.UtL.integer;var v=n(94527),x=n(41049),b=n(93490),E=n(24249),S=n(3568),w=n(90458),T=n(81609),k=n(97544),C=n(63395),A=n(97628),P=n(34476),R=n(51091),_=n(42623),j=n(67504),D=n(61688),M=n(55709),L=n(40228),U=n(33913),I=n(19707),O=n(9119),N=n(3348),q=n(40635),B=n(78037),F=n(38571),W=n(72035),Q=n(84356),H=Object.create,z=Object.defineProperty,X=Object.getOwnPropertyDescriptor,G=Object.getOwnPropertyNames,V=Object.getPrototypeOf,K=Object.prototype.hasOwnProperty,J=(e,t)=>function(){return t||(0,e[G(e)[0]])((t={exports:{}}).exports,t),t.exports},$=J({"../../node_modules/rfc6902/pointer.js"(e){function t(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function n(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(e,"__esModule",{value:!0}),e.Pointer=e.escapeToken=e.unescapeToken=void 0,e.unescapeToken=t,e.escapeToken=n,e.Pointer=function(){function e(e){void 0===e&&(e=[""]),this.tokens=e}return e.fromJSON=function(n){var r=n.split("/").map(t);if(""!==r[0])throw Error("Invalid JSON Pointer: ".concat(n));return new e(r)},e.prototype.toString=function(){return this.tokens.map(n).join("/")},e.prototype.evaluate=function(e){for(var t=null,n="",r=e,i=1,o=this.tokens.length;i<o;i++)t=r,"__proto__"!=(n=this.tokens[i])&&"constructor"!=n&&"prototype"!=n&&(r=(t||{})[n]);return{parent:t,key:n,value:r}},e.prototype.get=function(e){return this.evaluate(e).value},e.prototype.set=function(e,t){var n=this.evaluate(e);n.parent&&(n.parent[n.key]=t)},e.prototype.push=function(e){this.tokens.push(e)},e.prototype.add=function(t){return new e(this.tokens.concat(String(t)))},e}()}}),Z=J({"../../node_modules/rfc6902/util.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.clone=e.objectType=e.hasOwnProperty=void 0,e.hasOwnProperty=Object.prototype.hasOwnProperty,e.objectType=function(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":typeof e},e.clone=function t(n){if(null==n||"object"!=typeof n)return n;if(n.constructor==Array){for(var r=n.length,i=Array(r),o=0;o<r;o++)i[o]=t(n[o]);return i}if(n.constructor==Date)return new Date(+n);var s={};for(var a in n)e.hasOwnProperty.call(n,a)&&(s[a]=t(n[a]));return s}}}),Y=J({"../../node_modules/rfc6902/diff.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.diffAny=e.diffObjects=e.diffArrays=e.intersection=e.subtract=e.isDestructive=void 0;var t=Z();function n(e,n){var r={};for(var i in e)t.hasOwnProperty.call(e,i)&&void 0!==e[i]&&(r[i]=1);for(var o in n)t.hasOwnProperty.call(n,o)&&void 0!==n[o]&&delete r[o];return Object.keys(r)}function r(e){for(var n=e.length,r={},i=0;i<n;i++){var o=e[i];for(var s in o)t.hasOwnProperty.call(o,s)&&void 0!==o[s]&&(r[s]=(r[s]||0)+1)}for(var s in r)r[s]<n&&delete r[s];return Object.keys(r)}function i(e,t){return{operations:e.operations.concat(t),cost:e.cost+1}}function o(e,t,n,r){void 0===r&&(r=a);var o={"0,0":{operations:[],cost:0}},s=isNaN(e.length)||e.length<=0?0:e.length;return(function s(a,l){var c="".concat(a,",").concat(l),u=o[c];if(void 0===u){if(a>0&&l>0&&!r(e[a-1],t[l-1],n.add(String(a-1))).length)u=s(a-1,l-1);else{var d=[];if(a>0){var f=s(a-1,l);d.push(i(f,{op:"remove",index:a-1}))}if(l>0){var h=s(a,l-1),p={op:"add",index:a-1,value:t[l-1]};d.push(i(h,p))}if(a>0&&l>0){var y=s(a-1,l-1),m={op:"replace",index:a-1,original:e[a-1],value:t[l-1]};d.push(i(y,m))}u=d.sort(function(e,t){return e.cost-t.cost})[0]}o[c]=u}return u})(s,isNaN(t.length)||t.length<=0?0:t.length).operations.reduce(function(e,t){var i=e[0],o=e[1];if("add"===t.op){var a=t.index+1+o,l=a<s+o?String(a):"-",c={op:t.op,path:n.add(l).toString(),value:t.value};return[i.concat(c),o+1]}if("remove"===t.op){var c={op:t.op,path:n.add(String(t.index+o)).toString()};return[i.concat(c),o-1]}var u=n.add(String(t.index+o)),d=r(t.original,t.value,u);return[i.concat.apply(i,d),o]},[[],0])[0]}function s(e,t,i,o){void 0===o&&(o=a);var s=[];return n(e,t).forEach(function(e){s.push({op:"remove",path:i.add(e).toString()})}),n(t,e).forEach(function(e){s.push({op:"add",path:i.add(e).toString(),value:t[e]})}),r([e,t]).forEach(function(n){s.push.apply(s,o(e[n],t[n],i.add(n)))}),s}function a(e,n,r,i){if(void 0===i&&(i=a),e===n)return[];var l=(0,t.objectType)(e),c=(0,t.objectType)(n);return"array"==l&&"array"==c?o(e,n,r,i):"object"==l&&"object"==c?s(e,n,r,i):[{op:"replace",path:r.toString(),value:n}]}e.isDestructive=function(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t},e.subtract=n,e.intersection=r,e.diffArrays=o,e.diffObjects=s,e.diffAny=a}}),ee=J({"../../node_modules/rfc6902/patch.js"(e){var t,n=e&&e.__extends||(t=function(e,n){return(t=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});Object.defineProperty(e,"__esModule",{value:!0}),e.apply=e.InvalidOperationError=e.test=e.copy=e.move=e.replace=e.remove=e.add=e.TestError=e.MissingError=void 0;var r=$(),i=Z(),o=Y(),s=function(e){function t(t){var n=e.call(this,"Value required at path: ".concat(t))||this;return n.path=t,n.name="MissingError",n}return n(t,e),t}(Error);e.MissingError=s;var a=function(e){function t(t,n){var r=e.call(this,"Test failed: ".concat(t," != ").concat(n))||this;return r.actual=t,r.expected=n,r.name="TestError",r}return n(t,e),t}(Error);function l(e,t,n){if(Array.isArray(e))if("-"==t)e.push(n);else{var r=parseInt(t,10);e.splice(r,0,n)}else e[t]=n}function c(e,t){if(Array.isArray(e)){var n=parseInt(t,10);e.splice(n,1)}else delete e[t]}function u(e,t){var n=r.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.parent?new s(t.path):(l(n.parent,n.key,(0,i.clone)(t.value)),null)}function d(e,t){var n=r.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.value?new s(t.path):(c(n.parent,n.key),null)}function f(e,t){var n=r.Pointer.fromJSON(t.path).evaluate(e);if(null===n.parent)return new s(t.path);if(Array.isArray(n.parent)){if(parseInt(n.key,10)>=n.parent.length)return new s(t.path)}else if(void 0===n.value)return new s(t.path);return n.parent[n.key]=(0,i.clone)(t.value),null}function h(e,t){var n=r.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new s(t.from);var i=r.Pointer.fromJSON(t.path).evaluate(e);return void 0===i.parent?new s(t.path):(c(n.parent,n.key),l(i.parent,i.key,n.value),null)}function p(e,t){var n=r.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new s(t.from);var o=r.Pointer.fromJSON(t.path).evaluate(e);return void 0===o.parent?new s(t.path):(l(o.parent,o.key,(0,i.clone)(n.value)),null)}function y(e,t){var n=r.Pointer.fromJSON(t.path).evaluate(e);return(0,o.diffAny)(n.value,t.value,new r.Pointer).length?new a(n.value,t.value):null}e.TestError=a,e.add=u,e.remove=d,e.replace=f,e.move=h,e.copy=p,e.test=y;var m=function(e){function t(t){var n=e.call(this,"Invalid operation: ".concat(t.op))||this;return n.operation=t,n.name="InvalidOperationError",n}return n(t,e),t}(Error);e.InvalidOperationError=m,e.apply=function(e,t){switch(t.op){case"add":return u(e,t);case"remove":return d(e,t);case"replace":return f(e,t);case"move":return h(e,t);case"copy":return p(e,t);case"test":return y(e,t)}return new m(t)}}}),et=J({"../../node_modules/rfc6902/index.js"(e){Object.defineProperty(e,"__esModule",{value:!0}),e.createTests=e.createPatch=e.applyPatch=e.Pointer=void 0;var t=$();Object.defineProperty(e,"Pointer",{enumerable:!0,get:function(){return t.Pointer}});var n=ee(),r=Y();function i(e,n){var r=t.Pointer.fromJSON(n).evaluate(e);if(void 0!==r)return{op:"test",path:n,value:r.value}}e.applyPatch=function(e,t){return t.map(function(t){return(0,n.apply)(e,t)})},e.createPatch=function(e,n,i){var o=new t.Pointer;return(i?function e(t,n,o){var s=i(t,n,o);return Array.isArray(s)?s:(0,r.diffAny)(t,n,o,e)}:r.diffAny)(e,n,o)},e.createTests=function(e,t){var n=[];return t.filter(r.isDestructive).forEach(function(t){var r=i(e,t.path);if(r&&n.push(r),"from"in t){var o=i(e,t.from);o&&n.push(o)}}),n}}});function en(e){let t=e.value;return t?(0,i.jsx)(i.Fragment,{children:(0,o.M0D)(t)}):null}var er=["meta","implicitRules","contained","extension","modifierExtension"],ei=["language","text"],eo=(0,r.createContext)({path:"",profileUrl:void 0,elements:Object.create(null),elementsByPath:Object.create(null),getExtendedProps:()=>({readonly:!1,hidden:!1}),accessPolicyResource:void 0,debugMode:!1,isDefaultContext:!0});eo.displayName="ElementsContext";var es=["extension","modifierExtension"];["id",...er].filter(e=>!es.includes(e));var ea={outline:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"},filled:{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"currentColor",stroke:"none"}},el=(e,t,n,i)=>{let o=(0,r.forwardRef)((n,o)=>{let{color:s="currentColor",size:a=24,stroke:l=2,title:c,className:u,children:d,...f}=n;return(0,r.createElement)("svg",{ref:o,...ea[e],width:a,height:a,className:["tabler-icon","tabler-icon-".concat(t),u].join(" "),..."filled"===e?{fill:s}:{strokeWidth:l,stroke:s},...f},[c&&(0,r.createElement)("title",{key:"svg-title"},c),...i.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(d)?d:[d]])});return o.displayName="".concat(n),o};el("outline","adjustments-horizontal","AdjustmentsHorizontal",[["path",{d:"M14 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-0"}],["path",{d:"M4 6l8 0",key:"svg-1"}],["path",{d:"M16 6l4 0",key:"svg-2"}],["path",{d:"M8 12m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-3"}],["path",{d:"M4 12l2 0",key:"svg-4"}],["path",{d:"M10 12l10 0",key:"svg-5"}],["path",{d:"M17 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-6"}],["path",{d:"M4 18l11 0",key:"svg-7"}],["path",{d:"M19 18l1 0",key:"svg-8"}]]);var ec=el("outline","alert-circle","AlertCircle",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M12 8v4",key:"svg-1"}],["path",{d:"M12 16h.01",key:"svg-2"}]]);el("outline","arrow-down","ArrowDown",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M18 13l-6 6",key:"svg-1"}],["path",{d:"M6 13l6 6",key:"svg-2"}]]),el("outline","arrow-right","ArrowRight",[["path",{d:"M5 12l14 0",key:"svg-0"}],["path",{d:"M13 18l6 -6",key:"svg-1"}],["path",{d:"M13 6l6 6",key:"svg-2"}]]),el("outline","arrow-up","ArrowUp",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M18 11l-6 -6",key:"svg-1"}],["path",{d:"M6 11l6 -6",key:"svg-2"}]]),el("outline","binary-tree","BinaryTree",[["path",{d:"M6 20a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z",key:"svg-0"}],["path",{d:"M16 4a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z",key:"svg-1"}],["path",{d:"M16 20a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z",key:"svg-2"}],["path",{d:"M11 12a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z",key:"svg-3"}],["path",{d:"M21 12a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z",key:"svg-4"}],["path",{d:"M5.058 18.306l2.88 -4.606",key:"svg-5"}],["path",{d:"M10.061 10.303l2.877 -4.604",key:"svg-6"}],["path",{d:"M10.065 13.705l2.876 4.6",key:"svg-7"}],["path",{d:"M15.063 5.7l2.881 4.61",key:"svg-8"}]]),el("outline","bleach-off","BleachOff",[["path",{d:"M5 19h14m1.986 -1.977a2 2 0 0 0 -.146 -.773l-7.1 -12.25a2 2 0 0 0 -3.5 0l-.815 1.405m-1.488 2.568l-4.797 8.277a2 2 0 0 0 1.75 2.75",key:"svg-0"}],["path",{d:"M3 3l18 18",key:"svg-1"}]]),el("outline","bleach","Bleach",[["path",{d:"M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75",key:"svg-0"}]]),el("outline","box-multiple","BoxMultiple",[["path",{d:"M7 3m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M17 17v2a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2v-10a2 2 0 0 1 2 -2h2",key:"svg-1"}]]),el("outline","brackets-contain","BracketsContain",[["path",{d:"M7 4h-4v16h4",key:"svg-0"}],["path",{d:"M17 4h4v16h-4",key:"svg-1"}],["path",{d:"M8 16h.01",key:"svg-2"}],["path",{d:"M12 16h.01",key:"svg-3"}],["path",{d:"M16 16h.01",key:"svg-4"}]]),el("outline","bucket-off","BucketOff",[["path",{d:"M5.029 5.036c-.655 .58 -1.029 1.25 -1.029 1.964c0 2.033 3.033 3.712 6.96 3.967m3.788 -.21c3.064 -.559 5.252 -2.029 5.252 -3.757c0 -2.21 -3.582 -4 -8 -4c-1.605 0 -3.1 .236 -4.352 .643",key:"svg-0"}],["path",{d:"M4 7c0 .664 .088 1.324 .263 1.965l2.737 10.035c.5 1.5 2.239 2 5 2s4.5 -.5 5 -2c.1 -.3 .252 -.812 .457 -1.535m.862 -3.146c.262 -.975 .735 -2.76 1.418 -5.354a7.45 7.45 0 0 0 .263 -1.965",key:"svg-1"}],["path",{d:"M3 3l18 18",key:"svg-2"}]]),el("outline","bucket","Bucket",[["path",{d:"M12 7m-8 0a8 4 0 1 0 16 0a8 4 0 1 0 -16 0",key:"svg-0"}],["path",{d:"M4 7c0 .664 .088 1.324 .263 1.965l2.737 10.035c.5 1.5 2.239 2 5 2s4.5 -.5 5 -2c.333 -1 1.246 -4.345 2.737 -10.035a7.45 7.45 0 0 0 .263 -1.965",key:"svg-1"}]]),el("outline","cake","Cake",[["path",{d:"M3 20h18v-8a3 3 0 0 0 -3 -3h-12a3 3 0 0 0 -3 3v8z",key:"svg-0"}],["path",{d:"M3 14.803c.312 .135 .654 .204 1 .197a2.4 2.4 0 0 0 2 -1a2.4 2.4 0 0 1 2 -1a2.4 2.4 0 0 1 2 1a2.4 2.4 0 0 0 2 1a2.4 2.4 0 0 0 2 -1a2.4 2.4 0 0 1 2 -1a2.4 2.4 0 0 1 2 1a2.4 2.4 0 0 0 2 1c.35 .007 .692 -.062 1 -.197",key:"svg-1"}],["path",{d:"M12 4l1.465 1.638a2 2 0 1 1 -3.015 .099l1.55 -1.737z",key:"svg-2"}]]),el("outline","calendar","Calendar",[["path",{d:"M4 7a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12z",key:"svg-0"}],["path",{d:"M16 3v4",key:"svg-1"}],["path",{d:"M8 3v4",key:"svg-2"}],["path",{d:"M4 11h16",key:"svg-3"}],["path",{d:"M11 15h1",key:"svg-4"}],["path",{d:"M12 15v3",key:"svg-5"}]]);var eu=el("outline","check","Check",[["path",{d:"M5 12l5 5l10 -10",key:"svg-0"}]]);el("outline","checkbox","Checkbox",[["path",{d:"M9 11l3 3l8 -8",key:"svg-0"}],["path",{d:"M20 12v6a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h9",key:"svg-1"}]]),el("outline","chevron-down","ChevronDown",[["path",{d:"M6 9l6 6l6 -6",key:"svg-0"}]]),el("outline","chevron-right","ChevronRight",[["path",{d:"M9 6l6 6l-6 6",key:"svg-0"}]]),el("outline","chevron-up","ChevronUp",[["path",{d:"M6 15l6 -6l6 6",key:"svg-0"}]]),el("outline","circle-minus","CircleMinus",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 12l6 0",key:"svg-1"}]]),el("outline","circle-plus","CirclePlus",[["path",{d:"M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0",key:"svg-0"}],["path",{d:"M9 12h6",key:"svg-1"}],["path",{d:"M12 9v6",key:"svg-2"}]]),el("outline","cloud-upload","CloudUpload",[["path",{d:"M7 18a4.6 4.4 0 0 1 0 -9a5 4.5 0 0 1 11 2h1a3.5 3.5 0 0 1 0 7h-1",key:"svg-0"}],["path",{d:"M9 15l3 -3l3 3",key:"svg-1"}],["path",{d:"M12 12l0 9",key:"svg-2"}]]),el("outline","columns","Columns",[["path",{d:"M4 6l5.5 0",key:"svg-0"}],["path",{d:"M4 10l5.5 0",key:"svg-1"}],["path",{d:"M4 14l5.5 0",key:"svg-2"}],["path",{d:"M4 18l5.5 0",key:"svg-3"}],["path",{d:"M14.5 6l5.5 0",key:"svg-4"}],["path",{d:"M14.5 10l5.5 0",key:"svg-5"}],["path",{d:"M14.5 14l5.5 0",key:"svg-6"}],["path",{d:"M14.5 18l5.5 0",key:"svg-7"}]]);var ed=el("outline","copy","Copy",[["path",{d:"M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z",key:"svg-0"}],["path",{d:"M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1",key:"svg-1"}]]);el("outline","currency-dollar","CurrencyDollar",[["path",{d:"M16.7 8a3 3 0 0 0 -2.7 -2h-4a3 3 0 0 0 0 6h4a3 3 0 0 1 0 6h-4a3 3 0 0 1 -2.7 -2",key:"svg-0"}],["path",{d:"M12 3v3m0 12v3",key:"svg-1"}]]),el("outline","dots","Dots",[["path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-0"}],["path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-1"}],["path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0",key:"svg-2"}]]),el("outline","edit","Edit",[["path",{d:"M7 7h-1a2 2 0 0 0 -2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2 -2v-1",key:"svg-0"}],["path",{d:"M20.385 6.585a2.1 2.1 0 0 0 -2.97 -2.97l-8.415 8.385v3h3l8.385 -8.415z",key:"svg-1"}],["path",{d:"M16 5l3 3",key:"svg-2"}]]),el("outline","empathize","Empathize",[["path",{d:"M12 5.5m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0 -5 0",key:"svg-0"}],["path",{d:"M12 21.368l5.095 -5.096a3.088 3.088 0 1 0 -4.367 -4.367l-.728 .727l-.728 -.727a3.088 3.088 0 1 0 -4.367 4.367l5.095 5.096z",key:"svg-1"}]]),el("outline","equal-not","EqualNot",[["path",{d:"M5 10h14",key:"svg-0"}],["path",{d:"M5 14h14",key:"svg-1"}],["path",{d:"M5 19l14 -14",key:"svg-2"}]]),el("outline","equal","Equal",[["path",{d:"M5 10h14",key:"svg-0"}],["path",{d:"M5 14h14",key:"svg-1"}]]);var ef=el("outline","eye-off","EyeOff",[["path",{d:"M10.585 10.587a2 2 0 0 0 2.829 2.828",key:"svg-0"}],["path",{d:"M16.681 16.673a8.717 8.717 0 0 1 -4.681 1.327c-3.6 0 -6.6 -2 -9 -6c1.272 -2.12 2.712 -3.678 4.32 -4.674m2.86 -1.146a9.055 9.055 0 0 1 1.82 -.18c3.6 0 6.6 2 9 6c-.666 1.11 -1.379 2.067 -2.138 2.87",key:"svg-1"}],["path",{d:"M3 3l18 18",key:"svg-2"}]]),eh=el("outline","eye","Eye",[["path",{d:"M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0",key:"svg-0"}],["path",{d:"M21 12c-2.4 4 -5.4 6 -9 6c-3.6 0 -6.6 -2 -9 -6c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6",key:"svg-1"}]]);el("outline","file-alert","FileAlert",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M12 17l.01 0",key:"svg-2"}],["path",{d:"M12 11l0 3",key:"svg-3"}]]),el("outline","file-plus","FilePlus",[["path",{d:"M14 3v4a1 1 0 0 0 1 1h4",key:"svg-0"}],["path",{d:"M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z",key:"svg-1"}],["path",{d:"M12 11l0 6",key:"svg-2"}],["path",{d:"M9 14l6 0",key:"svg-3"}]]),el("outline","filter","Filter",[["path",{d:"M4 4h16v2.172a2 2 0 0 1 -.586 1.414l-4.414 4.414v7l-6 2v-8.5l-4.48 -4.928a2 2 0 0 1 -.52 -1.345v-2.227z",key:"svg-0"}]]),el("outline","language","Language",[["path",{d:"M9 6.371c0 4.418 -2.239 6.629 -5 6.629",key:"svg-0"}],["path",{d:"M4 6.371h7",key:"svg-1"}],["path",{d:"M5 9c0 2.144 2.252 3.908 6 4",key:"svg-2"}],["path",{d:"M12 20l4 -9l4 9",key:"svg-3"}],["path",{d:"M19.1 18h-6.2",key:"svg-4"}],["path",{d:"M6.694 3l.793 .582",key:"svg-5"}]]),el("outline","logout","Logout",[["path",{d:"M14 8v-2a2 2 0 0 0 -2 -2h-7a2 2 0 0 0 -2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2 -2v-2",key:"svg-0"}],["path",{d:"M9 12h12l-3 -3",key:"svg-1"}],["path",{d:"M18 15l3 -3",key:"svg-2"}]]),el("outline","map-pin","MapPin",[["path",{d:"M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-0"}],["path",{d:"M17.657 16.657l-4.243 4.243a2 2 0 0 1 -2.827 0l-4.244 -4.243a8 8 0 1 1 11.314 0z",key:"svg-1"}]]),el("outline","math-greater","MathGreater",[["path",{d:"M5 18l14 -6l-14 -6",key:"svg-0"}]]),el("outline","math-lower","MathLower",[["path",{d:"M19 18l-14 -6l14 -6",key:"svg-0"}]]),el("outline","message","Message",[["path",{d:"M8 9h8",key:"svg-0"}],["path",{d:"M8 13h6",key:"svg-1"}],["path",{d:"M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z",key:"svg-2"}]]),el("outline","plus","Plus",[["path",{d:"M12 5l0 14",key:"svg-0"}],["path",{d:"M5 12l14 0",key:"svg-1"}]]),el("outline","refresh","Refresh",[["path",{d:"M20 11a8.1 8.1 0 0 0 -15.5 -2m-.5 -4v4h4",key:"svg-0"}],["path",{d:"M4 13a8.1 8.1 0 0 0 15.5 2m.5 4v-4h-4",key:"svg-1"}]]),el("outline","search","Search",[["path",{d:"M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0",key:"svg-0"}],["path",{d:"M21 21l-6 -6",key:"svg-1"}]]),el("outline","settings","Settings",[["path",{d:"M10.325 4.317c.426 -1.756 2.924 -1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543 -.94 3.31 .826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756 .426 1.756 2.924 0 3.35a1.724 1.724 0 0 0 -1.066 2.573c.94 1.543 -.826 3.31 -2.37 2.37a1.724 1.724 0 0 0 -2.572 1.065c-.426 1.756 -2.924 1.756 -3.35 0a1.724 1.724 0 0 0 -2.573 -1.066c-1.543 .94 -3.31 -.826 -2.37 -2.37a1.724 1.724 0 0 0 -1.065 -2.572c-1.756 -.426 -1.756 -2.924 0 -3.35a1.724 1.724 0 0 0 1.066 -2.573c-.94 -1.543 .826 -3.31 2.37 -2.37c1 .608 2.296 .07 2.572 -1.065z",key:"svg-0"}],["path",{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0 -6 0",key:"svg-1"}]]),el("outline","sort-ascending","SortAscending",[["path",{d:"M4 6l7 0",key:"svg-0"}],["path",{d:"M4 12l7 0",key:"svg-1"}],["path",{d:"M4 18l9 0",key:"svg-2"}],["path",{d:"M15 9l3 -3l3 3",key:"svg-3"}],["path",{d:"M18 6l0 12",key:"svg-4"}]]),el("outline","sort-descending","SortDescending",[["path",{d:"M4 6l9 0",key:"svg-0"}],["path",{d:"M4 12l7 0",key:"svg-1"}],["path",{d:"M4 18l7 0",key:"svg-2"}],["path",{d:"M15 15l3 3l3 -3",key:"svg-3"}],["path",{d:"M18 6l0 12",key:"svg-4"}]]),el("outline","square","Square",[["path",{d:"M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-0"}]]),el("outline","stethoscope","Stethoscope",[["path",{d:"M6 4h-1a2 2 0 0 0 -2 2v3.5h0a5.5 5.5 0 0 0 11 0v-3.5a2 2 0 0 0 -2 -2h-1",key:"svg-0"}],["path",{d:"M8 15a6 6 0 1 0 12 0v-3",key:"svg-1"}],["path",{d:"M11 3v2",key:"svg-2"}],["path",{d:"M6 3v2",key:"svg-3"}],["path",{d:"M20 10m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-4"}]]),el("outline","switch-horizontal","SwitchHorizontal",[["path",{d:"M16 3l4 4l-4 4",key:"svg-0"}],["path",{d:"M10 7l10 0",key:"svg-1"}],["path",{d:"M8 13l-4 4l4 4",key:"svg-2"}],["path",{d:"M4 17l9 0",key:"svg-3"}]]),el("outline","table-export","TableExport",[["path",{d:"M12.5 21h-7.5a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v7.5",key:"svg-0"}],["path",{d:"M3 10h18",key:"svg-1"}],["path",{d:"M10 3v18",key:"svg-2"}],["path",{d:"M16 19h6",key:"svg-3"}],["path",{d:"M19 16l3 3l-3 3",key:"svg-4"}]]),el("outline","trash","Trash",[["path",{d:"M4 7l16 0",key:"svg-0"}],["path",{d:"M10 11l0 6",key:"svg-1"}],["path",{d:"M14 11l0 6",key:"svg-2"}],["path",{d:"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12",key:"svg-3"}],["path",{d:"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3",key:"svg-4"}]]),el("outline","x","X",[["path",{d:"M18 6l-12 12",key:"svg-0"}],["path",{d:"M6 6l12 12",key:"svg-1"}]]),r.Component;var ep=function(){for(var e,t,n=0,r="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=function e(t){var n,r,i="";if("string"==typeof t||"number"==typeof t)i+=t;else if("object"==typeof t)if(Array.isArray(t)){var o=t.length;for(n=0;n<o;n++)t[n]&&(r=e(t[n]))&&(i&&(i+=" "),i+=r)}else for(r in t)t[r]&&(i&&(i+=" "),i+=r);return i}(e))&&(r&&(r+=" "),r+=t);return r};async function ey(e,t){return new Promise((n,r)=>{var i;let o=new MessageChannel;o.port1.onmessage=e=>{let{data:t}=e;o.port1.close(),t.error?r(t.error):n(t.result)},null==(i=e.contentWindow)||i.postMessage(t,new URL(e.src).origin,[o.port2])})}function em(e){let t=a().navigate,{to:n,suffix:r,label:s,onClick:l,children:c,...u}=e,d=function(e){if(e){var t,n,r;if("string"==typeof e){return(t=e).startsWith("http://")||t.startsWith("https://")||t.startsWith("/")?t:"/"+t}if((0,o.NCg)(e)){return n=e,"/".concat(n.resourceType,"/").concat(n.id)}if((0,o.A_h)(e)){return r=e,"/".concat(r.reference)}}return"#"}(n);return r&&(d+="/"+r),(0,i.jsx)(b.Anchor,{href:d,"aria-label":s,onAuxClick:e=>{e.stopPropagation()},onClick:e=>{e.stopPropagation(),l?(e.preventDefault(),l(e)):n&&(1===e.button||e.ctrlKey||e.metaKey||(e.preventDefault(),t(d)))},...u,children:c})}function eg(e){let t=e.value;return t?(0,i.jsx)(i.Fragment,{children:(0,o.EpQ)(t,e.options)}):null}var ev=(0,r.createContext)({submitting:!1});function ex(e){let[t,n]=(0,r.useState)(!1);return(0,i.jsx)(ev.Provider,{value:{submitting:t},children:(0,i.jsx)("form",{style:e.style,"data-testid":e.testid,onSubmit:t=>{t.preventDefault();let r=function(e){let t={};for(let o of Array.from(e.elements)){var n,r,i;o instanceof HTMLInputElement?(n=t,(r=o).disabled||("checkbox"===r.type||"radio"===r.type)&&!r.checked||(n[r.name]=r.value)):o instanceof HTMLTextAreaElement?t[o.name]=o.value:o instanceof HTMLSelectElement&&(t[(i=o).name]=i.value)}return t}(t.target);if(e.onSubmit){n(!0);let t=e.onSubmit(r);(null==t?void 0:t.then)?t.catch(console.error).finally(()=>{n(!1)}):n(!1)}},children:e.children})})}function eb(e){let{children:t,...n}=e,{submitting:o}=(0,r.useContext)(ev);return(0,i.jsx)(E.Button,{type:"submit",loading:o,...n,children:t})}function eE(e){let{url:t}=e,[n,s]=(0,r.useState)(!1),a=(0,r.useRef)(null),[l,c]=(0,r.useState)(),[u,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{t&&n&&a.current&&(ey(a.current,{command:"loadCcdaXml",value:t}).catch(console.error),s(!1))},[t,n]);let f=async()=>{if(t)try{d(!0);let e=await (await fetch(t)).text(),n=new FormData;n.append("ccdaFile",new Blob([e],{type:"text/xml"}),"ccda.xml");let r=await fetch("".concat("https://ccda-validator.medplum.com/","referenceccdaservice/?validationObjective=C-CDA_IG_Plus_Vocab&referenceFileName=No%20scenario%20File&curesUpdate=true&severityLevel=WARNING"),{method:"POST",body:n,credentials:"omit",redirect:"manual"});if(!r.ok)throw Error("Validation failed: ".concat(r.status," ").concat(r.statusText));let i=await r.json();c(i)}catch(e){c(void 0),console.error("CCDA validation error:",e)}finally{d(!1)}};return t?(0,i.jsxs)("div",{"data-testid":"ccda-iframe",style:{maxWidth:e.maxWidth},children:[(0,i.jsx)("div",{style:{minHeight:400},children:(0,i.jsx)("iframe",{title:"C-CDA Viewer",width:"100%",height:"400",ref:a,src:"https://ccda.medplum.com",allowFullScreen:!0,frameBorder:0,seamless:!0,onLoad:()=>s(!0)})}),(0,i.jsxs)("div",{style:{marginTop:"10px",marginBottom:"10px",display:"flex",alignItems:"center"},children:[(0,i.jsx)(E.Button,{type:"button",onClick:f,disabled:u,children:u?"Validating...":"Validate"}),l&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{style:{marginLeft:"15px"},children:[(0,i.jsx)("strong",{children:"Validation Results:"})," ",l?l.resultsMetaData.resultMetaData.filter(e=>null==e?void 0:e.type.includes("Error")).reduce((e,t)=>e+(t.count||0),0):0," errors found"]}),(0,i.jsx)(E.Button,{type:"button",onClick:()=>{let e,t,n,r;l&&(e=new Blob([JSON.stringify(l,null,2)],{type:o.cME.JSON}),t=URL.createObjectURL(e),(n=document.createElement("a")).href=t,r="ccda-validation-results",n.download="".concat(r,".json"),document.body.appendChild(n),n.click(),URL.revokeObjectURL(t))},color:"green",style:{marginLeft:"auto"},children:"Download Full Results"})]})]})]}):null}function eS(e){var t,n;let{contentType:r,url:s,title:a}=null!=(t=e.value)?t:{},l=p(s);return l?(0,i.jsxs)("div",{"data-testid":"attachment-display",children:[(null==r?void 0:r.startsWith("image/"))&&(0,i.jsx)("img",{"data-testid":"attachment-image",style:{maxWidth:e.maxWidth},src:l,alt:a}),(null==r?void 0:r.startsWith("video/"))&&(0,i.jsx)("video",{"data-testid":"attachment-video",style:{maxWidth:e.maxWidth},controls:!0,children:(0,i.jsx)("source",{type:r,src:l})}),((null==r?void 0:r.startsWith("text/"))||"application/json"===r||"application/pdf"===r)&&(0,i.jsx)("div",{"data-testid":"attachment-iframe",style:{maxWidth:e.maxWidth,minHeight:400},children:(0,i.jsx)("iframe",{title:"Attachment",width:"100%",height:"400",src:l+"#navpanes=0",allowFullScreen:!0,frameBorder:0,seamless:!0})}),r===o.cME.CDA_XML&&(0,i.jsx)(eE,{url:l}),(0,i.jsx)("div",{"data-testid":"download-link",style:{padding:"2px 16px 16px 16px"},children:(0,i.jsx)(b.Anchor,{href:s,"data-testid":"attachment-details",target:"_blank",rel:"noopener noreferrer",download:(null==(n=a)?void 0:n.includes("."))?n:void 0,children:a||"Download"})})]}):null}ev.displayName="FormContext";var ew={root:"DescriptionList_root",compact:"DescriptionList_compact"};function eT(e){let{children:t,compact:n}=e;return(0,i.jsx)("dl",{className:ep(ew.root,{[ew.compact]:n}),children:t})}function ek(e){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("dt",{children:e.term}),(0,i.jsx)("dd",{children:e.children})]})}function eC(e){var t;let n=null==(t=e.values)?void 0:t.map((t,n)=>(0,i.jsx)("div",{children:(0,i.jsx)(eS,{value:t,maxWidth:e.maxWidth})},"attatchment-"+n)),r;if(e.includeDescriptionListEntry){if(void 0===e.property)throw Error("props.property is required when includeDescriptionListEntry is true");if(!(0,o.dI)(e.path))throw Error("props.path is required when includeDescriptionListEntry is true");let t=e.path.split(".").pop();r=(0,i.jsx)(ek,{term:(0,o.hq1)(t),children:n})}else r=(0,i.jsx)(i.Fragment,{children:n});return r}function eA(e){var t;let n=(void 0).MEDPLUM_LOGO_URL;return n?(0,i.jsx)("img",{src:n,alt:"Logo",style:{maxHeight:e.size}}):(0,i.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 180 180",style:{width:e.size,height:e.size},children:[(0,i.jsx)("title",{children:"Medplum Logo"}),(0,i.jsx)("path",{fill:null!=(t=e.fill)?t:"#9c36b5",d:"M84 56c-3-15-15-24-23-28l5-10c8 2 14 8 20 14 0-12 1-16 5-21 8-9 13-9 41-9 0 7 1 18-3 24-7 9-16 7-41 8 5 8 7 14 8 22 36-24 74-7 74 39 0 42-40 83-80 83s-80-41-80-83c0-46 38-63 74-39Zm-3 43H65c-4 0-7 3-7 7v4c0 4 3 7 7 7h16v16c0 4 3 7 7 7h4c4 0 7-3 7-7v-16h16c4 0 7-3 7-7v-4c0-4-3-7-7-7H99V83c0-4-3-7-7-7h-4c-4 0-7 3-7 7z"})]})}function eP(e){let[t,n]=(0,r.useState)();return(0,i.jsx)(ex,{onSubmit:t=>{var r;n(void 0),null==(r=e.onSubmit(t))||r.catch(e=>n((0,o.zWg)(e)))},children:(0,i.jsxs)(S.Stack,{children:[(0,i.jsxs)(w.Center,{style:{flexDirection:"column"},children:[(0,i.jsx)(eA,{size:32}),(0,i.jsx)(T.Title,{children:e.title})]}),t&&(0,i.jsx)(v.Alert,{icon:(0,i.jsx)(ec,{size:16}),title:"Error",color:"red",children:t}),e.qrCodeUrl&&(0,i.jsxs)(S.Stack,{align:"center",children:[(0,i.jsx)(k.Text,{children:"Scan this QR code with your authenticator app."}),(0,i.jsx)("img",{src:e.qrCodeUrl,alt:"Multi Factor Auth QR Code"})]}),(0,i.jsx)(S.Stack,{children:(0,i.jsx)(C.TextInput,{name:"token",label:"MFA code",autoComplete:"one-time-code",required:!0,autoFocus:!0})}),(0,i.jsx)(A.Group,{justify:"flex-end",mt:"xl",children:(0,i.jsx)(eb,{children:e.buttonText})})]})})}var eR={root:"Container_root"};function e_(e){let{children:t,...n}=e;return(0,i.jsx)(P.Container,{className:eR.root,...n,children:t})}var ej={paper:"Panel_paper",fill:"Panel_fill"};function eD(e){let{width:t,fill:n,className:r,children:o,...s}=e;return(0,i.jsx)(R.Paper,{className:ep(ej.paper,n&&ej.fill,r),style:t?{maxWidth:t}:void 0,shadow:"sm",radius:"sm",withBorder:!0,...s,children:o})}function eM(e){let{children:t,...n}=e;return(0,i.jsx)(e_,{children:(0,i.jsx)(eD,{...n,children:t})})}function eL(e,t){var n,r,i;return null==e||null==(i=e.issue)||null==(r=i.filter(e=>{var n;return eO(null==(n=e.expression)?void 0:n[0],t)}))||null==(n=r.map(e=>{var t;return null==(t=e.details)?void 0:t.text}))?void 0:n.join("\n")}function eU(e,t){var n;return null==e||null==(n=e.issue)?void 0:n.filter(e=>{var n;return eO(null==(n=e.expression)?void 0:n[0],t)})}var eI=/\[\d+\]/;function eO(e,t){if(("string"==typeof e&&eI.test(e))!==("string"==typeof t&&eI.test(t))&&(e=null==e?void 0:e.replace(eI,""),t=null==t?void 0:t.replace(eI,"")),e===t)return!0;if(!e||!t)return!1;let n=e.indexOf(".");if(n>=0&&e.substring(n+1)===t)return!0;let r=t.indexOf(".");return r>=0&&t.substring(r+1)===e}function eN(e){let t=l(),[n,s]=(0,r.useState)();return(0,i.jsxs)(ex,{onSubmit:async n=>{try{e.handleAuthResponse(await t.startNewProject({login:e.login,projectName:n.projectName}))}catch(e){s((0,o.ZrK)(e))}},children:[(0,i.jsxs)(w.Center,{style:{flexDirection:"column"},children:[(0,i.jsx)(eA,{size:32}),(0,i.jsx)(T.Title,{children:"Create project"})]}),(0,i.jsxs)(S.Stack,{gap:"xl",children:[(0,i.jsx)(C.TextInput,{name:"projectName",label:"Project Name",placeholder:"My Project",required:!0,autoFocus:!0,error:eL(n,"projectName")}),(0,i.jsxs)(k.Text,{c:"dimmed",size:"xs",children:["By clicking submit you agree to the Medplum"," ",(0,i.jsx)(b.Anchor,{href:"https://www.medplum.com/privacy",children:"Privacy\xa0Policy"})," and ",(0,i.jsx)(b.Anchor,{href:"https://www.medplum.com/terms",children:"Terms\xa0of\xa0Service"}),"."]})]}),(0,i.jsx)(A.Group,{justify:"flex-end",mt:"xl",wrap:"nowrap",children:(0,i.jsx)(eb,{children:"Create project"})})]})}function eq(e){let t=l(),{googleClientId:n,handleGoogleCredential:o}=e,s=(0,r.useRef)(null),[a,c]=(0,r.useState)("u">typeof google),[u,d]=(0,r.useState)(!1),[f,h]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(typeof google>"u"){var e;let t,n;return void(e=()=>c(!0),t=document.getElementsByTagName("head")[0],(n=document.createElement("script")).async=!0,n.src="https://accounts.google.com/gsi/client",n.onload=null!=e?e:null,t.appendChild(n))}u||(google.accounts.id.initialize({client_id:n,callback:o}),d(!0)),s.current&&!f&&(google.accounts.id.renderButton(s.current,{}),h(!0))},[t,n,u,a,s,f,o]),n?(0,i.jsx)("div",{ref:s}):null}function eB(e){var t;let n=(null==(t=e.outcome)?void 0:t.issue)||e.issues;return n&&0!==n.length?(0,i.jsx)(v.Alert,{icon:(0,i.jsx)(ec,{size:16}),color:"red",children:n.map(e=>{var t;return(0,i.jsx)("div",{"data-testid":"text-field-error",children:(0,o.hMM)(e)},null==(t=e.details)?void 0:t.text)})}):null}var eF={userNotice:"AuthenticationForm_userNotice"};function eW(e){let[t,n]=(0,r.useState)();return t?(0,i.jsx)(eH,{email:t,resetEmail:()=>n(void 0),...e}):(0,i.jsx)(eQ,{setEmail:n,...e})}function eQ(e){let{setEmail:t,onRegister:n,handleAuthResponse:s,children:a,disableEmailAuth:c,...u}=e,d=l(),f=!e.disableGoogleAuth&&function(e){var t;if(e)return e;let n=o.DA.getOrigin();if(n&&(null!==(t="undefined".split(","))&&void 0!==t?t:[]).includes(n))return"undefined"}(e.googleClientId),[h,p]=(0,r.useState)(),y=eU(h,void 0),m=(0,r.useCallback)(async e=>{if(!e.authorizeUrl)return!1;let t=JSON.stringify({...await d.ensureCodeChallenge(u),domain:e.domain}),n=new URL(e.authorizeUrl);return n.searchParams.set("state",t),o.DA.assign(n.toString()),!0},[d,u]),g=(0,r.useCallback)(async e=>{let n=await d.post("auth/method",{email:e.email});await m(n)||t(e.email)},[d,m,t]),v=(0,r.useCallback)(async e=>{try{let t=await d.startGoogleLogin({...u,googleCredential:e.credential});await m(t)||s(t)}catch(e){p((0,o.ZrK)(e))}},[d,u,m,s]);return(0,i.jsxs)(ex,{onSubmit:g,children:[(0,i.jsx)(w.Center,{style:{flexDirection:"column"},children:a}),(0,i.jsx)(eB,{issues:y}),f&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(A.Group,{justify:"center",p:"xl",style:{height:70},children:(0,i.jsx)(eq,{googleClientId:f,handleGoogleCredential:v})}),!c&&(0,i.jsx)(j.Divider,{label:"or",labelPosition:"center",my:"lg"})]}),!c&&(0,i.jsx)(C.TextInput,{name:"email",type:"email",label:"Email",placeholder:"name@domain.com",required:!0,autoFocus:!0,error:eL(h,"email"),"data-testid":"auth.email"}),(0,i.jsxs)(A.Group,{justify:"space-between",mt:"xl",gap:0,wrap:"nowrap",children:[(0,i.jsx)("div",{children:n&&(0,i.jsx)(b.Anchor,{component:"button",type:"button",c:"dimmed",onClick:n,size:"xs","data-dashlane-ignore":"true","data-lp-ignore":"true","data-no-autofill":"true","data-form-type":"navigation",children:"Register"})}),!c&&(0,i.jsx)(eb,{children:"Next"})]})]})}function eH(e){let{onForgotPassword:t,handleAuthResponse:n,children:s,...a}=e,c=l(),[u,d]=(0,r.useState)(),f=eU(u,void 0),h=(0,r.useCallback)(e=>{c.startLogin({...a,password:e.password,remember:"on"===e.remember}).then(n).catch(e=>d((0,o.ZrK)(e)))},[c,a,n]);return(0,i.jsxs)(ex,{onSubmit:h,children:[(0,i.jsx)(w.Center,{style:{flexDirection:"column"},children:s}),(0,i.jsx)(eB,{issues:f}),(0,i.jsxs)(S.Stack,{gap:"sm",children:[(0,i.jsx)(D.PasswordInput,{name:"password",label:"Password",autoComplete:"off",required:!0,autoFocus:!0,error:eL(u,"password"),"data-testid":"auth.password"}),(0,i.jsxs)(M.Flex,{className:eF.userNotice,justify:"space-between",align:"center",px:"xs",bdrs:"sm",children:[(0,i.jsxs)(k.Text,{size:"xs",children:["Logging in as ",(0,i.jsx)("em",{children:e.email})]}),(0,i.jsx)(E.Button,{variant:"transparent",onClick:e.resetEmail,size:"compact-xs",children:"Change"})]})]}),(0,i.jsxs)(A.Group,{justify:"space-between",mt:"xl",gap:0,wrap:"nowrap",children:[t&&(0,i.jsx)(b.Anchor,{component:"button",type:"button",c:"dimmed",onClick:t,size:"xs",children:"Forgot password"}),(0,i.jsx)(L.Checkbox,{id:"remember",name:"remember",label:"Remember me",size:"xs",style:{lineHeight:1}}),(0,i.jsx)(eb,{children:"Sign in"})]})]})}function ez(e){let t=l(),n=(0,U.useCombobox)(),[s,a]=(0,r.useState)(""),[c,u]=(0,r.useState)();function d(e){var t;return!!(null==e||null==(t=e.toLowerCase())?void 0:t.includes(s.toLowerCase()))}let f=e.memberships.filter(function(e){var t,n;return d(null==(t=e.profile)?void 0:t.display)||d(null==(n=e.project)?void 0:n.display)}).slice(0,10).map(e=>(0,i.jsx)(I.Combobox.Option,{value:e.id,children:(0,i.jsx)(eX,{...e})},e.id));return(0,i.jsxs)(S.Stack,{children:[(0,i.jsxs)(M.Flex,{gap:"md",mb:"md",justify:"center",align:"center",direction:"column",wrap:"nowrap",children:[(0,i.jsx)(eA,{size:32}),(0,i.jsx)(T.Title,{order:3,children:"Choose profile"})]}),(0,i.jsx)(eB,{outcome:c}),(0,i.jsxs)(I.Combobox,{store:n,onOptionSubmit:function(n){t.post("auth/profile",{login:e.login,profile:n}).then(e.handleAuthResponse).catch(e=>u((0,o.ZrK)(e)))},children:[(0,i.jsx)(I.Combobox.EventsTarget,{children:(0,i.jsx)(C.TextInput,{placeholder:"Search",value:s,onChange:e=>{a(e.currentTarget.value),n.updateSelectedOptionIndex()}})}),(0,i.jsx)("div",{children:(0,i.jsx)(I.Combobox.Options,{children:f.length>0?f:(0,i.jsx)(I.Combobox.Empty,{children:"Nothing found..."})})})]})]})}function eX(e){var t,n,r,o;let s=null==(o=e.identifier)||null==(r=o.find(e=>"https://medplum.com/identifier/label"===e.system))?void 0:r.value;return(0,i.jsxs)(A.Group,{children:[(0,i.jsx)(x.Avatar,{radius:"xl"}),(0,i.jsxs)("div",{children:[(0,i.jsx)(k.Text,{fz:"sm",fw:500,children:null==(t=e.profile)?void 0:t.display}),(0,i.jsxs)(k.Text,{fz:"xs",opacity:.6,children:[null==(n=e.project)?void 0:n.display," ",s?" - ".concat(s):""]})]})]})}var eG=/^patient\/Condition\.(?:\*|c?r?u?d?s?)$/,eV=/^patient\/Observation\.(?:\*|c?r?u?d?s?)$/;function eK(e){var t;let n=l();return(0,i.jsx)(ex,{onSubmit:t=>{n.post("auth/scope",{login:e.login,scope:Object.keys(t).join(" ")}).then(e.handleAuthResponse).catch(console.log)},children:(0,i.jsxs)(S.Stack,{children:[(0,i.jsxs)(w.Center,{style:{flexDirection:"column"},children:[(0,i.jsx)(eA,{size:32}),(0,i.jsx)(T.Title,{children:"Choose scope"})]}),(0,i.jsx)(S.Stack,{children:(null!=(t=e.scope)?t:"openid").split(" ").map(e=>{let t;return eG.test(e)?t=[e+"?category=http://terminology.hl7.org/CodeSystem/condition-category|encounter-diagnosis",e+"?category=http://terminology.hl7.org/CodeSystem/condition-category|problem-list-item",e+"?category=http://hl7.org/fhir/us/core/CodeSystem/condition-category|health-concern"]:eV.test(e)&&(t=[e+"?category=http://hl7.org/fhir/us/core/CodeSystem/us-core-observation-category|clinical-test",e+"?category=http://terminology.hl7.org/CodeSystem/observation-category|laboratory",e+"?category=http://terminology.hl7.org/CodeSystem/observation-category|social-history",e+"?category=http://hl7.org/fhir/us/core/CodeSystem/us-core-category|sdoh",e+"?category=http://terminology.hl7.org/CodeSystem/observation-category|survey",e+"?category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs"]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(L.Checkbox,{id:e,name:e,label:e,defaultChecked:!0},e),null==t?void 0:t.map(e=>(0,i.jsx)(L.Checkbox,{id:e,name:e,label:e},e))]},e+"_group")})}),(0,i.jsx)(A.Group,{justify:"flex-end",mt:"xl",children:(0,i.jsx)(eb,{children:"Set scope"})})]})})}function eJ(e){let{login:t,chooseScopes:n,onSuccess:s,onForgotPassword:a,onRegister:c,onCode:u,...d}=e,f=l(),[h,p]=(0,r.useState)(),y=(0,r.useRef)(!1),[m,g]=(0,r.useState)(!1),[v,x]=(0,r.useState)(),[b,E]=(0,r.useState)(!1),[S,w]=(0,r.useState)(),T=(0,r.useCallback)(e=>{u?u(e):f.processCode(e).then(()=>{s&&s()}).catch(e=>(0,_.Ds)({color:"red",message:(0,o.zWg)(e)}))},[f,u,s]),k=(0,r.useCallback)(e=>{g(!!e.mfaEnrollRequired),x(e.enrollQrCode),E(!!e.mfaRequired),e.login&&p(e.login),e.memberships&&w(e.memberships),e.code&&(n?w(void 0):T(e.code))},[n,T]),C=(0,r.useCallback)(e=>{T(e.code)},[T]);return(0,r.useEffect)(()=>{!t||y.current||h||(y.current=!0,f.get("auth/login/"+t).then(k).catch(e=>(0,_.Ds)({color:"red",message:(0,o.zWg)(e)})))},[f,t,y,h,k]),(0,i.jsx)(eM,{width:450,px:"sm",py:"md",children:h?m&&v?(0,i.jsx)(eP,{title:"Enroll in MFA",buttonText:"Enroll",qrCodeUrl:v,onSubmit:async e=>{k(await f.post("auth/mfa/login-enroll",{login:h,token:e.token}))}}):b?(0,i.jsx)(eP,{title:"Enter MFA code",buttonText:"Submit code",onSubmit:async e=>{k(await f.post("auth/mfa/verify",{login:h,token:e.token}))}}):S?(0,i.jsx)(ez,{login:h,memberships:S,handleAuthResponse:k}):"new"===e.projectId?(0,i.jsx)(eN,{login:h,handleAuthResponse:k}):e.chooseScopes?(0,i.jsx)(eK,{login:h,scope:e.scope,handleAuthResponse:C}):(0,i.jsx)("div",{children:"Success"}):(0,i.jsx)(eW,{onForgotPassword:a,onRegister:c,handleAuthResponse:k,disableGoogleAuth:e.disableGoogleAuth,disableEmailAuth:e.disableEmailAuth,...d,children:e.children})})}function e$(e){return(0,i.jsx)(i.Fragment,{children:(0,o.PDW)(e.value)})}function eZ(e){return(0,i.jsx)(i.Fragment,{children:(0,o.amN)(e.value)})}function eY(e){let t=e.value;if(!t)return null;let n=[];return t.value&&n.push(t.value),(t.use||t.system)&&(n.push(" ["),t.use&&n.push(t.use),t.use&&t.system&&n.push(" "),t.system&&n.push(t.system),n.push("]")),(0,i.jsx)(i.Fragment,{children:n.join("").trim()})}function e0(e){var t;let n=e.value;return n?(0,i.jsxs)(i.Fragment,{children:[n.name,n.name&&": ",null==(t=n.telecom)?void 0:t.map(e=>(0,i.jsx)(eY,{value:e},"telecom-".concat(n.name,"-").concat(e.value)))]}):null}function e1(e,t,n){let r=(0,o.Jsh)(e,t,{profileUrl:n});return r?Array.isArray(r)?[r.map(e=>e.value),r[0].type]:[r.value,r.type]:[void 0,"undefined"]}function e2(e){var t;let{elementDefinitionType:n}=e,s=l(),a=(0,r.useContext)(eo),[c,u]=(0,r.useState)((0,o.h1O)("Extension")),d=(0,r.useMemo)(()=>{if((0,o.dI)(null==n?void 0:n.profile))return n.profile[0]},[n]),[f,h]=(0,r.useState)(void 0!==d);if((0,r.useEffect)(()=>{d&&(h(!0),s.requestProfileSchema(d).then(()=>{let e=(0,o.nKc)(d);h(!1),e&&u(e)}).catch(e=>{h(!1),console.warn(e)}))},[s,d]),d&&(f||!(0,o.hHN)(d)))return(0,i.jsx)("div",{children:"Loading..."});if((null==(t=c.elements["value[x]"])?void 0:t.max)!==0){let[t,n]=e1({type:"Extension",value:e.value},"value[x]",null!=d?d:a.profileUrl);return(0,i.jsx)(tr,{propertyType:n,value:t})}return(0,i.jsx)(ta,{path:e.path,value:{type:c.type,value:e.value},compact:e.compact,ignoreMissingValues:e.ignoreMissingValues,link:e.link,profileUrl:d})}function e4(e){var t,n;return(0,i.jsxs)("div",{children:[null==(t=e.value)?void 0:t.system,": ",null==(n=e.value)?void 0:n.value]})}function e3(e){return(0,i.jsx)(i.Fragment,{children:(0,o.upu)(e.value)})}function e6(e){return(0,i.jsx)(i.Fragment,{children:(0,o.VZ2)(e.value)})}function e7(e){return(0,i.jsx)(i.Fragment,{children:(0,o.LuA)(e.value)})}function e5(e){let t=e.value;return t?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e6,{value:t.numerator}),"\xa0/\xa0",(0,i.jsx)(e6,{value:t.denominator})]}):null}function e8(e){if(!e.value)return null;let t=e.value.display||e.value.reference||(0,o.AsM)(e.value);return!1!==e.link&&e.value.reference?(0,i.jsx)(em,{to:e.value,children:t}):(0,i.jsx)(i.Fragment,{children:t})}async function e9(e){let{medplum:t,property:n}=e;return new Promise((e,r)=>{if(!n.slicing)return void e([]);let i=[],s=[],a=[];for(let e of n.slicing.slices){var l,c;let n;if(!(0,o.NmV)(e)){console.debug("Unsupported slice definition",e);continue}(0,o.dI)(e.elements)||(n=null==(c=e.type[0])||null==(l=c.profile)?void 0:l[0]),i.push(e),s.push(n),n&&a.push(t.requestProfileSchema(n))}Promise.all(a).then(()=>{for(let e=0;e<i.length;e++){let t=i[e],n=s[e];n&&(t.typeSchema=(0,o.nKc)(n))}e(i)}).catch(r)})}function te(e,t,n){return void 0!==t?(0,i.jsx)(e,{value:t,children:n}):n}function tt(e){var t,n,s;let{slice:a,property:l}=e,c=null!=(s=null==(t=a.typeSchema)?void 0:t.elements)?s:a.elements,u=(0,r.useContext)(eo),d=(0,r.useMemo)(()=>{var t;if((0,o.dI)(c))return(0,o.bbl)({parentContext:u,elements:c,path:e.path,profileUrl:null==(t=a.typeSchema)?void 0:t.url})},[u,e.path,null==(n=a.typeSchema)?void 0:n.url,c]);return te(eo.Provider,d,(0,i.jsx)(i.Fragment,{children:e.value.map((t,n)=>(0,i.jsx)("div",{children:(0,i.jsx)(tr,{property:l,path:e.path,arrayElement:!0,elementDefinitionType:a.type[0],propertyType:a.type[0].code,value:t,ignoreMissingValues:e.ignoreMissingValues,link:e.link})},"".concat(n,"-").concat(e.value.length)))}))}function tn(e){var t;let n,{property:s,propertyType:a}=e,c=l(),u=(0,r.useMemo)(()=>Array.isArray(e.values)?e.values:[],[e.values]),[d,f]=(0,r.useState)(!0),[h,p]=(0,r.useState)([]),[y,m]=(0,r.useState)(()=>[u]),[g,v]=(0,r.useState)(0),x=(0,r.useContext)(eo);if((0,r.useEffect)(()=>{e9({medplum:c,property:s}).then(e=>{v(u.length),p(e),m(function(e,t,n,r){if(!(0,o.dI)(null==n?void 0:n.slices))return[e];let i=Array(t.length+1);for(let e=0;e<i.length;e++)i[e]=[];for(let s of e){let e=(0,o.ZcR)(s,t,n.discriminator,r),a=e?t.findIndex(t=>t.name===e):-1;-1===a&&(a=t.length),i[a].push(s)}return i}(u.slice(0,50),e,s.slicing,x.profileUrl)),f(!1)}).catch(e=>{console.error(e),f(!1)})},[c,s,x.profileUrl,m,u]),d)return(0,i.jsx)("div",{children:"Loading..."});if((null==(t=s.type[0])?void 0:t.code)!=="Extension"){let t=y[h.length],r=t.map((n,r)=>(0,i.jsx)("div",{children:(0,i.jsx)(tr,{path:e.path,arrayElement:!0,property:s,propertyType:a,value:n,ignoreMissingValues:e.ignoreMissingValues,link:e.link})},"".concat(r,"-").concat(t.length)));if(e.includeDescriptionListEntry){if(!(0,o.dI)(e.path))throw Error("props.path is required when includeDescriptionListEntry is true");let t=e.path.split(".").pop();n=(0,i.jsx)(ek,{term:(0,o.hq1)(t),children:r})}else n=(0,i.jsx)(i.Fragment,{children:r})}return(0,i.jsxs)(i.Fragment,{children:[h.map((t,n)=>{if(!e.path)throw Error("Displaying a resource property with slices of type ".concat(e.propertyType," requires path"));let r=(0,i.jsx)(tt,{path:e.path,slice:t,property:s,value:y[n],ignoreMissingValues:e.ignoreMissingValues,link:e.link},t.name);return e.includeDescriptionListEntry&&(r=(0,i.jsx)(ek,{term:(0,o.hq1)(t.name),children:r},t.name)),r}),n,g>50&&(0,i.jsx)(A.Group,{justify:"right",children:(0,i.jsxs)(k.Text,{children:["... ",g," total values"]})})]})}function tr(e){var t,n,r;let{property:s,propertyType:a,value:l}=e;if(null==s||null==(t=s.path)?void 0:t.endsWith(".id"))return(0,i.jsxs)(M.Flex,{gap:3,align:"center",children:[l,!(0,o.Ime)(l)&&(0,i.jsx)(O.CopyButton,{value:l,timeout:2e3,children:e=>{let{copied:t,copy:n}=e;return(0,i.jsx)(N.Tooltip,{label:t?"Copied":"Copy",withArrow:!0,position:"right",children:(0,i.jsx)(q.ActionIcon,{variant:"subtle",color:t?"teal":"gray",onClick:n,children:t?(0,i.jsx)(eu,{size:"1rem"}):(0,i.jsx)(ed,{size:"1rem"})})})}})]});if(s&&(s.isArray||s.max>1)&&!e.arrayElement)return a===o.UtL.Attachment?(0,i.jsx)(eC,{values:l,maxWidth:e.maxWidth,includeDescriptionListEntry:e.includeArrayDescriptionListEntry,property:s,path:e.path}):(0,i.jsx)(tn,{path:e.path,property:s,propertyType:a,values:l,includeDescriptionListEntry:e.includeArrayDescriptionListEntry,ignoreMissingValues:e.ignoreMissingValues,link:e.link});switch(a){case o.UtL.boolean:return(0,i.jsx)(i.Fragment,{children:void 0===l?"":(!!l).toString()});case o.UtL.SystemString:case o.UtL.string:return(null==(r=e.property)||null==(n=r.path)?void 0:n.toLowerCase().includes("secret"))?(0,i.jsx)(ti,{value:l}):(0,i.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:l});case o.UtL.code:case o.UtL.date:case o.UtL.decimal:case o.UtL.id:case o.UtL.integer:case o.UtL.positiveInt:case o.UtL.unsignedInt:case o.UtL.uri:case o.UtL.url:return(0,i.jsx)(i.Fragment,{children:l});case o.UtL.canonical:return(0,i.jsx)(e8,{value:{reference:l},link:e.link});case o.UtL.dateTime:case o.UtL.instant:return(0,i.jsx)(i.Fragment,{children:(0,o.r69)(l)});case o.UtL.markdown:return(0,i.jsx)("pre",{children:l});case o.UtL.Address:return(0,i.jsx)(en,{value:l});case o.UtL.Annotation:return(0,i.jsx)(i.Fragment,{children:null==l?void 0:l.text});case o.UtL.Attachment:return(0,i.jsx)(eS,{value:l,maxWidth:e.maxWidth});case o.UtL.CodeableConcept:return(0,i.jsx)(e$,{value:l});case o.UtL.Coding:return(0,i.jsx)(eZ,{value:l});case o.UtL.ContactDetail:return(0,i.jsx)(e0,{value:l});case o.UtL.ContactPoint:return(0,i.jsx)(eY,{value:l});case o.UtL.HumanName:return(0,i.jsx)(eg,{value:l});case o.UtL.Identifier:return(0,i.jsx)(e4,{value:l});case o.UtL.Money:return(0,i.jsx)(e3,{value:l});case o.UtL.Period:return(0,i.jsx)(i.Fragment,{children:(0,o.dH3)(l)});case o.UtL.Quantity:case o.UtL.Duration:return(0,i.jsx)(e6,{value:l});case o.UtL.Range:return(0,i.jsx)(e7,{value:l});case o.UtL.Ratio:return(0,i.jsx)(e5,{value:l});case o.UtL.Reference:return(0,i.jsx)(e8,{value:l,link:e.link});case o.UtL.Timing:return(0,i.jsx)(i.Fragment,{children:(0,o.iwe)(l)});case o.UtL.Dosage:case o.UtL.UsageContext:if(!e.path)throw Error("Displaying property of type ".concat(e.propertyType," requires path"));return(0,i.jsx)(ta,{path:e.path,value:{type:a,value:l},compact:!0,ignoreMissingValues:e.ignoreMissingValues});case o.UtL.Extension:if(!e.path)throw Error("Displaying property of type ".concat(e.propertyType," requires path"));return(0,i.jsx)(e2,{path:e.path,value:l,compact:!0,ignoreMissingValues:e.ignoreMissingValues,elementDefinitionType:e.elementDefinitionType});default:if(!s)throw Error("Displaying property of type ".concat(e.propertyType," requires element schema"));if(!e.path)throw Error("Displaying property of type ".concat(e.propertyType," requires path"));return(0,i.jsx)(ta,{path:e.path,value:{type:s.type[0].code,value:l},compact:!0,ignoreMissingValues:e.ignoreMissingValues})}}function ti(e){var t;let[n,s]=(0,r.useState)(!1),a=null!=(t=e.value)?t:"",l=!(0,o.Ime)(a),c="".repeat(8);return(0,i.jsxs)(M.Flex,{gap:3,align:"center",children:[n?(0,i.jsx)("div",{style:{whiteSpace:"pre-wrap"},children:a}):(0,i.jsx)("div",{style:{whiteSpace:"pre-wrap"},"aria-hidden":"true",children:l?c:""}),l&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(O.CopyButton,{value:e.value,timeout:2e3,children:e=>{let{copied:t,copy:n}=e;return(0,i.jsx)(N.Tooltip,{label:t?"Copied":"Copy secret",withArrow:!0,position:"right",children:(0,i.jsx)(q.ActionIcon,{variant:"subtle",color:t?"teal":"gray",onClick:n,"aria-label":t?"Copied":"Copy secret",children:t?(0,i.jsx)(eu,{size:"1rem"}):(0,i.jsx)(ed,{size:"1rem"})})})}}),(0,i.jsx)(N.Tooltip,{label:n?"Hide secret":"Show secret",withArrow:!0,position:"right",children:(0,i.jsx)(q.ActionIcon,{variant:"subtle",color:"gray",onClick:()=>s(!n),"aria-label":n?"Hide secret":"Show secret",children:n?(0,i.jsx)(ef,{size:"1rem"}):(0,i.jsx)(eh,{size:"1rem"})})})]})]})}var to=["extension","modifierExtension"],ts=er.filter(e=>!to.includes(e));function ta(e){var t;let n=e.value,{value:s,type:a}=n,l=(0,r.useContext)(eo),c=null!=(t=e.profileUrl)?t:null==l?void 0:l.profileUrl,u=(0,r.useMemo)(()=>(0,o.kg4)(a,c),[c,a]),d=(0,r.useMemo)(()=>{if(u)return(0,o.bbl)({parentContext:l,elements:u.elements,path:e.path,profileUrl:u.url,accessPolicyResource:e.accessPolicyResource})},[u,l,e.path,e.accessPolicyResource]);if((0,o.Ime)(s))return null;if(!u)return(0,i.jsxs)("div",{children:[a,"\xa0not implemented"]});if("object"==typeof s&&"name"in s&&1===Object.keys(s).length&&"string"==typeof s.name)return(0,i.jsx)("div",{children:s.name});let f=null!=d?d:l;return te(eo.Provider,d,(0,i.jsx)(eT,{compact:e.compact,children:Object.entries(f.elements).map(t=>{var r;let[s,a]=t;if(to.includes(s)&&(0,o.Ime)(null==(r=a.slicing)?void 0:r.slices)||ts.includes(s)||ei.includes(s)&&2===a.path.split(".").length||s.includes("."))return null;let[l,c]=e1(n,s,f.profileUrl);if((e.ignoreMissingValues||0===a.max)&&(0,o.Ime)(l)||e.path.endsWith(".extension")&&("url"===s||"id"===s))return null;let u=a.max>1||a.isArray,d=(0,i.jsx)(tr,{property:a,propertyType:c,path:e.path+"."+s,value:l,ignoreMissingValues:e.ignoreMissingValues,includeArrayDescriptionListEntry:u,link:e.link},s);return u?d:(0,i.jsx)(ek,{term:(0,o.hq1)(s),children:d},s)})}))}o.ypx;function tl(e){let{profileUrl:t}=e,n=l(),s=n.getAccessPolicy(),a=y(e.value),[c,u]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(a)if(t)n.requestProfileSchema(t,{expandProfile:!0}).then(()=>{(0,o.nKc)(t)?u(!0):console.error("Schema not found for ".concat(t))}).catch(e=>{console.error("Error in requestProfileSchema",e)});else{let e=a.resourceType;n.requestSchema(e).then(()=>{u(!0)}).catch(console.error)}},[n,t,a]);let d=(0,r.useMemo)(()=>a&&(0,o.df0)(a,o.f_l.READ,s),[s,a]);return c&&a?(0,i.jsx)(ta,{path:a.resourceType,value:{type:a.resourceType,value:e.forceUseInput?e.value:a},profileUrl:t,ignoreMissingValues:e.ignoreMissingValues,accessPolicyResource:d}):null}((e,t,n)=>(n=null!=e?H(V(e)):{},((e,t,n,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of G(t))K.call(e,i)||i===n||z(e,i,{get:()=>t[i],enumerable:!(r=X(t,i))||r.enumerable})})(!t&&e&&e.__esModule?n:z(n,"default",{value:e,enumerable:!0}),e)))(et(),1),o.XPK.EQUALS,o.XPK.NOT,o.XPK.CONTAINS,o.XPK.EXACT,o.XPK.EQUALS,o.XPK.NOT,o.XPK.CONTAINS,o.XPK.EXACT,o.XPK.EQUALS,o.XPK.NOT,o.XPK.EQUALS,o.XPK.NOT,o.XPK.EQUALS,o.XPK.NOT_EQUALS,o.XPK.GREATER_THAN,o.XPK.LESS_THAN,o.XPK.GREATER_THAN_OR_EQUALS,o.XPK.LESS_THAN_OR_EQUALS,o.XPK.EQUALS,o.XPK.NOT_EQUALS,o.XPK.GREATER_THAN,o.XPK.LESS_THAN,o.XPK.GREATER_THAN_OR_EQUALS,o.XPK.LESS_THAN_OR_EQUALS,o.XPK.EQUALS,o.XPK.NOT_EQUALS,o.XPK.GREATER_THAN,o.XPK.LESS_THAN,o.XPK.GREATER_THAN_OR_EQUALS,o.XPK.LESS_THAN_OR_EQUALS,o.XPK.STARTS_AFTER,o.XPK.ENDS_BEFORE,o.XPK.APPROXIMATELY,o.XPK.EQUALS,o.XPK.NOT_EQUALS,o.XPK.GREATER_THAN,o.XPK.LESS_THAN,o.XPK.GREATER_THAN_OR_EQUALS,o.XPK.LESS_THAN_OR_EQUALS,o.XPK.STARTS_AFTER,o.XPK.ENDS_BEFORE,o.XPK.APPROXIMATELY,o.XPK.EQUALS,o.XPK.NOT,o.XPK.ABOVE,o.XPK.BELOW,Event,Event,Event;var tc={root:"InfoBar_root",entry:"InfoBar_entry",key:"InfoBar_key",value:"InfoBar_value"};function tu(e){return(0,i.jsx)(Q.ScrollArea,{children:(0,i.jsx)("div",{className:tc.root,children:e.children})})}tu.Entry=function(e){return(0,i.jsx)("div",{className:tc.entry,children:e.children})},tu.Key=function(e){return(0,i.jsx)("div",{className:tc.key,children:e.children})},tu.Value=function(e){return(0,i.jsx)("div",{className:tc.value,children:e.children})},o.cME.FHIR_JSON,o.cME.FHIR_JSON,o.cME.CDA_XML,o.cME.CDA_XML,o.ypx,o.Od0,o.Pzm,o.Pzm,o.Pzm},64806:(e,t,n)=>{n.d(t,{AEw:()=>ev,A_h:()=>e6,AsM:()=>eE,DA:()=>t0,EpQ:()=>eO,HQo:()=>S,Ime:()=>eS,Jsh:()=>J,LuA:()=>ez,M0D:()=>eI,NCg:()=>e3,NmV:()=>nj,Od0:()=>p,PDW:()=>eV,Pzm:()=>f,SQA:()=>nk,UtL:()=>eZ,VZ2:()=>eX,XPK:()=>tF,ZcR:()=>nD,ZrK:()=>T,amN:()=>eK,bbl:()=>nR,c2A:()=>eT,cME:()=>t3,dH3:()=>eB,dI:()=>ew,df0:()=>tY,f_l:()=>t$,h1O:()=>I,hHN:()=>O,hMM:()=>A,hq1:()=>e1,iPK:()=>eg,iwe:()=>eH,kg4:()=>U,nKc:()=>N,p8P:()=>function e(t){if(!t)return"";let n=[];if(t.valueQuantity)n.push(eX(t.valueQuantity));else if(t.valueCodeableConcept)n.push(eV(t.valueCodeableConcept));else{let e=eJ(t.valueString);e&&n.push(e)}return"component"in t&&n.push(t.component.map(t=>e(t)).join(" / ")),n.join(" / ").trim()},r69:()=>eq,upu:()=>eG,ypx:()=>h,zWg:()=>k});var r,i=n(60996).hp,o=Object.defineProperty,s=(e,t,n)=>((e,t,n)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n)(e,"symbol"!=typeof t?t+"":t,n),a=class{toString(){return"".concat(this.operator,"(").concat(this.child.toString(),")")}constructor(e,t){s(this,"operator"),s(this,"child"),this.operator=e,this.child=t}},l=class{toString(){return"(".concat(this.left.toString()," ").concat(this.operator," ").concat(this.right.toString(),")")}constructor(e,t,n){s(this,"operator"),s(this,"left"),s(this,"right"),this.operator=e,this.left=t,this.right=n}},c=class{registerInfix(e,t){return this.infixParselets[e]=t,this}registerPrefix(e,t){return this.prefixParselets[e]=t,this}prefix(e,t,n){return this.registerPrefix(e,{parse:(e,r)=>n(r,e.consumeAndParse(t))})}infixLeft(e,t,n){return this.registerInfix(e,{parse:(e,r,i)=>n(r,i,e.consumeAndParse(t)),precedence:t})}construct(e){return new u(e,this.prefixParselets,this.infixParselets)}constructor(){s(this,"prefixParselets",{}),s(this,"infixParselets",{})}},u=class{hasMore(){return this.tokens.length>0}match(e){var t;return(null==(t=this.peek())?void 0:t.id)===e&&(this.consume(),!0)}consumeAndParse(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,t=this.consume(),n=this.prefixParselets[t.id];if(!n)throw Error('Parse error at "'.concat(t.value,'" (line ').concat(t.line,", column ").concat(t.column,"). No matching prefix parselet."));let r=n.parse(this,t);for(;e>this.getPrecedence();){let e=this.consume();r=this.getInfixParselet(e).parse(this,r,e)}return r}getPrecedence(){let e=this.peek();if(!e)return 1/0;let t=this.getInfixParselet(e);return t?t.precedence:1/0}consume(e,t){var n,r;if(!this.tokens.length)throw Error("Cant consume unknown more tokens.");if(e&&(null==(n=this.peek())?void 0:n.id)!==e){let t=this.peek();throw Error("Expected ".concat(e,' but got "').concat(t.id,'" (').concat(t.value,") at line ").concat(t.line," column ").concat(t.column,"."))}if(t&&(null==(r=this.peek())?void 0:r.value)!==t){let e=this.peek();throw Error('Expected "'.concat(t,'" but got "').concat(e.value,'" at line ').concat(e.line," column ").concat(e.column,"."))}return this.tokens.shift()}peek(){return this.tokens.length>0?this.tokens[0]:void 0}removeComments(){this.tokens=this.tokens.filter(e=>"Comment"!==e.id)}getInfixParselet(e){return this.infixParselets["Symbol"===e.id?e.value:e.id]}constructor(e,t,n){s(this,"tokens"),s(this,"prefixParselets"),s(this,"infixParselets"),this.tokens=e,this.prefixParselets=t,this.infixParselets=n}},d=class{clear(){this.cache.clear()}get(e){let t=this.cache.get(e);return t&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size>=this.max&&this.cache.delete(this.first()),this.cache.set(e,t)}delete(e){this.cache.delete(e)}keys(){return this.cache.keys()}first(){return this.cache.keys().next().value}constructor(e=10){s(this,"max"),s(this,"cache"),this.max=e,this.cache=new Map}},f="http://snomed.info/sct",h="http://hl7.org",p="http://terminology.hl7.org",y={resourceType:"OperationOutcome",id:"not-found",issue:[{severity:"error",code:"not-found",details:{text:"Not found"}}]},m={resourceType:"OperationOutcome",id:"unauthorized",issue:[{severity:"error",code:"login",details:{text:"Unauthorized"}}]},g={...m,issue:[...m.issue,{severity:"error",code:"expired",details:{text:"Token expired"}}]},v={...m,issue:[...m.issue,{severity:"error",code:"invalid",details:{text:"Token not issued for this audience"}}]};function x(e,t){return{resourceType:"OperationOutcome",issue:[{severity:"error",code:"invalid",details:{text:e},...t?{expression:[t]}:void 0}]}}function b(e){return{resourceType:"OperationOutcome",issue:[{severity:"error",code:"structure",details:{text:e}}]}}function E(e){return"object"==typeof e&&null!==e&&"OperationOutcome"===e.resourceType}function S(e){return"ok"===e.id||"created"===e.id||"not-modified"===e.id||"accepted"===e.id}var w=class e extends Error{constructor(t,n){super(C(t),n),s(this,"outcome"),Object.setPrototypeOf(this,e.prototype),this.name=this.constructor.name,this.outcome=t,Error.captureStackTrace(this,this.constructor)}};function T(e){return e instanceof w?e.outcome:E(e)?e:x(k(e))}function k(e){return e?"string"==typeof e?e:e&&"object"==typeof e&&(e instanceof Error||"u">typeof DOMException&&e instanceof DOMException||"[object Error]"===Object.prototype.toString.call(e))?e.message:E(e)?C(e):"object"==typeof e&&"code"in e&&"string"==typeof e.code?e.code:JSON.stringify(e):"Unknown error"}function C(e){var t,n;let r=null!=(n=null==(t=e.issue)?void 0:t.map(A))?n:[];return r.length>0?r.join("; "):"Unknown error"}function A(e){var t,n;let r;return r=(null==(t=e.details)?void 0:t.text)?e.diagnostics?"".concat(e.details.text," (").concat(e.diagnostics,")"):e.details.text:e.diagnostics?e.diagnostics:"Unknown error",(null==(n=e.expression)?void 0:n.length)&&(r+=" (".concat(e.expression.join(", "),")")),r}var P=function(e){let t=Object.create(null);for(let[n,r]of Object.entries(e))t[n]={name:n,type:n,path:n,elements:Object.fromEntries(Object.entries(r.elements).map(e=>{let[t,n]=e;return[t,function(e,t){var n,r;let i=t.max&&t.max===Number.MAX_SAFE_INTEGER?1/0:t.max;return{path:e,description:"",type:null!=(n=t.type)?n:[],min:null!=(r=t.min)?r:0,max:null!=i?i:1,isArray:!!i&&i>1,constraints:[]}}(t,n)]})),constraints:[],innerTypes:[]};return t}({Element:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]}}},BackboneElement:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]}}},Address:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},use:{type:[{code:"code"}]},type:{type:[{code:"code"}]},text:{type:[{code:"string"}]},line:{max:0x1fffffffffffff,type:[{code:"string"}]},city:{type:[{code:"string"}]},district:{type:[{code:"string"}]},state:{type:[{code:"string"}]},postalCode:{type:[{code:"string"}]},country:{type:[{code:"string"}]},period:{type:[{code:"Period"}]}}},Age:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},Annotation:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},"author[x]":{type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Practitioner","http://hl7.org/fhir/StructureDefinition/Patient","http://hl7.org/fhir/StructureDefinition/RelatedPerson","http://hl7.org/fhir/StructureDefinition/Organization"]},{code:"string"}]},time:{type:[{code:"dateTime"}]},text:{min:1,type:[{code:"markdown"}]}}},Attachment:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},contentType:{type:[{code:"code"}]},language:{type:[{code:"code"}]},data:{type:[{code:"base64Binary"}]},url:{type:[{code:"url"}]},size:{type:[{code:"unsignedInt"}]},hash:{type:[{code:"base64Binary"}]},title:{type:[{code:"string"}]},creation:{type:[{code:"dateTime"}]}}},CodeableConcept:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},coding:{max:0x1fffffffffffff,type:[{code:"Coding"}]},text:{type:[{code:"string"}]}}},Coding:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},system:{type:[{code:"uri"}]},version:{type:[{code:"string"}]},code:{type:[{code:"code"}]},display:{type:[{code:"string"}]},userSelected:{type:[{code:"boolean"}]}}},ContactDetail:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},name:{type:[{code:"string"}]},telecom:{max:0x1fffffffffffff,type:[{code:"ContactPoint"}]}}},ContactPoint:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},system:{type:[{code:"code"}]},value:{type:[{code:"string"}]},use:{type:[{code:"code"}]},rank:{type:[{code:"positiveInt"}]},period:{type:[{code:"Period"}]}}},Contributor:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},name:{min:1,type:[{code:"string"}]},contact:{max:0x1fffffffffffff,type:[{code:"ContactDetail"}]}}},Count:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},DataRequirement:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},profile:{max:0x1fffffffffffff,type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]},"subject[x]":{type:[{code:"CodeableConcept"},{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Group"]}]},mustSupport:{max:0x1fffffffffffff,type:[{code:"string"}]},codeFilter:{max:0x1fffffffffffff,type:[{code:"DataRequirementCodeFilter"}]},dateFilter:{max:0x1fffffffffffff,type:[{code:"DataRequirementDateFilter"}]},limit:{type:[{code:"positiveInt"}]},sort:{max:0x1fffffffffffff,type:[{code:"DataRequirementSort"}]}}},DataRequirementCodeFilter:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},path:{type:[{code:"string"}]},searchParam:{type:[{code:"string"}]},valueSet:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/ValueSet"]}]},code:{max:0x1fffffffffffff,type:[{code:"Coding"}]}}},DataRequirementDateFilter:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},path:{type:[{code:"string"}]},searchParam:{type:[{code:"string"}]},"value[x]":{type:[{code:"dateTime"},{code:"Period"},{code:"Duration"}]}}},DataRequirementSort:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},path:{min:1,type:[{code:"string"}]},direction:{min:1,type:[{code:"code"}]}}},Distance:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},Dosage:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},sequence:{type:[{code:"integer"}]},text:{type:[{code:"string"}]},additionalInstruction:{max:0x1fffffffffffff,type:[{code:"CodeableConcept"}]},patientInstruction:{type:[{code:"string"}]},timing:{type:[{code:"Timing"}]},"asNeeded[x]":{type:[{code:"boolean"},{code:"CodeableConcept"}]},site:{type:[{code:"CodeableConcept"}]},route:{type:[{code:"CodeableConcept"}]},method:{type:[{code:"CodeableConcept"}]},doseAndRate:{max:0x1fffffffffffff,type:[{code:"DosageDoseAndRate"}]},maxDosePerPeriod:{type:[{code:"Ratio"}]},maxDosePerAdministration:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},maxDosePerLifetime:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]}}},DosageDoseAndRate:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{type:[{code:"CodeableConcept"}]},"dose[x]":{type:[{code:"Range"},{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},"rate[x]":{type:[{code:"Ratio"},{code:"Range"},{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]}}},Duration:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},ElementDefinition:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},path:{min:1,type:[{code:"string"}]},representation:{max:0x1fffffffffffff,type:[{code:"code"}]},sliceName:{type:[{code:"string"}]},sliceIsConstraining:{type:[{code:"boolean"}]},label:{type:[{code:"string"}]},code:{max:0x1fffffffffffff,type:[{code:"Coding"}]},slicing:{type:[{code:"ElementDefinitionSlicing"}]},short:{type:[{code:"string"}]},definition:{type:[{code:"markdown"}]},comment:{type:[{code:"markdown"}]},requirements:{type:[{code:"markdown"}]},alias:{max:0x1fffffffffffff,type:[{code:"string"}]},min:{type:[{code:"unsignedInt"}]},max:{type:[{code:"string"}]},base:{type:[{code:"ElementDefinitionBase"}]},contentReference:{type:[{code:"uri"}]},type:{max:0x1fffffffffffff,type:[{code:"ElementDefinitionType"}]},"defaultValue[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]},meaningWhenMissing:{type:[{code:"markdown"}]},orderMeaning:{type:[{code:"string"}]},"fixed[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]},"pattern[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]},example:{max:0x1fffffffffffff,type:[{code:"ElementDefinitionExample"}]},"minValue[x]":{type:[{code:"date"},{code:"dateTime"},{code:"instant"},{code:"time"},{code:"decimal"},{code:"integer"},{code:"positiveInt"},{code:"unsignedInt"},{code:"Quantity"}]},"maxValue[x]":{type:[{code:"date"},{code:"dateTime"},{code:"instant"},{code:"time"},{code:"decimal"},{code:"integer"},{code:"positiveInt"},{code:"unsignedInt"},{code:"Quantity"}]},maxLength:{type:[{code:"integer"}]},condition:{max:0x1fffffffffffff,type:[{code:"id"}]},constraint:{max:0x1fffffffffffff,type:[{code:"ElementDefinitionConstraint"}]},mustSupport:{type:[{code:"boolean"}]},isModifier:{type:[{code:"boolean"}]},isModifierReason:{type:[{code:"string"}]},isSummary:{type:[{code:"boolean"}]},binding:{type:[{code:"ElementDefinitionBinding"}]},mapping:{max:0x1fffffffffffff,type:[{code:"ElementDefinitionMapping"}]}}},ElementDefinitionSlicingDiscriminator:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},path:{min:1,type:[{code:"string"}]}}},ElementDefinitionSlicing:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},discriminator:{max:0x1fffffffffffff,type:[{code:"ElementDefinitionSlicingDiscriminator"}]},description:{type:[{code:"string"}]},ordered:{type:[{code:"boolean"}]},rules:{min:1,type:[{code:"code"}]}}},ElementDefinitionBase:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},path:{min:1,type:[{code:"string"}]},min:{min:1,type:[{code:"unsignedInt"}]},max:{min:1,type:[{code:"string"}]}}},ElementDefinitionType:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},code:{min:1,type:[{code:"uri"}]},profile:{max:0x1fffffffffffff,type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition","http://hl7.org/fhir/StructureDefinition/ImplementationGuide"]}]},targetProfile:{max:0x1fffffffffffff,type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition","http://hl7.org/fhir/StructureDefinition/ImplementationGuide"]}]},aggregation:{max:0x1fffffffffffff,type:[{code:"code"}]},versioning:{type:[{code:"code"}]}}},ElementDefinitionExample:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},label:{min:1,type:[{code:"string"}]},"value[x]":{min:1,type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]}}},ElementDefinitionConstraint:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},key:{min:1,type:[{code:"id"}]},requirements:{type:[{code:"string"}]},severity:{min:1,type:[{code:"code"}]},human:{min:1,type:[{code:"string"}]},expression:{type:[{code:"string"}]},xpath:{type:[{code:"string"}]},source:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]}}},ElementDefinitionBinding:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},strength:{min:1,type:[{code:"code"}]},description:{type:[{code:"string"}]},valueSet:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/ValueSet"]}]}}},ElementDefinitionMapping:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},identity:{min:1,type:[{code:"id"}]},language:{type:[{code:"code"}]},map:{min:1,type:[{code:"string"}]},comment:{type:[{code:"string"}]}}},Expression:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},description:{type:[{code:"string"}]},name:{type:[{code:"id"}]},language:{min:1,type:[{code:"code"}]},expression:{type:[{code:"string"}]},reference:{type:[{code:"uri"}]}}},Extension:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},url:{min:1,type:[{code:"uri"}]},"value[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]}}},HumanName:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},use:{type:[{code:"code"}]},text:{type:[{code:"string"}]},family:{type:[{code:"string"}]},given:{max:0x1fffffffffffff,type:[{code:"string"}]},prefix:{max:0x1fffffffffffff,type:[{code:"string"}]},suffix:{max:0x1fffffffffffff,type:[{code:"string"}]},period:{type:[{code:"Period"}]}}},Identifier:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},use:{type:[{code:"code"}]},type:{type:[{code:"CodeableConcept"}]},system:{type:[{code:"uri"}]},value:{type:[{code:"string"}]},period:{type:[{code:"Period"}]},assigner:{type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Organization"]}]}}},MarketingStatus:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},country:{min:1,type:[{code:"CodeableConcept"}]},jurisdiction:{type:[{code:"CodeableConcept"}]},status:{min:1,type:[{code:"CodeableConcept"}]},dateRange:{min:1,type:[{code:"Period"}]},restoreDate:{type:[{code:"dateTime"}]}}},Meta:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},versionId:{type:[{code:"id"}]},lastUpdated:{type:[{code:"instant"}]},source:{type:[{code:"uri"}]},profile:{max:0x1fffffffffffff,type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]},security:{max:0x1fffffffffffff,type:[{code:"Coding"}]},tag:{max:0x1fffffffffffff,type:[{code:"Coding"}]},project:{type:[{code:"uri"}]},author:{type:[{code:"Reference"}]},onBehalfOf:{type:[{code:"Reference"}]},account:{type:[{code:"Reference"}]},accounts:{max:0x1fffffffffffff,type:[{code:"Reference"}]},compartment:{max:0x1fffffffffffff,type:[{code:"Reference"}]}}},Money:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},currency:{type:[{code:"code"}]}}},Narrative:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},status:{min:1,type:[{code:"code"}]},div:{min:1,type:[{code:"xhtml"}]}}},ParameterDefinition:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},name:{type:[{code:"code"}]},use:{min:1,type:[{code:"code"}]},min:{type:[{code:"integer"}]},max:{type:[{code:"string"}]},documentation:{type:[{code:"string"}]},type:{min:1,type:[{code:"code"}]},profile:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]}}},Period:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},start:{type:[{code:"dateTime"}]},end:{type:[{code:"dateTime"}]}}},Population:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},"age[x]":{type:[{code:"Range"},{code:"CodeableConcept"}]},gender:{type:[{code:"CodeableConcept"}]},race:{type:[{code:"CodeableConcept"}]},physiologicalCondition:{type:[{code:"CodeableConcept"}]}}},ProdCharacteristic:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},height:{type:[{code:"Quantity"}]},width:{type:[{code:"Quantity"}]},depth:{type:[{code:"Quantity"}]},weight:{type:[{code:"Quantity"}]},nominalVolume:{type:[{code:"Quantity"}]},externalDiameter:{type:[{code:"Quantity"}]},shape:{type:[{code:"string"}]},color:{max:0x1fffffffffffff,type:[{code:"string"}]},imprint:{max:0x1fffffffffffff,type:[{code:"string"}]},image:{max:0x1fffffffffffff,type:[{code:"Attachment"}]},scoring:{type:[{code:"CodeableConcept"}]}}},ProductShelfLife:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},identifier:{type:[{code:"Identifier"}]},type:{min:1,type:[{code:"CodeableConcept"}]},period:{min:1,type:[{code:"Quantity"}]},specialPrecautionsForStorage:{max:0x1fffffffffffff,type:[{code:"CodeableConcept"}]}}},Quantity:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},Range:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},low:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},high:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]}}},Ratio:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},numerator:{type:[{code:"Quantity"}]},denominator:{type:[{code:"Quantity"}]}}},Reference:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},reference:{type:[{code:"string"}]},type:{type:[{code:"uri"}]},identifier:{type:[{code:"Identifier"}]},display:{type:[{code:"string"}]}}},RelatedArtifact:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},label:{type:[{code:"string"}]},display:{type:[{code:"string"}]},citation:{type:[{code:"markdown"}]},url:{type:[{code:"url"}]},document:{type:[{code:"Attachment"}]},resource:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/Resource"]}]}}},SampledData:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},origin:{min:1,type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},period:{min:1,type:[{code:"decimal"}]},factor:{type:[{code:"decimal"}]},lowerLimit:{type:[{code:"decimal"}]},upperLimit:{type:[{code:"decimal"}]},dimensions:{min:1,type:[{code:"positiveInt"}]},data:{type:[{code:"string"}]}}},Signature:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,max:0x1fffffffffffff,type:[{code:"Coding"}]},when:{min:1,type:[{code:"instant"}]},who:{min:1,type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Practitioner","http://hl7.org/fhir/StructureDefinition/PractitionerRole","http://hl7.org/fhir/StructureDefinition/RelatedPerson","http://hl7.org/fhir/StructureDefinition/Patient","http://hl7.org/fhir/StructureDefinition/Device","http://hl7.org/fhir/StructureDefinition/Organization"]}]},onBehalfOf:{type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Practitioner","http://hl7.org/fhir/StructureDefinition/PractitionerRole","http://hl7.org/fhir/StructureDefinition/RelatedPerson","http://hl7.org/fhir/StructureDefinition/Patient","http://hl7.org/fhir/StructureDefinition/Device","http://hl7.org/fhir/StructureDefinition/Organization"]}]},targetFormat:{type:[{code:"code"}]},sigFormat:{type:[{code:"code"}]},data:{type:[{code:"base64Binary"}]}}},SubstanceAmount:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},"amount[x]":{type:[{code:"Quantity"},{code:"Range"},{code:"string"}]},amountType:{type:[{code:"CodeableConcept"}]},amountText:{type:[{code:"string"}]},referenceRange:{type:[{code:"SubstanceAmountReferenceRange"}]}}},SubstanceAmountReferenceRange:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},lowLimit:{type:[{code:"Quantity"}]},highLimit:{type:[{code:"Quantity"}]}}},Timing:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},event:{max:0x1fffffffffffff,type:[{code:"dateTime"}]},repeat:{type:[{code:"TimingRepeat"}]},code:{type:[{code:"CodeableConcept"}]}}},TimingRepeat:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},"bounds[x]":{type:[{code:"Duration"},{code:"Range"},{code:"Period"}]},count:{type:[{code:"positiveInt"}]},countMax:{type:[{code:"positiveInt"}]},duration:{type:[{code:"decimal"}]},durationMax:{type:[{code:"decimal"}]},durationUnit:{type:[{code:"code"}]},frequency:{type:[{code:"positiveInt"}]},frequencyMax:{type:[{code:"positiveInt"}]},period:{type:[{code:"decimal"}]},periodMax:{type:[{code:"decimal"}]},periodUnit:{type:[{code:"code"}]},dayOfWeek:{max:0x1fffffffffffff,type:[{code:"code"}]},timeOfDay:{max:0x1fffffffffffff,type:[{code:"time"}]},when:{max:0x1fffffffffffff,type:[{code:"code"}]},offset:{type:[{code:"unsignedInt"}]}}},TriggerDefinition:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},name:{type:[{code:"string"}]},"timing[x]":{type:[{code:"Timing"},{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Schedule"]},{code:"date"},{code:"dateTime"}]},data:{max:0x1fffffffffffff,type:[{code:"DataRequirement"}]},condition:{type:[{code:"Expression"}]}}},UsageContext:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},code:{min:1,type:[{code:"Coding"}]},"value[x]":{min:1,type:[{code:"CodeableConcept"},{code:"Quantity"},{code:"Range"},{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/PlanDefinition","http://hl7.org/fhir/StructureDefinition/ResearchStudy","http://hl7.org/fhir/StructureDefinition/InsurancePlan","http://hl7.org/fhir/StructureDefinition/HealthcareService","http://hl7.org/fhir/StructureDefinition/Group","http://hl7.org/fhir/StructureDefinition/Location","http://hl7.org/fhir/StructureDefinition/Organization"]}]}}},MoneyQuantity:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},SimpleQuantity:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{max:0,type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},IdentityProvider:{elements:{authorizeUrl:{min:1,type:[{code:"string"}]},tokenUrl:{min:1,type:[{code:"string"}]},tokenAuthMethod:{type:[{code:"code"}]},userInfoUrl:{min:1,type:[{code:"string"}]},clientId:{min:1,type:[{code:"string"}]},clientSecret:{min:1,type:[{code:"string"}]},usePkce:{type:[{code:"boolean"}]},useSubject:{type:[{code:"boolean"}]}}}}),R=Object.create(null),_=Object.create(null),j={"http://hl7.org/fhir/StructureDefinition/MoneyQuantity":"MoneyQuantity","http://hl7.org/fhir/StructureDefinition/SimpleQuantity":"SimpleQuantity","http://hl7.org/fhir/uv/sql-on-fhir/StructureDefinition/ViewDefinition":"ViewDefinition"};function D(e){let t;return(t=_[e])||(t=_[e]=Object.create(null)),t}function M(e){var t,n;let r=(Array.isArray(e)?e:null!=(n=null==(t=e.entry)?void 0:t.map(e=>e.resource))?n:[]).filter(e=>(null==e?void 0:e.resourceType)==="StructureDefinition");for(let e of(function(e){var t,n;for(let r of Array.isArray(e)?e:null!=(n=null==(t=e.entry)?void 0:t.map(e=>e.resource))?n:[])(null==r?void 0:r.resourceType)==="StructureDefinition"&&"resource"===r.kind&&eY(r.type)}(r),r))L(e)}function L(e){var t,n;if(!(null==e?void 0:e.name))throw Error("Failed loading StructureDefinition from bundle");if("StructureDefinition"!==e.resourceType)return;let r=new q(e).parse(),i=j[e.url],o,s;for(let a of(i?(o=P,s=i):(o=e.url==="http://hl7.org/fhir/StructureDefinition/".concat(e.type)||e.url==="https://medplum.com/fhir/StructureDefinition/".concat(e.type)||(null==(t=e.type)?void 0:t.startsWith("http://"))||(null==(n=e.type)?void 0:n.startsWith("https://"))?P:D(e.url),s=e.type),o[s]=r,r.innerTypes))a.parentType=r,o[a.name]=a;R[e.url]=r}function U(e,t){if(t){let n=D(t)[e];if(n)return n}return P[e]}function I(e,t){let n=U(e,t);if(!n)throw new w(x("Unknown data type: "+e));return n}function O(e){return!!R[e]}function N(e){return R[e]}var q=class{parse(){let e=this.next();for(;e;){var t,n,r,i,o;if(e.sliceName)this.parseSliceStart(e);else if(null==(t=e.id)?void 0:t.includes(":")){if(null==(n=this.slicingContext)?void 0:n.current){let t=F(e,this.slicingContext.path);this.slicingContext.current.elements[t]=this.parseElementDefinition(e)}}else{let t=this.parseElementDefinition(e);this.checkFieldEnter(e,t);let n=this.backboneContext;for(;n;){if(null==(r=e.path)?void 0:r.startsWith(n.path+".")){n.type.elements[F(e,n.path)]=t;break}n=n.parent}if(!n){let n=F(e,this.root.path);e.isSummary&&(null==(i=this.resourceSchema.summaryProperties)||i.add(n.replace("[x]",""))),t.min>0&&(null==(o=this.resourceSchema.mandatoryProperties)||o.add(n.replace("[x]",""))),this.resourceSchema.elements[n]=t}this.checkFieldExit(e)}e=this.next()}return this.checkFieldExit(),this.innerTypes.length>0&&(this.resourceSchema.innerTypes=this.innerTypes),this.resourceSchema}checkFieldEnter(e,t){this.isInnerType(e)&&this.enterInnerType(e),this.slicingContext&&!W(this.slicingContext.path,null==e?void 0:e.path)&&(this.slicingContext=void 0),e.slicing&&!this.slicingContext&&this.enterSlice(e,t)}enterInnerType(e){for(var t,n,r;this.backboneContext&&!W(null==(t=this.backboneContext)?void 0:t.path,e.path);)this.innerTypes.push(this.backboneContext.type),this.backboneContext=this.backboneContext.parent;let i=e0(e);this.backboneContext={type:{name:i,type:i,path:e.path,title:e.label,description:e.definition,elements:{},constraints:this.parseElementDefinition(e).constraints,innerTypes:[]},path:e.path,parent:W(null==(n=this.backboneContext)?void 0:n.path,e.path)?this.backboneContext:null==(r=this.backboneContext)?void 0:r.parent}}enterSlice(e,t){var n,r,i,o,s,a,l,c,u,d;let f;f=null==(u=(c=e).slicing)?void 0:u.discriminator,((null==(d=c.type)?!void 0:!d.some(e=>"Extension"===e.code))||(null==f?void 0:f.length)!==1||"value"!==f[0].type||"url"!==f[0].path||(null==(n=this.peek())?void 0:n.sliceName))&&(t.slicing={discriminator:(null!=(s=null==(r=e.slicing)?void 0:r.discriminator)?s:[]).map(e=>{if("value"!==e.type&&"pattern"!==e.type&&"type"!==e.type)throw Error("Unsupported slicing discriminator type: ".concat(e.type));return{path:e.path,type:e.type}}),slices:[],ordered:null!=(a=null==(i=e.slicing)?void 0:i.ordered)&&a,rule:null==(o=e.slicing)?void 0:o.rules},this.slicingContext={field:t.slicing,path:null!=(l=e.path)?l:""})}checkFieldExit(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this.backboneContext&&!W(this.backboneContext.path,null==e?void 0:e.path))if(this.backboneContext.parent)do this.innerTypes.push(this.backboneContext.type),this.backboneContext=this.backboneContext.parent;while(this.backboneContext&&!W(this.backboneContext.path,null==e?void 0:e.path));else this.innerTypes.push(this.backboneContext.type),this.backboneContext=void 0}next(){let e=this.peek();if(e)return this.index++,e}peek(){let e=this.elements[this.index];if(e){var t,n,r,i,o,s,a,l,c,u,d,f,h;if(this.elementIndex[null!=(t=e.path)?t:""]=e,e.contentReference){let t=e.contentReference.slice(e.contentReference.indexOf("#")+1),p=this.elementIndex[t];return p?{...p,id:e.id,path:e.path,min:null!=(a=e.min)?a:p.min,max:null!=(l=e.max)?l:p.max,base:{path:null!=(c=null==(n=p.base)?void 0:n.path)?c:t,min:null!=(d=null!=(u=null==(r=e.base)?void 0:r.min)?u:null==(i=p.base)?void 0:i.min)?d:p.min,max:null!=(h=null!=(f=null==(o=e.base)?void 0:o.max)?f:null==(s=p.base)?void 0:s.max)?h:p.max},contentReference:e.contentReference,definition:e.definition}:void 0}return e}}isInnerType(e){var t;let n=this.peek();return!!(W(null==e?void 0:e.path,null==n?void 0:n.path)&&(null==(t=e.type)?void 0:t.some(e=>["BackboneElement","Element"].includes(e.code))))}parseSliceStart(e){var t;if(!this.slicingContext)throw Error("Invalid slice start before discriminator: ".concat(e.sliceName," (").concat(e.id,")"));this.slicingContext.current={...this.parseElementDefinition(e),name:null!=(t=e.sliceName)?t:"",definition:e.definition,elements:{}},this.slicingContext.field.slices.push(this.slicingContext.current)}parseElementDefinitionType(e){var t;return(null!=(t=e.type)?t:[]).map(t=>{var n,r;let i;return("BackboneElement"===t.code||"Element"===t.code)&&(i=e0(e)),i||(i=null==(n=eb(t,"http://hl7.org/fhir/StructureDefinition/structuredefinition-fhir-type"))?void 0:n.valueUrl),i||(i=null!=(r=t.code)?r:""),{code:i,targetProfile:t.targetProfile,profile:t.profile}})}parseElementDefinition(e){var t,n,r,i;let o=B(e.max),s=(null==(t=e.base)?void 0:t.max)?B(e.base.max):o,a={type:"ElementDefinition",value:e};return{description:e.definition||"",path:e.path||(null==(n=e.base)?void 0:n.path)||"",min:null!=(r=e.min)?r:0,max:o,isArray:s>1,constraints:(null!=(i=e.constraint)?i:[]).map(e=>{var t,n,r,i;return{key:null!=(t=e.key)?t:"",severity:null!=(n=e.severity)?n:"error",expression:null!=(r=e.expression)?r:"",description:null!=(i=e.human)?i:""}}),type:this.parseElementDefinitionType(e),fixed:Q(J(a,"fixed[x]")),pattern:Q(J(a,"pattern[x]")),binding:e.binding}}constructor(e){var t;if(s(this,"root"),s(this,"elements"),s(this,"elementIndex"),s(this,"index"),s(this,"resourceSchema"),s(this,"slicingContext"),s(this,"innerTypes"),s(this,"backboneContext"),!(null==(t=e.snapshot)?void 0:t.element)||0===e.snapshot.element.length)throw Error("No snapshot defined for StructureDefinition '".concat(e.name,"'"));this.root=e.snapshot.element[0],this.elements=e.snapshot.element.slice(1),this.elementIndex=Object.create(null),this.index=0,this.resourceSchema={name:e.name,path:this.root.path,title:e.title,type:e.type,url:e.url,version:e.version,kind:e.kind,description:function(e){let t=e.description;return(null==t?void 0:t.startsWith("Base StructureDefinition for ".concat(e.name," Type: ")))&&(t=t.substring("Base StructureDefinition for ".concat(e.name," Type: ").length)),t}(e),elements:{},constraints:this.parseElementDefinition(this.root).constraints,innerTypes:[],summaryProperties:new Set,mandatoryProperties:new Set},this.innerTypes=[]}};function B(e){return"*"===e?1/0:Number.parseInt(e,10)}function F(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t=e.path,n=r,t?n&&t.startsWith(n)?t.substring(n.length+1):t:""}function W(e,t){return!!e&&!!t&&(t.startsWith(e+".")||t===e)}function Q(e){return Array.isArray(e)&&e.length>0?e[0]:eS(e)?void 0:e}function H(e,t,n){var r,i,o;let s,a=e.path;return r=J(e,t,n),i=a,o=t,s=i?i+".":"",void 0===r?{type:"undefined",value:void 0,path:"".concat(s).concat(o)}:Array.isArray(r)?r.map((e,t)=>({...e,path:"".concat(s).concat(o,"[").concat(t,"]")})):{...r,path:"".concat(s).concat(o)}}new d(1e3);var z={date:/^(\d(\d(\d[1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2]\d|3[0-1]))?)?$/,dateTime:/^(\d(\d(\d[1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2]\d|3[0-1])(T([01]\d|2[0-3])(:[0-5]\d:([0-5]\d|60)(\.\d{1,9})?)?)?)?(Z|[+-]((0\d|1[0-3]):[0-5]\d|14:00)?)?)?$/};function X(e){return[{type:eZ.boolean,value:e}]}function G(e){return null==e?{type:"undefined",value:void 0}:Number.isSafeInteger(e)?{type:eZ.integer,value:e}:"number"==typeof e?{type:eZ.decimal,value:e}:"boolean"==typeof e?{type:eZ.boolean,value:e}:"string"==typeof e?{type:eZ.string,value:e}:el(e)?{type:eZ.Quantity,value:e}:e3(e)?{type:e.resourceType,value:e}:eA(e)?{type:eZ.CodeableConcept,value:e}:eC(e)?{type:eZ.Coding,value:e}:{type:eZ.BackboneElement,value:e}}function V(e){return 0!==e.length&&!!e[0].value}function K(e,t){if(0!==e.length){if(1===e.length&&(!t||e[0].type===t))return e[0];throw Error("Expected singleton of type ".concat(t,", but found ").concat(JSON.stringify(e)))}}function J(e,t,n){if(!e.value)return;let r=function(e,t,n){let r=U(e,n);if(r)return function(e,t){var n;let r=null!=(n=e[t])?n:e[t+"[x]"];if(r)return r;for(let n=0;n<t.length;n++){let r=t[n];if(r>="A"&&r<="Z"){let r=e[t.slice(0,n)+"[x]"];if(r)return r}}}(r.elements,t)}(e.type,t,null==n?void 0:n.profileUrl);return r?function(e,t,n){let r=e.value,i=n.type;if(!i||0===i.length)return;let o,s="undefined",a,l=n.path.lastIndexOf("."),c=n.path.substring(l+1);for(let e of i){let t=c.replace("[x]",e_(e.code));if(o=r[t],a=r["_"+t],void 0!==o||void 0!==a){s=e.code;break}}if(a)if(Array.isArray(o)){o=o.slice();for(let e=0;e<Math.max(o.length,a.length);e++)o[e]=ef(o[e],a[e])}else if(!o&&Array.isArray(a)){o=a.slice();for(let e=0;e<a.length;e++)o[e]=ef(void 0,a[e])}else o=ef(o,a);if(!eS(o))return("Element"===s||"BackboneElement"===s)&&(s=n.type[0].code),Array.isArray(o)?o.map(e=>$(e,s)):$(o,s)}(e,0,r):function(e,t){let n,r=e.value;if(r&&"object"==typeof r){if(t in r){let e=r[t];n=Array.isArray(e)?e.map(G):G(e)}else{let e=t.endsWith("[x]")?t.substring(0,t.length-3):t;for(let t of Object.values(eZ)){let i=e+e_(t);if(i in r){let e=r[i];n=Array.isArray(e)?e.map(e=>({type:t,value:e})):{type:t,value:e};break}}}if(Array.isArray(n)){if(0===n.length||eS(n[0]))return}else if(eS(n))return;return n}}(e,t)}function $(e,t){return"Resource"===t&&e3(e)&&(t=e.resourceType),{type:t,value:e}}function Z(e){let t=[];for(let n of e){let e=!1;for(let r of t)if(V(Y(n,r))){e=!0;break}e||t.push(n)}return t}function Y(e,t){var n,r;let i=null==(n=e.value)?void 0:n.valueOf(),o=null==(r=t.value)?void 0:r.valueOf();return"number"==typeof i&&"number"==typeof o?X(1e-8>Math.abs(i-o)):el(i)&&el(o)?X(ec(i,o)):X("object"==typeof i&&"object"==typeof o?eu(e,t):i===o)}function ee(e,t){return 0===e.length&&0===t.length?X(!0):e.length!==t.length?X(!1):(e.sort(et),t.sort(et),X(e.every((e,n)=>V(function(e,t){let{type:n,value:r}=e,{type:i,value:o}=t,s=null==r?void 0:r.valueOf(),a=null==o?void 0:o.valueOf();return"number"==typeof s&&"number"==typeof a?X(.01>Math.abs(s-a)):el(s)&&el(a)?X(ec(s,a)):X("Coding"===n&&"Coding"===i?"object"==typeof s&&"object"==typeof a&&s.code===a.code&&s.system===a.system:"object"==typeof s&&"object"==typeof a?eu({...s,id:void 0},{...a,id:void 0}):"string"==typeof s&&"string"==typeof a?s.toLowerCase()===a.toLowerCase():s===a)}(e,t[n])))))}function et(e,t){var n,r;let i=null==(n=e.value)?void 0:n.valueOf(),o=null==(r=t.value)?void 0:r.valueOf();return"number"==typeof i&&"number"==typeof o?i-o:"string"==typeof i&&"string"==typeof o?i.localeCompare(o):0}function en(e,t){let{value:n}=e;if(null==n)return!1;let r=t;switch(r.startsWith("System.")&&(r=r.substring(7)),r.startsWith("FHIR.")&&(r=r.substring(5)),r){case"Boolean":return"boolean"==typeof n;case"Decimal":case"Integer":return"number"==typeof n;case"Date":return er(n);case"DateTime":return ei(n);case"Time":return"string"==typeof n&&!!/^T\d/.exec(n);case"Period":return eo(n);case"Quantity":return el(n);default:return e.type===r||"object"==typeof n&&(null==n?void 0:n.resourceType)===r}}function er(e){return"string"==typeof e&&!!z.date.exec(e)}function ei(e){return"string"==typeof e&&!!z.dateTime.exec(e)}function eo(e){return!!(e&&"object"==typeof e&&("start"in e&&ei(e.start)||"end"in e&&ei(e.end)))}function es(e){if(e){if(er(e)||ei(e))return{start:ea(e,"0000-01-01T00:00:00.000"),end:ea(e,"xxxx-12-31T23:59:59.999")};if(eo(e))return{start:e.start?ea(e.start,"0000-01-01T00:00:00.000"):void 0,end:e.end?ea(e.end,"xxxx-12-31T23:59:59.999"):void 0}}}function ea(e,t){let n="Z",r=Math.max(e.indexOf("+",10),e.indexOf("-",10));return r>-1?(n=e.substring(r),e=e.substring(0,r)):e.endsWith("Z")&&(e=e.substring(0,e.length-1)),new Date(e+t.substring(e.length)+n).toISOString()}function el(e){return!!(e&&"object"==typeof e&&"value"in e&&"number"==typeof e.value)}function ec(e,t){return .01>Math.abs(e.value-t.value)&&(e.unit===t.unit||e.code===t.code||e.unit===t.code||e.code===t.unit)}function eu(e,t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(let r of n){let n=e[r],i=t[r];if(ed(n)&&ed(i)){if(!eu(n,i))return!1}else if(n!==i)return!1}return!0}function ed(e){return null!==e&&"object"==typeof e}function ef(e,t){if(t){var n,r;if("object"!=typeof t)throw Error("Primitive extension must be an object");return n=null!=e?e:{},r=t,delete r.__proto__,delete r.constructor,Object.assign(n,r)}return e}function eh(e,t){return e3(e,t)&&"id"in e&&"string"==typeof e.id}function ep(e){var t;let n=null!=(t=ey(e))?t:"undefined/undefined",r=eg(e);return r===n?{reference:n}:{reference:n,display:r}}function ey(e){return e6(e)?e.reference:eh(e)?"".concat(e.resourceType,"/").concat(e.id):void 0}function em(e){if(e)return e6(e)?e.reference.split("/")[1]:e.id}function eg(e){var t,n;if("Patient"===e.resourceType||"Practitioner"===e.resourceType||"RelatedPerson"===e.resourceType){let t=function(e){let t=e.name;if(t&&t.length>0)return eO(t[0])}(e);if(t)return t}if("Device"===e.resourceType){let t=function(e){let t=e.deviceName;if(t&&t.length>0)return t[0].name}(e);if(t)return t}if("MedicationRequest"===e.resourceType&&e.medicationCodeableConcept)return eV(e.medicationCodeableConcept);if("Subscription"===e.resourceType&&e.criteria)return e.criteria;if("User"===e.resourceType&&e.email)return e.email;if("name"in e&&e.name&&"string"==typeof e.name)return e.name;if("code"in e&&e.code){let t=e.code;if(Array.isArray(t)&&(t=t[0]),eA(t))return eV(t);if(ek(n=t)&&"text"in n&&"string"==typeof n.text)return t.text}return null!=(t=ey(e))?t:""}function ev(e){if(!("photo"in e))return;let t=e.photo;if(t)if(!Array.isArray(t))return ex(t);else for(let e of t){let t=ex(e);if(t)return t}}function ex(e){var t;if(e.url&&(null==(t=e.contentType)?void 0:t.startsWith("image/")))return e.url}function eb(e){for(var t,n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];let o=e;for(let e=0;e<r.length&&o;e++)o=null==o||null==(t=o.extension)?void 0:t.find(t=>t.url===r[e]);return o}function eE(e,t){var n;return null!=(n=JSON.stringify(function e(t){if(null!=t&&""!==t)return"object"==typeof t?Array.isArray(t)?function(t){let n=t.length;if(0===n)return;let r,i=0;for(let o=0;o<n;o++){let n=t[o],s=e(n);s===n||r||(r=Array.from(t)),void 0===s?r&&(r[o]=null):(r&&(r[o]=s),i++)}if(0!==i)return null!=r?r:t}(t):function(t){let n,r=0;for(let i in t){let o=t[i],s=e(o);s===o||n||(n={...t}),void 0===s?n&&delete n[i]:(n&&(n[i]=s),r++)}if(0!==r)return null!=n?n:t}(t):t}(e),null,t?2:void 0))?n:""}function eS(e){if(null==e)return!0;let t=typeof e;return("string"===t||"object"===t)&&!ew(e)}function ew(e){if(null==e)return!1;let t=typeof e;return"string"===t&&""!==e||"object"===t&&("length"in e&&e.length>0||Object.keys(e).length>0)}function eT(e,t,n){return!!(e===t||eS(e)&&eS(t))||!(eS(e)||eS(t))&&(Array.isArray(e)&&Array.isArray(t)?function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!eT(e[n],t[n]))return!1;return!0}(e,t):!(Array.isArray(e)||Array.isArray(t))&&(ek(e)&&ek(t)?function(e,t,n){let r=new Set;for(let i of(Object.keys(e).forEach(e=>r.add(e)),Object.keys(t).forEach(e=>r.add(e)),"meta"===n&&(r.delete("versionId"),r.delete("lastUpdated"),r.delete("author")),r))if(!eT(e[i],t[i],i))return!1;return!0}(e,t,n):(ek(e)||ek(t),!1)))}function ek(e){return null!==e&&"object"==typeof e}function eC(e){return ek(e)&&"code"in e&&"string"==typeof e.code}function eA(e){return ek(e)&&"coding"in e&&Array.isArray(e.coding)&&e.coding.every(eC)}var eP=[];for(let e=0;e<256;e++)eP.push(e.toString(16).padStart(2,"0"));function eR(e){return ArrayBuffer.isView(e)?e.buffer:e}function e_(e){return e?e.charAt(0).toUpperCase()+e.substring(1):""}var ej=e=>new Promise(t=>{setTimeout(t,e)});function eD(e,t,n){let r=[];for(let i=0;i<n-1;i++){let n=e.indexOf(t);if(n<0)break;r.push(e.slice(0,n)),e=e.slice(n+t.length)}return r.push(e),r}function eM(e,t){return e?(e.push(t),e):[t]}function eL(e){return e.endsWith("/")?e:e+"/"}function eU(e,t){return new URL(t.startsWith("/")?t.slice(1):t,eL(e.toString())).toString()}function eI(e,t){var n;if(!e)return"";let r=[];if(e.line&&r.push(...e.line),e.city||e.state||e.postalCode){let t=[];e.city&&t.push(e.city),e.state&&t.push(e.state),e.postalCode&&t.push(e.postalCode),r.push(t.join(", "))}return e.use&&((null==t?void 0:t.all)||(null==t?void 0:t.use))&&r.push("["+e.use+"]"),r.join(null!=(n=null==t?void 0:t.lineSeparator)?n:", ").trim()}function eO(e,t){if(!e)return"";let n=[];if(e.prefix&&(null==t?void 0:t.prefix)!==!1&&n.push(...e.prefix),e.given&&n.push(...e.given),e.family&&n.push(e.family),e.suffix&&(null==t?void 0:t.suffix)!==!1&&n.push(...e.suffix),e.use&&((null==t?void 0:t.all)||(null==t?void 0:t.use))&&n.push("["+e.use+"]"),0===n.length){let t=eJ(e.text);if(t)return t}return n.join(" ").trim()}function eN(e){return e instanceof Date&&!Number.isNaN(e.getTime())}function eq(e,t,n){if(!e)return"";let r=new Date(e);return eN(r)?r.toLocaleString(t,n):""}function eB(e,t,n){return e&&(e.start||e.end)?eq(e.start,t,n)+" - "+eq(e.end,t,n):""}var eF={s:"every second",min:"every minute",h:"hourly",d:"daily",wk:"weekly",mo:"monthly",a:"annually"},eW={s:"second",min:"minute",h:"hour",d:"day",wk:"week",mo:"month",a:"year"},eQ={s:"seconds",min:"minutes",h:"hours",d:"days",wk:"weeks",mo:"months",a:"years"};function eH(e){if(!e)return"";let t=[];return function(e,t){var n,r;if(!(null==t?void 0:t.periodUnit))return;let i=null!=(n=t.frequency)?n:1,o=null!=(r=t.period)?r:1,s=t.periodUnit;1===i&&1===o?e.push(eF[s]):(1===i?e.push("once"):e.push(i+" times"),1===o?e.push("per "+eW[s]):e.push("per "+o+" "+eQ[s])),t.dayOfWeek&&e.push("on "+t.dayOfWeek.map(e_).join(", ")),t.timeOfDay&&e.push("at "+t.timeOfDay.map(e=>(function(e,t,n){if(!e)return"";let r=new Date("2000-01-01T"+e+"Z");return eN(r)?r.toLocaleTimeString(void 0,void 0):""})(e)).join(", "))}(t,e.repeat),e.event&&t.push(e.event.map(e=>eq(e)).join(", ")),e_(t.join(" ").trim())}function ez(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n&&void 0===t)throw Error("Precision must be specified for exclusive ranges");let r=(null==e?void 0:e.low)&&{...e.low,comparator:void 0},i=(null==e?void 0:e.high)&&{...e.high,comparator:void 0};return(null==r?void 0:r.value)===void 0&&(null==i?void 0:i.value)===void 0?"":(null==r?void 0:r.value)!==void 0&&(null==i?void 0:i.value)===void 0?n&&void 0!==t?(r.value=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(e$(e,t)-n)*Math.pow(10,-t)}(r.value,t),"> ".concat(eX(r,t))):">= ".concat(eX(r,t)):(null==r?void 0:r.value)===void 0&&(null==i?void 0:i.value)!==void 0?n&&void 0!==t?(i.value=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return(e$(e,t)+n)*Math.pow(10,-t)}(i.value,t),"< ".concat(eX(i,t))):"<= ".concat(eX(i,t)):((null==r?void 0:r.unit)===(null==i?void 0:i.unit)&&(null==r||delete r.unit),"".concat(eX(r,t)," - ").concat(eX(i,t)))}function eX(e,t){if(!e)return"";let n=[];return e.comparator&&(n.push(e.comparator),n.push(" ")),void 0!==e.value&&(void 0!==t?n.push(e.value.toFixed(t)):n.push(e.value)),e.unit&&("%"!==e.unit&&" "!==n.at(-1)&&n.push(" "),n.push(e.unit)),n.join("").trim()}function eG(e){var t;return(null==e?void 0:e.value)===void 0?"":e.value.toLocaleString(void 0,{style:"currency",currency:null!=(t=e.currency)?t:"USD",currencyDisplay:"narrowSymbol"})}function eV(e){return e?eJ(e.text)||(e.coding?e.coding.map(e=>eK(e)).join(", "):""):""}function eK(e,t){var n;let r=eJ(null==e?void 0:e.display);if(r){let n=t?eJ(null==e?void 0:e.code):void 0;return"".concat(r).concat(n?" ("+n+")":"")}return null!=(n=eJ(null==e?void 0:e.code))?n:""}function eJ(e){return"string"==typeof e?e:void 0}function e$(e,t){return void 0===t?e:Math.round(e*Math.pow(10,t))}var eZ={Address:"Address",Age:"Age",Annotation:"Annotation",Attachment:"Attachment",BackboneElement:"BackboneElement",CodeableConcept:"CodeableConcept",Coding:"Coding",ContactDetail:"ContactDetail",ContactPoint:"ContactPoint",Contributor:"Contributor",Count:"Count",DataRequirement:"DataRequirement",Distance:"Distance",Dosage:"Dosage",Duration:"Duration",Expression:"Expression",Extension:"Extension",HumanName:"HumanName",Identifier:"Identifier",MarketingStatus:"MarketingStatus",Meta:"Meta",Money:"Money",Narrative:"Narrative",ParameterDefinition:"ParameterDefinition",Period:"Period",Population:"Population",ProdCharacteristic:"ProdCharacteristic",ProductShelfLife:"ProductShelfLife",Quantity:"Quantity",Range:"Range",Ratio:"Ratio",Reference:"Reference",RelatedArtifact:"RelatedArtifact",SampledData:"SampledData",Signature:"Signature",SubstanceAmount:"SubstanceAmount",SystemString:"http://hl7.org/fhirpath/System.String",Timing:"Timing",TriggerDefinition:"TriggerDefinition",UsageContext:"UsageContext",base64Binary:"base64Binary",boolean:"boolean",canonical:"canonical",code:"code",date:"date",dateTime:"dateTime",decimal:"decimal",id:"id",instant:"instant",integer:"integer",markdown:"markdown",oid:"oid",positiveInt:"positiveInt",string:"string",time:"time",unsignedInt:"unsignedInt",uri:"uri",url:"url",uuid:"uuid"};function eY(e){let t=e7.types[e];return t||(t={searchParamsDetails:{}},e7.types[e]=t),t.searchParams||"Binary"===e||(t.searchParams={_id:{base:[e],code:"_id",type:"token",expression:e+".id"},_lastUpdated:{base:[e],code:"_lastUpdated",type:"date",expression:e+".meta.lastUpdated"},_compartment:{base:[e],code:"_compartment",type:"reference",expression:e+".meta.compartment"},_profile:{base:[e],code:"_profile",type:"uri",expression:e+".meta.profile"},_security:{base:[e],code:"_security",type:"token",expression:e+".meta.security"},_source:{base:[e],code:"_source",type:"uri",expression:e+".meta.source"},_tag:{base:[e],code:"_tag",type:"token",expression:e+".meta.tag"}}),t}function e0(e){var t,n,r,i,o,s;let a=null==(n=e.type)||null==(t=n[0])?void 0:t.code;return"BackboneElement"===a||"Element"===a?1===(s=null==(r=null!=(o=null==(i=e.base)?void 0:i.path)?o:e.path)?void 0:r.split(".")).length?s[0]:s.map(e_).join(""):a}function e1(e){var t,n;return((t=e.replaceAll("[x]","").split(".").pop()).length<100?null!=(n=t.match(/[A-Z]+(?![a-z])|[A-Z]?[a-z]+|\d+/g))?n:[]:t.split(/(?=[A-Z])/)).map(e4).join(" ").replace("_"," ").replaceAll(/\s+/g," ")}var e2=new Set(["ID","IP","PKCE","JWKS","URI","URL","OMB","UDI"]);function e4(e){let t=e.toUpperCase();return e===t?e:e2.has(t)?t:t.charAt(0)+e.slice(1)}function e3(e,t){return!(!e||"object"!=typeof e||!("resourceType"in e)||t&&e.resourceType!==t)}function e6(e,t){return!!e&&"object"==typeof e&&"reference"in e&&"string"==typeof e.reference&&(!t||null!==e.reference.match(new RegExp("^".concat(t,"(/|\\?)"))))}var e7={types:{}};function e5(e){if(e.startsWith("T"))return e+"T00:00:00.000Z".substring(e.length);if(e.length<=10)return e;try{return new Date(e).toISOString()}catch(t){return e}}var e8=()=>[],e9={empty:(e,t)=>X(t.every(e=>eS(e.value))),hasValue:(e,t)=>X(0!==t.length),exists:(e,t,n)=>n?X(t.some(t=>V(n.eval(e,[t])))):X(t.length>0&&t.every(e=>!eS(e.value))),all:(e,t,n)=>X(t.every(t=>V(n.eval(e,[t])))),allTrue:(e,t)=>{for(let e of t)if(!e.value)return X(!1);return X(!0)},anyTrue:(e,t)=>{for(let e of t)if(e.value)return X(!0);return X(!1)},allFalse:(e,t)=>{for(let e of t)if(e.value)return X(!1);return X(!0)},anyFalse:(e,t)=>{for(let e of t)if(!e.value)return X(!0);return X(!1)},subsetOf:(e,t,n)=>{if(0===t.length)return X(!0);let r=n.eval(e,tr(e));return 0===r.length?X(!1):X(t.every(e=>r.some(t=>t.value===e.value)))},supersetOf:(e,t,n)=>{let r=n.eval(e,tr(e));return 0===r.length?X(!0):0===t.length?X(!1):X(r.every(e=>t.some(t=>t.value===e.value)))},count:(e,t)=>[{type:eZ.integer,value:t.length}],distinct:(e,t)=>{let n=[];for(let e of t)n.some(t=>t.value===e.value)||n.push(e);return n},isDistinct:(e,t)=>X(t.length===e9.distinct(e,t).length),where:(e,t,n)=>t.filter(t=>V(n.eval(e,[t]))),select:(e,t,n)=>t.flatMap(t=>n.eval({parent:e,variables:{$this:t}},[t])),repeat:e8,ofType:(e,t,n)=>t.filter(e=>e.type===n.name),single:(e,t)=>{if(t.length>1)throw Error("Expected input length one for single()");return 0===t.length?[]:t.slice(0,1)},first:(e,t)=>0===t.length?[]:t.slice(0,1),last:(e,t)=>0===t.length?[]:t.slice(-1,t.length),tail:(e,t)=>0===t.length?[]:t.slice(1,t.length),skip:(e,t,n)=>{var r;let i=null==(r=n.eval(e,t)[0])?void 0:r.value;if("number"!=typeof i)throw TypeError("Expected a number for skip(num)");return i>=t.length?[]:i<=0?t:t.slice(i,t.length)},take:(e,t,n)=>{var r;let i=null==(r=n.eval(e,t)[0])?void 0:r.value;if("number"!=typeof i)throw TypeError("Expected a number for take(num)");return i>=t.length?t:i<=0?[]:t.slice(0,i)},intersect:(e,t,n)=>{if(!n)return t;let r=n.eval(e,tr(e)),i=[];for(let e of t)!i.some(t=>t.value===e.value)&&r.some(t=>t.value===e.value)&&i.push(e);return i},exclude:(e,t,n)=>{if(!n)return t;let r=n.eval(e,tr(e)),i=[];for(let e of t)r.some(t=>t.value===e.value)||i.push(e);return i},union:(e,t,n)=>n?Z([...t,...n.eval(e,tr(e))]):t,combine:(e,t,n)=>n?[...t,...n.eval(e,tr(e))]:t,htmlChecks:(e,t,n)=>[G(!0)],iif:(e,t,n,r,i)=>{let o=n.eval(e,t);if(o.length>1||1===o.length&&"boolean"!=typeof o[0].value)throw Error("Expected criterion to evaluate to a Boolean");return V(o)?r.eval(e,t):i?i.eval(e,t):[]},toBoolean:(e,t)=>{if(0===t.length)return[];let[{value:n}]=tn(t,1);if("boolean"==typeof n)return[{type:eZ.boolean,value:n}];if("number"==typeof n&&(0===n||1===n))return X(!!n);if("string"==typeof n){let e=n.toLowerCase();if(["true","t","yes","y","1","1.0"].includes(e))return X(!0);if(["false","f","no","n","0","0.0"].includes(e))return X(!1)}return[]},convertsToBoolean:(e,t)=>0===t.length?[]:X(1===e9.toBoolean(e,t).length),toInteger:(e,t)=>{if(0===t.length)return[];let[{value:n}]=tn(t,1);return"number"==typeof n?[{type:eZ.integer,value:n}]:"string"==typeof n&&/^[+-]?\d+$/.exec(n)?[{type:eZ.integer,value:Number.parseInt(n,10)}]:"boolean"==typeof n?[{type:eZ.integer,value:+!!n}]:[]},convertsToInteger:(e,t)=>0===t.length?[]:X(1===e9.toInteger(e,t).length),toDate:(e,t)=>{if(0===t.length)return[];let[{value:n}]=tn(t,1);return"string"==typeof n&&/^\d{4}(-\d{2}(-\d{2})?)?/.exec(n)?[{type:eZ.date,value:e5(n)}]:[]},convertsToDate:(e,t)=>0===t.length?[]:X(1===e9.toDate(e,t).length),toDateTime:(e,t)=>{if(0===t.length)return[];let[{value:n}]=tn(t,1);return"string"==typeof n&&/^\d{4}(-\d{2}(-\d{2})?)?/.exec(n)?[{type:eZ.dateTime,value:e5(n)}]:[]},convertsToDateTime:(e,t)=>0===t.length?[]:X(1===e9.toDateTime(e,t).length),toDecimal:(e,t)=>{if(0===t.length)return[];let[{value:n}]=tn(t,1);return"number"==typeof n?[{type:eZ.decimal,value:n}]:"string"==typeof n&&/^-?\d{1,9}(\.\d{1,9})?$/.exec(n)?[{type:eZ.decimal,value:Number.parseFloat(n)}]:"boolean"==typeof n?[{type:eZ.decimal,value:+!!n}]:[]},convertsToDecimal:(e,t)=>0===t.length?[]:X(1===e9.toDecimal(e,t).length),toQuantity:(e,t)=>{if(0===t.length)return[];let[{value:n}]=tn(t,1);return el(n)?[{type:eZ.Quantity,value:n}]:"number"==typeof n?[{type:eZ.Quantity,value:{value:n,unit:"1"}}]:"string"==typeof n&&/^-?\d{1,9}(\.\d{1,9})?/.exec(n)?[{type:eZ.Quantity,value:{value:Number.parseFloat(n),unit:"1"}}]:"boolean"==typeof n?[{type:eZ.Quantity,value:{value:+!!n,unit:"1"}}]:[]},convertsToQuantity:(e,t)=>0===t.length?[]:X(1===e9.toQuantity(e,t).length),toString:(e,t)=>{if(0===t.length)return[];let[{value:n}]=tn(t,1);return null==n?[]:el(n)?[{type:eZ.string,value:"".concat(n.value," '").concat(n.unit,"'")}]:[{type:eZ.string,value:n.toString()}]},convertsToString:(e,t)=>0===t.length?[]:X(1===e9.toString(e,t).length),toTime:(e,t)=>{if(0===t.length)return[];let[{value:n}]=tn(t,1);if("string"==typeof n){let e=/^T?(\d{2}(:\d{2}(:\d{2})?)?)/.exec(n);if(e)return[{type:eZ.time,value:e5("T"+e[1])}]}return[]},convertsToTime:(e,t)=>0===t.length?[]:X(1===e9.toTime(e,t).length),indexOf:(e,t,n)=>te((e,t)=>e.indexOf(t),e,t,n),substring:(e,t,n,r)=>te((e,t,n)=>{let r=n?t+n:e.length;return t<0||t>=e.length?void 0:e.substring(t,r)},e,t,n,r),startsWith:(e,t,n)=>te((e,t)=>e.startsWith(t),e,t,n),endsWith:(e,t,n)=>te((e,t)=>e.endsWith(t),e,t,n),contains:(e,t,n)=>te((e,t)=>e.includes(t),e,t,n),upper:(e,t)=>te(e=>e.toUpperCase(),e,t),lower:(e,t)=>te(e=>e.toLowerCase(),e,t),replace:(e,t,n,r)=>te((e,t,n)=>e.replaceAll(t,n),e,t,n,r),matches:(e,t,n)=>te((e,t)=>!!new RegExp(t).exec(e),e,t,n),replaceMatches:(e,t,n,r)=>te((e,t,n)=>e.replaceAll(RegExp(t,"g"),n.replaceAll(/\$\{(\w+)\}/g,"$<$1>")),e,t,n,r),length:(e,t)=>te(e=>e.length,e,t),toChars:(e,t)=>te(e=>e?e.split(""):void 0,e,t),encode:e8,decode:e8,escape:e8,unescape:e8,trim:e8,split:e8,join:(e,t,n)=>{var r,i;let o=null!=(i=null==n||null==(r=n.eval(e,tr(e))[0])?void 0:r.value)?i:"";if("string"!=typeof o)throw TypeError("Separator must be a string.");return[{type:eZ.string,value:t.map(e=>{var t,n;return null!=(n=null==(t=e.value)?void 0:t.toString())?n:""}).join(o)}]},abs:(e,t)=>tt(Math.abs,e,t),ceiling:(e,t)=>tt(Math.ceil,e,t),exp:(e,t)=>tt(Math.exp,e,t),floor:(e,t)=>tt(Math.floor,e,t),ln:(e,t)=>tt(Math.log,e,t),log:(e,t,n)=>tt((e,t)=>Math.log(e)/Math.log(t),e,t,n),power:(e,t,n)=>tt(Math.pow,e,t,n),round:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return tt(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if("number"!=typeof t||t<0)throw Error("Invalid precision provided to round()");let n=Math.pow(10,t);return Math.round(e*n)/n},e,t,...r)},sqrt:(e,t)=>tt(Math.sqrt,e,t),truncate:(e,t)=>tt(e=>Math.trunc(e),e,t),children:e8,descendants:e8,trace:(e,t,n)=>t,now:()=>[{type:eZ.dateTime,value:new Date().toISOString()}],timeOfDay:()=>[{type:eZ.time,value:new Date().toISOString().substring(11)}],today:()=>[{type:eZ.date,value:new Date().toISOString().substring(0,10)}],between:(e,t,n,r,i)=>{var o;let s=e9.toDateTime(e,n.eval(e,t));if(0===s.length)throw Error("Invalid start date");let a=e9.toDateTime(e,r.eval(e,t));if(0===a.length)throw Error("Invalid end date");let l=null==(o=i.eval(e,t)[0])?void 0:o.value;if("years"!==l&&"months"!==l&&"days"!==l)throw Error("Invalid units");let c=function(e,t){let n=new Date(e);n.setUTCHours(0,0,0,0);let r=t?new Date(t):new Date;r.setUTCHours(0,0,0,0);let i=n.getUTCFullYear(),o=n.getUTCMonth(),s=n.getUTCDate(),a=r.getUTCFullYear(),l=r.getUTCMonth(),c=r.getUTCDate(),u=a-i;(l<o||l===o&&c<s)&&u--;let d=12*a+l-(12*i+o);return c<s&&d--,{years:u,months:d,days:Math.floor((r.getTime()-n.getTime())/864e5)}}(s[0].value,a[0].value);return[{type:eZ.Quantity,value:{value:c[l],unit:l}}]},is:(e,t,n)=>{let r="";return n instanceof ts?r=n.name:n instanceof ty&&(r=n.left.name+"."+n.right.name),r?t.map(e=>({type:eZ.boolean,value:en(e,r)})):[]},not:(e,t)=>e9.toBoolean(e,t).map(e=>({type:eZ.boolean,value:!e.value})),resolve:(e,t)=>t.map(e=>{let t=e.value,n;if("string"==typeof t)n=t;else if("object"==typeof t){if(t.resource)return G(t.resource);t.reference?n=t.reference:t.type&&t.identifier&&(n="".concat(t.type,"?identifier=").concat(t.identifier.system,"|").concat(t.identifier.value))}if(null==n?void 0:n.includes("?")){let[e]=n.split("?");return{type:e,value:{resourceType:e}}}if(null==n?void 0:n.includes("/")){let[e,t]=n.split("/");return{type:e,value:{resourceType:e,id:t}}}return{type:eZ.BackboneElement,value:void 0}}).filter(e=>!!e.value),as:(e,t)=>t,type:(e,t)=>t.map(e=>{let{value:t}=e;return"boolean"==typeof t?{type:eZ.BackboneElement,value:{namespace:"System",name:"Boolean"}}:"number"==typeof t?{type:eZ.BackboneElement,value:{namespace:"System",name:"Integer"}}:e3(t)?{type:eZ.BackboneElement,value:{namespace:"FHIR",name:t.resourceType}}:{type:eZ.BackboneElement,value:null}}),conformsTo:(e,t,n)=>{let r=n.eval(e,t)[0].value;if(!r.startsWith("http://hl7.org/fhir/StructureDefinition/"))throw Error("Expected a StructureDefinition URL");let i=r.replace("http://hl7.org/fhir/StructureDefinition/","");return t.map(e=>{var t;return{type:eZ.boolean,value:(null==(t=e.value)?void 0:t.resourceType)===i}})},getResourceKey:(e,t)=>{let n=t[0].value;return(null==n?void 0:n.id)?[{type:eZ.id,value:n.id}]:[]},getReferenceKey:(e,t,n)=>{let r=t[0].value;if(!(null==r?void 0:r.reference))return[];let i="";return n instanceof ts&&(i=n.name),i&&!r.reference.startsWith(i+"/")?[]:[{type:eZ.id,value:em(r)}]},extension:(e,t,n)=>{var r;let i=n.eval(e,t)[0].value,o=null==t||null==(r=t[0])?void 0:r.value;if(o){let e=eb(o,i);if(e)return[{type:eZ.Extension,value:e}]}return[]}};function te(e,t,n){for(var r=arguments.length,i=Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];if(0===n.length)return[];let[{value:s}]=tn(n,1);if("string"!=typeof s)throw TypeError("String function cannot be called with non-string");let a=e(s,...i.map(e=>{var r;return null==e||null==(r=e.eval(t,n)[0])?void 0:r.value}));return void 0===a?[]:Array.isArray(a)?a.map(G):[G(a)]}function tt(e,t,n){for(var r=arguments.length,i=Array(r>3?r-3:0),o=3;o<r;o++)i[o-3]=arguments[o];if(0===n.length)return[];let[{value:s}]=tn(n,1),a=el(s),l=a?s.value:s;if("number"!=typeof l)throw TypeError("Math function cannot be called with non-number");let c=e(l,...i.map(e=>{var r;return null==(r=e.eval(t,n)[0])?void 0:r.value}));return[{type:a?eZ.Quantity:n[0].type,value:a?{...s,value:c}:c}]}function tn(e,t){if(e.length!==t)throw Error("Expected ".concat(t," arguments"));for(let t of e)if(null==t)throw Error("Expected non-null argument");return e}function tr(e){var t;let n=e;for(;null==(t=n.parent)?void 0:t.variables.$this;)n=n.parent;return[n.variables.$this]}var ti=class{eval(e,t){try{if(!(t.length>0))return this.child.eval(e,[]);{let n=[];for(let r of t)n.push(this.child.eval({parent:e,variables:{$this:r}},[r]));return n.flat()}}catch(e){throw Error('FhirPathError on "'.concat(this.original,'": ').concat(e),{cause:e})}}toString(){return this.child.toString()}constructor(e,t){s(this,"original"),s(this,"child"),this.original=e,this.child=t}},to=class{eval(){return[this.value]}toString(){let e=this.value.value;return"string"==typeof e?"'".concat(e,"'"):e.toString()}constructor(e){s(this,"value"),this.value=e}},ts=class{eval(e,t){if("$this"===this.name)return t;let n=this.getVariable(e);if(n)return[n];if(this.name.startsWith("%"))throw Error("Undefined variable ".concat(this.name));return t.flatMap(e=>this.evalValue(e)).filter(e=>(null==e?void 0:e.value)!==void 0)}getVariable(e){let t=e.variables[this.name];return void 0!==t?t:e.parent?this.getVariable(e.parent):void 0}evalValue(e){let t=e.value;if(!(!t||"object"!=typeof t))return e3(t,this.name)?e:H(e,this.name)}toString(){return this.name}constructor(e){s(this,"name"),this.name=e}},ta=class{eval(){return[]}toString(){return"{}"}},tl=class extends a{eval(e,t){return this.impl(this.child.eval(e,t))}toString(){return this.operator+this.child.toString()}constructor(e,t,n){super(e,t),s(this,"impl"),this.impl=n}},tc=class extends l{eval(e,t){return e9.ofType(e,this.left.eval(e,t),this.right)}constructor(e,t){super("as",e,t)}},tu=class extends l{},td=class extends tu{eval(e,t){let n=this.left.eval(e,t);if(1!==n.length)return[];let r=this.right.eval(e,t);if(1!==r.length)return[];let i=n[0].value,o=r[0].value,s=el(i)?i.value:i,a=el(o)?o.value:o,l=this.impl(s,a);return"boolean"==typeof l?X(l):el(i)?[{type:eZ.Quantity,value:{...i,value:l}}]:[G(l)]}constructor(e,t,n,r){super(e,t,n),s(this,"impl"),this.impl=r}},tf=class extends l{eval(e,t){let n=[...this.left.eval(e,t),...this.right.eval(e,t)];return n.length>0&&n.every(e=>"string"==typeof e.value)?[{type:eZ.string,value:n.map(e=>e.value).join("")}]:n}constructor(e,t){super("&",e,t)}},th=class extends tu{eval(e,t){let n=this.left.eval(e,t),r=this.right.eval(e,t);return X(n.some(e=>e.value===r[0].value))}constructor(e,t){super("contains",e,t)}},tp=class extends tu{eval(e,t){let n=K(this.left.eval(e,t)),r=this.right.eval(e,t);return n?X(r.some(e=>Y(n,e)[0].value)):[]}constructor(e,t){super("in",e,t)}},ty=class extends l{eval(e,t){return this.right.eval(e,this.left.eval(e,t))}toString(){return"".concat(this.left.toString(),".").concat(this.right.toString())}constructor(e,t){super(".",e,t)}},tm=class extends l{eval(e,t){return Z([...this.left.eval(e,t),...this.right.eval(e,t)])}constructor(e,t){super("|",e,t)}},tg=class extends tu{eval(e,t){let n=this.left.eval(e,t),r=this.right.eval(e,t);return 0===n.length||0===r.length?[]:n.length!==r.length?X(!1):X(n.every((e,t)=>V(Y(e,r[t]))))}constructor(e,t){super("=",e,t)}},tv=class extends tu{eval(e,t){let n=this.left.eval(e,t),r=this.right.eval(e,t);return 0===n.length||0===r.length?[]:n.length!==r.length?X(!0):X(n.some((e,t)=>!V(Y(e,r[t]))))}constructor(e,t){super("!=",e,t)}},tx=class extends tu{eval(e,t){return ee(this.left.eval(e,t),this.right.eval(e,t))}constructor(e,t){super("~",e,t)}},tb=class extends tu{eval(e,t){return X(!V(ee(this.left.eval(e,t),this.right.eval(e,t))))}constructor(e,t){super("!~",e,t)}},tE=class extends tu{eval(e,t){let n=this.left.eval(e,t);if(1!==n.length)return[];let r=this.right.name;return X(en(n[0],r))}constructor(e,t){super("is",e,t)}},tS=class extends tu{eval(e,t){let n=K(this.left.eval(e,t),"boolean"),r=K(this.right.eval(e,t),"boolean");return(null==n?void 0:n.value)===!0&&(null==r?void 0:r.value)===!0?X(!0):(null==n?void 0:n.value)===!1||(null==r?void 0:r.value)===!1?X(!1):[]}constructor(e,t){super("and",e,t)}},tw=class extends tu{eval(e,t){let n=K(this.left.eval(e,t),"boolean"),r=K(this.right.eval(e,t),"boolean");return(null==n?void 0:n.value)===!1&&(null==r?void 0:r.value)===!1?X(!1):(null==n?void 0:n.value)||(null==r?void 0:r.value)?X(!0):[]}constructor(e,t){super("or",e,t)}},tT=class extends tu{eval(e,t){let n=K(this.left.eval(e,t),"boolean"),r=K(this.right.eval(e,t),"boolean");return n&&r?X(n.value!==r.value):[]}constructor(e,t){super("xor",e,t)}},tk=class extends tu{eval(e,t){let n=K(this.left.eval(e,t),"boolean"),r=K(this.right.eval(e,t),"boolean");return(null==r?void 0:r.value)===!0||(null==n?void 0:n.value)===!1?X(!0):n&&r?X(!1):[]}constructor(e,t){super("implies",e,t)}},tC=class{eval(e,t){let n=e9[this.name];if(!n)throw Error("Unrecognized function: "+this.name);return n(e,t,...this.args)}toString(){return"".concat(this.name,"(").concat(this.args.map(e=>e.toString()).join(", "),")")}constructor(e,t){s(this,"name"),s(this,"args"),this.name=e,this.args=t}},tA=class{eval(e,t){let n=this.expr.eval(e,t);if(1!==n.length)return[];let r=n[0].value;if("number"!=typeof r)throw Error("Invalid indexer expression: should return integer}");let i=this.left.eval(e,t);return r in i?[i[r]]:[]}toString(){return"".concat(this.left.toString(),"[").concat(this.expr.toString(),"]")}constructor(e,t){s(this,"left"),s(this,"expr"),this.left=e,this.expr=t}},tP=["year","years","month","months","week","weeks","day","days","hour","hours","minute","minutes","second","seconds","millisecond","milliseconds"],tR={"'":"'",'"':'"',"`":"`",r:"\r",n:"\n",t:"	",f:"\f","\\":"\\"},t_=class{tokenize(){for(;this.pos.index<this.str.length;){let e=this.consumeToken();e&&this.result.push(e)}return this.result}prevToken(){return this.result.slice(-1)[0]}peekToken(){this.mark();let e=this.consumeToken();return this.reset(),e}consumeToken(){this.consumeWhitespace();let e=this.curr();if(!e)return;this.mark();let t=this.peek();return"/"===e&&"*"===t?this.consumeMultiLineComment():"/"===e&&"/"===t?this.consumeSingleLineComment():"'"===e||'"'===e||"`"===e?this.consumeString(e):"@"===e?this.consumeDateTime():/\d/.exec(e)?this.consumeNumber():/\w/.exec(e)||("$"===e||"%"===e)&&/\w/.exec(t)?this.consumeSymbol():("$"===e||"%"===e)&&("'"===t||'"'===t||"`"===t)?this.consumeQuotedSymbol(t):this.consumeOperator()}consumeWhitespace(){this.consumeWhile(()=>/\s/.exec(this.curr()))}consumeMultiLineComment(){let e=this.pos.index;return this.consumeWhile(()=>"*"!==this.curr()||"/"!==this.peek()),this.advance(),this.advance(),this.buildToken("Comment",this.str.substring(e,this.pos.index))}consumeSingleLineComment(){return this.buildToken("Comment",this.consumeWhile(()=>"\n"!==this.curr()))}consumeString(e){this.advance();let t="",n;for(;n=this.consumeChar(e);)t+=n;let r=this.buildToken("`"===e?"Symbol":"String",t);return this.advance(),r}consumeChar(e){let t=this.curr();if("\\"===t){this.advance();let t=this.curr(),r=tR[t];if(void 0!==r)return this.advance(),r;if("u"===t){var n;this.advance();let e=null==(n=/^[0-9a-fA-F]{4}$/.exec(this.str.substring(this.pos.index,this.pos.index+4)))?void 0:n[0];return e?(this.advance(),this.advance(),this.advance(),this.advance(),String.fromCodePoint(Number.parseInt(e,16))):"u"}return this.consumeChar(e)}return t!==e&&t?(this.advance(),t):""}consumeQuotedSymbol(e){this.mark();let t=this.pos.index;this.advance(),this.consumeString(e);let n=this.str.substring(t,this.pos.index);return this.buildToken("Symbol",n)}consumeDateTime(){this.advance();let e=this.pos.index;this.consumeWhile(()=>/[\d-]/.exec(this.curr()));let t=!1,n=!1;if("T"===this.curr()&&(t=!0,this.advance(),this.consumeWhile(()=>/[\d:]/.exec(this.curr())),"."===this.curr()&&/\d/.exec(this.peek())&&(this.advance(),this.consumeWhile(()=>/\d/.exec(this.curr()))),"Z"===this.curr()?(n=!0,this.advance()):("+"===this.curr()||"-"===this.curr())&&(n=!0,this.advance(),this.consumeWhile(()=>/[\d:]/.exec(this.curr())))),this.pos.index===e)throw Error("Invalid DateTime literal");let r=this.str.substring(e,this.pos.index);return r.endsWith("T")?r=r.substring(0,r.length-1):r.startsWith("T")||!t||n||(r+="Z"),this.buildToken("DateTime",r)}consumeNumber(){var e;let t=this.pos.index,n="Number";return this.consumeWhile(()=>/\d/.exec(this.curr())),"."===this.curr()&&/\d/.exec(this.peek())&&(this.advance(),this.consumeWhile(()=>/\d/.exec(this.curr()))),"-"===this.curr()&&this.dateTimeLiterals?(this.pos.index=t-1,this.consumeDateTime()):(" "===this.curr()&&(e=this.peekToken())&&("String"===e.id||"Symbol"===e.id&&tP.includes(e.value))&&(n="Quantity",this.consumeToken()),this.buildToken(n,this.str.substring(t,this.pos.index)))}consumeSymbol(){var e;let t=this.consumeWhile(()=>this.symbolRegex.exec(this.curr()));return(null==(e=this.prevToken())?void 0:e.value)!=="."&&this.keywords.includes(t)?this.buildToken(t,t):this.buildToken("Symbol",t)}consumeOperator(){let e=this.curr(),t=e+this.peek();return this.operators.includes(t)?(this.advance(),this.advance(),this.buildToken(t,t)):(this.advance(),this.buildToken(e,e))}consumeWhile(e){let t=this.pos.index;for(;this.pos.index<this.str.length&&e();)this.advance();return this.str.substring(t,this.pos.index)}curr(){return this.str[this.pos.index]}peek(){var e;return null!=(e=this.str[this.pos.index+1])?e:""}mark(){this.markStack.push({...this.pos})}reset(){let e=this.markStack.pop();if(!e)throw Error("No mark to reset to");this.pos.index=e.index,this.pos.line=e.line,this.pos.column=e.column}advance(){this.pos.index++,"\n"===this.curr()?(this.pos.line++,this.pos.column=0):this.pos.column++}buildToken(e,t){let n=this.markStack.pop();if(!n)throw Error("No mark for token");return{id:e,value:t,...n}}constructor(e,t,n,r){var i;s(this,"str"),s(this,"keywords"),s(this,"operators"),s(this,"dateTimeLiterals"),s(this,"symbolRegex"),s(this,"result",[]),s(this,"pos",{index:0,line:1,column:0}),s(this,"markStack",[]),this.str=e,this.keywords=t,this.operators=n,this.dateTimeLiterals=!!(null==r?void 0:r.dateTimeLiterals),this.symbolRegex=null!=(i=null==r?void 0:r.symbolRegex)?i:/[$\w%]/}},tj=["true","false"],tD=["!=","!~","<=",">=","{}","->"],tM={FunctionCall:0,Dot:1,Indexer:2,UnaryAdd:3,UnarySubtract:3,Multiply:4,Divide:4,Modulo:4,Add:5,Subtract:5,Ampersand:5,Is:6,As:6,Union:7,GreaterThan:8,GreaterThanOrEquals:8,LessThan:8,LessThanOrEquals:8,Equals:9,Equivalent:9,NotEquals:9,NotEquivalent:9,In:10,Contains:10,And:11,Xor:12,Or:12,Implies:13,Arrow:100,Semicolon:200},tL={parse(e){var t;let n=e.consumeAndParse();if(!e.match(")"))throw Error("Parse error: expected `)` got `"+(null==(t=e.peek())?void 0:t.value)+"`");return n}},tU={parse(e,t){let n=e.consumeAndParse();if(!e.match("]"))throw Error("Parse error: expected `]`");return new tA(t,n)},precedence:tM.Indexer},tI={parse(e,t){if(!(t instanceof ts))throw Error("Unexpected parentheses");let n=[];for(;!e.match(")");)n.push(e.consumeAndParse()),e.match(",");return new tC(t.name,n)},precedence:tM.FunctionCall};function tO(){return new c().registerPrefix("String",{parse:(e,t)=>new to({type:eZ.string,value:t.value})}).registerPrefix("DateTime",{parse:(e,t)=>new to({type:eZ.dateTime,value:e5(t.value)})}).registerPrefix("Quantity",{parse:(e,t)=>{let n,r;return new to({type:eZ.Quantity,value:{value:Number.parseFloat((n=t.value.split(" "))[0]),unit:r=(null==(r=n[1])?void 0:r.startsWith("'"))&&r.endsWith("'")?r.substring(1,r.length-1):"{"+r+"}"}})}}).registerPrefix("Number",{parse:(e,t)=>new to({type:t.value.includes(".")?eZ.decimal:eZ.integer,value:Number.parseFloat(t.value)})}).registerPrefix("true",{parse:()=>new to({type:eZ.boolean,value:!0})}).registerPrefix("false",{parse:()=>new to({type:eZ.boolean,value:!1})}).registerPrefix("Symbol",{parse:(e,t)=>new ts(t.value)}).registerPrefix("{}",{parse:()=>new ta}).registerPrefix("(",tL).registerInfix("[",tU).registerInfix("(",tI).prefix("+",tM.UnaryAdd,(e,t)=>new tl("+",t,e=>e)).prefix("-",tM.UnarySubtract,(e,t)=>new td("-",t,t,(e,t)=>-t)).infixLeft(".",tM.Dot,(e,t,n)=>new ty(e,n)).infixLeft("/",tM.Divide,(e,t,n)=>new td("/",e,n,(e,t)=>e/t)).infixLeft("*",tM.Multiply,(e,t,n)=>new td("*",e,n,(e,t)=>e*t)).infixLeft("+",tM.Add,(e,t,n)=>new td("+",e,n,(e,t)=>e+t)).infixLeft("-",tM.Subtract,(e,t,n)=>new td("-",e,n,(e,t)=>e-t)).infixLeft("|",tM.Union,(e,t,n)=>new tm(e,n)).infixLeft("=",tM.Equals,(e,t,n)=>new tg(e,n)).infixLeft("!=",tM.NotEquals,(e,t,n)=>new tv(e,n)).infixLeft("~",tM.Equivalent,(e,t,n)=>new tx(e,n)).infixLeft("!~",tM.NotEquivalent,(e,t,n)=>new tb(e,n)).infixLeft("<",tM.LessThan,(e,t,n)=>new td("<",e,n,(e,t)=>e<t)).infixLeft("<=",tM.LessThanOrEquals,(e,t,n)=>new td("<=",e,n,(e,t)=>e<=t)).infixLeft(">",tM.GreaterThan,(e,t,n)=>new td(">",e,n,(e,t)=>e>t)).infixLeft(">=",tM.GreaterThanOrEquals,(e,t,n)=>new td(">=",e,n,(e,t)=>e>=t)).infixLeft("&",tM.Ampersand,(e,t,n)=>new tf(e,n)).infixLeft("and",tM.And,(e,t,n)=>new tS(e,n)).infixLeft("as",tM.As,(e,t,n)=>new tc(e,n)).infixLeft("contains",tM.Contains,(e,t,n)=>new th(e,n)).infixLeft("div",tM.Divide,(e,t,n)=>new td("div",e,n,(e,t)=>e/t|0)).infixLeft("in",tM.In,(e,t,n)=>new tp(e,n)).infixLeft("is",tM.Is,(e,t,n)=>new tE(e,n)).infixLeft("mod",tM.Modulo,(e,t,n)=>new td("mod",e,n,(e,t)=>e%t)).infixLeft("or",tM.Or,(e,t,n)=>new tw(e,n)).infixLeft("xor",tM.Xor,(e,t,n)=>new tT(e,n)).infixLeft("implies",tM.Implies,(e,t,n)=>new tk(e,n))}var tN=tO();function tq(e,t,n){n&&(n.display&&tB(e,t,t.textSearchSystem,n.display),tB(e,t,n.system,n.code))}function tB(e,t,n,r){(n||r)&&!e.some(e=>e.system===n&&e.value===r)&&e.push({system:n,value:r&&t.caseInsensitive?r.toLocaleLowerCase():r})}var tF={EQUALS:"eq",NOT_EQUALS:"ne",GREATER_THAN:"gt",LESS_THAN:"lt",GREATER_THAN_OR_EQUALS:"ge",LESS_THAN_OR_EQUALS:"le",STARTS_AFTER:"sa",ENDS_BEFORE:"eb",APPROXIMATELY:"ap",CONTAINS:"contains",STARTS_WITH:"sw",EXACT:"exact",TEXT:"text",NOT:"not",ABOVE:"above",BELOW:"below",IN:"in",NOT_IN:"not-in",OF_TYPE:"of-type",MISSING:"missing",PRESENT:"present",IDENTIFIER:"identifier",ITERATE:"iterate"},tW={contains:tF.CONTAINS,exact:tF.EXACT,above:tF.ABOVE,below:tF.BELOW,text:tF.TEXT,not:tF.NOT,in:tF.IN,"not-in":tF.NOT_IN,"of-type":tF.OF_TYPE,missing:tF.MISSING,identifier:tF.IDENTIFIER,iterate:tF.ITERATE},tQ={eq:tF.EQUALS,ne:tF.NOT_EQUALS,lt:tF.LESS_THAN,le:tF.LESS_THAN_OR_EQUALS,gt:tF.GREATER_THAN,ge:tF.GREATER_THAN_OR_EQUALS,sa:tF.STARTS_AFTER,eb:tF.ENDS_BEFORE,ap:tF.APPROXIMATELY,sw:tF.STARTS_WITH},tH=[tF.MISSING,tF.PRESENT];function tz(e){let t=e.split(":");if(t.includes("*"))throw new w(x("'*' is not supported as a value for search inclusion parameters"));if(1===t.length)throw new w(x("Invalid include value '".concat(e,"': must be of the form ResourceType:search-parameter")));if(2===t.length)return{resourceType:t[0],searchParam:t[1]};if(3===t.length)return{resourceType:t[0],searchParam:t[1],targetType:t[2]};throw new w(x("Invalid include value '".concat(e,"'")))}function tX(e,t){return"date"!==e.type||ei(t)}function tG(e){let t=[],n="",r=!1;for(let i of e)r?(n+=i,r=!1):"\\"===i?r=!0:","===i?(t.push(n),n=""):n+=i;return t.push(n),t}function tV(e){return e===tF.NOT_EQUALS||e===tF.NOT}var tK={resourceType:"*"},tJ=["UserSecurityRequest","Project","ProjectMembership","User"],t$={READ:"read",VREAD:"vread",UPDATE:"update",DELETE:"delete",HISTORY:"history",CREATE:"create",SEARCH:"search"},tZ=[t$.READ,t$.VREAD,t$.HISTORY,t$.SEARCH];function tY(e,t,n){var r;return n?null==(r=n.resource)?void 0:r.find(n=>{var r,i,o,s,a,l,c,u;let d;return r=e,i=t,o=n,d=r.resourceType,l=o,c=d,u=i,!!(!(l.resourceType!==c&&("*"!==l.resourceType||tJ.includes(c)))&&(l.interaction?l.interaction.includes(u):!l.readonly||tZ.includes(u)))&&("Binary"===d||!(o.compartment&&!(null==(a=r.meta)||null==(s=a.compartment)?void 0:s.some(e=>{var t;return e.reference===(null==(t=o.compartment)?void 0:t.reference)}))||o.criteria&&!function(e,t){if(t.resourceType!==e.resourceType)return!1;if(t.filters){for(let n of t.filters)if(!function(e,t,n){var r,i;let o=null==(i=e7.types[t.resourceType])||null==(r=i.searchParams)?void 0:r[n.code];if(!o)return!1;let s=function(e,t){let n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;if("string"==typeof e){var o;let t=null==i?void 0:i.get(e);n=null!=t?t:new ti(o=e,tN.construct(new t_(o,tj,tD).tokenize()).consumeAndParse()),i&&!t&&i.set(e,n)}else n=e;return n.eval({variables:r},t).map(e=>{var t;let n={type:e.type,value:null==(t=e.value)?void 0:t.valueOf()};return"path"in e&&(n.path=e.path),n})}(o.expression,[G(e)]);if(n.operator===tF.MISSING||n.operator===tF.PRESENT)return function(e,t){let n=e.length>0;return(t.operator===tF.MISSING&&"false"===t.value||t.operator===tF.PRESENT&&"true"===t.value)===n}(s,n);switch(o.type){case"reference":return function(e,t){let n=tV(t.operator);if(""===t.value&&0===e.length)return t.operator===tF.EQUALS;let r=function(e){let t=new Set;for(let n of e){let{value:e}=n;e&&("string"==typeof e?t.add(e):e6(e)?t.add(e.reference):eh(e)?t.add(ey(e)):"object"==typeof e.identifier&&t.add("identifier:".concat(e.identifier.system,"|").concat(e.identifier.value)))}return Array.from(t)}(e);for(let e of tG(t.value)){let i=r.includes(e);if(i||"_compartment"!==t.code||(i=r.some(t=>null==t?void 0:t.endsWith("/"+e))),i)return!n}return n}(s,n);case"string":case"uri":return function(e,t){let n=function(e){let t=new Set;for(let n of e){let e=function(e){if(!e)return"";switch(e.type){case"Address":return eI(e.value);case"CodeableConcept":return eV(e.value);case"Coding":return eK(e.value);case"ContactPoint":return e.value.value;case"HumanName":return eO(e.value);case"Quantity":return eX(e.value);case"Reference":return function(e){var t,n;return e?null!=(n=null!=(t=e.display)?t:e.reference)?n:eE(e):""}(e.value);default:var t,n;return null!=(n=null==(t=e.value)?void 0:t.toString())?n:""}}(n);e&&t.add(e)}return Array.from(t)}(e),r=tG(t.value),i=tV(t.operator);for(let e of n)for(let t of r){var o,s;if(o=e,s=t,o.toLowerCase().includes(s.toLowerCase()))return!i}return i}(s,n);case"token":return function(e,t){let n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];for(let r of e)!function(e,t,n){let{type:r,value:i}=n;switch(r){case eZ.Identifier:!function(e,t,n){var r;(null==n||null==(r=n.type)?void 0:r.text)&&tB(e,t,t.textSearchSystem,n.type.text),tB(e,t,null==n?void 0:n.system,null==n?void 0:n.value)}(t,e,i);break;case eZ.CodeableConcept:var o=t,s=e,a=i;if((null==a?void 0:a.text)&&tB(o,s,s.textSearchSystem,a.text),null==a?void 0:a.coding)for(let e of a.coding)tq(o,s,e);break;case eZ.Coding:tq(t,e,i);break;case eZ.ContactPoint:!function(e,t,n){var r;n&&tB(e,t,n.system,null==(r=n.value)?void 0:r.toLocaleLowerCase())}(t,e,i);break;default:tB(t,e,void 0,null==i?void 0:i.toString())}}(t,n,r);return n}(e),r=tG(t.value),i=tV(t.operator);for(let e of n)for(let t of r)if(function(e,t){var n,r,i,o;if(t.includes("|")){let[n,s]=t.split("|").map(e=>e.toLowerCase());return(!!n||!!s)&&(n?(null==(r=e.system)?void 0:r.toLowerCase())===n&&(!s||(null==(i=e.value)?void 0:i.toLowerCase())===s):!e.system&&(null==(o=e.value)?void 0:o.toLowerCase())===s)}return(null==(n=e.value)?void 0:n.toLowerCase())===t.toLowerCase()}(e,t))return!i;return i}(s,n);case"date":return function(e,t){let n=function(e){let t=[];for(let n of e){let e=es(n.value);e&&t.push(e)}return t}(e),r=tG(t.value),i=tV(t.operator);for(let e of n)for(let n of r)if(function(e,t,n){var r,i;if(!e)return!1;let o=es(n);if(!o)return!1;let s=null!=(r=e.start)?r:"0000",a=null!=(i=e.end)?i:"9999",l=o.start,c=o.end;switch(t){case tF.APPROXIMATELY:case tF.EQUALS:case tF.NOT_EQUALS:return s<c&&a>l;case tF.LESS_THAN:return s<l;case tF.GREATER_THAN:return a>c;case tF.LESS_THAN_OR_EQUALS:return s<=c;case tF.GREATER_THAN_OR_EQUALS:return a>=l;case tF.STARTS_AFTER:return s>c;case tF.ENDS_BEFORE:return a<l;default:return!1}}(e,t.operator,n))return!i;return i}(s,n);default:return!1}}(e,t,n))return!1}return!0}(r,function(e,t){let n;if(!e)throw Error("Invalid search URL");let r="",i;if("string"==typeof e)if(e.includes("?")){let[t,n]=e.split("?");r=t,i=new URLSearchParams(n)}else r=e;else"object"==typeof e&&(r=e.pathname,i=e.searchParams);n=r.includes("/")?r.split("/").filter(Boolean).pop():r;let o=[];i&&o.push(...i.entries());var s=n,a=o;let l={resourceType:s};for(let[e,t]of a)!function(e,t,n){let r,i,o=t.indexOf(":");if(o>=0?(r=t.substring(0,o),i=t.substring(o+1)):(r=t,i=""),"_"!==r){if("_has"===r||t.includes(".")){e.filters=eM(e.filters,{code:t,operator:tF.EQUALS,value:n});return}switch(r){case"_sort":var s,a,l=e,c=n;for(let e of c.split(",")){let t,n=!1;e.startsWith("-")?(t=e.substring(1),n=!0):t=e,l.sortRules||(l.sortRules=[]),l.sortRules.push({code:t,descending:n})}break;case"_cursor":e.cursor=n;break;case"_count":e.count=Number.parseInt(n,10);break;case"_offset":e.offset=Number.parseInt(n,10);break;case"_total":e.total=n;break;case"_summary":"count"===n?(e.total="accurate",e.count=0):("true"===n||"data"===n||"text"===n)&&(e.summary=n);break;case"_include":{let t=tz(n);"iterate"===i&&(t.modifier=tF.ITERATE),e.include=eM(e.include,t);break}case"_revinclude":{let t=tz(n);"iterate"===i&&(t.modifier=tF.ITERATE),e.revInclude=eM(e.revInclude,t);break}case"_fields":case"_elements":e.fields=n.split(",");break;case"_type":e.types=n.split(",");break;case"_format":e.format=n;break;case"_pretty":e.pretty="true"===n;break;default:{let t=null==(a=e7.types[e.resourceType])||null==(s=a.searchParams)?void 0:s[r];t?e.filters=eM(e.filters,function(e,t,n){if(tH.includes(t))return{code:e.code,operator:t,value:n};switch(e.type){case"number":case"date":case"quantity":{let{operator:r,value:i}=function(e,t){let n=tQ[e.substring(0,2)];return n?{operator:n,value:e.substring(2)}:{operator:t,value:e}}(n,t||tF.EQUALS);if(!tX(e,i))throw new w(x("Invalid format for ".concat(e.type," search parameter: ").concat(i)));return{code:e.code,operator:r,value:i}}case"reference":case"string":case"token":case"uri":if(!tX(e,n))throw new w(x("Invalid format for ".concat(e.type," search parameter: ").concat(n)));return{code:e.code,operator:function(e){var t;return null!=(t=tW[e])?t:tF.EQUALS}(t),value:n};default:throw Error("Unrecognized search parameter type: "+e.type)}}(t,i,n)):e.filters=eM(e.filters,function(e,t,n){let r=tF.EQUALS;if(t)r=t;else if(n.length>=2){var i;let e=n.substring(0,2);e in tQ&&(2===n.length||(null==(i=n.at(2))?void 0:i.match(/\d/)))&&(r=e,n=n.substring(e.length))}return{code:e,operator:r,value:n}}(r,i,n))}}}}(l,e,t);return l}(o.criteria))))}):tK}var t0={assign(e){globalThis.location.assign(e)},reload(){globalThis.location.reload()},getSearch:()=>globalThis.location.search,getPathname:()=>globalThis.location.pathname,getLocation:()=>globalThis.location.toString(),getOrigin:()=>globalThis.location.protocol+"//"+globalThis.location.host+"/"};function t1(e){{let t=new window.TextEncoder().encode(e),n=String.fromCharCode.apply(null,t);return window.btoa(n)}}function t2(){let e=new Uint32Array(28);return crypto.getRandomValues(e),function(e){let t=new Uint8Array(eR(e)),n=Array(t.length);for(let e=0;e<t.length;e++)n[e]=eP[t[e]];return n.join("")}(e.buffer)}async function t4(e){return crypto.subtle.digest("SHA-256",new TextEncoder().encode(e))}var t3={CSS:"text/css",DICOM:"application/dicom",FAVICON:"image/vnd.microsoft.icon",FHIR_JSON:"application/fhir+json",FORM_URL_ENCODED:"application/x-www-form-urlencoded",HL7_V2:"x-application/hl7-v2+er7",HTML:"text/html",JAVASCRIPT:"text/javascript",JSON:"application/json",JSON_PATCH:"application/json-patch+json",JWT:"application/jwt",MULTIPART_FORM_DATA:"multipart/form-data",PNG:"image/png",SCIM_JSON:"application/scim+json",SVG:"image/svg+xml",TEXT:"text/plain",TYPESCRIPT:"text/typescript",PING:"x-application/ping",XML:"text/xml",CDA_XML:"application/cda+xml",OCTET_STREAM:"application/octet-stream"},t6=class{addEventListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}removeEventListener(e,t){let n=this.listeners[e];if(n){for(let e=0;e<n.length;e++)if(n[e]===t)return void n.splice(e,1)}}dispatchEvent(e){let t=this.listeners[e.type];if(t)for(let n of t)n.call(this,e);return!e.defaultPrevented}removeAllListeners(){this.listeners={}}listenerCount(e){var t,n;return null!=(n=null==(t=this.listeners[e])?void 0:t.length)?n:0}constructor(){s(this,"listeners"),this.listeners={}}},t7=class{dispatchEvent(e){this.emitter.dispatchEvent(e)}addEventListener(e,t){this.emitter.addEventListener(e,t)}removeEventListener(e,t){this.emitter.removeEventListener(e,t)}removeAllListeners(){this.emitter.removeAllListeners()}listenerCount(e){return this.emitter.listenerCount(e)}constructor(){s(this,"emitter",new t6)}},t5={"Patient-open":"Patient-open","Patient-close":"Patient-close","ImagingStudy-open":"ImagingStudy-open","ImagingStudy-close":"ImagingStudy-close","Encounter-open":"Encounter-open","Encounter-close":"Encounter-close","DiagnosticReport-open":"DiagnosticReport-open","DiagnosticReport-close":"DiagnosticReport-close","DiagnosticReport-select":"DiagnosticReport-select","DiagnosticReport-update":"DiagnosticReport-update",syncerror:"syncerror"},t8=["Patient","Encounter","ImagingStudy","DiagnosticReport","OperationOutcome","Bundle"],t9=["DiagnosticReport-update"],ne={"Patient-open":{patient:{resourceType:"Patient"},encounter:{resourceType:"Encounter",optional:!0}},"Patient-close":{patient:{resourceType:"Patient"},encounter:{resourceType:"Encounter",optional:!0}},"ImagingStudy-open":{study:{resourceType:"ImagingStudy"},encounter:{resourceType:"Encounter",optional:!0},patient:{resourceType:"Patient",optional:!0}},"ImagingStudy-close":{study:{resourceType:"ImagingStudy"},encounter:{resourceType:"Encounter",optional:!0},patient:{resourceType:"Patient",optional:!0}},"Encounter-open":{encounter:{resourceType:"Encounter"},patient:{resourceType:"Patient"}},"Encounter-close":{encounter:{resourceType:"Encounter"},patient:{resourceType:"Patient"}},"DiagnosticReport-open":{report:{resourceType:"DiagnosticReport"},encounter:{resourceType:"Encounter",optional:!0},study:{resourceType:"ImagingStudy",optional:!0,manyAllowed:!0},patient:{resourceType:"Patient"}},"DiagnosticReport-close":{report:{resourceType:"DiagnosticReport"},encounter:{resourceType:"Encounter",optional:!0},study:{resourceType:"ImagingStudy",optional:!0,manyAllowed:!0},patient:{resourceType:"Patient"}},"DiagnosticReport-select":{report:{resourceType:"DiagnosticReport",reference:!0},patient:{resourceType:"Patient",optional:!0,reference:!0},select:{resourceType:"*",reference:!0,manyAllowed:!0}},"DiagnosticReport-update":{report:{resourceType:"DiagnosticReport",reference:!0},patient:{resourceType:"Patient",optional:!0,reference:!0},updates:{resourceType:"Bundle"}},syncerror:{operationoutcome:{resourceType:"OperationOutcome"}}};function nt(e){return!!e.endpoint}function nn(e){if(!nr(e))throw new w(b("subscriptionRequest must be an object conforming to SubscriptionRequest type."));let{channelType:t,mode:n,topic:r,events:i}=e,o={"hub.channel.type":t,"hub.mode":n,"hub.topic":r,"hub.events":i.join(",")};return nt(e)&&(o.endpoint=e.endpoint),new URLSearchParams(o).toString()}function nr(e){if("object"!=typeof e)return!1;let{channelType:t,mode:n,topic:r,events:i}=e;if(!(t&&n&&r&&i)||"string"!=typeof r||"object"!=typeof i||!Array.isArray(i)||i.length<1||"websocket"!==t||"subscribe"!==n&&"unsubscribe"!==n)return!1;for(let e of i)if(!t5[e])return!1;return!(nt(e)&&!("string"==typeof e.endpoint&&e.endpoint.startsWith("ws")))}function ni(e,t,n,r){if(!(e&&"string"==typeof e))throw new w(b("Must provide a topic."));if(!t5[t])throw new w(b("Must provide a valid FHIRcast event name. Supported events: ".concat(Object.keys(t5).join(", "))));if("object"!=typeof n)throw new w(b("context must be a context object or array of context objects."));if(t9.includes(t)&&!r)throw new w(b("The '".concat(t,"' event must contain a 'context.versionId'.")));let i=Array.isArray(n)?n:[n];return function(e,t){let n=new Map,r=ne[e];for(let i=0;i<t.length;i++){let o=t[i].key;if(!r[o])throw new w(b("Key '".concat(o,"' not found for event '").concat(e,"'. Make sure to add only valid keys.")));!function(e,t,n,r,i){var o;if(i.set(t.key,(null!=(o=i.get(t.key))?o:0)+1),r.reference){if(!e6(t.reference))throw new w(b("context[".concat(n,"] is invalid. Expected key '").concat(t.key,"' to be a reference.")))}else{var s,a=t.resource;if("object"!=typeof a)throw new w(b("context[".concat(n,"] is invalid. Context must contain a single valid FHIR resource! Resource is not an object.")));if(!(a.id&&"string"==typeof a.id))throw new w(b("context[".concat(n,"] is invalid. Resource must contain a valid string ID.")));if(!a.resourceType)throw new w(b("context[".concat(n,"] is invalid. Resource must contain a resource type. No resource type found.")));let i=r.resourceType;if("*"!==i){if(s=a.resourceType,!t8.includes(s))throw new w(b("context[".concat(n,"] is invalid. Resource must contain a valid FHIRcast resource type. Resource type is not a known resource type.")));if(i&&a.resourceType!==i)throw new w(b("context[".concat(n,"] is invalid. context[").concat(n,"] for the '").concat(e,"' event should contain resource of type ").concat(i,".")))}}}(e,t[i],i,r[o],n)}for(let[t,o]of Object.entries(r)){var i;if(!(o.optional||n.has(t)))throw new w(b("Missing required key '".concat(t,"' on context for '").concat(e,"' event.")));if(!o.manyAllowed&&(null!=(i=n.get(t))?i:0)>1)throw new w(b("".concat(n.get(t)," context entries with key '").concat(t,"' found for the '").concat(e,"' event when schema only allows for 1.")))}}(t,i),{timestamp:new Date().toISOString(),id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replaceAll(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),event:{"hub.topic":e,"hub.event":t,context:i,...r?{"context.versionId":r}:{}}}}var no=class extends t7{disconnect(){this.websocket.close()}constructor(e){if(super(),s(this,"subRequest"),s(this,"websocket"),this.subRequest=e,!e.endpoint)throw new w(b("Subscription request should contain an endpoint."));if(!nr(e))throw new w(b("Subscription request failed validation."));let t=new WebSocket(e.endpoint);t.addEventListener("open",()=>{this.dispatchEvent({type:"connect"}),t.addEventListener("message",e=>{let n=JSON.parse(e.data);n["hub.topic"]||"heartbeat"!==n.event["hub.event"]&&(this.dispatchEvent({type:"message",payload:n}),t.send(JSON.stringify({id:null==n?void 0:n.id,timestamp:new Date().toISOString()})))}),t.addEventListener("close",()=>{this.dispatchEvent({type:"disconnect"})})}),this.websocket=t}};function ns(e){var t,n;let[r,i,o]=e.split(".");return JSON.parse(void(n=(t=(t=i).padEnd(t.length+(4-t.length%4)%4,"=")).replaceAll("-","+").replaceAll("_","/")))}var na=class{async get(e){return this.medplum.get("keyvalue/v1/".concat(e))}async set(e,t){await this.medplum.put("keyvalue/v1/".concat(e),t,t3.TEXT)}async delete(e){await this.medplum.delete("keyvalue/v1/".concat(e))}constructor(e){s(this,"medplum"),this.medplum=e}};r=Symbol.toStringTag;var nl=class{isPending(){return"pending"===this.status}isOk(){return"success"===this.status}read(){switch(this.status){case"pending":throw this.suspender;case"error":throw this.error;default:return this.response}}then(e,t){return this.suspender.then(e,t)}catch(e){return this.suspender.catch(e)}finally(e){return this.suspender.finally(e)}constructor(e){s(this,r,"ReadablePromise"),s(this,"suspender"),s(this,"status","pending"),s(this,"response"),s(this,"error"),this.suspender=e.then(e=>(this.status="success",this.response=e,e),e=>{throw this.status="error",this.error=e,e})}},nc=class{makeKey(e){return this.prefix+e}clear(){this.storage===globalThis.localStorage&&this.prefix?Object.keys(this.storage).filter(e=>e.startsWith(this.prefix)).forEach(e=>{this.storage.removeItem(e)}):this.storage.clear()}getString(e){var t;return null!=(t=this.storage.getItem(this.makeKey(e)))?t:void 0}setString(e,t){t?this.storage.setItem(this.makeKey(e),t):this.storage.removeItem(this.makeKey(e))}getObject(e){let t=this.getString(e);return t?JSON.parse(t):void 0}setObject(e,t){this.setString(e,t?eE(t):void 0)}constructor(e,t=""){var n;s(this,"storage"),s(this,"prefix",""),this.storage=null!=(n=null!=e?e:globalThis.localStorage)?n:new nu,this.prefix=t}},nu=class{get length(){return this.data.size}clear(){this.data.clear()}getItem(e){var t;return null!=(t=this.data.get(e))?t:null}setItem(e,t){t?this.data.set(e,t):this.data.delete(e)}removeItem(e){this.data.delete(e)}key(e){return Array.from(this.data.keys())[e]}constructor(){s(this,"data"),this.data=new Map}},nd={Event:"u">typeof globalThis.Event?globalThis.Event:void 0,ErrorEvent:void 0,CloseEvent:void 0},nf=!1;function nh(e){return new e.constructor(e.type,e)}var np={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0},ny=!1,nm=class e extends t7{static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return e.CONNECTING}get OPEN(){return e.OPEN}get CLOSING(){return e.CLOSING}get CLOSED(){return e.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(e){this._binaryType=e,this._ws&&(this._ws.binaryType=e)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){var e,t;return this._messageQueue.reduce((e,t)=>("string"==typeof t?e+=t.length:t instanceof Blob?e+=t.size:e+=t.byteLength,e),0)+(null!=(t=null==(e=this._ws)?void 0:e.bufferedAmount)?t:0)}get extensions(){var e,t;return null!=(t=null==(e=this._ws)?void 0:e.extensions)?t:""}get protocol(){var e,t;return null!=(t=null==(e=this._ws)?void 0:e.protocol)?t:""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?e.CLOSED:e.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}close(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1?arguments[1]:void 0;return(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws)?this._ws.readyState===this.CLOSED?void this._debug("close: already closed"):void this._ws.close(e,t):void this._debug("close enqueued: no ws instance")}reconnect(e,t){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED&&this._disconnect(e,t),this._connect()}send(e){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",e),this._ws.send(e);else{let{maxEnqueuedMessages:t=np.maxEnqueuedMessages}=this._options;this._messageQueue.length<t&&(this._debug("enqueue",e),this._messageQueue.push(e))}}_debug(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this._options.debug&&this._debugLogger("RWS>",...t)}_getNextDelay(){let{reconnectionDelayGrowFactor:e=np.reconnectionDelayGrowFactor,minReconnectionDelay:t=np.minReconnectionDelay,maxReconnectionDelay:n=np.maxReconnectionDelay}=this._options,r=0;return this._retryCount>0&&(r=t*Math.pow(e,this._retryCount-1))>n&&(r=n),this._debug("next delay",r),r}_wait(){return new Promise(e=>{setTimeout(e,this._getNextDelay())})}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;let{maxRetries:e=np.maxRetries,connectionTimeout:t=np.connectionTimeout}=this._options;if(this._retryCount>=e)return void this._debug("max retries reached",this._retryCount,">=",e);this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!ny&&(console.error(" No WebSocket implementation available. You should define options.WebSocket."),ny=!0);let e=this._options.WebSocket||WebSocket;this._debug("connect",{url:this._url,protocols:this._protocols}),this._ws=this._protocols?new e(this._url,this._protocols):new e(this._url),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),t)}).catch(e=>{this._connectLock=!1,this._handleError(new nd.ErrorEvent(Error(e.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new nd.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1?arguments[1]:void 0;if(this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(e,t),this._handleClose(new nd.CloseEvent(e,t,this))}catch(e){}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}constructor(e,t,n={}){nf||(function(){if(typeof globalThis.Event>"u")throw Error("Unable to lazy init events for ReconnectingWebSocket. globalThis.Event is not defined yet");nd.Event=globalThis.Event,nd.ErrorEvent=class extends Event{constructor(e,t){super("error",t),s(this,"message"),s(this,"error"),this.message=e.message,this.error=e}},nd.CloseEvent=class extends Event{constructor(e=1e3,t="",n){super("close",n),s(this,"code"),s(this,"reason"),s(this,"wasClean",!0),this.code=e,this.reason=t}}}(),nf=!0),super(),s(this,"_ws"),s(this,"_retryCount",-1),s(this,"_uptimeTimeout"),s(this,"_connectTimeout"),s(this,"_shouldReconnect",!0),s(this,"_connectLock",!1),s(this,"_binaryType"),s(this,"_closeCalled",!1),s(this,"_messageQueue",[]),s(this,"_debugLogger",console.log.bind(console)),s(this,"_url"),s(this,"_protocols"),s(this,"_options"),s(this,"onclose",null),s(this,"onerror",null),s(this,"onmessage",null),s(this,"onopen",null),s(this,"_handleOpen",e=>{this._debug("open event");let{minUptime:t=np.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),t),function(e,t){if(!e)throw Error(t)}(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(e=>{var t;return null==(t=this._ws)?void 0:t.send(e)}),this._messageQueue=[],this.onopen&&this.onopen(e),this.dispatchEvent(nh(e))}),s(this,"_handleMessage",e=>{this._debug("message event"),this.onmessage&&this.onmessage(e),this.dispatchEvent(nh(e))}),s(this,"_handleError",e=>{this._debug("error event",e.message),this._disconnect(void 0,"TIMEOUT"===e.message?"timeout":void 0),this.onerror&&this.onerror(e),this._debug("exec error listeners"),this.dispatchEvent(nh(e)),this._connect()}),s(this,"_handleClose",e=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(e),this.dispatchEvent(nh(e))}),this._url=e,this._protocols=t,this._options=n,this._options.startClosed&&(this._shouldReconnect=!1),this._options.binaryType?this._binaryType=this._options.binaryType:this._binaryType="blob",this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}},ng=class extends t7{getCriteria(){return this.criteria}_addCriteria(e){this.criteria.add(e)}_removeCriteria(e){this.criteria.delete(e)}constructor(...e){super(),s(this,"criteria"),this.criteria=new Set(e)}},nv=class{clearAttachedSubscription(){this.subscriptionId=void 0,this.token=void 0}constructor(e,t){s(this,"criteria"),s(this,"emitter"),s(this,"refCount"),s(this,"subscriptionProps"),s(this,"subscriptionId"),s(this,"token"),s(this,"connecting",!1),this.criteria=e,this.emitter=new ng(e),this.refCount=1,this.subscriptionProps=t?{...t}:void 0}},nx=class{setupListeners(){let e=this.ws;e.addEventListener("message",e=>{var t,n,r,i,o,s;try{let s=JSON.parse(e.data);if("pong"===s.type){this.waitingForPong=!1;return}let a=null==s||null==(n=s.entry)||null==(t=n[0])?void 0:t.resource;if("heartbeat"===a.type){null==(i=this.masterSubEmitter)||i.dispatchEvent({type:"heartbeat",payload:s});return}if("handshake"===a.type){let e=em(a.subscription),t={type:"connect",payload:{subscriptionId:e}};null==(o=this.masterSubEmitter)||o.dispatchEvent(t);let n=this.criteriaEntriesBySubscriptionId.get(e);if(!n)return void console.warn("Received handshake for criteria the SubscriptionManager is not listening for yet");n.connecting=!1,n.emitter.dispatchEvent({...t});return}null==(r=this.masterSubEmitter)||r.dispatchEvent({type:"message",payload:s});let l=this.criteriaEntriesBySubscriptionId.get(em(a.subscription));if(!l)return void console.warn("Received notification for criteria the SubscriptionManager is not listening for");l.emitter.dispatchEvent({type:"message",payload:s})}catch(t){console.error(t);let e={type:"error",payload:t};for(let t of(null==(s=this.masterSubEmitter)||s.dispatchEvent(e),this.getAllCriteriaEmitters()))t.dispatchEvent({...e})}}),e.addEventListener("error",()=>{var e;let t={type:"error",payload:new w({resourceType:"OperationOutcome",issue:[{severity:"error",code:"exception",details:{text:"Internal server error"},diagnostics:Error("WebSocket error").toString()}]})};for(let n of(null==(e=this.masterSubEmitter)||e.dispatchEvent(t),this.getAllCriteriaEmitters()))n.dispatchEvent({...t})}),e.addEventListener("close",()=>{var e,t;let n={type:"close"};for(let t of(null==(e=this.masterSubEmitter)||e.dispatchEvent(n),this.getAllCriteriaEmitters()))t.dispatchEvent({...n});this.pingTimer&&(clearInterval(this.pingTimer),this.pingTimer=void 0,this.waitingForPong=!1),this.wsClosed&&(this.criteriaEntries.clear(),this.criteriaEntriesBySubscriptionId.clear(),null==(t=this.masterSubEmitter)||t.removeAllListeners())}),e.addEventListener("open",()=>{var t;let n={type:"open"};for(let e of(null==(t=this.masterSubEmitter)||t.dispatchEvent(n),this.getAllCriteriaEmitters()))e.dispatchEvent({...n});this.refreshAllSubscriptions().catch(console.error),this.pingTimer||(this.pingTimer=setInterval(()=>{if(this.waitingForPong){this.waitingForPong=!1,e.reconnect();return}e.send(JSON.stringify({type:"ping"})),this.waitingForPong=!0},this.pingIntervalMs))}),this.medplum.addEventListener("change",()=>{var e;let t=this.medplum.getProfile();this.currentProfile&&void 0===t?this.ws.close():t&&(null==(e=this.currentProfile)?void 0:e.id)!==t.id&&this.ws.reconnect(),this.currentProfile=t})}emitError(e,t){var n;let r={type:"error",payload:t};null==(n=this.masterSubEmitter)||n.dispatchEvent(r),e.emitter.dispatchEvent({...r})}maybeEmitDisconnect(e){let{subscriptionId:t}=e;if(t){var n;let r={type:"disconnect",payload:{subscriptionId:t}};null==(n=this.masterSubEmitter)||n.dispatchEvent(r),e.emitter.dispatchEvent({...r})}else console.warn("Called disconnect for `CriteriaEntry` before `subscriptionId` was present.")}async getTokenForCriteria(e){var t,n;let r=null==e?void 0:e.subscriptionId;r||(r=(await this.medplum.createResource({...e.subscriptionProps,resourceType:"Subscription",status:"active",reason:"WebSocket subscription for ".concat(ey(this.medplum.getProfile())),channel:{type:"websocket"},criteria:e.criteria})).id);let{parameter:i}=await this.medplum.get("fhir/R4/Subscription/".concat(r,"/$get-ws-binding-token")),o=null==i||null==(t=i.find(e=>"token"===e.name))?void 0:t.valueString,s=null==i||null==(n=i.find(e=>"websocket-url"===e.name))?void 0:n.valueUrl;if(!o)throw new w(b("Failed to get token"));if(!s)throw new w(b("Failed to get URL from $get-ws-binding-token"));return[r,o]}maybeGetCriteriaEntry(e,t){let n=this.criteriaEntries.get(e);if(n){if(!t)return n.bareCriteria;for(let e of n.criteriaWithProps)if(eT(t,e.subscriptionProps))return e}}getAllCriteriaEmitters(){let e=[];for(let t of this.criteriaEntries.values())for(let n of(t.bareCriteria&&e.push(t.bareCriteria.emitter),t.criteriaWithProps))e.push(n.emitter);return e}addCriteriaEntry(e){let{criteria:t,subscriptionProps:n}=e,r;this.criteriaEntries.has(t)?r=this.criteriaEntries.get(t):(r={criteriaWithProps:[]},this.criteriaEntries.set(t,r)),n?r.criteriaWithProps.push(e):r.bareCriteria=e}removeCriteriaEntry(e){var t;let{criteria:n,subscriptionProps:r,subscriptionId:i,token:o}=e;if(!this.criteriaEntries.has(n))return;let s=this.criteriaEntries.get(n);r?s.criteriaWithProps=s.criteriaWithProps.filter(e=>!eT(r,e.subscriptionProps)):s.bareCriteria=void 0,s.bareCriteria||0!==s.criteriaWithProps.length||(this.criteriaEntries.delete(n),null==(t=this.masterSubEmitter)||t._removeCriteria(n)),i&&this.criteriaEntriesBySubscriptionId.delete(i),o&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"unbind-from-token",payload:{token:o}}))}async subscribeToCriteria(e){if(!(this.ws.readyState!==WebSocket.OPEN||e.connecting)){e.connecting=!0;try{let[t,n]=await this.getTokenForCriteria(e);e.subscriptionId=t,e.token=n,this.criteriaEntriesBySubscriptionId.set(t,e),this.ws.send(JSON.stringify({type:"bind-with-token",payload:{token:n}}))}catch(t){console.error(k(t)),this.emitError(e,t),this.removeCriteriaEntry(e)}}}async refreshAllSubscriptions(){for(let e of(this.criteriaEntriesBySubscriptionId.clear(),this.criteriaEntries.values()))for(let t of[...e.bareCriteria?[e.bareCriteria]:[],...e.criteriaWithProps])t.clearAttachedSubscription(),await this.subscribeToCriteria(t)}addCriteria(e,t){this.masterSubEmitter&&this.masterSubEmitter._addCriteria(e);let n=this.maybeGetCriteriaEntry(e,t);if(n)return n.refCount+=1,n.emitter;let r=new nv(e,t);return this.addCriteriaEntry(r),this.subscribeToCriteria(r).catch(console.error),r.emitter}removeCriteria(e,t){let n=this.maybeGetCriteriaEntry(e,t);if(!n)return void console.warn("Criteria not known to `SubscriptionManager`. Possibly called remove too many times.");n.refCount-=1,n.refCount>0||(this.maybeEmitDisconnect(n),this.removeCriteriaEntry(n))}getWebSocket(){return this.ws}closeWebSocket(){this.wsClosed||(this.wsClosed=!0,this.ws.close())}reconnectWebSocket(){this.ws.reconnect(),this.wsClosed=!1}getCriteriaCount(){return this.getAllCriteriaEmitters().length}getMasterEmitter(){return this.masterSubEmitter||(this.masterSubEmitter=new ng(...Array.from(this.criteriaEntries.keys()))),this.masterSubEmitter}constructor(e,t,n){var r;let i;if(s(this,"medplum"),s(this,"ws"),s(this,"masterSubEmitter"),s(this,"criteriaEntries"),s(this,"criteriaEntriesBySubscriptionId"),s(this,"wsClosed"),s(this,"pingTimer"),s(this,"pingIntervalMs"),s(this,"waitingForPong",!1),s(this,"currentProfile"),!(e instanceof nk))throw new w(b("First arg of constructor should be a `MedplumClient`"));try{i=new URL(t).toString()}catch(e){throw new w(b("Not a valid URL"))}let o=(null==n?void 0:n.ReconnectingWebSocket)?new n.ReconnectingWebSocket(i,void 0,{debug:null==n?void 0:n.debug,debugLogger:null==n?void 0:n.debugLogger}):new nm(i,void 0,{debug:null==n?void 0:n.debug,debugLogger:null==n?void 0:n.debugLogger});this.medplum=e,this.ws=o,this.masterSubEmitter=new ng,this.criteriaEntries=new Map,this.criteriaEntriesBySubscriptionId=new Map,this.wsClosed=!1,this.pingIntervalMs=null!=(r=null==n?void 0:n.pingIntervalMs)?r:5e3,this.currentProfile=e.getProfile(),this.setupListeners()}},nb=t3.FHIR_JSON+", */*; q=0.1",nE={resourceType:"Device",id:"system",deviceName:[{type:"model-name",name:"System"}]},nS={ClientCredentials:"client_credentials",AuthorizationCode:"authorization_code",RefreshToken:"refresh_token",JwtBearer:"urn:ietf:params:oauth:grant-type:jwt-bearer",TokenExchange:"urn:ietf:params:oauth:grant-type:token-exchange"},nw={AccessToken:"urn:ietf:params:oauth:token-type:access_token"},nT={JwtBearer:"urn:ietf:params:oauth:client-assertion-type:jwt-bearer"},nk=class extends t7{get isInitialized(){return this.initComplete}getInitPromise(){return this.initPromise}async attemptResumeActiveLogin(){let e=this.getActiveLogin();e&&(this.setAccessToken(e.accessToken,e.refreshToken),await this.refreshProfile())}getBaseUrl(){return this.baseUrl}getAuthorizeUrl(){return this.authorizeUrl}getTokenUrl(){return this.tokenUrl}getLogoutUrl(){return this.logoutUrl}getFhircastHubUrl(){return this.fhircastHubUrl}getDefaultHeaders(){return this.defaultHeaders}clear(){this.storage.clear(),sessionStorage.clear(),this.clearActiveLogin()}clearActiveLogin(){var e;this.storage.setString("activeLogin",void 0),null==(e=this.requestCache)||e.clear(),this.accessToken=void 0,this.refreshToken=void 0,this.refreshPromise=void 0,this.accessTokenExpires=void 0,this.sessionDetails=void 0,this.medplumServer=void 0,this.dispatchEvent({type:"change"})}invalidateUrl(e){var t;e=e.toString(),null==(t=this.requestCache)||t.delete(e)}invalidateAll(){var e;null==(e=this.requestCache)||e.clear()}invalidateSearches(e){let t=eU(this.fhirBaseUrl,e);if(this.requestCache)for(let e of this.requestCache.keys())(e.endsWith(t)||e.includes(t+"?"))&&this.requestCache.delete(e)}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e.toString();let n=this.getCacheEntry(e,t);if(n)return n.value;let r=new nl(e.startsWith(this.fhirBaseUrl)&&this.autoBatchQueue&&!t.disableAutoBatch?new Promise((n,r)=>{this.autoBatchQueue.push({method:"GET",url:e.replace(this.fhirBaseUrl,""),options:t,resolve:n,reject:r}),this.autoBatchTimerId||(this.autoBatchTimerId=setTimeout(()=>this.executeAutoBatch(),this.autoBatchTime))}):this.request("GET",e,t));return this.setCacheEntry(e,r),r}post(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e=e.toString(),this.setRequestBody(r,t),n&&this.setRequestContentType(r,n),this.invalidateUrl(e),this.request("POST",e,r)}put(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e=e.toString(),this.setRequestBody(r,t),n&&this.setRequestContentType(r,n),this.invalidateUrl(e),this.request("PUT",e,r)}patch(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e=e.toString(),this.setRequestBody(n,t),this.setRequestContentType(n,t3.JSON_PATCH),this.invalidateUrl(e),this.request("PATCH",e,n)}delete(e,t){return e=e.toString(),this.invalidateUrl(e),this.request("DELETE",e,t)}async startNewUser(e,t){var n;let{codeChallengeMethod:r,codeChallenge:i}=await this.startPkce();return this.post("auth/newuser",{...e,clientId:null!=(n=e.clientId)?n:this.clientId,codeChallengeMethod:r,codeChallenge:i},void 0,t)}async startNewProject(e,t){return this.post("auth/newproject",e,void 0,t)}async startNewPatient(e,t){return this.post("auth/newpatient",e,void 0,t)}async startLogin(e,t){var n;return this.post("auth/login",{...await this.ensureCodeChallenge(e),clientId:null!=(n=e.clientId)?n:this.clientId,scope:e.scope},void 0,t)}async startGoogleLogin(e,t){var n;return this.post("auth/google",{...await this.ensureCodeChallenge(e),clientId:null!=(n=e.clientId)?n:this.clientId,scope:e.scope},void 0,t)}async ensureCodeChallenge(e){return e.codeChallenge?e:{...e,...await this.startPkce()}}async signOut(){await this.post(this.logoutUrl,{}),this.clear()}async signInWithRedirect(e){let t=new URLSearchParams(t0.getSearch()).get("code");return t?this.processCode(t):void await this.requestAuthorization(e)}signOutWithRedirect(){t0.assign(this.logoutUrl)}async signInWithExternalAuth(e,t,n,r){let i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],o=r;i&&(o=await this.ensureCodeChallenge(r)),t0.assign(this.getExternalAuthRedirectUri(e,t,n,o,i))}async exchangeExternalAccessToken(e,t){if(!(t=null!=t?t:this.clientId))throw Error("MedplumClient is missing clientId");return this.fetchTokens({grant_type:nS.TokenExchange,subject_token_type:nw.AccessToken,client_id:t,subject_token:e})}getExternalAuthRedirectUri(e,t,n,r){var i;let o=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=new URL(e);if(s.searchParams.set("response_type","code"),s.searchParams.set("client_id",t),s.searchParams.set("redirect_uri",n),s.searchParams.set("scope",null!=(i=r.scope)?i:"openid profile email"),s.searchParams.set("state",JSON.stringify(r)),o){let{codeChallenge:e,codeChallengeMethod:t}=r;if(!t)throw Error("`LoginRequest` for external auth must include a `codeChallengeMethod`.");if(!e)throw Error("`LoginRequest` for external auth must include a `codeChallenge`.");s.searchParams.set("code_challenge_method",t),s.searchParams.set("code_challenge",e)}return s.toString()}fhirUrl(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new URL(eU(this.fhirBaseUrl,t.join("/")))}fhirSearchUrl(e,t){var n;let r=this.fhirUrl(e);return t&&("object"!=typeof(n=t)||Array.isArray(n)||n instanceof URLSearchParams||(n=Object.fromEntries(Object.entries(n).filter(e=>void 0!==e[1]))),r.search=new URLSearchParams(n).toString()),r}search(e,t,n){let r=this.fhirSearchUrl(e,t),i="search-"+r.toString(),o=this.getCacheEntry(i,n);if(o)return o.value;let s=this.getBundle(r,n);return this.setCacheEntry(i,s),s}searchOne(e,t,n){let r=this.fhirSearchUrl(e,t);r.searchParams.set("_count","1"),r.searchParams.sort();let i="searchOne-"+r.toString(),o=this.getCacheEntry(i,n);if(o)return o.value;let s=new nl(this.search(e,r.searchParams,n).then(e=>{var t,n;return null==(n=e.entry)||null==(t=n[0])?void 0:t.resource}));return this.setCacheEntry(i,s),s}searchResources(e,t,n){let r="searchResources-"+this.fhirSearchUrl(e,t).toString(),i=this.getCacheEntry(r,n);if(i)return i.value;let o=new nl(this.search(e,t,n).then(nA));return this.setCacheEntry(r,o),o}async *searchResourcePages(e,t,n){let r=this.fhirSearchUrl(e,t);for(;r;){var i,o;let t=new URL(r).searchParams;t.has("_count")||t.set("_count","1000");let s=await this.search(e,t,n),a=null==(i=s.link)?void 0:i.find(e=>"next"===e.relation);if(!(null==(o=s.entry)?void 0:o.length)&&!a)break;yield nA(s),r=(null==a?void 0:a.url)?new URL(a.url):void 0}}valueSetExpand(e,t){let n=this.fhirUrl("ValueSet","$expand");return n.search=new URLSearchParams(e).toString(),this.get(n.toString(),t)}getCached(e,t){var n,r;let i=null==(r=this.requestCache)||null==(n=r.get(this.fhirUrl(e,t).toString()))?void 0:n.value;return(null==i?void 0:i.isOk())?i.read():void 0}getCachedReference(e){let t=e.reference;if(!t)return;if("system"===t)return nE;let[n,r]=t.split("/");if(!(!n||!r))return this.getCached(n,r)}readResource(e,t,n){if(!t)throw Error('The "id" parameter cannot be null, undefined, or an empty string.');return this.get(this.fhirUrl(e,t),n)}readReference(e,t){let n=e.reference;if(!n)return new nl(Promise.reject(Error("Missing reference")));if("system"===n)return new nl(Promise.resolve(nE));let[r,i]=n.split("/");return r&&i?this.readResource(r,i,t):new nl(Promise.reject(Error("Invalid reference")))}requestSchema(e){if(P[e])return Promise.resolve();let t=e+"-requestSchema",n=this.getCacheEntry(t,void 0);if(n)return n.value;let r=new nl((async()=>{let t='{\n      StructureDefinitionList(_filter: "name eq '.concat(e,'") {\n        resourceType,\n        name,\n        kind,\n        description,\n        type,\n        url,\n        snapshot {\n          element {\n            id,\n            path,\n            definition,\n            min,\n            max,\n            base {\n              path,\n              min,\n              max\n            },\n            contentReference,\n            type {\n              code,\n              profile,\n              targetProfile\n            },\n            binding {\n              strength,\n              valueSet\n            }\n          }\n        }\n      }\n      SearchParameterList(base: "').concat(e,'", _count: 100) {\n        base,\n        code,\n        type,\n        expression,\n        target\n      }\n    }').replaceAll(/\s+/g," "),n=await this.graphql(t);for(let e of(M(n.data.StructureDefinitionList),n.data.SearchParameterList))!function(e){var t;for(let n of null!=(t=e.base)?t:[]){let t=eY(n);t.searchParams||(t.searchParams={}),t.searchParams[e.code]=e}}(e)})());return this.setCacheEntry(t,r),r}requestProfileSchema(e,t){if(!(null==t?void 0:t.expandProfile)&&O(e))return Promise.resolve();let n=e+"-requestSchema"+((null==t?void 0:t.expandProfile)?"-nested":""),r=this.getCacheEntry(n,void 0);if(r)return r.value;let i=new nl((async()=>{if(null==t?void 0:t.expandProfile){let t=this.fhirUrl("StructureDefinition","$expand-profile");t.search=new URLSearchParams({url:e}).toString(),M(await this.post(t.toString(),{}))}else{let t=await this.searchOne("StructureDefinition",{url:e,_sort:"-_lastUpdated"});if(!t)return void console.warn("No StructureDefinition found for ".concat(e,"!"));L(t)}})());return this.setCacheEntry(n,i),i}readHistory(e,t,n,r){let i=this.fhirUrl(e,t,"_history");return(null==n?void 0:n.count)&&i.searchParams.set("_count",n.count.toString()),(null==n?void 0:n.offset)&&i.searchParams.set("_offset",n.offset.toString()),this.get(i.toString(),r)}readVersion(e,t,n,r){return this.get(this.fhirUrl(e,t,"_history",n),r)}readPatientEverything(e,t){return this.getBundle(this.fhirUrl("Patient",e,"$everything"),t)}readPatientSummary(e,t){return this.getBundle(this.fhirUrl("Patient",e,"$summary"),t)}createResource(e,t){if(!e.resourceType)throw Error("Missing resourceType");return this.invalidateSearches(e.resourceType),this.post(this.fhirUrl(e.resourceType),e,void 0,t)}async createResourceIfNoneExist(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.fhirUrl(e.resourceType);this.setRequestHeader(n,"If-None-Exist",t);let i=await this.post(r,e,void 0,n);return this.cacheResource(i),this.invalidateUrl(this.fhirUrl(e.resourceType,e.id,"_history")),this.invalidateSearches(e.resourceType),i}async upsertResource(e,t,n){let r=this.fhirSearchUrl(e.resourceType,t),i=await this.put(r,e,void 0,n);return i||(i=e),this.cacheResource(i),this.invalidateUrl(this.fhirUrl(e.resourceType,e.id,"_history")),this.invalidateSearches(e.resourceType),i}async createAttachment(e,t,n,r,i){let o=nP(e,t,n,r);if(o.contentType===t3.XML){let e=o.data,t;(t=e instanceof Blob?await new Promise((t,n)=>{let r=new FileReader;r.onload=()=>{if(!r.result)return void n(Error("Failed to load file"));t(r.result)},r.readAsText(e,"utf-8")}):ArrayBuffer.isView(e)?new TextDecoder().decode(e):e).includes("<ClinicalDocument")&&t.includes("urn:hl7-org:v3")&&(o={...o,contentType:t3.CDA_XML})}let s=null!=i?i:"object"==typeof t?t:{},a=await this.createBinary(o,s);return{contentType:o.contentType,url:a.url,title:o.filename}}createBinary(e,t,n,r,i){let o=nP(e,t,n,r),s=null!=i?i:"object"==typeof t?t:{},{data:a,contentType:l,filename:c,securityContext:u,onProgress:d}=o,f=this.fhirUrl("Binary");return c&&f.searchParams.set("_filename",c),(null==u?void 0:u.reference)&&this.setRequestHeader(s,"X-Security-Context",u.reference),d?this.uploadwithProgress(f,a,l,d,s):this.post(f,a,l,s)}uploadwithProgress(e,t,n,r,i){return new Promise((o,s)=>{var a;let l=new XMLHttpRequest,c=()=>l.abort();null==i||null==(a=i.signal)||a.addEventListener("abort",c);let u=e=>{var t;null==i||null==(t=i.signal)||t.removeEventListener("abort",c),e instanceof Error?s(e):o(e)};if(l.responseType="json",l.onabort=()=>u(new DOMException("Request aborted","AbortError")),l.onerror=()=>u(Error("Request error")),r&&(l.upload.onprogress=e=>r(e),l.upload.onload=e=>r(e)),l.onload=()=>{l.status>=200&&l.status<300?u(l.response):u(new w(T(l.response||l.statusText)))},l.open("POST",e),l.withCredentials=!0,l.setRequestHeader("Authorization","Bearer "+this.accessToken),l.setRequestHeader("Cache-Control","no-cache, no-store, max-age=0"),l.setRequestHeader("Content-Type",n),!1!==this.options.extendedMode&&l.setRequestHeader("X-Medplum","extended"),null==i?void 0:i.headers)for(let[e,t]of Object.entries(i.headers))l.setRequestHeader(e,t);l.send(t)})}async createPdf(e,t,n,r){if(!this.createPdfImpl)throw Error("PDF creation not enabled");let i=function(e,t,n,r){return ek(e)&&"docDefinition"in e?e:{docDefinition:e,filename:t,tableLayouts:n,fonts:r}}(e,t,n,r),o="object"==typeof t?t:{},{docDefinition:s,tableLayouts:a,fonts:l,...c}=i,u=await this.createPdfImpl(s,a,l),d={...c,data:u,contentType:"application/pdf"};return this.createBinary(d,o)}createComment(e,t,n){let r=this.getProfile(),i,o;return"Encounter"===e.resourceType&&(i=ep(e),o=e.subject),"ServiceRequest"===e.resourceType&&(i=e.encounter,o=e.subject),"Patient"===e.resourceType&&(o=ep(e)),this.createResource({resourceType:"Communication",status:"completed",basedOn:[ep(e)],encounter:i,subject:o,sender:r?ep(r):void 0,sent:new Date().toISOString(),payload:[{contentString:t}]},n)}async updateResource(e,t){if(!e.resourceType)throw Error("Missing resourceType");if(!e.id)throw Error("Missing id");let n=await this.put(this.fhirUrl(e.resourceType,e.id),e,void 0,t);return n||(n=e),this.cacheResource(n),this.invalidateUrl(this.fhirUrl(e.resourceType,e.id,"_history")),this.invalidateSearches(e.resourceType),n}async patchResource(e,t,n,r){let i=await this.patch(this.fhirUrl(e,t),n,r);return this.cacheResource(i),this.invalidateUrl(this.fhirUrl(e,t,"_history")),this.invalidateSearches(e),i}deleteResource(e,t,n){return this.deleteCacheEntry(this.fhirUrl(e,t).toString()),this.invalidateSearches(e),this.delete(this.fhirUrl(e,t),n)}validateResource(e,t){return this.post(this.fhirUrl(e.resourceType,"$validate"),e,void 0,t)}executeBot(e,t,n,r){let i;return"string"==typeof e?i=this.fhirUrl("Bot",e,"$execute"):(i=this.fhirUrl("Bot","$execute")).searchParams.set("identifier",e.system+"|"+e.value),this.post(i,t,n,r)}executeBatch(e,t){return this.post(this.fhirBaseUrl,e,void 0,t)}sendEmail(e,t){return this.post("email/v1/send",e,t3.JSON,t)}graphql(e,t,n,r){return this.post(this.fhirUrl("$graphql"),{query:e,operationName:t,variables:n},t3.JSON,r)}readResourceGraph(e,t,n,r){return this.get("".concat(this.fhirUrl(e,t),"/$graph?graph=").concat(n),r)}pushToAgent(e,t,n,r,i,o){let{waitTimeout:s,...a}=null!=o?o:{};return this.post(this.fhirUrl("Agent",em(e),"$push"),{destination:"string"==typeof t?t:ey(t),body:n,contentType:r,waitForResponse:i,...void 0!==s?{waitTimeout:s}:void 0},t3.FHIR_JSON,a)}getActiveLogin(){return this.storage.getObject("activeLogin")}async setActiveLogin(e){var t,n;(null==(t=this.sessionDetails)?void 0:t.profile)&&ey(this.sessionDetails.profile)===(null==(n=e.profile)?void 0:n.reference)||this.clearActiveLogin(),this.setAccessToken(e.accessToken,e.refreshToken),this.storage.setObject("activeLogin",e),this.addLogin(e),this.refreshPromise=void 0,await this.refreshProfile()}getAccessToken(){return this.accessToken}isAuthenticated(e){return void 0!==this.accessTokenExpires&&Date.now()<this.accessTokenExpires-(null!=e?e:this.refreshGracePeriod)}setAccessToken(e,t){this.accessToken=e,this.refreshToken=t,this.accessTokenExpires=function(e){try{let t=ns(e).exp;return"number"==typeof t?1e3*t:void 0}catch(e){return}}(e),this.medplumServer=function(e){try{return"string"==typeof ns(e).login_id}catch(e){return!1}}(e)}getLogins(){var e;return null!=(e=this.storage.getObject("logins"))?e:[]}addLogin(e){let t=this.getLogins().filter(t=>{var n,r;return(null==(n=t.profile)?void 0:n.reference)!==(null==(r=e.profile)?void 0:r.reference)});t.push(e),this.storage.setObject("logins",t)}async refreshProfile(){return this.medplumServer?(this.profilePromise=new Promise((e,t)=>{this.get("auth/me",{cache:"no-cache"}).then(t=>{var n,r;this.profilePromise=void 0;let i=(null==(r=this.sessionDetails)||null==(n=r.profile)?void 0:n.id)!==t.profile.id;this.sessionDetails=t,i&&this.dispatchEvent({type:"change"}),e(t.profile),this.dispatchEvent({type:"profileRefreshed"})}).catch(t)}),this.dispatchEvent({type:"profileRefreshing"}),this.profilePromise):Promise.resolve(void 0)}isLoading(){var e;return!this.isInitialized||!!this.profilePromise&&!(null==(e=this.sessionDetails)?void 0:e.profile)}isSuperAdmin(){var e;return!!(null==(e=this.sessionDetails)?void 0:e.project.superAdmin)}isProjectAdmin(){var e;return!!(null==(e=this.sessionDetails)?void 0:e.membership.admin)}getProject(){var e;return null==(e=this.sessionDetails)?void 0:e.project}getProjectMembership(){var e;return null==(e=this.sessionDetails)?void 0:e.membership}getProfile(){var e;return null==(e=this.sessionDetails)?void 0:e.profile}async getProfileAsync(){return this.profilePromise?this.profilePromise:this.sessionDetails?this.sessionDetails.profile:this.refreshProfile()}getUserConfiguration(){var e;return null==(e=this.sessionDetails)?void 0:e.config}getAccessPolicy(){var e;return null==(e=this.sessionDetails)?void 0:e.accessPolicy}async download(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.refreshPromise&&await this.refreshPromise;let n=e.toString();n.startsWith("Binary/")&&(e=this.fhirUrl(n));let r=t.headers;return r||(t.headers=r={}),r.Accept||(r.Accept="*/*"),this.addFetchOptionsDefaults(t),(await this.fetchWithRetry(e.toString(),t)).blob()}async createMedia(e,t){let{additionalFields:n,...r}=e,i=await this.createResource({resourceType:"Media",status:"preparation",content:{contentType:e.contentType},...n});r.securityContext||(r.securityContext=ep(i));let o=await this.createAttachment(r,t);return this.updateResource({...i,status:"completed",content:o})}async uploadMedia(e,t,n,r,i){return this.createMedia({data:e,contentType:t,filename:n,additionalFields:r},i)}async createDocumentReference(e,t){let{additionalFields:n,...r}=e,i=await this.createResource({resourceType:"DocumentReference",status:"current",content:[{attachment:{contentType:e.contentType}}],...n});r.securityContext||(r.securityContext=ep(i));let o=await this.createAttachment(r,t);return this.updateResource({...i,content:[{attachment:o}]})}async bulkExport(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=this.fhirUrl("".concat(e&&"".concat(e,"/"),"$export"));return t&&i.searchParams.set("_type",t),n&&i.searchParams.set("_since",n),this.startAsyncRequest(i.toString(),r)}async startAsyncRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.addFetchOptionsDefaults(t),t.headers.Prefer="respond-async",this.request("POST",e,t)}get keyValue(){return this.keyValueClient||(this.keyValueClient=new na(this)),this.keyValueClient}getBundle(e,t){return new nl((async()=>{let n=await this.get(e,t);if(n.entry)for(let e of n.entry)this.cacheResource(e.resource);return n})())}getCacheEntry(e,t){if(!this.requestCache||(null==t?void 0:t.cache)==="no-cache"||(null==t?void 0:t.cache)==="reload")return;let n=this.requestCache.get(e);if(!(!n||n.requestTime+this.cacheTime<Date.now()))return n}setCacheEntry(e,t){this.requestCache&&this.requestCache.set(e,{requestTime:Date.now(),value:t})}cacheResource(e){var t,n;null==e||!e.id||(null==(n=e.meta)||null==(t=n.tag)?void 0:t.some(e=>"SUBSETTED"===e.code))||this.setCacheEntry(this.fhirUrl(e.resourceType,e.id).toString(),new nl(Promise.resolve(e)))}deleteCacheEntry(e){this.requestCache&&this.requestCache.delete(e)}async request(e,t){var n,r;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};await this.refreshIfExpired(),i.method=e,this.addFetchOptionsDefaults(i);let s=await this.fetchWithRetry(t,i);if(401===s.status)return this.handleUnauthenticated(e,t,i);if(204===s.status||304===s.status)return;let a=null==(n=s.headers.get("content-type"))?void 0:n.includes("json");if(404===s.status&&!a)throw new w(y);let l=await this.parseBody(s,a);if(200===s.status&&i.followRedirectOnOk||201===s.status&&i.followRedirectOnCreated){let e=await nC(s,l);if(e)return this.request("GET",e,{...i,body:void 0})}if(202===s.status&&i.pollStatusOnAccepted){let e=null!=(r=await nC(s,l))?r:o.statusUrl;if(e)return this.pollStatus(e,i,o)}if(s.status>=400)throw new w(T(l));return l}async parseBody(e,t){let n;if("0"!==e.headers.get("content-length")){if(t)try{n=await e.json()}catch(t){throw console.error("Error parsing response",e.status,t),t}else n=await e.text();return n}}async fetchWithRetry(e,t){var n,r,i;e.startsWith("http")||(e=eU(this.baseUrl,e));let o=null!=(n=null==t?void 0:t.maxRetries)?n:2;for(let n=0;n<=o;n++)try{this.options.verbose&&this.logRequest(e,t);let s=await this.fetch(e,t);if(this.options.verbose&&this.logResponse(s),this.setCurrentRateLimit(s),n>=o||(i=s,429!==i.status&&!(i.status>=500)))return s;let a=this.getRetryDelay(n),l=null!=(r=t.maxRetryTime)?r:2e3;if(a>l)return s;await ej(a)}catch(e){if("Failed to fetch"===e.message&&0===n&&this.dispatchEvent({type:"offline"}),"AbortError"===e.name||n===o)throw e}throw Error("Unreachable")}logRequest(e,t){if(console.log("> ".concat(t.method," ").concat(e)),t.headers){let e=t.headers;for(let t of Object.keys(e).sort((e,t)=>e.localeCompare(t)))console.log("> ".concat(t,": ").concat(e[t]))}}logResponse(e){console.log("< ".concat(e.status," ").concat(e.statusText)),e.headers&&e.headers.forEach((e,t)=>console.log("< ".concat(t,": ").concat(e)))}setCurrentRateLimit(e){if(!(null==e?void 0:e.headers)||"function"!=typeof e.headers.get)return;let t=e.headers.get("ratelimit");t&&(this.currentRateLimits=t)}rateLimitStatus(){if(!this.currentRateLimits)return[];let e=this.currentRateLimits;return e.split(/\s*;\s*/g).map(t=>{let n=t.split(/\s*,\s*/g);if(3!==n.length)throw Error("Could not parse RateLimit header: "+e);let r=n[0].substring(1,n[0].length-1),i=n.find(e=>e.startsWith("r=")),o=i?Number.parseInt(i.substring(2),10):NaN,s=n.find(e=>e.startsWith("t=")),a=s?Number.parseInt(s.substring(2),10):NaN;if(!r||Number.isNaN(o)||Number.isNaN(a))throw Error("Could not parse RateLimit header: "+e);return{name:r,remainingUnits:o,secondsUntilReset:a}})}getRetryDelay(e){let t=this.rateLimitStatus(),n=500*Math.pow(1.5,e);for(let e of t)e.remainingUnits||(n=Math.max(n,1e3*e.secondsUntilReset));return n}async pollStatus(e,t,n){let r={...t,method:"GET",body:void 0,redirect:"follow"};if(void 0===n.pollCount)t.headers&&"object"==typeof t.headers&&"Prefer"in t.headers&&(r.headers={...t.headers},delete r.headers.Prefer),n.statusUrl=e,n.pollCount=1;else{var i;let e=null!=(i=t.pollStatusPeriod)?i:1e3;await ej(e),n.pollCount++}return this.request("GET",e,r,n)}async executeAutoBatch(){if(void 0===this.autoBatchQueue)return;let e=[...this.autoBatchQueue];if(this.autoBatchQueue.length=0,this.autoBatchTimerId=void 0,1===e.length){let t=e[0];try{t.resolve(await this.request(t.method,eU(this.fhirBaseUrl,t.url),t.options))}catch(e){t.reject(new w(T(e)))}return}let t={resourceType:"Bundle",type:"batch",entry:e.map(e=>({request:{method:e.method,url:e.url},resource:e.options.body?JSON.parse(e.options.body):void 0}))},n=await this.post(this.fhirBaseUrl,t);for(let t=0;t<e.length;t++){var r,i;let o=e[t],s=null==(r=n.entry)?void 0:r[t];(null==s||null==(i=s.response)?void 0:i.outcome)&&!S(s.response.outcome)?o.reject(new w(s.response.outcome)):o.resolve(null==s?void 0:s.resource)}}addFetchOptionsDefaults(e){Object.entries(this.defaultHeaders).forEach(t=>{let[n,r]=t;this.setRequestHeader(e,n,r)}),this.setRequestHeader(e,"Accept",nb,!0),!1!==this.options.extendedMode&&this.setRequestHeader(e,"X-Medplum","extended"),e.body&&this.setRequestHeader(e,"Content-Type",t3.FHIR_JSON,!0),this.accessToken?this.setRequestHeader(e,"Authorization","Bearer "+this.accessToken):this.basicAuth&&this.setRequestHeader(e,"Authorization","Basic "+this.basicAuth),e.cache||(e.cache="no-cache"),e.credentials||(e.credentials="include")}setRequestContentType(e,t){this.setRequestHeader(e,"Content-Type",t)}setRequestHeader(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=e.headers;i?Array.isArray(i)?r&&i.some(e=>{let[n]=e;return n.toLowerCase()===t.toLowerCase()})||i.push([t,n]):i instanceof Headers?r&&i.has(t)||i.set(t,n):!ek(i)||r&&i[t]||(i[t]=n):e.headers={[t]:n}}setRequestBody(e,t){"string"==typeof t||"u">typeof Blob&&(t instanceof Blob||(null==t?void 0:t.constructor.name)==="Blob")||"u">typeof File&&(t instanceof File||(null==t?void 0:t.constructor.name)==="File")||"u">typeof Uint8Array&&(t instanceof Uint8Array||(null==t?void 0:t.constructor.name)==="Uint8Array")?e.body=t:t&&(e.body=JSON.stringify(t))}handleUnauthenticated(e,t,n){return this.refresh()?this.request(e,t,n):(this.clear(),this.onUnauthenticated&&this.onUnauthenticated(),Promise.reject(new w(m)))}async startPkce(){let e=t2();sessionStorage.setItem("pkceState",e);let t=t2().slice(0,128);sessionStorage.setItem("codeVerifier",t);try{let e=await t4(t);return{codeChallengeMethod:"S256",codeChallenge:(function(e){let t=new Uint8Array(eR(e)),n=Array(t.length);for(let e=0;e<t.length;e++)n[e]=String.fromCharCode(t[e]);return window.btoa(n.join(""))})(e).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}}catch(e){return console.warn("Failed to hash code verifier. Falling back to 'plain' code challenge method",e),{codeChallengeMethod:"plain",codeChallenge:t}}}async requestAuthorization(e){var t,n,r;let i=await this.ensureCodeChallenge(null!=e?e:{}),o=new URL(this.authorizeUrl);o.searchParams.set("response_type","code"),o.searchParams.set("state",sessionStorage.getItem("pkceState")),o.searchParams.set("client_id",null!=(t=i.clientId)?t:this.clientId),o.searchParams.set("redirect_uri",null!=(n=i.redirectUri)?n:t0.getOrigin()),o.searchParams.set("code_challenge_method",i.codeChallengeMethod),o.searchParams.set("code_challenge",i.codeChallenge),o.searchParams.set("scope",null!=(r=i.scope)?r:"openid profile"),t0.assign(o.toString())}processCode(e,t){var n,r,i;let o={grant_type:nS.AuthorizationCode,code:e,client_id:null!=(r=null!=(n=null==t?void 0:t.clientId)?n:this.clientId)?r:"",redirect_uri:null!=(i=null==t?void 0:t.redirectUri)?i:t0.getOrigin()};if("u">typeof sessionStorage){let e=sessionStorage.getItem("codeVerifier");e&&(o.code_verifier=e)}return this.fetchTokens(o)}refreshIfExpired(e){var t;return this.refreshPromise||void 0===this.accessTokenExpires||this.isAuthenticated(e)||this.refresh(),null!=(t=this.refreshPromise)?t:Promise.resolve()}refresh(){var e;return this.refreshPromise?this.refreshPromise:this.refreshToken?(this.refreshPromise=this.fetchTokens({grant_type:nS.RefreshToken,client_id:null!=(e=this.clientId)?e:"",refresh_token:this.refreshToken}),this.refreshPromise):this.clientId&&this.clientSecret?(this.refreshPromise=this.startClientLogin(this.clientId,this.clientSecret),this.refreshPromise):void 0}async startClientLogin(e,t){return this.clientId=e,this.clientSecret=t,this.fetchTokens({grant_type:nS.ClientCredentials,client_id:e,client_secret:t})}async startJwtBearerLogin(e,t,n){return this.clientId=e,this.fetchTokens({grant_type:nS.JwtBearer,client_id:e,assertion:t,scope:n})}async startJwtAssertionLogin(e){return this.fetchTokens({grant_type:nS.ClientCredentials,client_assertion_type:nT.JwtBearer,client_assertion:e})}setBasicAuth(e,t){this.clientId=e,this.clientSecret=t,this.basicAuth=t1(e+":"+t)}setVerbose(e){this.options.verbose=e}async fhircastSubscribe(e,t){if("string"!=typeof e||""===e)throw new w(b("Invalid topic provided. Topic must be a valid string."));if(!("object"==typeof t&&Array.isArray(t)&&t.length>0))throw new w(b("Invalid events provided. Events must be an array of event names containing at least one event."));let n={channelType:"websocket",mode:"subscribe",topic:e,events:t},r=(await this.post(this.fhircastHubUrl,nn(n),t3.FORM_URL_ENCODED))["hub.channel.endpoint"];if(!r)throw Error("Invalid response!");return n.endpoint=r,n}async fhircastUnsubscribe(e){if(!nr(e))throw new w(b("Invalid topic or subscriptionRequest. SubscriptionRequest must be an object."));if(!(e.endpoint&&"string"==typeof e.endpoint&&e.endpoint.startsWith("ws")))throw new w(b("Provided subscription request must have an endpoint in order to unsubscribe."));e.mode="unsubscribe",await this.post(this.fhircastHubUrl,nn(e),t3.FORM_URL_ENCODED)}fhircastConnect(e){return new no(e)}async fhircastPublish(e,t,n,r){return t9.includes(t)?this.post(this.fhircastHubUrl,ni(e,t,n,r),t3.JSON):(function(e){if(t9.includes(e))throw new w(b("'context.version' is required for '".concat(e,"'.")))}(t),this.post(this.fhircastHubUrl,ni(e,t,n),t3.JSON))}async fhircastGetContext(e){return this.get("".concat(this.fhircastHubUrl,"/").concat(e),{cache:"no-cache"})}async invite(e,t){return this.post("admin/projects/"+e+"/invite",t)}async fetchTokens(e){let t=new URLSearchParams(e),n={...this.defaultHeaders,"Content-Type":t3.FORM_URL_ENCODED};this.basicAuth&&(n.Authorization="Basic ".concat(this.basicAuth)),this.credentialsInHeader&&(t.delete("client_id"),t.delete("client_secret"),!this.basicAuth&&e.client_id&&e.client_secret&&(n.Authorization="Basic ".concat(t1(e.client_id+":"+e.client_secret))));let r={method:"POST",headers:n,body:t.toString(),credentials:"include"},i;try{i=await this.fetchWithRetry(this.tokenUrl,r)}catch(e){throw this.refreshPromise=void 0,e}if(!i.ok){this.clearActiveLogin();try{let e=await i.json();throw new w(x(e.error_description))}catch(e){throw new w(x("Failed to fetch tokens"),{cause:e})}}let o=await i.json();return await this.verifyTokens(o),this.getProfile()}async verifyTokens(e){let t=e.access_token;if(3===t.split(".").length){let e=ns(t);if(Date.now()>=1e3*e.exp)throw this.clearActiveLogin(),new w(g);if(e.cid){if(e.cid!==this.clientId)throw this.clearActiveLogin(),new w(v)}else if(this.clientId&&e.client_id!==this.clientId)throw this.clearActiveLogin(),new w(v)}return this.setActiveLogin({accessToken:t,refreshToken:e.refresh_token,project:e.project,profile:e.profile})}checkSessionDetailsMatchLogin(e){var t,n,r;return!this.sessionDetails||!e||null!=(r=null==(n=e.profile)||null==(t=n.reference)?void 0:t.endsWith(this.sessionDetails.profile.id))&&r}setupStorageListener(){try{window.addEventListener("storage",e=>{if(null===e.key)t0.reload();else if(e.key===this.storage.makeKey("activeLogin")){let t=e.oldValue?JSON.parse(e.oldValue):void 0,n=e.newValue?JSON.parse(e.newValue):void 0;(null==t?void 0:t.profile.reference)===(null==n?void 0:n.profile.reference)&&this.checkSessionDetailsMatchLogin(n)?n?this.setAccessToken(n.accessToken,n.refreshToken):this.clear():t0.reload()}})}catch(e){}}getSubscriptionManager(){return this.subscriptionManager||(this.subscriptionManager=new nx(this,eU(this.baseUrl,"/ws/subscriptions-r4").toString().replace("http://","ws://").replace("https://","wss://"))),this.subscriptionManager}subscribeToCriteria(e,t){return this.getSubscriptionManager().addCriteria(e,t)}unsubscribeFromCriteria(e,t){this.subscriptionManager&&(this.subscriptionManager.removeCriteria(e,t),0===this.subscriptionManager.getCriteriaCount()&&this.subscriptionManager.closeWebSocket())}getMasterSubscriptionEmitter(){return this.getSubscriptionManager().getMasterEmitter()}constructor(e){var t,n,r,i,o,a,l,c,u,f,h,p,y,m;if(super(),s(this,"options"),s(this,"fetch"),s(this,"createPdfImpl"),s(this,"storage"),s(this,"requestCache"),s(this,"cacheTime"),s(this,"baseUrl"),s(this,"fhirBaseUrl"),s(this,"authorizeUrl"),s(this,"tokenUrl"),s(this,"logoutUrl"),s(this,"fhircastHubUrl"),s(this,"defaultHeaders"),s(this,"onUnauthenticated"),s(this,"autoBatchTime"),s(this,"autoBatchQueue"),s(this,"refreshGracePeriod"),s(this,"subscriptionManager"),s(this,"medplumServer"),s(this,"clientId"),s(this,"clientSecret"),s(this,"credentialsInHeader"),s(this,"autoBatchTimerId"),s(this,"accessToken"),s(this,"accessTokenExpires"),s(this,"refreshToken"),s(this,"refreshPromise"),s(this,"profilePromise"),s(this,"sessionDetails"),s(this,"currentRateLimits"),s(this,"basicAuth"),s(this,"initPromise"),s(this,"initComplete",!0),s(this,"keyValueClient"),(null==e?void 0:e.baseUrl)&&!e.baseUrl.startsWith("http"))throw Error("Base URL must start with http or https");this.options=null!=e?e:{},this.fetch=null!=(t=null==e?void 0:e.fetch)?t:function(){if(!globalThis.fetch)throw Error("Fetch not available in this environment");return globalThis.fetch.bind(globalThis)}(),this.storage=null!=(n=null==e?void 0:e.storage)?n:new nc(void 0,null==e?void 0:e.storagePrefix),this.createPdfImpl=null==e?void 0:e.createPdf,this.baseUrl=eL(null!=(r=null==e?void 0:e.baseUrl)?r:"https://api.medplum.com/"),this.fhirBaseUrl=eU(this.baseUrl,null!=(i=null==e?void 0:e.fhirUrlPath)?i:"fhir/R4"),this.authorizeUrl=eU(this.baseUrl,null!=(o=null==e?void 0:e.authorizeUrl)?o:"oauth2/authorize"),this.tokenUrl=eU(this.baseUrl,null!=(a=null==e?void 0:e.tokenUrl)?a:"oauth2/token"),this.logoutUrl=eU(this.baseUrl,null!=(l=null==e?void 0:e.logoutUrl)?l:"oauth2/logout"),this.fhircastHubUrl=eU(this.baseUrl,null!=(c=null==e?void 0:e.fhircastHubUrl)?c:"fhircast/STU3"),this.clientId=null!=(u=null==e?void 0:e.clientId)?u:"",this.clientSecret=null!=(f=null==e?void 0:e.clientSecret)?f:"",this.credentialsInHeader=(null==e?void 0:e.authCredentialsMethod)==="header",this.defaultHeaders=null!=(h=null==e?void 0:e.defaultHeaders)?h:{},this.onUnauthenticated=null==e?void 0:e.onUnauthenticated,this.refreshGracePeriod=null!=(p=null==e?void 0:e.refreshGracePeriod)?p:3e5,this.cacheTime=null!=(y=null==e?void 0:e.cacheTime)?y:6e4,this.cacheTime>0?this.requestCache=new d(null!=(m=null==e?void 0:e.resourceCacheSize)?m:1e3):this.requestCache=void 0,(null==e?void 0:e.autoBatchTime)?(this.autoBatchTime=e.autoBatchTime,this.autoBatchQueue=[]):(this.autoBatchTime=0,this.autoBatchQueue=void 0),(null==e?void 0:e.accessToken)&&this.setAccessToken(e.accessToken),void 0===this.storage.getInitPromise?((null==e?void 0:e.accessToken)||this.attemptResumeActiveLogin().catch(console.error),this.initPromise=Promise.resolve(),this.dispatchEvent({type:"storageInitialized"})):(this.initComplete=!1,this.initPromise=this.storage.getInitPromise(),this.initPromise.then(()=>{(null==e?void 0:e.accessToken)||this.attemptResumeActiveLogin().catch(console.error),this.initComplete=!0,this.dispatchEvent({type:"storageInitialized"})}).catch(e=>{console.error(e),this.initComplete=!0,this.dispatchEvent({type:"storageInitFailed",payload:{error:e}})})),this.setupStorageListener()}};async function nC(e,t){var n,r;let i=e.headers.get("content-location");if(i)return i;let o=e.headers.get("location");return o||(E(t)&&(null==(r=t.issue)||null==(n=r[0])?void 0:n.diagnostics)?t.issue[0].diagnostics:void 0)}function nA(e){var t,n;return Object.assign(null!=(n=null==(t=e.entry)?void 0:t.map(e=>e.resource))?n:[],{bundle:e})}function nP(e,t,n,r){return ek(e)&&"data"in e&&"contentType"in e?e:{data:e,filename:t,contentType:n,onProgress:r}}function nR(e){var t;let n,{parentContext:r,path:i,elements:o,profileUrl:s,debugMode:a,accessPolicyResource:l}=e;if(i===(null==r?void 0:r.path))return;null!=a||(a=null!=(t=null==r?void 0:r.debugMode)&&t),null!=l||(l=null==r?void 0:r.accessPolicyResource);let c=function(e,t,n,r){let i=Object.create(null);if(n)for(let[t,r]of Object.entries(n.elementsByPath)){let n=function(e,t){let n=e+".";if(t.startsWith(n))return t.slice(n.length)}(e,t);void 0!==n&&(i[n]=r)}let o=!1;if(t)for(let[e,n]of Object.entries(t))e in i||(i[e]=n,o=!0);return r&&console.assert(o,"Unnecessary ElementsContext; not using any newly provided elements"),i}(i,o,r,!!a),u=eD(i,".",2)[1];c=function(e,t,n){var r;if(!(null==t||null==(r=t.readonlyFields)?void 0:r.length))return e;let i=Object.create(null),o=n?n+".":"";for(let[n,r]of Object.entries(e))n_(o+n,t.readonlyFields)?i[n]={...r,readonly:!0}:i[n]=r;return i}(c=function(e,t,n){var r;if(!(null==t||null==(r=t.hiddenFields)?void 0:r.length))return e;let i=n?n+".":"";return Object.fromEntries(Object.entries(e).filter(e=>{let[n]=e;return!n_(i+n,t.hiddenFields)}))}(c,l,u),l,u);let d=Object.create(null);for(let[e,t]of Object.entries(c))d[i+"."+e]=t;if(r&&!r.isDefaultContext)n=r.getExtendedProps;else{let e=Object.create(null);n=t=>{let n=eD(t,".",2)[1];if(n){if(!e[n]){let t=n_(n,null==l?void 0:l.hiddenFields);e[n]={hidden:t,readonly:t||n_(n,null==l?void 0:l.readonlyFields)}}return e[n]}}}return{path:i,elements:c,elementsByPath:d,profileUrl:null!=s?s:null==r?void 0:r.profileUrl,debugMode:a,getExtendedProps:n,accessPolicyResource:l}}function n_(e,t){if(!(null==t?void 0:t.length))return!1;let n=e.split(".");for(let e=1;e<=n.length;e++){let r=n.slice(0,e).join(".");if(t.includes(r))return!0}return!1}function nj(e){return void 0!==e.type&&e.type.length>0}function nD(e,t,n,r){if(e)for(let a of t){var i,o,s;let t={value:e,type:null!=(s=null==(i=a.typeSchema)?void 0:i.type)?s:null==(o=a.type)?void 0:o[0].code};if(n.every(e=>{var n,i;return function(e,t,n,r){let i=function(e,t,n){if(void 0===e)return[void 0];if("$this"===t)return[e];let r=(null==n?void 0:n.withPath)?H:J,[i,...o]=t.split("."),s=[r(e,i,n)];for(let e of o){let t=[];for(let i of s)if(Array.isArray(i))for(let o of i)t.push(r(o,e,n));else((null==n?void 0:n.withPath)&&(null==i?void 0:i.value)!==void 0||!(null==n?void 0:n.withPath)&&void 0!==i)&&t.push(r(i,e,n));s=t}return s}(e,t.path,{profileUrl:r});if(i){var o,s,a;let e=null!=(s=null==(o=n.typeSchema)?void 0:o.elements)?s:n.elements;return null!=(a=i.some(r=>(function(e,t,n,r){let i;if(Array.isArray(e))return!1;i="$this"===t.path?n:(null!=r?r:n.elements)[t.path];let o=n.type;switch(t.type){case"value":case"pattern":var s;if(!e||!i)break;if(i.pattern)return function e(t,n){var r,i;return!!eS(t)||!eS(n)&&(Array.isArray(t)&&Array.isArray(n)?(r=t,n.every(t=>r.some(n=>e(n,t)))):!(Array.isArray(t)||Array.isArray(n))&&(ek(t)&&ek(n)?(i=t,Object.entries(n).every(t=>{let[n,r]=t;return n in i&&e(i[n],r)})):!(ek(t)||ek(n))&&t===n))}(e,i.pattern);if(i.fixed)return eT(e,i.fixed);if((null==(s=i.binding)?void 0:s.strength)==="required"&&i.binding.valueSet)return!0;break;case"type":return!!e&&!!(null==o?void 0:o.length)&&o.some(t=>t.code===e.type)}return!1})(r,t,n,e)))&&a}return console.assert(!1,"getNestedProperty[%s] in isDiscriminatorComponentMatch missed",t.path),!1}(t,e,a,null!=(i=null==(n=a.typeSchema)?void 0:n.url)?i:r)}))return a.name}}[...tD],tO().registerInfix("->",{precedence:tM.Arrow}).registerInfix(";",{precedence:tM.Semicolon})," ".repeat(2),[...tD],tF.EXACT,tF.NOT_EQUALS,tF.CONTAINS,tF.STARTS_WITH,tF.GREATER_THAN,tF.LESS_THAN,tF.GREATER_THAN_OR_EQUALS,tF.LESS_THAN_OR_EQUALS,tF.APPROXIMATELY,tF.STARTS_AFTER,tF.ENDS_BEFORE,tF.PRESENT,tF.IN,tF.NOT_IN,tF.EQUALS,tF.IDENTIFIER,tO()}}]);