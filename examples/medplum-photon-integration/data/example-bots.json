{
  "resourceType": "Bundle",
  "type": "transaction",
  "entry": [
    {
      "fullUrl": "urn:uuid:fa2eccb4-1d1d-477b-bd4d-7ebd66a5bb15",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/typescript",
        "data": "aW1wb3J0IHsgQm90RXZlbnQsIGFsbE9rLCBub3JtYWxpemVFcnJvclN0cmluZywgTWVkcGx1bUNsaWVudCB9IGZyb20gJ0BtZWRwbHVtL2NvcmUnOwoKZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoX21lZHBsdW06IE1lZHBsdW1DbGllbnQsIGV2ZW50OiBCb3RFdmVudCk6IFByb21pc2U8YW55PiB7CiAgY29uc3QgQ0xJRU5UX0lEID0gZXZlbnQuc2VjcmV0c1snUEhPVE9OX0NMSUVOVF9JRCddPy52YWx1ZVN0cmluZyBhcyBzdHJpbmc7CiAgY29uc3QgQ0xJRU5UX1NFQ1JFVCA9IGV2ZW50LnNlY3JldHNbJ1BIT1RPTl9DTElFTlRfU0VDUkVUJ10/LnZhbHVlU3RyaW5nIGFzIHN0cmluZzsKCiAgY29uc3QgYm9keSA9IHsKICAgIGNsaWVudF9pZDogQ0xJRU5UX0lELAogICAgY2xpZW50X3NlY3JldDogQ0xJRU5UX1NFQ1JFVCwKICAgIGF1ZGllbmNlOiAnaHR0cHM6Ly9hcGkubmV1dHJvbi5oZWFsdGgnLAogICAgZ3JhbnRfdHlwZTogJ2NsaWVudF9jcmVkZW50aWFscycsCiAgfTsKCiAgdHJ5IHsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXV0aC5uZXV0cm9uLmhlYWx0aC9vYXV0aC90b2tlbicsIHsKICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICB9LAogICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSwKICAgIH0pOwoKICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBIVFRQIGVycm9yLCBzdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfSwgJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApOwogICAgfQoKICAgIHJldHVybiBhbGxPazsKICB9IGNhdGNoIChlcnIpIHsKICAgIHRocm93IG5ldyBFcnJvcihub3JtYWxpemVFcnJvclN0cmluZyhlcnIpKTsKICB9Cn0K"
      }
    },
    {
      "fullUrl": "urn:uuid:59f53112-c60f-41cf-8299-23556dfd8276",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/javascript",
        "data": "InVzZSBzdHJpY3QiOwpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwpleHBvcnRzLmhhbmRsZXIgPSBoYW5kbGVyOwpjb25zdCBjb3JlXzEgPSByZXF1aXJlKCJAbWVkcGx1bS9jb3JlIik7CmFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoX21lZHBsdW0sIGV2ZW50KSB7CiAgICB2YXIgX2EsIF9iOwogICAgY29uc3QgQ0xJRU5UX0lEID0gKF9hID0gZXZlbnQuc2VjcmV0c1snUEhPVE9OX0NMSUVOVF9JRCddKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWVTdHJpbmc7CiAgICBjb25zdCBDTElFTlRfU0VDUkVUID0gKF9iID0gZXZlbnQuc2VjcmV0c1snUEhPVE9OX0NMSUVOVF9TRUNSRVQnXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnZhbHVlU3RyaW5nOwogICAgY29uc3QgYm9keSA9IHsKICAgICAgICBjbGllbnRfaWQ6IENMSUVOVF9JRCwKICAgICAgICBjbGllbnRfc2VjcmV0OiBDTElFTlRfU0VDUkVULAogICAgICAgIGF1ZGllbmNlOiAnaHR0cHM6Ly9hcGkubmV1dHJvbi5oZWFsdGgnLAogICAgICAgIGdyYW50X3R5cGU6ICdjbGllbnRfY3JlZGVudGlhbHMnLAogICAgfTsKICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hdXRoLm5ldXRyb24uaGVhbHRoL29hdXRoL3Rva2VuJywgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSwKICAgICAgICB9KTsKICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCBlcnJvciwgc3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c30sICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvcmVfMS5hbGxPazsKICAgIH0KICAgIGNhdGNoIChlcnIpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoKDAsIGNvcmVfMS5ub3JtYWxpemVFcnJvclN0cmluZykoZXJyKSk7CiAgICB9Cn0KLy8jIHNvdXJjZU1hcHBpbmdVUkw9dGVzdC1hdXRoLmpzLm1hcA=="
      }
    },
    {
      "fullUrl": "urn:uuid:333d8b0d-d4c3-4209-9e1a-351de0bf37cc",
      "request": {
        "method": "PUT",
        "url": "$bot-test-auth-reference"
      },
      "resource": {
        "resourceType": "Bot",
        "id": "$bot-test-auth-id",
        "identifier": [
          {
            "system": "https://neutron.health/bots",
            "value": "test-auth"
          }
        ],
        "name": "test-auth",
        "runtimeVersion": "awslambda",
        "sourceCode": {
          "contentType": "text/typescript",
          "url": "urn:uuid:fa2eccb4-1d1d-477b-bd4d-7ebd66a5bb15"
        },
        "executableCode": {
          "contentType": "text/javascript",
          "url": "urn:uuid:59f53112-c60f-41cf-8299-23556dfd8276"
        }
      }
    },
    {
      "fullUrl": "urn:uuid:1e0de63e-1426-4ddf-84b8-0440f9207cb7",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/typescript",
        "data": "aW1wb3J0IHsgQm90RXZlbnQsIE1lZHBsdW1DbGllbnQsIG5vcm1hbGl6ZUVycm9yU3RyaW5nLCBQYXRjaE9wZXJhdGlvbiB9IGZyb20gJ0BtZWRwbHVtL2NvcmUnOwppbXBvcnQgeyBBZGRyZXNzLCBDb250YWN0UG9pbnQsIElkZW50aWZpZXIsIFBhdGllbnQgfSBmcm9tICdAbWVkcGx1bS9maGlydHlwZXMnOwppbXBvcnQgZmV0Y2ggZnJvbSAnbm9kZS1mZXRjaCc7CgppbnRlcmZhY2UgQ3JlYXRlUGF0aWVudFZhcmlhYmxlcyB7CiAgZXh0ZXJuYWxJZDogc3RyaW5nOwogIG5hbWU6IFBob3Rvbk5hbWU7CiAgZGF0ZU9mQmlydGg6IHN0cmluZzsKICBzZXg6ICdNQUxFJyB8ICdGRU1BTEUnIHwgJ1VOS05PV04nOwogIGdlbmRlcj86IHN0cmluZzsKICBlbWFpbD86IHN0cmluZzsKICBwaG9uZT86IHN0cmluZzsKICBhZGRyZXNzPzogUGhvdG9uQWRkcmVzczsKfQoKaW50ZXJmYWNlIFBob3Rvbk5hbWUgewogIGZpcnN0OiBzdHJpbmc7CiAgbGFzdDogc3RyaW5nOwogIHRpdGxlPzogc3RyaW5nOwogIG1pZGRsZT86IHN0cmluZzsKfQoKaW50ZXJmYWNlIFBob3RvbkFkZHJlc3MgewogIG5hbWU/OiBQaG90b25OYW1lOwogIHN0cmVldDE6IHN0cmluZzsKICBzdHJlZXQyPzogc3RyaW5nOwogIGNpdHk6IHN0cmluZzsKICBzdGF0ZTogc3RyaW5nOwogIGNvdW50cnk6IHN0cmluZzsKICBwb3N0YWxDb2RlOiBzdHJpbmc7Cn0KCmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKG1lZHBsdW06IE1lZHBsdW1DbGllbnQsIGV2ZW50OiBCb3RFdmVudDxQYXRpZW50Pik6IFByb21pc2U8c3RyaW5nPiB7CiAgY29uc3QgcGF0aWVudCA9IGV2ZW50LmlucHV0OwogIGNvbnN0IENMSUVOVF9JRCA9IGV2ZW50LnNlY3JldHNbJ1BIT1RPTl9DTElFTlRfSUQnXT8udmFsdWVTdHJpbmc7CiAgY29uc3QgQ0xJRU5UX1NFQ1JFVCA9IGV2ZW50LnNlY3JldHNbJ1BIT1RPTl9DTElFTlRfU0VDUkVUJ10/LnZhbHVlU3RyaW5nOwoKICBjb25zdCBQSE9UT05fQVVUSF9UT0tFTiA9IGF3YWl0IGhhbmRsZVBob3RvbkF1dGgoQ0xJRU5UX0lELCBDTElFTlRfU0VDUkVUKTsKCiAgY29uc3QgcXVlcnkgPSBgCiAgICBtdXRhdGlvbiBjcmVhdGVQYXRpZW50KAogICAgICAkZXh0ZXJuYWxJZDogSUQKICAgICAgJG5hbWU6IE5hbWVJbnB1dCEKICAgICAgJGRhdGVPZkJpcnRoOiBBV1NEYXRlIQogICAgICAkc2V4OiBTZXhUeXBlIQogICAgICAkZ2VuZGVyOiBTdHJpbmcKICAgICAgJGVtYWlsOiBBV1NFbWFpbAogICAgICAkcGhvbmU6IEFXU1Bob25lIQogICAgICAkYWRkcmVzczogQWRkcmVzc0lucHV0CiAgICApIHsKICAgICAgY3JlYXRlUGF0aWVudCgKICAgICAgICBleHRlcm5hbElkOiAkZXh0ZXJuYWxJZAogICAgICAgIG5hbWU6ICRuYW1lCiAgICAgICAgZGF0ZU9mQmlydGg6ICRkYXRlT2ZCaXJ0aAogICAgICAgIHNleDogJHNleAogICAgICAgIGdlbmRlcjogJGdlbmRlcgogICAgICAgIGVtYWlsOiAkZW1haWwKICAgICAgICBwaG9uZTogJHBob25lCiAgICAgICAgYWRkcmVzczogJGFkZHJlc3MKICAgICAgKSB7IGlkIH0KICAgIH0KICBgOwoKICBpZiAoIXBhdGllbnQuYmlydGhEYXRlKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhdGllbnQgYmlydGggZGF0ZSBpcyByZXF1aXJlZCB0byBzeW5jIHRvIFBob3RvbiBIZWFsdGgnKTsKICB9CgogIGlmICghcGF0aWVudC5uYW1lKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ1BhdGllbnQgbmFtZSBpcyByZXF1aXJlZCB0byBzeW5jIHRvIFBob3RvbiBIZWFsdGgnKTsKICB9CgogIGNvbnN0IHZhcmlhYmxlczogQ3JlYXRlUGF0aWVudFZhcmlhYmxlcyA9IHsKICAgIGV4dGVybmFsSWQ6IHBhdGllbnQuaWQgYXMgc3RyaW5nLAogICAgbmFtZTogewogICAgICBmaXJzdDogcGF0aWVudC5uYW1lPy5bMF0uZ2l2ZW4/LlswXSA/PyAnJywKICAgICAgbGFzdDogcGF0aWVudC5uYW1lPy5bMF0uZmFtaWx5ID8/ICcnLAogICAgfSwKICAgIGRhdGVPZkJpcnRoOiBmb3JtYXRBV1NEYXRlKHBhdGllbnQuYmlydGhEYXRlKSwKICAgIHNleDogZ2V0U2V4VHlwZShwYXRpZW50LmdlbmRlciksCiAgICBnZW5kZXI6IHBhdGllbnQuZ2VuZGVyID8/ICd1bmtub3duJywKICAgIHBob25lOiBnZXRUZWxlY29tKCdwaG9uZScsIHBhdGllbnQpLAogIH07CgogIGNvbnN0IGVtYWlsID0gZ2V0VGVsZWNvbSgnZW1haWwnLCBwYXRpZW50KTsKICBjb25zdCBhZGRyZXNzID0gZm9ybWF0UGhvdG9uQWRkcmVzcyhwYXRpZW50LmFkZHJlc3M/LlswXSk7CgogIGlmIChlbWFpbCkgewogICAgdmFyaWFibGVzLmVtYWlsID0gZW1haWw7CiAgfQoKICBpZiAoYWRkcmVzcykgewogICAgdmFyaWFibGVzLmFkZHJlc3MgPSBhZGRyZXNzOwogIH0KCiAgY29uc3QgYm9keSA9IEpTT04uc3RyaW5naWZ5KHsgcXVlcnksIHZhcmlhYmxlcyB9KTsKCiAgdHJ5IHsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLm5ldXRyb24uaGVhbHRoL2dyYXBocWwnLCB7CiAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgUEhPVE9OX0FVVEhfVE9LRU4sCiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgfSwKICAgICAgYm9keSwKICAgIH0pOwoKICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBIVFRQIEVycm9yISBTdGF0dXM6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCk7CiAgICB9CgogICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOwogICAgaWYgKHJlc3VsdC5lcnJvcnM/LlswXSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IocmVzdWx0LmVycm9yc1swXS5tZXNzYWdlKTsKICAgIH0KICAgIGF3YWl0IHVwZGF0ZVBhdGllbnQobWVkcGx1bSwgcGF0aWVudCwgcmVzdWx0KTsKICAgIHJldHVybiByZXN1bHQuZGF0YS5jcmVhdGVQYXRpZW50OwogIH0gY2F0Y2ggKGVycikgewogICAgdGhyb3cgbmV3IEVycm9yKG5vcm1hbGl6ZUVycm9yU3RyaW5nKGVycikpOwogIH0KfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlUGhvdG9uQXV0aChjbGllbnRJZD86IHN0cmluZywgY2xpZW50U2VjcmV0Pzogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmc+IHsKICBpZiAoIWNsaWVudElkIHx8ICFjbGllbnRTZWNyZXQpIHsKICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIGF1dGhlbnRpY2F0ZS4gSW52YWxpZCBjbGllbnQgSUQgb3Igc2VjcmV0LicpOwogIH0KCiAgY29uc3QgYm9keSA9IHsKICAgIGNsaWVudF9pZDogY2xpZW50SWQsCiAgICBjbGllbnRfc2VjcmV0OiBjbGllbnRTZWNyZXQsCiAgICBhdWRpZW5jZTogJ2h0dHBzOi8vYXBpLm5ldXRyb24uaGVhbHRoJywKICAgIGdyYW50X3R5cGU6ICdjbGllbnRfY3JlZGVudGlhbHMnLAogIH07CgogIHRyeSB7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL2F1dGgubmV1dHJvbi5oZWFsdGgvb2F1dGgvdG9rZW4nLCB7CiAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgfSwKICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksCiAgICB9KTsKCiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCBFcnJvciEgU3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApOwogICAgfQoKICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgIHJldHVybiByZXN1bHQuYWNjZXNzX3Rva2VuOwogIH0gY2F0Y2ggKGVycikgewogICAgdGhyb3cgbmV3IEVycm9yKG5vcm1hbGl6ZUVycm9yU3RyaW5nKGVycikpOwogIH0KfQoKYXN5bmMgZnVuY3Rpb24gdXBkYXRlUGF0aWVudChtZWRwbHVtOiBNZWRwbHVtQ2xpZW50LCBwYXRpZW50OiBQYXRpZW50LCByZXN1bHQ6IGFueSk6IFByb21pc2U8dm9pZD4gewogIGNvbnN0IHBhdGllbnREYXRhID0gcmVzdWx0LmRhdGEuY3JlYXRlUGF0aWVudDsKICBjb25zdCBwaG90b25JZCA9IHBhdGllbnREYXRhLmlkOwoKICBjb25zdCBwaG90b25JZGVudGlmaWVyOiBJZGVudGlmaWVyID0gewogICAgc3lzdGVtOiAnaHR0cHM6Ly9uZXV0cm9uLmhlYWx0aC9wYXRpZW50cycsCiAgICB2YWx1ZTogcGhvdG9uSWQsCiAgfTsKCiAgY29uc3QgaWRlbnRpZmllcnM6IElkZW50aWZpZXJbXSA9IHBhdGllbnQuaWRlbnRpZmllciA/PyBbXTsKICBpZGVudGlmaWVycy5wdXNoKHBob3RvbklkZW50aWZpZXIpOwoKICBjb25zdCBwYXRpZW50SWQgPSBwYXRpZW50LmlkIGFzIHN0cmluZzsKICBjb25zdCBvcCA9IHBhdGllbnQuaWRlbnRpZmllciA/ICdyZXBsYWNlJyA6ICdhZGQnOwoKICBjb25zdCBvcHM6IFBhdGNoT3BlcmF0aW9uW10gPSBbCiAgICB7IG9wOiAndGVzdCcsIHBhdGg6ICcvbWV0YS92ZXJzaW9uSWQnLCB2YWx1ZTogcGF0aWVudC5tZXRhPy52ZXJzaW9uSWQgfSwKICAgIHsgb3AsIHBhdGg6ICcvaWRlbnRpZmllcicsIHZhbHVlOiBpZGVudGlmaWVycyB9LAogIF07CgogIHRyeSB7CiAgICBhd2FpdCBtZWRwbHVtLnBhdGNoUmVzb3VyY2UoJ1BhdGllbnQnLCBwYXRpZW50SWQsIG9wcyk7CiAgICBjb25zb2xlLmxvZygnU3VjY2VzcycpOwogIH0gY2F0Y2ggKGVycikgewogICAgY29uc29sZS5lcnJvcihlcnIpOwogIH0KfQoKZnVuY3Rpb24gZm9ybWF0QVdTRGF0ZShkYXRlPzogc3RyaW5nKTogc3RyaW5nIHsKICBpZiAoIWRhdGUpIHsKICAgIHJldHVybiAnMTk3MC0wMS0wMSc7CiAgfQoKICByZXR1cm4gbmV3IERhdGUoZGF0ZSkudG9JU09TdHJpbmcoKS5zbGljZSgwLCAxMCk7Cn0KCmZ1bmN0aW9uIGdldFNleFR5cGUoc2V4PzogUGF0aWVudFsnZ2VuZGVyJ10pOiAnTUFMRScgfCAnRkVNQUxFJyB8ICdVTktOT1dOJyB7CiAgaWYgKHNleCA9PT0gJ2ZlbWFsZScpIHsKICAgIHJldHVybiAnRkVNQUxFJzsKICB9IGVsc2UgaWYgKHNleCA9PT0gJ21hbGUnKSB7CiAgICByZXR1cm4gJ01BTEUnOwogIH0gZWxzZSB7CiAgICByZXR1cm4gJ1VOS05PV04nOwogIH0KfQoKZXhwb3J0IGZ1bmN0aW9uIGdldFRlbGVjb20oc3lzdGVtOiBDb250YWN0UG9pbnRbJ3N5c3RlbSddLCBwZXJzb24/OiBQYXRpZW50KTogc3RyaW5nIHwgdW5kZWZpbmVkIHsKICBpZiAoIXBlcnNvbikgewogICAgdGhyb3cgbmV3IEVycm9yKCdObyBwYXRpZW50IHByb3ZpZGVkJyk7CiAgfQoKICBjb25zdCB0ZWxlY29tID0gcGVyc29uLnRlbGVjb20/LmZpbmQoKGNvbW0pID0+IGNvbW0uc3lzdGVtID09PSBzeXN0ZW0pOwogIGNvbnN0IHRlbGVjb21WYWx1ZSA9IHRlbGVjb20/LnZhbHVlOwoKICBpZiAoIXRlbGVjb21WYWx1ZSAmJiBzeXN0ZW0gPT09ICdwaG9uZScpIHsKICAgIHRocm93IG5ldyBFcnJvcignUGF0aWVudCBwaG9uZSBudW1iZXIgaXMgcmVxdWlyZWQgdG8gc3luYyB0byBQaG90b24gSGVhbHRoJyk7CiAgfQoKICBpZiAoIXRlbGVjb21WYWx1ZSkgewogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CgogIGlmIChzeXN0ZW0gPT09ICdwaG9uZScpIHsKICAgIHJldHVybiB0ZWxlY29tVmFsdWUuc2xpY2UoMCwgMSkgPT09ICcrMScgPyB0ZWxlY29tVmFsdWUgOiAnKzEnICsgdGVsZWNvbVZhbHVlOwogIH0gZWxzZSB7CiAgICByZXR1cm4gdGVsZWNvbVZhbHVlOwogIH0KfQoKZnVuY3Rpb24gZm9ybWF0UGhvdG9uQWRkcmVzcyhhZGRyZXNzPzogQWRkcmVzcyk6IFBob3RvbkFkZHJlc3MgfCB1bmRlZmluZWQgewogIGlmICghYWRkcmVzcykgewogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CgogIHJldHVybiB7CiAgICBzdHJlZXQxOiBhZGRyZXNzLmxpbmU/LlswXSA/PyAnJywKICAgIHN0cmVldDI6IGFkZHJlc3MubGluZT8uWzFdID8/ICcnLAogICAgY2l0eTogYWRkcmVzcy5jaXR5ID8/ICcnLAogICAgc3RhdGU6IGFkZHJlc3Muc3RhdGUgPz8gJycsCiAgICBjb3VudHJ5OiBhZGRyZXNzLmNvdW50cnkgPz8gJycsCiAgICBwb3N0YWxDb2RlOiBhZGRyZXNzLnBvc3RhbENvZGUgPz8gJycsCiAgfTsKfQo="
      }
    },
    {
      "fullUrl": "urn:uuid:bb21f9d3-9b98-4e04-bbe9-78486d737dab",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/javascript",
        "data": "InVzZSBzdHJpY3QiOwp2YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHsKICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgImRlZmF1bHQiOiBtb2QgfTsKfTsKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgeyB2YWx1ZTogdHJ1ZSB9KTsKZXhwb3J0cy5oYW5kbGVyID0gaGFuZGxlcjsKZXhwb3J0cy5nZXRUZWxlY29tID0gZ2V0VGVsZWNvbTsKY29uc3QgY29yZV8xID0gcmVxdWlyZSgiQG1lZHBsdW0vY29yZSIpOwpjb25zdCBub2RlX2ZldGNoXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZSgibm9kZS1mZXRjaCIpKTsKYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihtZWRwbHVtLCBldmVudCkgewogICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2YsIF9nLCBfaCwgX2osIF9rOwogICAgY29uc3QgcGF0aWVudCA9IGV2ZW50LmlucHV0OwogICAgY29uc3QgQ0xJRU5UX0lEID0gKF9hID0gZXZlbnQuc2VjcmV0c1snUEhPVE9OX0NMSUVOVF9JRCddKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudmFsdWVTdHJpbmc7CiAgICBjb25zdCBDTElFTlRfU0VDUkVUID0gKF9iID0gZXZlbnQuc2VjcmV0c1snUEhPVE9OX0NMSUVOVF9TRUNSRVQnXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnZhbHVlU3RyaW5nOwogICAgY29uc3QgUEhPVE9OX0FVVEhfVE9LRU4gPSBhd2FpdCBoYW5kbGVQaG90b25BdXRoKENMSUVOVF9JRCwgQ0xJRU5UX1NFQ1JFVCk7CiAgICBjb25zdCBxdWVyeSA9IGAKICAgIG11dGF0aW9uIGNyZWF0ZVBhdGllbnQoCiAgICAgICRleHRlcm5hbElkOiBJRAogICAgICAkbmFtZTogTmFtZUlucHV0IQogICAgICAkZGF0ZU9mQmlydGg6IEFXU0RhdGUhCiAgICAgICRzZXg6IFNleFR5cGUhCiAgICAgICRnZW5kZXI6IFN0cmluZwogICAgICAkZW1haWw6IEFXU0VtYWlsCiAgICAgICRwaG9uZTogQVdTUGhvbmUhCiAgICAgICRhZGRyZXNzOiBBZGRyZXNzSW5wdXQKICAgICkgewogICAgICBjcmVhdGVQYXRpZW50KAogICAgICAgIGV4dGVybmFsSWQ6ICRleHRlcm5hbElkCiAgICAgICAgbmFtZTogJG5hbWUKICAgICAgICBkYXRlT2ZCaXJ0aDogJGRhdGVPZkJpcnRoCiAgICAgICAgc2V4OiAkc2V4CiAgICAgICAgZ2VuZGVyOiAkZ2VuZGVyCiAgICAgICAgZW1haWw6ICRlbWFpbAogICAgICAgIHBob25lOiAkcGhvbmUKICAgICAgICBhZGRyZXNzOiAkYWRkcmVzcwogICAgICApIHsgaWQgfQogICAgfQogIGA7CiAgICBpZiAoIXBhdGllbnQuYmlydGhEYXRlKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYXRpZW50IGJpcnRoIGRhdGUgaXMgcmVxdWlyZWQgdG8gc3luYyB0byBQaG90b24gSGVhbHRoJyk7CiAgICB9CiAgICBpZiAoIXBhdGllbnQubmFtZSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignUGF0aWVudCBuYW1lIGlzIHJlcXVpcmVkIHRvIHN5bmMgdG8gUGhvdG9uIEhlYWx0aCcpOwogICAgfQogICAgY29uc3QgdmFyaWFibGVzID0gewogICAgICAgIGV4dGVybmFsSWQ6IHBhdGllbnQuaWQsCiAgICAgICAgbmFtZTogewogICAgICAgICAgICBmaXJzdDogKF9lID0gKF9kID0gKF9jID0gcGF0aWVudC5uYW1lKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2NbMF0uZ2l2ZW4pID09PSBudWxsIHx8IF9kID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfZFswXSkgIT09IG51bGwgJiYgX2UgIT09IHZvaWQgMCA/IF9lIDogJycsCiAgICAgICAgICAgIGxhc3Q6IChfZyA9IChfZiA9IHBhdGllbnQubmFtZSkgPT09IG51bGwgfHwgX2YgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9mWzBdLmZhbWlseSkgIT09IG51bGwgJiYgX2cgIT09IHZvaWQgMCA/IF9nIDogJycsCiAgICAgICAgfSwKICAgICAgICBkYXRlT2ZCaXJ0aDogZm9ybWF0QVdTRGF0ZShwYXRpZW50LmJpcnRoRGF0ZSksCiAgICAgICAgc2V4OiBnZXRTZXhUeXBlKHBhdGllbnQuZ2VuZGVyKSwKICAgICAgICBnZW5kZXI6IChfaCA9IHBhdGllbnQuZ2VuZGVyKSAhPT0gbnVsbCAmJiBfaCAhPT0gdm9pZCAwID8gX2ggOiAndW5rbm93bicsCiAgICAgICAgcGhvbmU6IGdldFRlbGVjb20oJ3Bob25lJywgcGF0aWVudCksCiAgICB9OwogICAgY29uc3QgZW1haWwgPSBnZXRUZWxlY29tKCdlbWFpbCcsIHBhdGllbnQpOwogICAgY29uc3QgYWRkcmVzcyA9IGZvcm1hdFBob3RvbkFkZHJlc3MoKF9qID0gcGF0aWVudC5hZGRyZXNzKSA9PT0gbnVsbCB8fCBfaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2pbMF0pOwogICAgaWYgKGVtYWlsKSB7CiAgICAgICAgdmFyaWFibGVzLmVtYWlsID0gZW1haWw7CiAgICB9CiAgICBpZiAoYWRkcmVzcykgewogICAgICAgIHZhcmlhYmxlcy5hZGRyZXNzID0gYWRkcmVzczsKICAgIH0KICAgIGNvbnN0IGJvZHkgPSBKU09OLnN0cmluZ2lmeSh7IHF1ZXJ5LCB2YXJpYWJsZXMgfSk7CiAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgKDAsIG5vZGVfZmV0Y2hfMS5kZWZhdWx0KSgnaHR0cHM6Ly9hcGkubmV1dHJvbi5oZWFsdGgvZ3JhcGhxbCcsIHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICdCZWFyZXIgJyArIFBIT1RPTl9BVVRIX1RPS0VOLAogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgYm9keSwKICAgICAgICB9KTsKICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCBFcnJvciEgU3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApOwogICAgICAgIH0KICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgaWYgKChfayA9IHJlc3VsdC5lcnJvcnMpID09PSBudWxsIHx8IF9rID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfa1swXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzdWx0LmVycm9yc1swXS5tZXNzYWdlKTsKICAgICAgICB9CiAgICAgICAgYXdhaXQgdXBkYXRlUGF0aWVudChtZWRwbHVtLCBwYXRpZW50LCByZXN1bHQpOwogICAgICAgIHJldHVybiByZXN1bHQuZGF0YS5jcmVhdGVQYXRpZW50OwogICAgfQogICAgY2F0Y2ggKGVycikgewogICAgICAgIHRocm93IG5ldyBFcnJvcigoMCwgY29yZV8xLm5vcm1hbGl6ZUVycm9yU3RyaW5nKShlcnIpKTsKICAgIH0KfQphc3luYyBmdW5jdGlvbiBoYW5kbGVQaG90b25BdXRoKGNsaWVudElkLCBjbGllbnRTZWNyZXQpIHsKICAgIGlmICghY2xpZW50SWQgfHwgIWNsaWVudFNlY3JldCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVW5hYmxlIHRvIGF1dGhlbnRpY2F0ZS4gSW52YWxpZCBjbGllbnQgSUQgb3Igc2VjcmV0LicpOwogICAgfQogICAgY29uc3QgYm9keSA9IHsKICAgICAgICBjbGllbnRfaWQ6IGNsaWVudElkLAogICAgICAgIGNsaWVudF9zZWNyZXQ6IGNsaWVudFNlY3JldCwKICAgICAgICBhdWRpZW5jZTogJ2h0dHBzOi8vYXBpLm5ldXRyb24uaGVhbHRoJywKICAgICAgICBncmFudF90eXBlOiAnY2xpZW50X2NyZWRlbnRpYWxzJywKICAgIH07CiAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgKDAsIG5vZGVfZmV0Y2hfMS5kZWZhdWx0KSgnaHR0cHM6Ly9hdXRoLm5ldXRyb24uaGVhbHRoL29hdXRoL3Rva2VuJywgewogICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICB9LAogICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSwKICAgICAgICB9KTsKICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSFRUUCBFcnJvciEgU3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApOwogICAgICAgIH0KICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdC5hY2Nlc3NfdG9rZW47CiAgICB9CiAgICBjYXRjaCAoZXJyKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCgwLCBjb3JlXzEubm9ybWFsaXplRXJyb3JTdHJpbmcpKGVycikpOwogICAgfQp9CmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVBhdGllbnQobWVkcGx1bSwgcGF0aWVudCwgcmVzdWx0KSB7CiAgICB2YXIgX2EsIF9iOwogICAgY29uc3QgcGF0aWVudERhdGEgPSByZXN1bHQuZGF0YS5jcmVhdGVQYXRpZW50OwogICAgY29uc3QgcGhvdG9uSWQgPSBwYXRpZW50RGF0YS5pZDsKICAgIGNvbnN0IHBob3RvbklkZW50aWZpZXIgPSB7CiAgICAgICAgc3lzdGVtOiAnaHR0cHM6Ly9uZXV0cm9uLmhlYWx0aC9wYXRpZW50cycsCiAgICAgICAgdmFsdWU6IHBob3RvbklkLAogICAgfTsKICAgIGNvbnN0IGlkZW50aWZpZXJzID0gKF9hID0gcGF0aWVudC5pZGVudGlmaWVyKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBbXTsKICAgIGlkZW50aWZpZXJzLnB1c2gocGhvdG9uSWRlbnRpZmllcik7CiAgICBjb25zdCBwYXRpZW50SWQgPSBwYXRpZW50LmlkOwogICAgY29uc3Qgb3AgPSBwYXRpZW50LmlkZW50aWZpZXIgPyAncmVwbGFjZScgOiAnYWRkJzsKICAgIGNvbnN0IG9wcyA9IFsKICAgICAgICB7IG9wOiAndGVzdCcsIHBhdGg6ICcvbWV0YS92ZXJzaW9uSWQnLCB2YWx1ZTogKF9iID0gcGF0aWVudC5tZXRhKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IudmVyc2lvbklkIH0sCiAgICAgICAgeyBvcCwgcGF0aDogJy9pZGVudGlmaWVyJywgdmFsdWU6IGlkZW50aWZpZXJzIH0sCiAgICBdOwogICAgdHJ5IHsKICAgICAgICBhd2FpdCBtZWRwbHVtLnBhdGNoUmVzb3VyY2UoJ1BhdGllbnQnLCBwYXRpZW50SWQsIG9wcyk7CiAgICAgICAgY29uc29sZS5sb2coJ1N1Y2Nlc3MnKTsKICAgIH0KICAgIGNhdGNoIChlcnIpIHsKICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICB9Cn0KZnVuY3Rpb24gZm9ybWF0QVdTRGF0ZShkYXRlKSB7CiAgICBpZiAoIWRhdGUpIHsKICAgICAgICByZXR1cm4gJzE5NzAtMDEtMDEnOwogICAgfQogICAgcmV0dXJuIG5ldyBEYXRlKGRhdGUpLnRvSVNPU3RyaW5nKCkuc2xpY2UoMCwgMTApOwp9CmZ1bmN0aW9uIGdldFNleFR5cGUoc2V4KSB7CiAgICBpZiAoc2V4ID09PSAnZmVtYWxlJykgewogICAgICAgIHJldHVybiAnRkVNQUxFJzsKICAgIH0KICAgIGVsc2UgaWYgKHNleCA9PT0gJ21hbGUnKSB7CiAgICAgICAgcmV0dXJuICdNQUxFJzsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHJldHVybiAnVU5LTk9XTic7CiAgICB9Cn0KZnVuY3Rpb24gZ2V0VGVsZWNvbShzeXN0ZW0sIHBlcnNvbikgewogICAgdmFyIF9hOwogICAgaWYgKCFwZXJzb24pIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIHBhdGllbnQgcHJvdmlkZWQnKTsKICAgIH0KICAgIGNvbnN0IHRlbGVjb20gPSAoX2EgPSBwZXJzb24udGVsZWNvbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZpbmQoKGNvbW0pID0+IGNvbW0uc3lzdGVtID09PSBzeXN0ZW0pOwogICAgY29uc3QgdGVsZWNvbVZhbHVlID0gdGVsZWNvbSA9PT0gbnVsbCB8fCB0ZWxlY29tID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0ZWxlY29tLnZhbHVlOwogICAgaWYgKCF0ZWxlY29tVmFsdWUgJiYgc3lzdGVtID09PSAncGhvbmUnKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYXRpZW50IHBob25lIG51bWJlciBpcyByZXF1aXJlZCB0byBzeW5jIHRvIFBob3RvbiBIZWFsdGgnKTsKICAgIH0KICAgIGlmICghdGVsZWNvbVZhbHVlKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGlmIChzeXN0ZW0gPT09ICdwaG9uZScpIHsKICAgICAgICByZXR1cm4gdGVsZWNvbVZhbHVlLnNsaWNlKDAsIDEpID09PSAnKzEnID8gdGVsZWNvbVZhbHVlIDogJysxJyArIHRlbGVjb21WYWx1ZTsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHJldHVybiB0ZWxlY29tVmFsdWU7CiAgICB9Cn0KZnVuY3Rpb24gZm9ybWF0UGhvdG9uQWRkcmVzcyhhZGRyZXNzKSB7CiAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZiwgX2csIF9oOwogICAgaWYgKCFhZGRyZXNzKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIHJldHVybiB7CiAgICAgICAgc3RyZWV0MTogKF9iID0gKF9hID0gYWRkcmVzcy5saW5lKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF0pICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6ICcnLAogICAgICAgIHN0cmVldDI6IChfZCA9IChfYyA9IGFkZHJlc3MubGluZSkgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jWzFdKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiAnJywKICAgICAgICBjaXR5OiAoX2UgPSBhZGRyZXNzLmNpdHkpICE9PSBudWxsICYmIF9lICE9PSB2b2lkIDAgPyBfZSA6ICcnLAogICAgICAgIHN0YXRlOiAoX2YgPSBhZGRyZXNzLnN0YXRlKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiAnJywKICAgICAgICBjb3VudHJ5OiAoX2cgPSBhZGRyZXNzLmNvdW50cnkpICE9PSBudWxsICYmIF9nICE9PSB2b2lkIDAgPyBfZyA6ICcnLAogICAgICAgIHBvc3RhbENvZGU6IChfaCA9IGFkZHJlc3MucG9zdGFsQ29kZSkgIT09IG51bGwgJiYgX2ggIT09IHZvaWQgMCA/IF9oIDogJycsCiAgICB9Owp9Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPXN5bmMtcGF0aWVudC5qcy5tYXA="
      }
    },
    {
      "fullUrl": "urn:uuid:4fe7ddd1-dd18-4e60-9150-886fa23ebc87",
      "request": {
        "method": "PUT",
        "url": "$bot-sync-patient-reference"
      },
      "resource": {
        "resourceType": "Bot",
        "id": "$bot-sync-patient-id",
        "identifier": [
          {
            "system": "https://neutron.health/bots",
            "value": "sync-patient"
          }
        ],
        "name": "sync-patient",
        "runtimeVersion": "awslambda",
        "sourceCode": {
          "contentType": "text/typescript",
          "url": "urn:uuid:1e0de63e-1426-4ddf-84b8-0440f9207cb7"
        },
        "executableCode": {
          "contentType": "text/javascript",
          "url": "urn:uuid:bb21f9d3-9b98-4e04-bbe9-78486d737dab"
        }
      }
    }
  ]
}