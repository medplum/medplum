(()=>{var a={};a.id=974,a.ids=[974],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:a=>{"use strict";a.exports=require("querystring")},12412:a=>{"use strict";a.exports=require("assert")},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},26713:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/is-bot")},28354:a=>{"use strict";a.exports=require("util")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30191:(a,b,c)=>{"use strict";c.r(b),c.d(b,{GlobalError:()=>D.a,__next_app__:()=>J,handler:()=>L,pages:()=>I,routeModule:()=>K,tree:()=>H});var d=c(73653),e=c(97714),f=c(85250),g=c(37587),h=c(22369),i=c(1889),j=c(96232),k=c(22841),l=c(46537),m=c(46027),n=c(78559),o=c(75928),p=c(19374),q=c(65971),r=c(261),s=c(79898),t=c(32967),u=c(26713),v=c(40139),w=c(14248),x=c(59580),y=c(57749),z=c(53123),A=c(89745),B=c(86439),C=c(58671),D=c.n(C),E=c(18283),F=c(39818),G={};for(let a in E)0>["default","tree","pages","GlobalError","__next_app__","routeModule","handler"].indexOf(a)&&(G[a]=()=>E[a]);c.d(b,G);let H=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(c.bind(c,34170)),"/Users/david/Projects/medplum/examples/medplum-nextauth-demo/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(c.bind(c,56035)),"/Users/david/Projects/medplum/examples/medplum-nextauth-demo/app/layout.tsx"],"global-error":[()=>Promise.resolve().then(c.t.bind(c,58671,23)),"next/dist/client/components/builtin/global-error.js"],"not-found":[()=>Promise.resolve().then(c.t.bind(c,17983,23)),"next/dist/client/components/builtin/not-found.js"],forbidden:[()=>Promise.resolve().then(c.t.bind(c,15034,23)),"next/dist/client/components/builtin/forbidden.js"],unauthorized:[()=>Promise.resolve().then(c.t.bind(c,54693,23)),"next/dist/client/components/builtin/unauthorized.js"]}],I=["/Users/david/Projects/medplum/examples/medplum-nextauth-demo/app/page.tsx"],J={require:c,loadChunk:()=>Promise.resolve()},K=new d.AppPageRouteModule({definition:{kind:e.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:H},distDir:".next",relativeProjectDir:""});async function L(a,b,d){var C;let G="/page";"/index"===G&&(G="/");let M=(0,h.getRequestMeta)(a,"postponed"),N=(0,h.getRequestMeta)(a,"minimalMode"),O=await K.prepare(a,b,{srcPage:G,multiZoneDraftMode:!1});if(!O)return b.statusCode=400,b.end("Bad Request"),null==d.waitUntil||d.waitUntil.call(d,Promise.resolve()),null;let{buildId:P,query:Q,params:R,parsedUrl:S,pageIsDynamic:T,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,serverActionsManifest:X,clientReferenceManifest:Y,subresourceIntegrityManifest:Z,prerenderManifest:$,isDraftMode:_,resolvedPathname:aa,revalidateOnlyGenerated:ab,routerServerContext:ac,nextConfig:ad,interceptionRoutePatterns:ae}=O,af=S.pathname||"/",ag=(0,r.normalizeAppPath)(G),{isOnDemandRevalidate:ah}=O,ai=K.match(af,$),aj=!!$.routes[aa],ak=!!(ai||aj||$.routes[ag]),al=a.headers["user-agent"]||"",am=(0,u.getBotType)(al),an=(0,p.isHtmlBotRequest)(a),ao=(0,h.getRequestMeta)(a,"isPrefetchRSCRequest")??"1"===a.headers[t.NEXT_ROUTER_PREFETCH_HEADER],ap=(0,h.getRequestMeta)(a,"isRSCRequest")??!!a.headers[t.RSC_HEADER],aq=(0,s.getIsPossibleServerAction)(a),ar=(0,m.checkIsAppPPREnabled)(ad.experimental.ppr)&&(null==(C=$.routes[ag]??$.dynamicRoutes[ag])?void 0:C.renderingMode)==="PARTIALLY_STATIC",as=!1,at=!1,au=ar?M:void 0,av=ar&&ap&&!ao,aw=(0,h.getRequestMeta)(a,"segmentPrefetchRSCRequest"),ax=!al||(0,p.shouldServeStreamingMetadata)(al,ad.htmlLimitedBots);an&&ar&&(ak=!1,ax=!1);let ay=!0===K.isDev||!ak||"string"==typeof M||av,az=an&&ar,aA=null;_||!ak||ay||aq||au||av||(aA=aa);let aB=aA;!aB&&K.isDev&&(aB=aa),K.isDev||_||!ak||!ap||av||(0,k.d)(a.headers);let aC={...E,tree:H,pages:I,GlobalError:D(),handler:L,routeModule:K,__next_app__:J};X&&Y&&(0,o.setReferenceManifestsSingleton)({page:G,clientReferenceManifest:Y,serverActionsManifest:X,serverModuleMap:(0,q.createServerModuleMap)({serverActionsManifest:X})});let aD=a.method||"GET",aE=(0,g.getTracer)(),aF=aE.getActiveScopeSpan();try{let f=K.getVaryHeader(aa,ae);b.setHeader("Vary",f);let k=async(c,d)=>{let e=new l.NodeNextRequest(a),f=new l.NodeNextResponse(b);return K.render(e,f,d).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=aE.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==i.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${aD} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${aD} ${a.url}`)})},m=async({span:e,postponed:f,fallbackRouteParams:g})=>{let i={query:Q,params:R,page:ag,sharedContext:{buildId:P},serverComponentsHmrCache:(0,h.getRequestMeta)(a,"serverComponentsHmrCache"),fallbackRouteParams:g,renderOpts:{App:()=>null,Document:()=>null,pageConfig:{},ComponentMod:aC,Component:(0,j.T)(aC),params:R,routeModule:K,page:G,postponed:f,shouldWaitOnAllReady:az,serveStreamingMetadata:ax,supportsDynamicResponse:"string"==typeof f||ay,buildManifest:U,nextFontManifest:V,reactLoadableManifest:W,subresourceIntegrityManifest:Z,serverActionsManifest:X,clientReferenceManifest:Y,setIsrStatus:null==ac?void 0:ac.setIsrStatus,dir:c(33873).join(process.cwd(),K.relativeProjectDir),isDraftMode:_,isRevalidate:ak&&!f&&!av,botType:am,isOnDemandRevalidate:ah,isPossibleServerAction:aq,assetPrefix:ad.assetPrefix,nextConfigOutput:ad.output,crossOrigin:ad.crossOrigin,trailingSlash:ad.trailingSlash,previewProps:$.preview,deploymentId:ad.deploymentId,enableTainting:ad.experimental.taint,htmlLimitedBots:ad.htmlLimitedBots,devtoolSegmentExplorer:ad.experimental.devtoolSegmentExplorer,reactMaxHeadersLength:ad.reactMaxHeadersLength,multiZoneDraftMode:!1,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:ad.experimental.cacheLife,basePath:ad.basePath,serverActions:ad.experimental.serverActions,...as?{nextExport:!0,supportsDynamicResponse:!1,isStaticGeneration:!0,isRevalidate:!0,isDebugDynamicAccesses:as}:{},experimental:{isRoutePPREnabled:ar,expireTime:ad.expireTime,staleTimes:ad.experimental.staleTimes,cacheComponents:!!ad.experimental.cacheComponents,clientSegmentCache:!!ad.experimental.clientSegmentCache,clientParamParsing:!!ad.experimental.clientParamParsing,dynamicOnHover:!!ad.experimental.dynamicOnHover,inlineCss:!!ad.experimental.inlineCss,authInterrupts:!!ad.experimental.authInterrupts,clientTraceMetadata:ad.experimental.clientTraceMetadata||[]},waitUntil:d.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:()=>{},onInstrumentationRequestError:(b,c,d)=>K.onRequestError(a,b,d,ac),err:(0,h.getRequestMeta)(a,"invokeError"),dev:K.isDev}},l=await k(e,i),{metadata:m}=l,{cacheControl:n,headers:o={},fetchTags:p}=m;if(p&&(o[y.NEXT_CACHE_TAGS_HEADER]=p),a.fetchMetrics=m.fetchMetrics,ak&&(null==n?void 0:n.revalidate)===0&&!K.isDev&&!ar){let a=m.staticBailoutInfo,b=Object.defineProperty(Error(`Page changed from static to dynamic at runtime ${aa}${(null==a?void 0:a.description)?`, reason: ${a.description}`:""}
see more here https://nextjs.org/docs/messages/app-static-to-dynamic-error`),"__NEXT_ERROR_CODE",{value:"E132",enumerable:!1,configurable:!0});if(null==a?void 0:a.stack){let c=a.stack;b.stack=b.message+c.substring(c.indexOf("\n"))}throw b}return{value:{kind:v.CachedRouteKind.APP_PAGE,html:l,headers:o,rscData:m.flightData,postponed:m.postponed,status:m.statusCode,segmentData:m.segmentData},cacheControl:n}},o=async({hasResolved:c,previousCacheEntry:f,isRevalidating:g,span:i})=>{let j,k=!1===K.isDev,l=c||b.writableEnded;if(ah&&ab&&!f&&!N)return(null==ac?void 0:ac.render404)?await ac.render404(a,b):(b.statusCode=404,b.end("This page could not be found")),null;if(ai&&(j=(0,w.parseFallbackField)(ai.fallback)),j===w.FallbackMode.PRERENDER&&(0,u.isBot)(al)&&(!ar||an)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),(null==f?void 0:f.isStale)===-1&&(ah=!0),ah&&(j!==w.FallbackMode.NOT_FOUND||f)&&(j=w.FallbackMode.BLOCKING_STATIC_RENDER),!N&&j!==w.FallbackMode.BLOCKING_STATIC_RENDER&&aB&&!l&&!_&&T&&(k||!aj)){let b;if((k||ai)&&j===w.FallbackMode.NOT_FOUND)throw new B.NoFallbackError;if(ar&&!ap){let c="string"==typeof(null==ai?void 0:ai.fallback)?ai.fallback:k?ag:null;if(b=await K.handleResponse({cacheKey:c,req:a,nextConfig:ad,routeKind:e.RouteKind.APP_PAGE,isFallback:!0,prerenderManifest:$,isRoutePPREnabled:ar,responseGenerator:async()=>m({span:i,postponed:void 0,fallbackRouteParams:k||at?(0,n.u)(ag):null}),waitUntil:d.waitUntil}),null===b)return null;if(b)return delete b.cacheControl,b}}let o=ah||g||!au?void 0:au;if(as&&void 0!==o)return{cacheControl:{revalidate:1,expire:void 0},value:{kind:v.CachedRouteKind.PAGES,html:x.default.EMPTY,pageData:{},headers:void 0,status:void 0}};let p=T&&ar&&((0,h.getRequestMeta)(a,"renderFallbackShell")||at)?(0,n.u)(af):null;return m({span:i,postponed:o,fallbackRouteParams:p})},p=async c=>{var f,g,i,j,k;let l,n=await K.handleResponse({cacheKey:aA,responseGenerator:a=>o({span:c,...a}),routeKind:e.RouteKind.APP_PAGE,isOnDemandRevalidate:ah,isRoutePPREnabled:ar,req:a,nextConfig:ad,prerenderManifest:$,waitUntil:d.waitUntil});if(_&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate"),K.isDev&&b.setHeader("Cache-Control","no-store, must-revalidate"),!n){if(aA)throw Object.defineProperty(Error("invariant: cache entry required but not generated"),"__NEXT_ERROR_CODE",{value:"E62",enumerable:!1,configurable:!0});return null}if((null==(f=n.value)?void 0:f.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant app-page handler received invalid cache entry ${null==(i=n.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E707",enumerable:!1,configurable:!0});let p="string"==typeof n.value.postponed;ak&&!av&&(!p||ao)&&(N||b.setHeader("x-nextjs-cache",ah?"REVALIDATED":n.isMiss?"MISS":n.isStale?"STALE":"HIT"),b.setHeader(t.NEXT_IS_PRERENDER_HEADER,"1"));let{value:q}=n;if(au)l={revalidate:0,expire:void 0};else if(N&&ap&&!ao&&ar)l={revalidate:0,expire:void 0};else if(!K.isDev)if(_)l={revalidate:0,expire:void 0};else if(ak){if(n.cacheControl)if("number"==typeof n.cacheControl.revalidate){if(n.cacheControl.revalidate<1)throw Object.defineProperty(Error(`Invalid revalidate configuration provided: ${n.cacheControl.revalidate} < 1`),"__NEXT_ERROR_CODE",{value:"E22",enumerable:!1,configurable:!0});l={revalidate:n.cacheControl.revalidate,expire:(null==(j=n.cacheControl)?void 0:j.expire)??ad.expireTime}}else l={revalidate:y.CACHE_ONE_YEAR,expire:void 0}}else b.getHeader("Cache-Control")||(l={revalidate:0,expire:void 0});if(n.cacheControl=l,"string"==typeof aw&&(null==q?void 0:q.kind)===v.CachedRouteKind.APP_PAGE&&q.segmentData){b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"2");let c=null==(k=q.headers)?void 0:k[y.NEXT_CACHE_TAGS_HEADER];N&&ak&&c&&"string"==typeof c&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,c);let d=q.segmentData.get(aw);return void 0!==d?(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(d,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl}):(b.statusCode=204,(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.EMPTY,cacheControl:n.cacheControl}))}let r=(0,h.getRequestMeta)(a,"onCacheEntry");if(r&&await r({...n,value:{...n.value,kind:"PAGE"}},{url:(0,h.getRequestMeta)(a,"initURL")}))return null;if(p&&au)throw Object.defineProperty(Error("Invariant: postponed state should not be present on a resume request"),"__NEXT_ERROR_CODE",{value:"E396",enumerable:!1,configurable:!0});if(q.headers){let a={...q.headers};for(let[c,d]of(N&&ak||delete a[y.NEXT_CACHE_TAGS_HEADER],Object.entries(a)))if(void 0!==d)if(Array.isArray(d))for(let a of d)b.appendHeader(c,a);else"number"==typeof d&&(d=d.toString()),b.appendHeader(c,d)}let s=null==(g=q.headers)?void 0:g[y.NEXT_CACHE_TAGS_HEADER];if(N&&ak&&s&&"string"==typeof s&&b.setHeader(y.NEXT_CACHE_TAGS_HEADER,s),!q.status||ap&&ar||(b.statusCode=q.status),!N&&q.status&&F.RedirectStatusCode[q.status]&&ap&&(b.statusCode=200),p&&b.setHeader(t.NEXT_DID_POSTPONE_HEADER,"1"),ap&&!_){if(void 0===q.rscData){if(q.postponed)throw Object.defineProperty(Error("Invariant: Expected postponed to be undefined"),"__NEXT_ERROR_CODE",{value:"E372",enumerable:!1,configurable:!0});return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:q.html,cacheControl:av?{revalidate:0,expire:void 0}:n.cacheControl})}return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:x.default.fromStatic(q.rscData,t.RSC_CONTENT_TYPE_HEADER),cacheControl:n.cacheControl})}let u=q.html;if(!p||N||ap)return(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:n.cacheControl});if(as)return u.push(new ReadableStream({start(a){a.enqueue(z.ENCODED_TAGS.CLOSED.BODY_AND_HTML),a.close()}})),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}});let w=new TransformStream;return u.push(w.readable),m({span:c,postponed:q.postponed,fallbackRouteParams:null}).then(async a=>{var b,c;if(!a)throw Object.defineProperty(Error("Invariant: expected a result to be returned"),"__NEXT_ERROR_CODE",{value:"E463",enumerable:!1,configurable:!0});if((null==(b=a.value)?void 0:b.kind)!==v.CachedRouteKind.APP_PAGE)throw Object.defineProperty(Error(`Invariant: expected a page response, got ${null==(c=a.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E305",enumerable:!1,configurable:!0});await a.value.html.pipeTo(w.writable)}).catch(a=>{w.writable.abort(a).catch(a=>{console.error("couldn't abort transformer",a)})}),(0,A.sendRenderResult)({req:a,res:b,generateEtags:ad.generateEtags,poweredByHeader:ad.poweredByHeader,result:u,cacheControl:{revalidate:0,expire:void 0}})};if(!aF)return await aE.withPropagatedContext(a.headers,()=>aE.trace(i.BaseServerSpan.handleRequest,{spanName:`${aD} ${a.url}`,kind:g.SpanKind.SERVER,attributes:{"http.method":aD,"http.target":a.url}},p));await p(aF)}catch(b){throw b instanceof B.NoFallbackError||await K.onRequestError(a,b,{routerKind:"App Router",routePath:G,routeType:"render",revalidateReason:(0,f.c)({isRevalidate:ak,isOnDemandRevalidate:ah})},ac),b}}},33435:(a,b,c)=>{"use strict";c.d(b,{f:()=>d});let d={debug:!0,providers:[{id:"medplum",name:"Medplum",type:"oauth",version:"2.0",checks:["state","nonce"],wellKnown:"https://api.medplum.com/.well-known/openid-configuration",accessTokenUrl:"https://api.medplum.com/oauth2/token",authorization:{url:"https://api.medplum.com/oauth2/authorize",params:{scope:"openid profile email",redirect_uri:"http://localhost:3000/api/auth/callback/medplum",response_type:"code",nonce:""}},clientId:process.env.MEDPLUM_CLIENT_ID,clientSecret:process.env.MEDPLUM_CLIENT_SECRET,profile:a=>({id:a.login_id,name:a.fhirUser})}],callbacks:{jwt:async({token:a,account:b})=>b?{...a,accessToken:b.access_token}:a,session:async({session:a,token:b})=>b?{...a,accessToken:b.accessToken}:a}}},33873:a=>{"use strict";a.exports=require("path")},34170:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>bR});var d,e=c(5939),f=c(98839),g=c(92809),h=Object.defineProperty,i=(a,b,c)=>((a,b,c)=>b in a?h(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c),j=class{constructor(a,b){i(this,"operator"),i(this,"child"),this.operator=a,this.child=b}toString(){return`${this.operator}(${this.child.toString()})`}},k=class{constructor(a,b,c){i(this,"operator"),i(this,"left"),i(this,"right"),this.operator=a,this.left=b,this.right=c}toString(){return`(${this.left.toString()} ${this.operator} ${this.right.toString()})`}},l=class{constructor(){i(this,"prefixParselets",{}),i(this,"infixParselets",{})}registerInfix(a,b){return this.infixParselets[a]=b,this}registerPrefix(a,b){return this.prefixParselets[a]=b,this}prefix(a,b,c){return this.registerPrefix(a,{parse:(a,d)=>c(d,a.consumeAndParse(b))})}infixLeft(a,b,c){return this.registerInfix(a,{parse:(a,d,e)=>c(d,e,a.consumeAndParse(b)),precedence:b})}construct(a){return new m(a,this.prefixParselets,this.infixParselets)}},m=class{constructor(a,b,c){i(this,"tokens"),i(this,"prefixParselets"),i(this,"infixParselets"),this.tokens=a,this.prefixParselets=b,this.infixParselets=c}hasMore(){return this.tokens.length>0}match(a){return this.peek()?.id===a&&(this.consume(),!0)}consumeAndParse(a=1/0){let b=this.consume(),c=this.prefixParselets[b.id];if(!c)throw Error(`Parse error at "${b.value}" (line ${b.line}, column ${b.column}). No matching prefix parselet.`);let d=c.parse(this,b);for(;a>this.getPrecedence();){let a=this.consume();d=this.getInfixParselet(a).parse(this,d,a)}return d}getPrecedence(){let a=this.peek();if(!a)return 1/0;let b=this.getInfixParselet(a);return b?b.precedence:1/0}consume(a,b){if(!this.tokens.length)throw Error("Cant consume unknown more tokens.");if(a&&this.peek()?.id!==a){let b=this.peek();throw Error(`Expected ${a} but got "${b.id}" (${b.value}) at line ${b.line} column ${b.column}.`)}if(b&&this.peek()?.value!==b){let a=this.peek();throw Error(`Expected "${b}" but got "${a.value}" at line ${a.line} column ${a.column}.`)}return this.tokens.shift()}peek(){return this.tokens.length>0?this.tokens[0]:void 0}removeComments(){this.tokens=this.tokens.filter(a=>"Comment"!==a.id)}getInfixParselet(a){return this.infixParselets["Symbol"===a.id?a.value:a.id]}},n=class{constructor(a=10){i(this,"max"),i(this,"cache"),this.max=a,this.cache=new Map}clear(){this.cache.clear()}get(a){let b=this.cache.get(a);return b&&(this.cache.delete(a),this.cache.set(a,b)),b}set(a,b){this.cache.has(a)?this.cache.delete(a):this.cache.size>=this.max&&this.cache.delete(this.first()),this.cache.set(a,b)}delete(a){this.cache.delete(a)}keys(){return this.cache.keys()}first(){return this.cache.keys().next().value}},o={resourceType:"OperationOutcome",id:"not-found",issue:[{severity:"error",code:"not-found",details:{text:"Not found"}}]},p={resourceType:"OperationOutcome",id:"unauthorized",issue:[{severity:"error",code:"login",details:{text:"Unauthorized"}}]},q={...p,issue:[...p.issue,{severity:"error",code:"expired",details:{text:"Token expired"}}]},r={...p,issue:[...p.issue,{severity:"error",code:"invalid",details:{text:"Token not issued for this audience"}}]};function s(a,b){return{resourceType:"OperationOutcome",issue:[{severity:"error",code:"invalid",details:{text:a},...b?{expression:[b]}:void 0}]}}function t(a){return{resourceType:"OperationOutcome",issue:[{severity:"error",code:"structure",details:{text:a}}]}}function u(a){return"object"==typeof a&&null!==a&&"OperationOutcome"===a.resourceType}var v=class a extends Error{constructor(b,c){super(y(b),c),i(this,"outcome"),Object.setPrototypeOf(this,a.prototype),this.name=this.constructor.name,this.outcome=b,Error.captureStackTrace(this,this.constructor)}};function w(a){return a instanceof v?a.outcome:u(a)?a:s(x(a))}function x(a){return a?"string"==typeof a?a:a&&"object"==typeof a&&(a instanceof Error||"u">typeof DOMException&&a instanceof DOMException||"[object Error]"===Object.prototype.toString.call(a))?a.message:u(a)?y(a):"object"==typeof a&&"code"in a&&"string"==typeof a.code?a.code:JSON.stringify(a):"Unknown error"}function y(a){let b=a.issue?.map(z)??[];return b.length>0?b.join("; "):"Unknown error"}function z(a){let b;return b=a.details?.text?a.diagnostics?`${a.details.text} (${a.diagnostics})`:a.details.text:a.diagnostics?a.diagnostics:"Unknown error",a.expression?.length&&(b+=` (${a.expression.join(", ")})`),b}var A=function(a){let b=Object.create(null);for(let[c,d]of Object.entries(a))b[c]={name:c,type:c,path:c,elements:Object.fromEntries(Object.entries(d.elements).map(([a,b])=>[a,function(a,b){let c=b.max&&b.max===Number.MAX_SAFE_INTEGER?1/0:b.max;return{path:a,description:"",type:b.type??[],min:b.min??0,max:c??1,isArray:!!c&&c>1,constraints:[]}}(a,b)])),constraints:[],innerTypes:[]};return b}({Element:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]}}},BackboneElement:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]}}},Address:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},use:{type:[{code:"code"}]},type:{type:[{code:"code"}]},text:{type:[{code:"string"}]},line:{max:0x1fffffffffffff,type:[{code:"string"}]},city:{type:[{code:"string"}]},district:{type:[{code:"string"}]},state:{type:[{code:"string"}]},postalCode:{type:[{code:"string"}]},country:{type:[{code:"string"}]},period:{type:[{code:"Period"}]}}},Age:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},Annotation:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},"author[x]":{type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Practitioner","http://hl7.org/fhir/StructureDefinition/Patient","http://hl7.org/fhir/StructureDefinition/RelatedPerson","http://hl7.org/fhir/StructureDefinition/Organization"]},{code:"string"}]},time:{type:[{code:"dateTime"}]},text:{min:1,type:[{code:"markdown"}]}}},Attachment:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},contentType:{type:[{code:"code"}]},language:{type:[{code:"code"}]},data:{type:[{code:"base64Binary"}]},url:{type:[{code:"url"}]},size:{type:[{code:"unsignedInt"}]},hash:{type:[{code:"base64Binary"}]},title:{type:[{code:"string"}]},creation:{type:[{code:"dateTime"}]}}},CodeableConcept:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},coding:{max:0x1fffffffffffff,type:[{code:"Coding"}]},text:{type:[{code:"string"}]}}},Coding:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},system:{type:[{code:"uri"}]},version:{type:[{code:"string"}]},code:{type:[{code:"code"}]},display:{type:[{code:"string"}]},userSelected:{type:[{code:"boolean"}]}}},ContactDetail:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},name:{type:[{code:"string"}]},telecom:{max:0x1fffffffffffff,type:[{code:"ContactPoint"}]}}},ContactPoint:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},system:{type:[{code:"code"}]},value:{type:[{code:"string"}]},use:{type:[{code:"code"}]},rank:{type:[{code:"positiveInt"}]},period:{type:[{code:"Period"}]}}},Contributor:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},name:{min:1,type:[{code:"string"}]},contact:{max:0x1fffffffffffff,type:[{code:"ContactDetail"}]}}},Count:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},DataRequirement:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},profile:{max:0x1fffffffffffff,type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]},"subject[x]":{type:[{code:"CodeableConcept"},{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Group"]}]},mustSupport:{max:0x1fffffffffffff,type:[{code:"string"}]},codeFilter:{max:0x1fffffffffffff,type:[{code:"DataRequirementCodeFilter"}]},dateFilter:{max:0x1fffffffffffff,type:[{code:"DataRequirementDateFilter"}]},limit:{type:[{code:"positiveInt"}]},sort:{max:0x1fffffffffffff,type:[{code:"DataRequirementSort"}]}}},DataRequirementCodeFilter:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},path:{type:[{code:"string"}]},searchParam:{type:[{code:"string"}]},valueSet:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/ValueSet"]}]},code:{max:0x1fffffffffffff,type:[{code:"Coding"}]}}},DataRequirementDateFilter:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},path:{type:[{code:"string"}]},searchParam:{type:[{code:"string"}]},"value[x]":{type:[{code:"dateTime"},{code:"Period"},{code:"Duration"}]}}},DataRequirementSort:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},path:{min:1,type:[{code:"string"}]},direction:{min:1,type:[{code:"code"}]}}},Distance:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},Dosage:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},sequence:{type:[{code:"integer"}]},text:{type:[{code:"string"}]},additionalInstruction:{max:0x1fffffffffffff,type:[{code:"CodeableConcept"}]},patientInstruction:{type:[{code:"string"}]},timing:{type:[{code:"Timing"}]},"asNeeded[x]":{type:[{code:"boolean"},{code:"CodeableConcept"}]},site:{type:[{code:"CodeableConcept"}]},route:{type:[{code:"CodeableConcept"}]},method:{type:[{code:"CodeableConcept"}]},doseAndRate:{max:0x1fffffffffffff,type:[{code:"DosageDoseAndRate"}]},maxDosePerPeriod:{type:[{code:"Ratio"}]},maxDosePerAdministration:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},maxDosePerLifetime:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]}}},DosageDoseAndRate:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{type:[{code:"CodeableConcept"}]},"dose[x]":{type:[{code:"Range"},{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},"rate[x]":{type:[{code:"Ratio"},{code:"Range"},{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]}}},Duration:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},ElementDefinition:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},path:{min:1,type:[{code:"string"}]},representation:{max:0x1fffffffffffff,type:[{code:"code"}]},sliceName:{type:[{code:"string"}]},sliceIsConstraining:{type:[{code:"boolean"}]},label:{type:[{code:"string"}]},code:{max:0x1fffffffffffff,type:[{code:"Coding"}]},slicing:{type:[{code:"ElementDefinitionSlicing"}]},short:{type:[{code:"string"}]},definition:{type:[{code:"markdown"}]},comment:{type:[{code:"markdown"}]},requirements:{type:[{code:"markdown"}]},alias:{max:0x1fffffffffffff,type:[{code:"string"}]},min:{type:[{code:"unsignedInt"}]},max:{type:[{code:"string"}]},base:{type:[{code:"ElementDefinitionBase"}]},contentReference:{type:[{code:"uri"}]},type:{max:0x1fffffffffffff,type:[{code:"ElementDefinitionType"}]},"defaultValue[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]},meaningWhenMissing:{type:[{code:"markdown"}]},orderMeaning:{type:[{code:"string"}]},"fixed[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]},"pattern[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]},example:{max:0x1fffffffffffff,type:[{code:"ElementDefinitionExample"}]},"minValue[x]":{type:[{code:"date"},{code:"dateTime"},{code:"instant"},{code:"time"},{code:"decimal"},{code:"integer"},{code:"positiveInt"},{code:"unsignedInt"},{code:"Quantity"}]},"maxValue[x]":{type:[{code:"date"},{code:"dateTime"},{code:"instant"},{code:"time"},{code:"decimal"},{code:"integer"},{code:"positiveInt"},{code:"unsignedInt"},{code:"Quantity"}]},maxLength:{type:[{code:"integer"}]},condition:{max:0x1fffffffffffff,type:[{code:"id"}]},constraint:{max:0x1fffffffffffff,type:[{code:"ElementDefinitionConstraint"}]},mustSupport:{type:[{code:"boolean"}]},isModifier:{type:[{code:"boolean"}]},isModifierReason:{type:[{code:"string"}]},isSummary:{type:[{code:"boolean"}]},binding:{type:[{code:"ElementDefinitionBinding"}]},mapping:{max:0x1fffffffffffff,type:[{code:"ElementDefinitionMapping"}]}}},ElementDefinitionSlicingDiscriminator:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},path:{min:1,type:[{code:"string"}]}}},ElementDefinitionSlicing:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},discriminator:{max:0x1fffffffffffff,type:[{code:"ElementDefinitionSlicingDiscriminator"}]},description:{type:[{code:"string"}]},ordered:{type:[{code:"boolean"}]},rules:{min:1,type:[{code:"code"}]}}},ElementDefinitionBase:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},path:{min:1,type:[{code:"string"}]},min:{min:1,type:[{code:"unsignedInt"}]},max:{min:1,type:[{code:"string"}]}}},ElementDefinitionType:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},code:{min:1,type:[{code:"uri"}]},profile:{max:0x1fffffffffffff,type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition","http://hl7.org/fhir/StructureDefinition/ImplementationGuide"]}]},targetProfile:{max:0x1fffffffffffff,type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition","http://hl7.org/fhir/StructureDefinition/ImplementationGuide"]}]},aggregation:{max:0x1fffffffffffff,type:[{code:"code"}]},versioning:{type:[{code:"code"}]}}},ElementDefinitionExample:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},label:{min:1,type:[{code:"string"}]},"value[x]":{min:1,type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]}}},ElementDefinitionConstraint:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},key:{min:1,type:[{code:"id"}]},requirements:{type:[{code:"string"}]},severity:{min:1,type:[{code:"code"}]},human:{min:1,type:[{code:"string"}]},expression:{type:[{code:"string"}]},xpath:{type:[{code:"string"}]},source:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]}}},ElementDefinitionBinding:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},strength:{min:1,type:[{code:"code"}]},description:{type:[{code:"string"}]},valueSet:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/ValueSet"]}]}}},ElementDefinitionMapping:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},identity:{min:1,type:[{code:"id"}]},language:{type:[{code:"code"}]},map:{min:1,type:[{code:"string"}]},comment:{type:[{code:"string"}]}}},Expression:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},description:{type:[{code:"string"}]},name:{type:[{code:"id"}]},language:{min:1,type:[{code:"code"}]},expression:{type:[{code:"string"}]},reference:{type:[{code:"uri"}]}}},Extension:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},url:{min:1,type:[{code:"uri"}]},"value[x]":{type:[{code:"base64Binary"},{code:"boolean"},{code:"canonical"},{code:"code"},{code:"date"},{code:"dateTime"},{code:"decimal"},{code:"id"},{code:"instant"},{code:"integer"},{code:"markdown"},{code:"oid"},{code:"positiveInt"},{code:"string"},{code:"time"},{code:"unsignedInt"},{code:"uri"},{code:"url"},{code:"uuid"},{code:"Address"},{code:"Age"},{code:"Annotation"},{code:"Attachment"},{code:"CodeableConcept"},{code:"Coding"},{code:"ContactPoint"},{code:"Count"},{code:"Distance"},{code:"Duration"},{code:"HumanName"},{code:"Identifier"},{code:"Money"},{code:"Period"},{code:"Quantity"},{code:"Range"},{code:"Ratio"},{code:"Reference"},{code:"SampledData"},{code:"Signature"},{code:"Timing"},{code:"ContactDetail"},{code:"Contributor"},{code:"DataRequirement"},{code:"Expression"},{code:"ParameterDefinition"},{code:"RelatedArtifact"},{code:"TriggerDefinition"},{code:"UsageContext"},{code:"Dosage"},{code:"Meta"}]}}},HumanName:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},use:{type:[{code:"code"}]},text:{type:[{code:"string"}]},family:{type:[{code:"string"}]},given:{max:0x1fffffffffffff,type:[{code:"string"}]},prefix:{max:0x1fffffffffffff,type:[{code:"string"}]},suffix:{max:0x1fffffffffffff,type:[{code:"string"}]},period:{type:[{code:"Period"}]}}},Identifier:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},use:{type:[{code:"code"}]},type:{type:[{code:"CodeableConcept"}]},system:{type:[{code:"uri"}]},value:{type:[{code:"string"}]},period:{type:[{code:"Period"}]},assigner:{type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Organization"]}]}}},MarketingStatus:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},country:{min:1,type:[{code:"CodeableConcept"}]},jurisdiction:{type:[{code:"CodeableConcept"}]},status:{min:1,type:[{code:"CodeableConcept"}]},dateRange:{min:1,type:[{code:"Period"}]},restoreDate:{type:[{code:"dateTime"}]}}},Meta:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},versionId:{type:[{code:"id"}]},lastUpdated:{type:[{code:"instant"}]},source:{type:[{code:"uri"}]},profile:{max:0x1fffffffffffff,type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]},security:{max:0x1fffffffffffff,type:[{code:"Coding"}]},tag:{max:0x1fffffffffffff,type:[{code:"Coding"}]},project:{type:[{code:"uri"}]},author:{type:[{code:"Reference"}]},onBehalfOf:{type:[{code:"Reference"}]},account:{type:[{code:"Reference"}]},accounts:{max:0x1fffffffffffff,type:[{code:"Reference"}]},compartment:{max:0x1fffffffffffff,type:[{code:"Reference"}]}}},Money:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},currency:{type:[{code:"code"}]}}},Narrative:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},status:{min:1,type:[{code:"code"}]},div:{min:1,type:[{code:"xhtml"}]}}},ParameterDefinition:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},name:{type:[{code:"code"}]},use:{min:1,type:[{code:"code"}]},min:{type:[{code:"integer"}]},max:{type:[{code:"string"}]},documentation:{type:[{code:"string"}]},type:{min:1,type:[{code:"code"}]},profile:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/StructureDefinition"]}]}}},Period:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},start:{type:[{code:"dateTime"}]},end:{type:[{code:"dateTime"}]}}},Population:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},"age[x]":{type:[{code:"Range"},{code:"CodeableConcept"}]},gender:{type:[{code:"CodeableConcept"}]},race:{type:[{code:"CodeableConcept"}]},physiologicalCondition:{type:[{code:"CodeableConcept"}]}}},ProdCharacteristic:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},height:{type:[{code:"Quantity"}]},width:{type:[{code:"Quantity"}]},depth:{type:[{code:"Quantity"}]},weight:{type:[{code:"Quantity"}]},nominalVolume:{type:[{code:"Quantity"}]},externalDiameter:{type:[{code:"Quantity"}]},shape:{type:[{code:"string"}]},color:{max:0x1fffffffffffff,type:[{code:"string"}]},imprint:{max:0x1fffffffffffff,type:[{code:"string"}]},image:{max:0x1fffffffffffff,type:[{code:"Attachment"}]},scoring:{type:[{code:"CodeableConcept"}]}}},ProductShelfLife:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},identifier:{type:[{code:"Identifier"}]},type:{min:1,type:[{code:"CodeableConcept"}]},period:{min:1,type:[{code:"Quantity"}]},specialPrecautionsForStorage:{max:0x1fffffffffffff,type:[{code:"CodeableConcept"}]}}},Quantity:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},Range:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},low:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},high:{type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]}}},Ratio:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},numerator:{type:[{code:"Quantity"}]},denominator:{type:[{code:"Quantity"}]}}},Reference:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},reference:{type:[{code:"string"}]},type:{type:[{code:"uri"}]},identifier:{type:[{code:"Identifier"}]},display:{type:[{code:"string"}]}}},RelatedArtifact:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},label:{type:[{code:"string"}]},display:{type:[{code:"string"}]},citation:{type:[{code:"markdown"}]},url:{type:[{code:"url"}]},document:{type:[{code:"Attachment"}]},resource:{type:[{code:"canonical",targetProfile:["http://hl7.org/fhir/StructureDefinition/Resource"]}]}}},SampledData:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},origin:{min:1,type:[{code:"Quantity",profile:["http://hl7.org/fhir/StructureDefinition/SimpleQuantity"]}]},period:{min:1,type:[{code:"decimal"}]},factor:{type:[{code:"decimal"}]},lowerLimit:{type:[{code:"decimal"}]},upperLimit:{type:[{code:"decimal"}]},dimensions:{min:1,type:[{code:"positiveInt"}]},data:{type:[{code:"string"}]}}},Signature:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,max:0x1fffffffffffff,type:[{code:"Coding"}]},when:{min:1,type:[{code:"instant"}]},who:{min:1,type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Practitioner","http://hl7.org/fhir/StructureDefinition/PractitionerRole","http://hl7.org/fhir/StructureDefinition/RelatedPerson","http://hl7.org/fhir/StructureDefinition/Patient","http://hl7.org/fhir/StructureDefinition/Device","http://hl7.org/fhir/StructureDefinition/Organization"]}]},onBehalfOf:{type:[{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Practitioner","http://hl7.org/fhir/StructureDefinition/PractitionerRole","http://hl7.org/fhir/StructureDefinition/RelatedPerson","http://hl7.org/fhir/StructureDefinition/Patient","http://hl7.org/fhir/StructureDefinition/Device","http://hl7.org/fhir/StructureDefinition/Organization"]}]},targetFormat:{type:[{code:"code"}]},sigFormat:{type:[{code:"code"}]},data:{type:[{code:"base64Binary"}]}}},SubstanceAmount:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},"amount[x]":{type:[{code:"Quantity"},{code:"Range"},{code:"string"}]},amountType:{type:[{code:"CodeableConcept"}]},amountText:{type:[{code:"string"}]},referenceRange:{type:[{code:"SubstanceAmountReferenceRange"}]}}},SubstanceAmountReferenceRange:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},lowLimit:{type:[{code:"Quantity"}]},highLimit:{type:[{code:"Quantity"}]}}},Timing:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},modifierExtension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},event:{max:0x1fffffffffffff,type:[{code:"dateTime"}]},repeat:{type:[{code:"TimingRepeat"}]},code:{type:[{code:"CodeableConcept"}]}}},TimingRepeat:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},"bounds[x]":{type:[{code:"Duration"},{code:"Range"},{code:"Period"}]},count:{type:[{code:"positiveInt"}]},countMax:{type:[{code:"positiveInt"}]},duration:{type:[{code:"decimal"}]},durationMax:{type:[{code:"decimal"}]},durationUnit:{type:[{code:"code"}]},frequency:{type:[{code:"positiveInt"}]},frequencyMax:{type:[{code:"positiveInt"}]},period:{type:[{code:"decimal"}]},periodMax:{type:[{code:"decimal"}]},periodUnit:{type:[{code:"code"}]},dayOfWeek:{max:0x1fffffffffffff,type:[{code:"code"}]},timeOfDay:{max:0x1fffffffffffff,type:[{code:"time"}]},when:{max:0x1fffffffffffff,type:[{code:"code"}]},offset:{type:[{code:"unsignedInt"}]}}},TriggerDefinition:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},type:{min:1,type:[{code:"code"}]},name:{type:[{code:"string"}]},"timing[x]":{type:[{code:"Timing"},{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/Schedule"]},{code:"date"},{code:"dateTime"}]},data:{max:0x1fffffffffffff,type:[{code:"DataRequirement"}]},condition:{type:[{code:"Expression"}]}}},UsageContext:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},code:{min:1,type:[{code:"Coding"}]},"value[x]":{min:1,type:[{code:"CodeableConcept"},{code:"Quantity"},{code:"Range"},{code:"Reference",targetProfile:["http://hl7.org/fhir/StructureDefinition/PlanDefinition","http://hl7.org/fhir/StructureDefinition/ResearchStudy","http://hl7.org/fhir/StructureDefinition/InsurancePlan","http://hl7.org/fhir/StructureDefinition/HealthcareService","http://hl7.org/fhir/StructureDefinition/Group","http://hl7.org/fhir/StructureDefinition/Location","http://hl7.org/fhir/StructureDefinition/Organization"]}]}}},MoneyQuantity:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},SimpleQuantity:{elements:{id:{type:[{code:"string"}]},extension:{max:0x1fffffffffffff,type:[{code:"Extension"}]},value:{type:[{code:"decimal"}]},comparator:{max:0,type:[{code:"code"}]},unit:{type:[{code:"string"}]},system:{type:[{code:"uri"}]},code:{type:[{code:"code"}]}}},IdentityProvider:{elements:{authorizeUrl:{min:1,type:[{code:"string"}]},tokenUrl:{min:1,type:[{code:"string"}]},tokenAuthMethod:{type:[{code:"code"}]},userInfoUrl:{min:1,type:[{code:"string"}]},clientId:{min:1,type:[{code:"string"}]},clientSecret:{min:1,type:[{code:"string"}]},usePkce:{type:[{code:"boolean"}]},useSubject:{type:[{code:"boolean"}]}}}}),B=Object.create(null),C=Object.create(null),D={"http://hl7.org/fhir/StructureDefinition/MoneyQuantity":"MoneyQuantity","http://hl7.org/fhir/StructureDefinition/SimpleQuantity":"SimpleQuantity","http://hl7.org/fhir/uv/sql-on-fhir/StructureDefinition/ViewDefinition":"ViewDefinition"};function E(a){let b;return(b=C[a])||(b=C[a]=Object.create(null)),b}function F(a){let b=(Array.isArray(a)?a:a.entry?.map(a=>a.resource)??[]).filter(a=>a?.resourceType==="StructureDefinition");for(let a of(function(a){for(let b of Array.isArray(a)?a:a.entry?.map(a=>a.resource)??[])b?.resourceType==="StructureDefinition"&&"resource"===b.kind&&au(b.type)}(b),b))G(a)}function G(a){if(!a?.name)throw Error("Failed loading StructureDefinition from bundle");if("StructureDefinition"!==a.resourceType)return;let b=new H(a).parse(),c=D[a.url],d,e;for(let f of(c?(d=A,e=c):(d=a.url===`http://hl7.org/fhir/StructureDefinition/${a.type}`||a.url===`https://medplum.com/fhir/StructureDefinition/${a.type}`||a.type?.startsWith("http://")||a.type?.startsWith("https://")?A:E(a.url),e=a.type),d[e]=b,b.innerTypes))f.parentType=b,d[f.name]=f;B[a.url]=b}var H=class{constructor(a){if(i(this,"root"),i(this,"elements"),i(this,"elementIndex"),i(this,"index"),i(this,"resourceSchema"),i(this,"slicingContext"),i(this,"innerTypes"),i(this,"backboneContext"),!a.snapshot?.element||0===a.snapshot.element.length)throw Error(`No snapshot defined for StructureDefinition '${a.name}'`);this.root=a.snapshot.element[0],this.elements=a.snapshot.element.slice(1),this.elementIndex=Object.create(null),this.index=0,this.resourceSchema={name:a.name,path:this.root.path,title:a.title,type:a.type,url:a.url,version:a.version,kind:a.kind,description:function(a){let b=a.description;return b?.startsWith(`Base StructureDefinition for ${a.name} Type: `)&&(b=b.substring(`Base StructureDefinition for ${a.name} Type: `.length)),b}(a),elements:{},constraints:this.parseElementDefinition(this.root).constraints,innerTypes:[],summaryProperties:new Set,mandatoryProperties:new Set},this.innerTypes=[]}parse(){let a=this.next();for(;a;){if(a.sliceName)this.parseSliceStart(a);else if(a.id?.includes(":")){if(this.slicingContext?.current){let b=J(a,this.slicingContext.path);this.slicingContext.current.elements[b]=this.parseElementDefinition(a)}}else{let b=this.parseElementDefinition(a);this.checkFieldEnter(a,b);let c=this.backboneContext;for(;c;){if(a.path?.startsWith(c.path+".")){c.type.elements[J(a,c.path)]=b;break}c=c.parent}if(!c){let c=J(a,this.root.path);a.isSummary&&this.resourceSchema.summaryProperties?.add(c.replace("[x]","")),b.min>0&&this.resourceSchema.mandatoryProperties?.add(c.replace("[x]","")),this.resourceSchema.elements[c]=b}this.checkFieldExit(a)}a=this.next()}return this.checkFieldExit(),this.innerTypes.length>0&&(this.resourceSchema.innerTypes=this.innerTypes),this.resourceSchema}checkFieldEnter(a,b){this.isInnerType(a)&&this.enterInnerType(a),this.slicingContext&&!K(this.slicingContext.path,a?.path)&&(this.slicingContext=void 0),a.slicing&&!this.slicingContext&&this.enterSlice(a,b)}enterInnerType(a){for(;this.backboneContext&&!K(this.backboneContext?.path,a.path);)this.innerTypes.push(this.backboneContext.type),this.backboneContext=this.backboneContext.parent;let b=av(a);this.backboneContext={type:{name:b,type:b,path:a.path,title:a.label,description:a.definition,elements:{},constraints:this.parseElementDefinition(a).constraints,innerTypes:[]},path:a.path,parent:K(this.backboneContext?.path,a.path)?this.backboneContext:this.backboneContext?.parent}}enterSlice(a,b){var c;let d;c=a,d=c.slicing?.discriminator,c.type?.some(a=>"Extension"===a.code)&&d?.length===1&&"value"===d[0].type&&"url"===d[0].path&&!this.peek()?.sliceName||(b.slicing={discriminator:(a.slicing?.discriminator??[]).map(a=>{if("value"!==a.type&&"pattern"!==a.type&&"type"!==a.type)throw Error(`Unsupported slicing discriminator type: ${a.type}`);return{path:a.path,type:a.type}}),slices:[],ordered:a.slicing?.ordered??!1,rule:a.slicing?.rules},this.slicingContext={field:b.slicing,path:a.path??""})}checkFieldExit(a){if(this.backboneContext&&!K(this.backboneContext.path,a?.path))if(this.backboneContext.parent)do this.innerTypes.push(this.backboneContext.type),this.backboneContext=this.backboneContext.parent;while(this.backboneContext&&!K(this.backboneContext.path,a?.path));else this.innerTypes.push(this.backboneContext.type),this.backboneContext=void 0}next(){let a=this.peek();if(a)return this.index++,a}peek(){let a=this.elements[this.index];if(a){if(this.elementIndex[a.path??""]=a,a.contentReference){let b=a.contentReference.slice(a.contentReference.indexOf("#")+1),c=this.elementIndex[b];return c?{...c,id:a.id,path:a.path,min:a.min??c.min,max:a.max??c.max,base:{path:c.base?.path??b,min:a.base?.min??c.base?.min??c.min,max:a.base?.max??c.base?.max??c.max},contentReference:a.contentReference,definition:a.definition}:void 0}return a}}isInnerType(a){let b=this.peek();return!!(K(a?.path,b?.path)&&a.type?.some(a=>["BackboneElement","Element"].includes(a.code)))}parseSliceStart(a){if(!this.slicingContext)throw Error(`Invalid slice start before discriminator: ${a.sliceName} (${a.id})`);this.slicingContext.current={...this.parseElementDefinition(a),name:a.sliceName??"",definition:a.definition,elements:{}},this.slicingContext.field.slices.push(this.slicingContext.current)}parseElementDefinitionType(a){return(a.type??[]).map(b=>{let c;return("BackboneElement"===b.code||"Element"===b.code)&&(c=av(a)),c||(c=af(b,"http://hl7.org/fhir/StructureDefinition/structuredefinition-fhir-type")?.valueUrl),c||(c=b.code??""),{code:c,targetProfile:b.targetProfile,profile:b.profile}})}parseElementDefinition(a){let b=I(a.max),c=a.base?.max?I(a.base.max):b,d={type:"ElementDefinition",value:a};return{description:a.definition||"",path:a.path||a.base?.path||"",min:a.min??0,max:b,isArray:c>1,constraints:(a.constraint??[]).map(a=>({key:a.key??"",severity:a.severity??"error",expression:a.expression??"",description:a.human??""})),type:this.parseElementDefinitionType(a),fixed:L(R(d,"fixed[x]")),pattern:L(R(d,"pattern[x]")),binding:a.binding}}};function I(a){return"*"===a?1/0:Number.parseInt(a,10)}function J(a,b=""){var c,d;return c=a.path,d=b,c?d&&c.startsWith(d)?c.substring(d.length+1):c:""}function K(a,b){return!!a&&!!b&&(b.startsWith(a+".")||b===a)}function L(a){return Array.isArray(a)&&a.length>0?a[0]:ag(a)?void 0:a}new n(1e3);var M={date:/^(\d(\d(\d[1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2]\d|3[0-1]))?)?$/,dateTime:/^(\d(\d(\d[1-9]|[1-9]0)|[1-9]00)|[1-9]000)(-(0[1-9]|1[0-2])(-(0[1-9]|[1-2]\d|3[0-1])(T([01]\d|2[0-3])(:[0-5]\d:([0-5]\d|60)(\.\d{1,9})?)?)?)?(Z|[+-]((0\d|1[0-3]):[0-5]\d|14:00)?)?)?$/};function N(a){return[{type:at.boolean,value:a}]}function O(a){return null==a?{type:"undefined",value:void 0}:Number.isSafeInteger(a)?{type:at.integer,value:a}:"number"==typeof a?{type:at.decimal,value:a}:"boolean"==typeof a?{type:at.boolean,value:a}:"string"==typeof a?{type:at.string,value:a}:Z(a)?{type:at.Quantity,value:a}:aw(a)?{type:a.resourceType,value:a}:ak(a)?{type:at.CodeableConcept,value:a}:aj(a)?{type:at.Coding,value:a}:{type:at.BackboneElement,value:a}}function P(a){return 0!==a.length&&!!a[0].value}function Q(a,b){if(0!==a.length){if(1===a.length&&(!b||a[0].type===b))return a[0];throw Error(`Expected singleton of type ${b}, but found ${JSON.stringify(a)}`)}}function R(a,b,c){if(!a.value)return;let d=function(a,b,c){let d=function(a,b){if(b){let c=E(b)[a];if(c)return c}return A[a]}(a,c);if(d)return function(a,b){let c=a[b]??a[b+"[x]"];if(c)return c;for(let c=0;c<b.length;c++){let d=b[c];if(d>="A"&&d<="Z"){let d=a[b.slice(0,c)+"[x]"];if(d)return d}}}(d.elements,b)}(a.type,b,c?.profileUrl);return d?function(a,b,c){let d=a.value,e=c.type;if(!e||0===e.length)return;let f,g="undefined",h,i=c.path.lastIndexOf("."),j=c.path.substring(i+1);for(let a of e){let b=j.replace("[x]",an(a.code));if(f=d[b],h=d["_"+b],void 0!==f||void 0!==h){g=a.code;break}}if(h)if(Array.isArray(f)){f=f.slice();for(let a=0;a<Math.max(f.length,h.length);a++)f[a]=ab(f[a],h[a])}else if(!f&&Array.isArray(h)){f=h.slice();for(let a=0;a<h.length;a++)f[a]=ab(void 0,h[a])}else f=ab(f,h);if(!ag(f))return("Element"===g||"BackboneElement"===g)&&(g=c.type[0].code),Array.isArray(f)?f.map(a=>S(a,g)):S(f,g)}(a,0,d):function(a,b){let c,d=a.value;if(d&&"object"==typeof d){if(b in d){let a=d[b];c=Array.isArray(a)?a.map(O):O(a)}else{let a=b.endsWith("[x]")?b.substring(0,b.length-3):b;for(let b of Object.values(at)){let e=a+an(b);if(e in d){let a=d[e];c=Array.isArray(a)?a.map(a=>({type:b,value:a})):{type:b,value:a};break}}}if(Array.isArray(c)){if(0===c.length||ag(c[0]))return}else if(ag(c))return;return c}}(a,b)}function S(a,b){return"Resource"===b&&aw(a)&&(b=a.resourceType),{type:b,value:a}}function T(a){let b=[];for(let c of a){let a=!1;for(let d of b)if(P(U(c,d))){a=!0;break}a||b.push(c)}return b}function U(a,b){let c=a.value?.valueOf(),d=b.value?.valueOf();return"number"==typeof c&&"number"==typeof d?N(1e-8>Math.abs(c-d)):Z(c)&&Z(d)?N($(c,d)):N("object"==typeof c&&"object"==typeof d?_(a,b):c===d)}function V(a,b){return 0===a.length&&0===b.length?N(!0):a.length!==b.length?N(!1):(a.sort(W),b.sort(W),N(a.every((a,c)=>P(function(a,b){let{type:c,value:d}=a,{type:e,value:f}=b,g=d?.valueOf(),h=f?.valueOf();return"number"==typeof g&&"number"==typeof h?N(.01>Math.abs(g-h)):Z(g)&&Z(h)?N($(g,h)):N("Coding"===c&&"Coding"===e?"object"==typeof g&&"object"==typeof h&&g.code===h.code&&g.system===h.system:"object"==typeof g&&"object"==typeof h?_({...g,id:void 0},{...h,id:void 0}):"string"==typeof g&&"string"==typeof h?g.toLowerCase()===h.toLowerCase():g===h)}(a,b[c])))))}function W(a,b){let c=a.value?.valueOf(),d=b.value?.valueOf();return"number"==typeof c&&"number"==typeof d?c-d:"string"==typeof c&&"string"==typeof d?c.localeCompare(d):0}function X(a,b){var c,d;let{value:e}=a;if(null==e)return!1;let f=b;switch(f.startsWith("System.")&&(f=f.substring(7)),f.startsWith("FHIR.")&&(f=f.substring(5)),f){case"Boolean":return"boolean"==typeof e;case"Decimal":case"Integer":return"number"==typeof e;case"Date":return"string"==typeof(c=e)&&!!M.date.exec(c);case"DateTime":return Y(e);case"Time":return"string"==typeof e&&!!/^T\d/.exec(e);case"Period":return!!((d=e)&&"object"==typeof d&&("start"in d&&Y(d.start)||"end"in d&&Y(d.end)));case"Quantity":return Z(e);default:return a.type===f||"object"==typeof e&&e?.resourceType===f}}function Y(a){return"string"==typeof a&&!!M.dateTime.exec(a)}function Z(a){return!!(a&&"object"==typeof a&&"value"in a&&"number"==typeof a.value)}function $(a,b){return .01>Math.abs(a.value-b.value)&&(a.unit===b.unit||a.code===b.code||a.unit===b.code||a.code===b.unit)}function _(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let d of c){let c=a[d],e=b[d];if(aa(c)&&aa(e)){if(!_(c,e))return!1}else if(c!==e)return!1}return!0}function aa(a){return null!==a&&"object"==typeof a}function ab(a,b){if(b){var c,d;if("object"!=typeof b)throw Error("Primitive extension must be an object");return c=a??{},d=b,delete d.__proto__,delete d.constructor,Object.assign(c,d)}return a}function ac(a){let b=ad(a)??"undefined/undefined",c=function(a){if("Patient"===a.resourceType||"Practitioner"===a.resourceType||"RelatedPerson"===a.resourceType){let b=function(a){let b=a.name;if(b&&b.length>0)return function(a,b){if(!a)return"";let c=[];if(a.prefix&&!0&&c.push(...a.prefix),a.given&&c.push(...a.given),a.family&&c.push(a.family),a.suffix&&b?.suffix!==!1&&c.push(...a.suffix),a.use&&(b?.all||b?.use)&&c.push("["+a.use+"]"),0===c.length){let b=as(a.text);if(b)return b}return c.join(" ").trim()}(b[0])}(a);if(b)return b}if("Device"===a.resourceType){let b=function(a){let b=a.deviceName;if(b&&b.length>0)return b[0].name}(a);if(b)return b}if("MedicationRequest"===a.resourceType&&a.medicationCodeableConcept)return ar(a.medicationCodeableConcept);if("Subscription"===a.resourceType&&a.criteria)return a.criteria;if("User"===a.resourceType&&a.email)return a.email;if("name"in a&&a.name&&"string"==typeof a.name)return a.name;if("code"in a&&a.code){var b;let c=a.code;if(Array.isArray(c)&&(c=c[0]),ak(c))return ar(c);if(ai(b=c)&&"text"in b&&"string"==typeof b.text)return c.text}return ad(a)??""}(a);return c===b?{reference:b}:{reference:b,display:c}}function ad(a){return ax(a)?a.reference:aw(a,void 0)&&"id"in a&&"string"==typeof a.id?`${a.resourceType}/${a.id}`:void 0}function ae(a){if(a)return ax(a)?a.reference.split("/")[1]:a.id}function af(a,...b){let c=a;for(let a=0;a<b.length&&c;a++)c=c?.extension?.find(c=>c.url===b[a]);return c}function ag(a){if(null==a)return!0;let b=typeof a;return("string"===b||"object"===b)&&!function(a){if(null==a)return!1;let b=typeof a;return"string"===b&&""!==a||"object"===b&&("length"in a&&a.length>0||Object.keys(a).length>0)}(a)}function ah(a,b,c){return!!(a===b||ag(a)&&ag(b))||!(ag(a)||ag(b))&&(Array.isArray(a)&&Array.isArray(b)?function(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(!ah(a[c],b[c]))return!1;return!0}(a,b):!(Array.isArray(a)||Array.isArray(b))&&(ai(a)&&ai(b)?function(a,b,c){let d=new Set;for(let e of(Object.keys(a).forEach(a=>d.add(a)),Object.keys(b).forEach(a=>d.add(a)),"meta"===c&&(d.delete("versionId"),d.delete("lastUpdated"),d.delete("author")),d))if(!ah(a[e],b[e],e))return!1;return!0}(a,b,c):(ai(a)||ai(b),!1)))}function ai(a){return null!==a&&"object"==typeof a}function aj(a){return ai(a)&&"code"in a&&"string"==typeof a.code}function ak(a){return ai(a)&&"coding"in a&&Array.isArray(a.coding)&&a.coding.every(aj)}var al=[];for(let a=0;a<256;a++)al.push(a.toString(16).padStart(2,"0"));function am(a){return ArrayBuffer.isView(a)?a.buffer:a}function an(a){return a?a.charAt(0).toUpperCase()+a.substring(1):""}var ao=a=>new Promise(b=>{setTimeout(b,a)});function ap(a){return a.endsWith("/")?a:a+"/"}function aq(a,b){return new URL(b.startsWith("/")?b.slice(1):b,ap(a.toString())).toString()}function ar(a){return a?as(a.text)||(a.coding?a.coding.map(a=>(function(a,b){let c=as(a?.display);if(c){let a=void 0;return`${c}${a?" ("+a+")":""}`}return as(a?.code)??""})(a)).join(", "):""):""}function as(a){return"string"==typeof a?a:void 0}var at={Address:"Address",Age:"Age",Annotation:"Annotation",Attachment:"Attachment",BackboneElement:"BackboneElement",CodeableConcept:"CodeableConcept",Coding:"Coding",ContactDetail:"ContactDetail",ContactPoint:"ContactPoint",Contributor:"Contributor",Count:"Count",DataRequirement:"DataRequirement",Distance:"Distance",Dosage:"Dosage",Duration:"Duration",Expression:"Expression",Extension:"Extension",HumanName:"HumanName",Identifier:"Identifier",MarketingStatus:"MarketingStatus",Meta:"Meta",Money:"Money",Narrative:"Narrative",ParameterDefinition:"ParameterDefinition",Period:"Period",Population:"Population",ProdCharacteristic:"ProdCharacteristic",ProductShelfLife:"ProductShelfLife",Quantity:"Quantity",Range:"Range",Ratio:"Ratio",Reference:"Reference",RelatedArtifact:"RelatedArtifact",SampledData:"SampledData",Signature:"Signature",SubstanceAmount:"SubstanceAmount",SystemString:"http://hl7.org/fhirpath/System.String",Timing:"Timing",TriggerDefinition:"TriggerDefinition",UsageContext:"UsageContext",base64Binary:"base64Binary",boolean:"boolean",canonical:"canonical",code:"code",date:"date",dateTime:"dateTime",decimal:"decimal",id:"id",instant:"instant",integer:"integer",markdown:"markdown",oid:"oid",positiveInt:"positiveInt",string:"string",time:"time",unsignedInt:"unsignedInt",uri:"uri",url:"url",uuid:"uuid"};function au(a){let b=ay.types[a];return b||(b={searchParamsDetails:{}},ay.types[a]=b),b.searchParams||"Binary"===a||(b.searchParams={_id:{base:[a],code:"_id",type:"token",expression:a+".id"},_lastUpdated:{base:[a],code:"_lastUpdated",type:"date",expression:a+".meta.lastUpdated"},_compartment:{base:[a],code:"_compartment",type:"reference",expression:a+".meta.compartment"},_profile:{base:[a],code:"_profile",type:"uri",expression:a+".meta.profile"},_security:{base:[a],code:"_security",type:"token",expression:a+".meta.security"},_source:{base:[a],code:"_source",type:"uri",expression:a+".meta.source"},_tag:{base:[a],code:"_tag",type:"token",expression:a+".meta.tag"}}),b}function av(a){var b;let c=a.type?.[0]?.code;return"BackboneElement"===c||"Element"===c?1===(b=(a.base?.path??a.path)?.split(".")).length?b[0]:b.map(an).join(""):c}function aw(a,b){return!(!a||"object"!=typeof a||!("resourceType"in a)||b&&a.resourceType!==b)}function ax(a,b){return!!a&&"object"==typeof a&&"reference"in a&&"string"==typeof a.reference&&(!b||null!==a.reference.match(RegExp(`^${b}(/|\\?)`)))}var ay={types:{}};function az(a){if(a.startsWith("T"))return a+"T00:00:00.000Z".substring(a.length);if(a.length<=10)return a;try{return new Date(a).toISOString()}catch{return a}}var aA=()=>[],aB={empty:(a,b)=>N(b.every(a=>ag(a.value))),hasValue:(a,b)=>N(0!==b.length),exists:(a,b,c)=>c?N(b.some(b=>P(c.eval(a,[b])))):N(b.length>0&&b.every(a=>!ag(a.value))),all:(a,b,c)=>N(b.every(b=>P(c.eval(a,[b])))),allTrue:(a,b)=>{for(let a of b)if(!a.value)return N(!1);return N(!0)},anyTrue:(a,b)=>{for(let a of b)if(a.value)return N(!0);return N(!1)},allFalse:(a,b)=>{for(let a of b)if(a.value)return N(!1);return N(!0)},anyFalse:(a,b)=>{for(let a of b)if(!a.value)return N(!0);return N(!1)},subsetOf:(a,b,c)=>{if(0===b.length)return N(!0);let d=c.eval(a,aF(a));return 0===d.length?N(!1):N(b.every(a=>d.some(b=>b.value===a.value)))},supersetOf:(a,b,c)=>{let d=c.eval(a,aF(a));return 0===d.length?N(!0):0===b.length?N(!1):N(d.every(a=>b.some(b=>b.value===a.value)))},count:(a,b)=>[{type:at.integer,value:b.length}],distinct:(a,b)=>{let c=[];for(let a of b)c.some(b=>b.value===a.value)||c.push(a);return c},isDistinct:(a,b)=>N(b.length===aB.distinct(a,b).length),where:(a,b,c)=>b.filter(b=>P(c.eval(a,[b]))),select:(a,b,c)=>b.flatMap(b=>c.eval({parent:a,variables:{$this:b}},[b])),repeat:aA,ofType:(a,b,c)=>b.filter(a=>a.type===c.name),single:(a,b)=>{if(b.length>1)throw Error("Expected input length one for single()");return 0===b.length?[]:b.slice(0,1)},first:(a,b)=>0===b.length?[]:b.slice(0,1),last:(a,b)=>0===b.length?[]:b.slice(-1,b.length),tail:(a,b)=>0===b.length?[]:b.slice(1,b.length),skip:(a,b,c)=>{let d=c.eval(a,b)[0]?.value;if("number"!=typeof d)throw TypeError("Expected a number for skip(num)");return d>=b.length?[]:d<=0?b:b.slice(d,b.length)},take:(a,b,c)=>{let d=c.eval(a,b)[0]?.value;if("number"!=typeof d)throw TypeError("Expected a number for take(num)");return d>=b.length?b:d<=0?[]:b.slice(0,d)},intersect:(a,b,c)=>{if(!c)return b;let d=c.eval(a,aF(a)),e=[];for(let a of b)!e.some(b=>b.value===a.value)&&d.some(b=>b.value===a.value)&&e.push(a);return e},exclude:(a,b,c)=>{if(!c)return b;let d=c.eval(a,aF(a)),e=[];for(let a of b)d.some(b=>b.value===a.value)||e.push(a);return e},union:(a,b,c)=>c?T([...b,...c.eval(a,aF(a))]):b,combine:(a,b,c)=>c?[...b,...c.eval(a,aF(a))]:b,htmlChecks:(a,b,c)=>[O(!0)],iif:(a,b,c,d,e)=>{let f=c.eval(a,b);if(f.length>1||1===f.length&&"boolean"!=typeof f[0].value)throw Error("Expected criterion to evaluate to a Boolean");return P(f)?d.eval(a,b):e?e.eval(a,b):[]},toBoolean:(a,b)=>{if(0===b.length)return[];let[{value:c}]=aE(b,1);if("boolean"==typeof c)return[{type:at.boolean,value:c}];if("number"==typeof c&&(0===c||1===c))return N(!!c);if("string"==typeof c){let a=c.toLowerCase();if(["true","t","yes","y","1","1.0"].includes(a))return N(!0);if(["false","f","no","n","0","0.0"].includes(a))return N(!1)}return[]},convertsToBoolean:(a,b)=>0===b.length?[]:N(1===aB.toBoolean(a,b).length),toInteger:(a,b)=>{if(0===b.length)return[];let[{value:c}]=aE(b,1);return"number"==typeof c?[{type:at.integer,value:c}]:"string"==typeof c&&/^[+-]?\d+$/.exec(c)?[{type:at.integer,value:Number.parseInt(c,10)}]:"boolean"==typeof c?[{type:at.integer,value:+!!c}]:[]},convertsToInteger:(a,b)=>0===b.length?[]:N(1===aB.toInteger(a,b).length),toDate:(a,b)=>{if(0===b.length)return[];let[{value:c}]=aE(b,1);return"string"==typeof c&&/^\d{4}(-\d{2}(-\d{2})?)?/.exec(c)?[{type:at.date,value:az(c)}]:[]},convertsToDate:(a,b)=>0===b.length?[]:N(1===aB.toDate(a,b).length),toDateTime:(a,b)=>{if(0===b.length)return[];let[{value:c}]=aE(b,1);return"string"==typeof c&&/^\d{4}(-\d{2}(-\d{2})?)?/.exec(c)?[{type:at.dateTime,value:az(c)}]:[]},convertsToDateTime:(a,b)=>0===b.length?[]:N(1===aB.toDateTime(a,b).length),toDecimal:(a,b)=>{if(0===b.length)return[];let[{value:c}]=aE(b,1);return"number"==typeof c?[{type:at.decimal,value:c}]:"string"==typeof c&&/^-?\d{1,9}(\.\d{1,9})?$/.exec(c)?[{type:at.decimal,value:Number.parseFloat(c)}]:"boolean"==typeof c?[{type:at.decimal,value:+!!c}]:[]},convertsToDecimal:(a,b)=>0===b.length?[]:N(1===aB.toDecimal(a,b).length),toQuantity:(a,b)=>{if(0===b.length)return[];let[{value:c}]=aE(b,1);return Z(c)?[{type:at.Quantity,value:c}]:"number"==typeof c?[{type:at.Quantity,value:{value:c,unit:"1"}}]:"string"==typeof c&&/^-?\d{1,9}(\.\d{1,9})?/.exec(c)?[{type:at.Quantity,value:{value:Number.parseFloat(c),unit:"1"}}]:"boolean"==typeof c?[{type:at.Quantity,value:{value:+!!c,unit:"1"}}]:[]},convertsToQuantity:(a,b)=>0===b.length?[]:N(1===aB.toQuantity(a,b).length),toString:(a,b)=>{if(0===b.length)return[];let[{value:c}]=aE(b,1);return null==c?[]:Z(c)?[{type:at.string,value:`${c.value} '${c.unit}'`}]:[{type:at.string,value:c.toString()}]},convertsToString:(a,b)=>0===b.length?[]:N(1===aB.toString(a,b).length),toTime:(a,b)=>{if(0===b.length)return[];let[{value:c}]=aE(b,1);if("string"==typeof c){let a=/^T?(\d{2}(:\d{2}(:\d{2})?)?)/.exec(c);if(a)return[{type:at.time,value:az("T"+a[1])}]}return[]},convertsToTime:(a,b)=>0===b.length?[]:N(1===aB.toTime(a,b).length),indexOf:(a,b,c)=>aC((a,b)=>a.indexOf(b),a,b,c),substring:(a,b,c,d)=>aC((a,b,c)=>{let d=c?b+c:a.length;return b<0||b>=a.length?void 0:a.substring(b,d)},a,b,c,d),startsWith:(a,b,c)=>aC((a,b)=>a.startsWith(b),a,b,c),endsWith:(a,b,c)=>aC((a,b)=>a.endsWith(b),a,b,c),contains:(a,b,c)=>aC((a,b)=>a.includes(b),a,b,c),upper:(a,b)=>aC(a=>a.toUpperCase(),a,b),lower:(a,b)=>aC(a=>a.toLowerCase(),a,b),replace:(a,b,c,d)=>aC((a,b,c)=>a.replaceAll(b,c),a,b,c,d),matches:(a,b,c)=>aC((a,b)=>!!new RegExp(b).exec(a),a,b,c),replaceMatches:(a,b,c,d)=>aC((a,b,c)=>a.replaceAll(RegExp(b,"g"),c.replaceAll(/\$\{(\w+)\}/g,"$<$1>")),a,b,c,d),length:(a,b)=>aC(a=>a.length,a,b),toChars:(a,b)=>aC(a=>a?a.split(""):void 0,a,b),encode:aA,decode:aA,escape:aA,unescape:aA,trim:aA,split:aA,join:(a,b,c)=>{let d=c?.eval(a,aF(a))[0]?.value??"";if("string"!=typeof d)throw TypeError("Separator must be a string.");return[{type:at.string,value:b.map(a=>a.value?.toString()??"").join(d)}]},abs:(a,b)=>aD(Math.abs,a,b),ceiling:(a,b)=>aD(Math.ceil,a,b),exp:(a,b)=>aD(Math.exp,a,b),floor:(a,b)=>aD(Math.floor,a,b),ln:(a,b)=>aD(Math.log,a,b),log:(a,b,c)=>aD((a,b)=>Math.log(a)/Math.log(b),a,b,c),power:(a,b,c)=>aD(Math.pow,a,b,c),round:(a,b,...c)=>aD((a,b=0)=>{if("number"!=typeof b||b<0)throw Error("Invalid precision provided to round()");let c=Math.pow(10,b);return Math.round(a*c)/c},a,b,...c),sqrt:(a,b)=>aD(Math.sqrt,a,b),truncate:(a,b)=>aD(a=>Math.trunc(a),a,b),children:aA,descendants:aA,trace:(a,b,c)=>b,now:()=>[{type:at.dateTime,value:new Date().toISOString()}],timeOfDay:()=>[{type:at.time,value:new Date().toISOString().substring(11)}],today:()=>[{type:at.date,value:new Date().toISOString().substring(0,10)}],between:(a,b,c,d,e)=>{let f=aB.toDateTime(a,c.eval(a,b));if(0===f.length)throw Error("Invalid start date");let g=aB.toDateTime(a,d.eval(a,b));if(0===g.length)throw Error("Invalid end date");let h=e.eval(a,b)[0]?.value;if("years"!==h&&"months"!==h&&"days"!==h)throw Error("Invalid units");let i=function(a,b){let c=new Date(a);c.setUTCHours(0,0,0,0);let d=b?new Date(b):new Date;d.setUTCHours(0,0,0,0);let e=c.getUTCFullYear(),f=c.getUTCMonth(),g=c.getUTCDate(),h=d.getUTCFullYear(),i=d.getUTCMonth(),j=d.getUTCDate(),k=h-e;(i<f||i===f&&j<g)&&k--;let l=12*h+i-(12*e+f);return j<g&&l--,{years:k,months:l,days:Math.floor((d.getTime()-c.getTime())/864e5)}}(f[0].value,g[0].value);return[{type:at.Quantity,value:{value:i[h],unit:h}}]},is:(a,b,c)=>{let d="";return c instanceof aH?d=c.name:c instanceof aQ&&(d=c.left.name+"."+c.right.name),d?b.map(a=>({type:at.boolean,value:X(a,d)})):[]},not:(a,b)=>aB.toBoolean(a,b).map(a=>({type:at.boolean,value:!a.value})),resolve:(a,b)=>b.map(a=>{let b=a.value,c;if("string"==typeof b)c=b;else if("object"==typeof b){if(b.resource)return O(b.resource);b.reference?c=b.reference:b.type&&b.identifier&&(c=`${b.type}?identifier=${b.identifier.system}|${b.identifier.value}`)}if(c?.includes("?")){let[a]=c.split("?");return{type:a,value:{resourceType:a}}}if(c?.includes("/")){let[a,b]=c.split("/");return{type:a,value:{resourceType:a,id:b}}}return{type:at.BackboneElement,value:void 0}}).filter(a=>!!a.value),as:(a,b)=>b,type:(a,b)=>b.map(({value:a})=>"boolean"==typeof a?{type:at.BackboneElement,value:{namespace:"System",name:"Boolean"}}:"number"==typeof a?{type:at.BackboneElement,value:{namespace:"System",name:"Integer"}}:aw(a)?{type:at.BackboneElement,value:{namespace:"FHIR",name:a.resourceType}}:{type:at.BackboneElement,value:null}),conformsTo:(a,b,c)=>{let d=c.eval(a,b)[0].value;if(!d.startsWith("http://hl7.org/fhir/StructureDefinition/"))throw Error("Expected a StructureDefinition URL");let e=d.replace("http://hl7.org/fhir/StructureDefinition/","");return b.map(a=>({type:at.boolean,value:a.value?.resourceType===e}))},getResourceKey:(a,b)=>{let c=b[0].value;return c?.id?[{type:at.id,value:c.id}]:[]},getReferenceKey:(a,b,c)=>{let d=b[0].value;if(!d?.reference)return[];let e="";return c instanceof aH&&(e=c.name),e&&!d.reference.startsWith(e+"/")?[]:[{type:at.id,value:ae(d)}]},extension:(a,b,c)=>{let d=c.eval(a,b)[0].value,e=b?.[0]?.value;if(e){let a=af(e,d);if(a)return[{type:at.Extension,value:a}]}return[]}};function aC(a,b,c,...d){if(0===c.length)return[];let[{value:e}]=aE(c,1);if("string"!=typeof e)throw TypeError("String function cannot be called with non-string");let f=a(e,...d.map(a=>a?.eval(b,c)[0]?.value));return void 0===f?[]:Array.isArray(f)?f.map(O):[O(f)]}function aD(a,b,c,...d){if(0===c.length)return[];let[{value:e}]=aE(c,1),f=Z(e),g=f?e.value:e;if("number"!=typeof g)throw TypeError("Math function cannot be called with non-number");let h=a(g,...d.map(a=>a.eval(b,c)[0]?.value));return[{type:f?at.Quantity:c[0].type,value:f?{...e,value:h}:h}]}function aE(a,b){if(a.length!==b)throw Error(`Expected ${b} arguments`);for(let b of a)if(null==b)throw Error("Expected non-null argument");return a}function aF(a){let b=a;for(;b.parent?.variables.$this;)b=b.parent;return[b.variables.$this]}var aG=class{constructor(a){i(this,"value"),this.value=a}eval(){return[this.value]}toString(){let a=this.value.value;return"string"==typeof a?`'${a}'`:a.toString()}},aH=class{constructor(a){i(this,"name"),this.name=a}eval(a,b){if("$this"===this.name)return b;let c=this.getVariable(a);if(c)return[c];if(this.name.startsWith("%"))throw Error(`Undefined variable ${this.name}`);return b.flatMap(a=>this.evalValue(a)).filter(a=>a?.value!==void 0)}getVariable(a){let b=a.variables[this.name];return void 0!==b?b:a.parent?this.getVariable(a.parent):void 0}evalValue(a){let b=a.value;if(!(!b||"object"!=typeof b)){var c,d,e,f;let g,h;return aw(b,this.name)?a:(c=this.name,g=a.path,d=R(a,c,void 0),e=g,f=c,h=e?e+".":"",void 0===d?{type:"undefined",value:void 0,path:`${h}${f}`}:Array.isArray(d)?d.map((a,b)=>({...a,path:`${h}${f}[${b}]`})):{...d,path:`${h}${f}`})}}toString(){return this.name}},aI=class{eval(){return[]}toString(){return"{}"}},aJ=class extends j{constructor(a,b,c){super(a,b),i(this,"impl"),this.impl=c}eval(a,b){return this.impl(this.child.eval(a,b))}toString(){return this.operator+this.child.toString()}},aK=class extends k{constructor(a,b){super("as",a,b)}eval(a,b){return aB.ofType(a,this.left.eval(a,b),this.right)}},aL=class extends k{},aM=class extends aL{constructor(a,b,c,d){super(a,b,c),i(this,"impl"),this.impl=d}eval(a,b){let c=this.left.eval(a,b);if(1!==c.length)return[];let d=this.right.eval(a,b);if(1!==d.length)return[];let e=c[0].value,f=d[0].value,g=Z(e)?e.value:e,h=Z(f)?f.value:f,i=this.impl(g,h);return"boolean"==typeof i?N(i):Z(e)?[{type:at.Quantity,value:{...e,value:i}}]:[O(i)]}},aN=class extends k{constructor(a,b){super("&",a,b)}eval(a,b){let c=[...this.left.eval(a,b),...this.right.eval(a,b)];return c.length>0&&c.every(a=>"string"==typeof a.value)?[{type:at.string,value:c.map(a=>a.value).join("")}]:c}},aO=class extends aL{constructor(a,b){super("contains",a,b)}eval(a,b){let c=this.left.eval(a,b),d=this.right.eval(a,b);return N(c.some(a=>a.value===d[0].value))}},aP=class extends aL{constructor(a,b){super("in",a,b)}eval(a,b){let c=Q(this.left.eval(a,b)),d=this.right.eval(a,b);return c?N(d.some(a=>U(c,a)[0].value)):[]}},aQ=class extends k{constructor(a,b){super(".",a,b)}eval(a,b){return this.right.eval(a,this.left.eval(a,b))}toString(){return`${this.left.toString()}.${this.right.toString()}`}},aR=class extends k{constructor(a,b){super("|",a,b)}eval(a,b){return T([...this.left.eval(a,b),...this.right.eval(a,b)])}},aS=class extends aL{constructor(a,b){super("=",a,b)}eval(a,b){let c=this.left.eval(a,b),d=this.right.eval(a,b);return 0===c.length||0===d.length?[]:c.length!==d.length?N(!1):N(c.every((a,b)=>P(U(a,d[b]))))}},aT=class extends aL{constructor(a,b){super("!=",a,b)}eval(a,b){let c=this.left.eval(a,b),d=this.right.eval(a,b);return 0===c.length||0===d.length?[]:c.length!==d.length?N(!0):N(c.some((a,b)=>!P(U(a,d[b]))))}},aU=class extends aL{constructor(a,b){super("~",a,b)}eval(a,b){return V(this.left.eval(a,b),this.right.eval(a,b))}},aV=class extends aL{constructor(a,b){super("!~",a,b)}eval(a,b){return N(!P(V(this.left.eval(a,b),this.right.eval(a,b))))}},aW=class extends aL{constructor(a,b){super("is",a,b)}eval(a,b){let c=this.left.eval(a,b);if(1!==c.length)return[];let d=this.right.name;return N(X(c[0],d))}},aX=class extends aL{constructor(a,b){super("and",a,b)}eval(a,b){let c=Q(this.left.eval(a,b),"boolean"),d=Q(this.right.eval(a,b),"boolean");return c?.value===!0&&d?.value===!0?N(!0):c?.value===!1||d?.value===!1?N(!1):[]}},aY=class extends aL{constructor(a,b){super("or",a,b)}eval(a,b){let c=Q(this.left.eval(a,b),"boolean"),d=Q(this.right.eval(a,b),"boolean");return c?.value===!1&&d?.value===!1?N(!1):c?.value||d?.value?N(!0):[]}},aZ=class extends aL{constructor(a,b){super("xor",a,b)}eval(a,b){let c=Q(this.left.eval(a,b),"boolean"),d=Q(this.right.eval(a,b),"boolean");return c&&d?N(c.value!==d.value):[]}},a$=class extends aL{constructor(a,b){super("implies",a,b)}eval(a,b){let c=Q(this.left.eval(a,b),"boolean"),d=Q(this.right.eval(a,b),"boolean");return d?.value===!0||c?.value===!1?N(!0):c&&d?N(!1):[]}},a_=class{constructor(a,b){i(this,"name"),i(this,"args"),this.name=a,this.args=b}eval(a,b){let c=aB[this.name];if(!c)throw Error("Unrecognized function: "+this.name);return c(a,b,...this.args)}toString(){return`${this.name}(${this.args.map(a=>a.toString()).join(", ")})`}},a0=class{constructor(a,b){i(this,"left"),i(this,"expr"),this.left=a,this.expr=b}eval(a,b){let c=this.expr.eval(a,b);if(1!==c.length)return[];let d=c[0].value;if("number"!=typeof d)throw Error("Invalid indexer expression: should return integer}");let e=this.left.eval(a,b);return d in e?[e[d]]:[]}toString(){return`${this.left.toString()}[${this.expr.toString()}]`}},a1=["!=","!~","<=",">=","{}","->"],a2={FunctionCall:0,Dot:1,Indexer:2,UnaryAdd:3,UnarySubtract:3,Multiply:4,Divide:4,Modulo:4,Add:5,Subtract:5,Ampersand:5,Is:6,As:6,Union:7,GreaterThan:8,GreaterThanOrEquals:8,LessThan:8,LessThanOrEquals:8,Equals:9,Equivalent:9,NotEquals:9,NotEquivalent:9,In:10,Contains:10,And:11,Xor:12,Or:12,Implies:13,Arrow:100,Semicolon:200},a3={parse(a){let b=a.consumeAndParse();if(!a.match(")"))throw Error("Parse error: expected `)` got `"+a.peek()?.value+"`");return b}},a4={parse(a,b){let c=a.consumeAndParse();if(!a.match("]"))throw Error("Parse error: expected `]`");return new a0(b,c)},precedence:a2.Indexer},a5={parse(a,b){if(!(b instanceof aH))throw Error("Unexpected parentheses");let c=[];for(;!a.match(")");)c.push(a.consumeAndParse()),a.match(",");return new a_(b.name,c)},precedence:a2.FunctionCall};function a6(){return new l().registerPrefix("String",{parse:(a,b)=>new aG({type:at.string,value:b.value})}).registerPrefix("DateTime",{parse:(a,b)=>new aG({type:at.dateTime,value:az(b.value)})}).registerPrefix("Quantity",{parse:(a,b)=>{let c,d,e;return new aG({type:at.Quantity,value:(d=Number.parseFloat((c=b.value.split(" "))[0]),e=c[1],{value:d,unit:e=e?.startsWith("'")&&e.endsWith("'")?e.substring(1,e.length-1):"{"+e+"}"})})}}).registerPrefix("Number",{parse:(a,b)=>new aG({type:b.value.includes(".")?at.decimal:at.integer,value:Number.parseFloat(b.value)})}).registerPrefix("true",{parse:()=>new aG({type:at.boolean,value:!0})}).registerPrefix("false",{parse:()=>new aG({type:at.boolean,value:!1})}).registerPrefix("Symbol",{parse:(a,b)=>new aH(b.value)}).registerPrefix("{}",{parse:()=>new aI}).registerPrefix("(",a3).registerInfix("[",a4).registerInfix("(",a5).prefix("+",a2.UnaryAdd,(a,b)=>new aJ("+",b,a=>a)).prefix("-",a2.UnarySubtract,(a,b)=>new aM("-",b,b,(a,b)=>-b)).infixLeft(".",a2.Dot,(a,b,c)=>new aQ(a,c)).infixLeft("/",a2.Divide,(a,b,c)=>new aM("/",a,c,(a,b)=>a/b)).infixLeft("*",a2.Multiply,(a,b,c)=>new aM("*",a,c,(a,b)=>a*b)).infixLeft("+",a2.Add,(a,b,c)=>new aM("+",a,c,(a,b)=>a+b)).infixLeft("-",a2.Subtract,(a,b,c)=>new aM("-",a,c,(a,b)=>a-b)).infixLeft("|",a2.Union,(a,b,c)=>new aR(a,c)).infixLeft("=",a2.Equals,(a,b,c)=>new aS(a,c)).infixLeft("!=",a2.NotEquals,(a,b,c)=>new aT(a,c)).infixLeft("~",a2.Equivalent,(a,b,c)=>new aU(a,c)).infixLeft("!~",a2.NotEquivalent,(a,b,c)=>new aV(a,c)).infixLeft("<",a2.LessThan,(a,b,c)=>new aM("<",a,c,(a,b)=>a<b)).infixLeft("<=",a2.LessThanOrEquals,(a,b,c)=>new aM("<=",a,c,(a,b)=>a<=b)).infixLeft(">",a2.GreaterThan,(a,b,c)=>new aM(">",a,c,(a,b)=>a>b)).infixLeft(">=",a2.GreaterThanOrEquals,(a,b,c)=>new aM(">=",a,c,(a,b)=>a>=b)).infixLeft("&",a2.Ampersand,(a,b,c)=>new aN(a,c)).infixLeft("and",a2.And,(a,b,c)=>new aX(a,c)).infixLeft("as",a2.As,(a,b,c)=>new aK(a,c)).infixLeft("contains",a2.Contains,(a,b,c)=>new aO(a,c)).infixLeft("div",a2.Divide,(a,b,c)=>new aM("div",a,c,(a,b)=>a/b|0)).infixLeft("in",a2.In,(a,b,c)=>new aP(a,c)).infixLeft("is",a2.Is,(a,b,c)=>new aW(a,c)).infixLeft("mod",a2.Modulo,(a,b,c)=>new aM("mod",a,c,(a,b)=>a%b)).infixLeft("or",a2.Or,(a,b,c)=>new aY(a,c)).infixLeft("xor",a2.Xor,(a,b,c)=>new aZ(a,c)).infixLeft("implies",a2.Implies,(a,b,c)=>new a$(a,c))}a6();var a7={EQUALS:"eq",NOT_EQUALS:"ne",GREATER_THAN:"gt",LESS_THAN:"lt",GREATER_THAN_OR_EQUALS:"ge",LESS_THAN_OR_EQUALS:"le",STARTS_AFTER:"sa",ENDS_BEFORE:"eb",APPROXIMATELY:"ap",CONTAINS:"contains",STARTS_WITH:"sw",EXACT:"exact",TEXT:"text",NOT:"not",ABOVE:"above",BELOW:"below",IN:"in",NOT_IN:"not-in",OF_TYPE:"of-type",MISSING:"missing",PRESENT:"present",IDENTIFIER:"identifier",ITERATE:"iterate"};a7.CONTAINS,a7.EXACT,a7.ABOVE,a7.BELOW,a7.TEXT,a7.NOT,a7.IN,a7.NOT_IN,a7.OF_TYPE,a7.MISSING,a7.IDENTIFIER,a7.ITERATE,a7.EQUALS,a7.NOT_EQUALS,a7.LESS_THAN,a7.LESS_THAN_OR_EQUALS,a7.GREATER_THAN,a7.GREATER_THAN_OR_EQUALS,a7.STARTS_AFTER,a7.ENDS_BEFORE,a7.APPROXIMATELY,a7.STARTS_WITH,a7.MISSING,a7.PRESENT;var a8={READ:"read",VREAD:"vread",HISTORY:"history",SEARCH:"search"};function a9(){return"u">typeof Buffer?Buffer:void 0}a8.READ,a8.VREAD,a8.HISTORY,a8.SEARCH;var ba={assign(a){},reload(){},getSearch:()=>"",getPathname:()=>"",getLocation:()=>"",getOrigin:()=>""};function bb(a){let b=a9();if(b)return b.from(a,"utf8").toString("base64");throw Error("Unable to encode base64")}function bc(){let a=new Uint32Array(28);return crypto.getRandomValues(a),function(a){let b=new Uint8Array(am(a)),c=Array(b.length);for(let a=0;a<b.length;a++)c[a]=al[b[a]];return c.join("")}(a.buffer)}async function bd(a){return crypto.subtle.digest("SHA-256",new TextEncoder().encode(a))}var be={FHIR_JSON:"application/fhir+json",FORM_URL_ENCODED:"application/x-www-form-urlencoded",JSON:"application/json",JSON_PATCH:"application/json-patch+json",TEXT:"text/plain",XML:"text/xml",CDA_XML:"application/cda+xml"},bf=class{constructor(){i(this,"listeners"),this.listeners={}}addEventListener(a,b){this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b)}removeEventListener(a,b){let c=this.listeners[a];if(c){for(let a=0;a<c.length;a++)if(c[a]===b)return void c.splice(a,1)}}dispatchEvent(a){let b=this.listeners[a.type];if(b)for(let c of b)c.call(this,a);return!a.defaultPrevented}removeAllListeners(){this.listeners={}}listenerCount(a){return this.listeners[a]?.length??0}},bg=class{constructor(){i(this,"emitter",new bf)}dispatchEvent(a){this.emitter.dispatchEvent(a)}addEventListener(a,b){this.emitter.addEventListener(a,b)}removeEventListener(a,b){this.emitter.removeEventListener(a,b)}removeAllListeners(){this.emitter.removeAllListeners()}listenerCount(a){return this.emitter.listenerCount(a)}},bh={"Patient-open":"Patient-open","Patient-close":"Patient-close","ImagingStudy-open":"ImagingStudy-open","ImagingStudy-close":"ImagingStudy-close","Encounter-open":"Encounter-open","Encounter-close":"Encounter-close","DiagnosticReport-open":"DiagnosticReport-open","DiagnosticReport-close":"DiagnosticReport-close","DiagnosticReport-select":"DiagnosticReport-select","DiagnosticReport-update":"DiagnosticReport-update",syncerror:"syncerror"},bi=["Patient","Encounter","ImagingStudy","DiagnosticReport","OperationOutcome","Bundle"],bj=["DiagnosticReport-update"],bk={"Patient-open":{patient:{resourceType:"Patient"},encounter:{resourceType:"Encounter",optional:!0}},"Patient-close":{patient:{resourceType:"Patient"},encounter:{resourceType:"Encounter",optional:!0}},"ImagingStudy-open":{study:{resourceType:"ImagingStudy"},encounter:{resourceType:"Encounter",optional:!0},patient:{resourceType:"Patient",optional:!0}},"ImagingStudy-close":{study:{resourceType:"ImagingStudy"},encounter:{resourceType:"Encounter",optional:!0},patient:{resourceType:"Patient",optional:!0}},"Encounter-open":{encounter:{resourceType:"Encounter"},patient:{resourceType:"Patient"}},"Encounter-close":{encounter:{resourceType:"Encounter"},patient:{resourceType:"Patient"}},"DiagnosticReport-open":{report:{resourceType:"DiagnosticReport"},encounter:{resourceType:"Encounter",optional:!0},study:{resourceType:"ImagingStudy",optional:!0,manyAllowed:!0},patient:{resourceType:"Patient"}},"DiagnosticReport-close":{report:{resourceType:"DiagnosticReport"},encounter:{resourceType:"Encounter",optional:!0},study:{resourceType:"ImagingStudy",optional:!0,manyAllowed:!0},patient:{resourceType:"Patient"}},"DiagnosticReport-select":{report:{resourceType:"DiagnosticReport",reference:!0},patient:{resourceType:"Patient",optional:!0,reference:!0},select:{resourceType:"*",reference:!0,manyAllowed:!0}},"DiagnosticReport-update":{report:{resourceType:"DiagnosticReport",reference:!0},patient:{resourceType:"Patient",optional:!0,reference:!0},updates:{resourceType:"Bundle"}},syncerror:{operationoutcome:{resourceType:"OperationOutcome"}}};function bl(a){return!!a.endpoint}function bm(a){if(!bn(a))throw new v(t("subscriptionRequest must be an object conforming to SubscriptionRequest type."));let{channelType:b,mode:c,topic:d,events:e}=a,f={"hub.channel.type":b,"hub.mode":c,"hub.topic":d,"hub.events":e.join(",")};return bl(a)&&(f.endpoint=a.endpoint),new URLSearchParams(f).toString()}function bn(a){if("object"!=typeof a)return!1;let{channelType:b,mode:c,topic:d,events:e}=a;if(!(b&&c&&d&&e)||"string"!=typeof d||"object"!=typeof e||!Array.isArray(e)||e.length<1||"websocket"!==b||"subscribe"!==c&&"unsubscribe"!==c)return!1;for(let a of e)if(!bh[a])return!1;return!(bl(a)&&!("string"==typeof a.endpoint&&a.endpoint.startsWith("ws")))}function bo(a,b,c,d){if(!(a&&"string"==typeof a))throw new v(t("Must provide a topic."));if(!bh[b])throw new v(t(`Must provide a valid FHIRcast event name. Supported events: ${Object.keys(bh).join(", ")}`));if("object"!=typeof c)throw new v(t("context must be a context object or array of context objects."));if(bj.includes(b)&&!d)throw new v(t(`The '${b}' event must contain a 'context.versionId'.`));let e=Array.isArray(c)?c:[c];return function(a,b){let c=new Map,d=bk[a];for(let e=0;e<b.length;e++){let f=b[e].key;if(!d[f])throw new v(t(`Key '${f}' not found for event '${a}'. Make sure to add only valid keys.`));!function(a,b,c,d,e){if(e.set(b.key,(e.get(b.key)??0)+1),d.reference){if(!ax(b.reference))throw new v(t(`context[${c}] is invalid. Expected key '${b.key}' to be a reference.`))}else{var f,g=b.resource;if("object"!=typeof g)throw new v(t(`context[${c}] is invalid. Context must contain a single valid FHIR resource! Resource is not an object.`));if(!(g.id&&"string"==typeof g.id))throw new v(t(`context[${c}] is invalid. Resource must contain a valid string ID.`));if(!g.resourceType)throw new v(t(`context[${c}] is invalid. Resource must contain a resource type. No resource type found.`));let e=d.resourceType;if("*"!==e){if(f=g.resourceType,!bi.includes(f))throw new v(t(`context[${c}] is invalid. Resource must contain a valid FHIRcast resource type. Resource type is not a known resource type.`));if(e&&g.resourceType!==e)throw new v(t(`context[${c}] is invalid. context[${c}] for the '${a}' event should contain resource of type ${e}.`))}}}(a,b[e],e,d[f],c)}for(let[b,e]of Object.entries(d)){if(!(e.optional||c.has(b)))throw new v(t(`Missing required key '${b}' on context for '${a}' event.`));if(!e.manyAllowed&&(c.get(b)??0)>1)throw new v(t(`${c.get(b)} context entries with key '${b}' found for the '${a}' event when schema only allows for 1.`))}}(b,e),{timestamp:new Date().toISOString(),id:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replaceAll(/[xy]/g,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)}),event:{"hub.topic":a,"hub.event":b,context:e,...d?{"context.versionId":d}:{}}}}var bp=class extends bg{constructor(a){if(super(),i(this,"subRequest"),i(this,"websocket"),this.subRequest=a,!a.endpoint)throw new v(t("Subscription request should contain an endpoint."));if(!bn(a))throw new v(t("Subscription request failed validation."));let b=new WebSocket(a.endpoint);b.addEventListener("open",()=>{this.dispatchEvent({type:"connect"}),b.addEventListener("message",a=>{let c=JSON.parse(a.data);c["hub.topic"]||"heartbeat"!==c.event["hub.event"]&&(this.dispatchEvent({type:"message",payload:c}),b.send(JSON.stringify({id:c?.id,timestamp:new Date().toISOString()})))}),b.addEventListener("close",()=>{this.dispatchEvent({type:"disconnect"})})}),this.websocket=b}disconnect(){this.websocket.close()}};function bq(a){let[b,c,d]=a.split(".");return JSON.parse(function(a){var b=(a=a.padEnd(a.length+(4-a.length%4)%4,"=")).replaceAll("-","+").replaceAll("_","/");let c=a9();if(c)return c.from(b,"base64").toString("utf-8");throw Error("Unable to decode base64")}(c))}var br=class{constructor(a){i(this,"medplum"),this.medplum=a}async get(a){return this.medplum.get(`keyvalue/v1/${a}`)}async set(a,b){await this.medplum.put(`keyvalue/v1/${a}`,b,be.TEXT)}async delete(a){await this.medplum.delete(`keyvalue/v1/${a}`)}};d=Symbol.toStringTag;var bs=class{constructor(a){i(this,d,"ReadablePromise"),i(this,"suspender"),i(this,"status","pending"),i(this,"response"),i(this,"error"),this.suspender=a.then(a=>(this.status="success",this.response=a,a),a=>{throw this.status="error",this.error=a,a})}isPending(){return"pending"===this.status}isOk(){return"success"===this.status}read(){switch(this.status){case"pending":throw this.suspender;case"error":throw this.error;default:return this.response}}then(a,b){return this.suspender.then(a,b)}catch(a){return this.suspender.catch(a)}finally(a){return this.suspender.finally(a)}},bt=class{constructor(a,b=""){i(this,"storage"),i(this,"prefix",""),this.storage=a??globalThis.localStorage??new bu,this.prefix=b}makeKey(a){return this.prefix+a}clear(){this.storage===globalThis.localStorage&&this.prefix?Object.keys(this.storage).filter(a=>a.startsWith(this.prefix)).forEach(a=>{this.storage.removeItem(a)}):this.storage.clear()}getString(a){return this.storage.getItem(this.makeKey(a))??void 0}setString(a,b){b?this.storage.setItem(this.makeKey(a),b):this.storage.removeItem(this.makeKey(a))}getObject(a){let b=this.getString(a);return b?JSON.parse(b):void 0}setObject(a,b){this.setString(a,b?JSON.stringify(function a(b){if(null!=b&&""!==b)return"object"==typeof b?Array.isArray(b)?function(b){let c=b.length;if(0===c)return;let d,e=0;for(let f=0;f<c;f++){let c=b[f],g=a(c);g===c||d||(d=Array.from(b)),void 0===g?d&&(d[f]=null):(d&&(d[f]=g),e++)}if(0!==e)return d??b}(b):function(b){let c,d=0;for(let e in b){let f=b[e],g=a(f);g===f||c||(c={...b}),void 0===g?c&&delete c[e]:(c&&(c[e]=g),d++)}if(0!==d)return c??b}(b):b}(b),null,void 0)??"":void 0)}},bu=class{constructor(){i(this,"data"),this.data=new Map}get length(){return this.data.size}clear(){this.data.clear()}getItem(a){return this.data.get(a)??null}setItem(a,b){b?this.data.set(a,b):this.data.delete(a)}removeItem(a){this.data.delete(a)}key(a){return Array.from(this.data.keys())[a]}},bv={Event:"u">typeof globalThis.Event?globalThis.Event:void 0,ErrorEvent:void 0,CloseEvent:void 0},bw=!1;function bx(a){return new a.constructor(a.type,a)}var by={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+4e3*Math.random(),minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0},bz=!1,bA=class a extends bg{constructor(a,b,c={}){bw||(function(){if(typeof globalThis.Event>"u")throw Error("Unable to lazy init events for ReconnectingWebSocket. globalThis.Event is not defined yet");bv.Event=globalThis.Event,bv.ErrorEvent=class extends Event{constructor(a,b){super("error",b),i(this,"message"),i(this,"error"),this.message=a.message,this.error=a}},bv.CloseEvent=class extends Event{constructor(a=1e3,b="",c){super("close",c),i(this,"code"),i(this,"reason"),i(this,"wasClean",!0),this.code=a,this.reason=b}}}(),bw=!0),super(),i(this,"_ws"),i(this,"_retryCount",-1),i(this,"_uptimeTimeout"),i(this,"_connectTimeout"),i(this,"_shouldReconnect",!0),i(this,"_connectLock",!1),i(this,"_binaryType"),i(this,"_closeCalled",!1),i(this,"_messageQueue",[]),i(this,"_debugLogger",console.log.bind(console)),i(this,"_url"),i(this,"_protocols"),i(this,"_options"),i(this,"onclose",null),i(this,"onerror",null),i(this,"onmessage",null),i(this,"onopen",null),i(this,"_handleOpen",a=>{this._debug("open event");let{minUptime:b=by.minUptime}=this._options;clearTimeout(this._connectTimeout),this._uptimeTimeout=setTimeout(()=>this._acceptOpen(),b),function(a,b){if(!a)throw Error(b)}(this._ws,"WebSocket is not defined"),this._ws.binaryType=this._binaryType,this._messageQueue.forEach(a=>this._ws?.send(a)),this._messageQueue=[],this.onopen&&this.onopen(a),this.dispatchEvent(bx(a))}),i(this,"_handleMessage",a=>{this._debug("message event"),this.onmessage&&this.onmessage(a),this.dispatchEvent(bx(a))}),i(this,"_handleError",a=>{this._debug("error event",a.message),this._disconnect(void 0,"TIMEOUT"===a.message?"timeout":void 0),this.onerror&&this.onerror(a),this._debug("exec error listeners"),this.dispatchEvent(bx(a)),this._connect()}),i(this,"_handleClose",a=>{this._debug("close event"),this._clearTimeouts(),this._shouldReconnect&&this._connect(),this.onclose&&this.onclose(a),this.dispatchEvent(bx(a))}),this._url=a,this._protocols=b,this._options=c,this._options.startClosed&&(this._shouldReconnect=!1),this._options.binaryType?this._binaryType=this._options.binaryType:this._binaryType="blob",this._options.debugLogger&&(this._debugLogger=this._options.debugLogger),this._connect()}static get CONNECTING(){return 0}static get OPEN(){return 1}static get CLOSING(){return 2}static get CLOSED(){return 3}get CONNECTING(){return a.CONNECTING}get OPEN(){return a.OPEN}get CLOSING(){return a.CLOSING}get CLOSED(){return a.CLOSED}get binaryType(){return this._ws?this._ws.binaryType:this._binaryType}set binaryType(a){this._binaryType=a,this._ws&&(this._ws.binaryType=a)}get retryCount(){return Math.max(this._retryCount,0)}get bufferedAmount(){return this._messageQueue.reduce((a,b)=>("string"==typeof b?a+=b.length:b instanceof Blob?a+=b.size:a+=b.byteLength,a),0)+(this._ws?.bufferedAmount??0)}get extensions(){return this._ws?.extensions??""}get protocol(){return this._ws?.protocol??""}get readyState(){return this._ws?this._ws.readyState:this._options.startClosed?a.CLOSED:a.CONNECTING}get url(){return this._ws?this._ws.url:""}get shouldReconnect(){return this._shouldReconnect}close(a=1e3,b){return(this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),this._ws)?this._ws.readyState===this.CLOSED?void this._debug("close: already closed"):void this._ws.close(a,b):void this._debug("close enqueued: no ws instance")}reconnect(a,b){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,this._ws&&this._ws.readyState!==this.CLOSED&&this._disconnect(a,b),this._connect()}send(a){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",a),this._ws.send(a);else{let{maxEnqueuedMessages:b=by.maxEnqueuedMessages}=this._options;this._messageQueue.length<b&&(this._debug("enqueue",a),this._messageQueue.push(a))}}_debug(...a){this._options.debug&&this._debugLogger("RWS>",...a)}_getNextDelay(){let{reconnectionDelayGrowFactor:a=by.reconnectionDelayGrowFactor,minReconnectionDelay:b=by.minReconnectionDelay,maxReconnectionDelay:c=by.maxReconnectionDelay}=this._options,d=0;return this._retryCount>0&&(d=b*Math.pow(a,this._retryCount-1))>c&&(d=c),this._debug("next delay",d),d}_wait(){return new Promise(a=>{setTimeout(a,this._getNextDelay())})}_connect(){if(this._connectLock||!this._shouldReconnect)return;this._connectLock=!0;let{maxRetries:a=by.maxRetries,connectionTimeout:b=by.connectionTimeout}=this._options;if(this._retryCount>=a)return void this._debug("max retries reached",this._retryCount,">=",a);this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),this._wait().then(()=>{if(this._closeCalled){this._connectLock=!1;return}!this._options.WebSocket&&typeof WebSocket>"u"&&!bz&&(console.error(" No WebSocket implementation available. You should define options.WebSocket."),bz=!0);let a=this._options.WebSocket||WebSocket;this._debug("connect",{url:this._url,protocols:this._protocols}),this._ws=this._protocols?new a(this._url,this._protocols):new a(this._url),this._ws.binaryType=this._binaryType,this._connectLock=!1,this._addListeners(),this._connectTimeout=setTimeout(()=>this._handleTimeout(),b)}).catch(a=>{this._connectLock=!1,this._handleError(new bv.ErrorEvent(Error(a.message),this))})}_handleTimeout(){this._debug("timeout event"),this._handleError(new bv.ErrorEvent(Error("TIMEOUT"),this))}_disconnect(a=1e3,b){if(this._clearTimeouts(),this._ws){this._removeListeners();try{this._ws.close(a,b),this._handleClose(new bv.CloseEvent(a,b,this))}catch{}}}_acceptOpen(){this._debug("accept open"),this._retryCount=0}_removeListeners(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))}_addListeners(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))}_clearTimeouts(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)}},bB=class extends bg{constructor(...a){super(),i(this,"criteria"),this.criteria=new Set(a)}getCriteria(){return this.criteria}_addCriteria(a){this.criteria.add(a)}_removeCriteria(a){this.criteria.delete(a)}},bC=class{constructor(a,b){i(this,"criteria"),i(this,"emitter"),i(this,"refCount"),i(this,"subscriptionProps"),i(this,"subscriptionId"),i(this,"token"),i(this,"connecting",!1),this.criteria=a,this.emitter=new bB(a),this.refCount=1,this.subscriptionProps=b?{...b}:void 0}clearAttachedSubscription(){this.subscriptionId=void 0,this.token=void 0}},bD=class{constructor(a,b,c){let d;if(i(this,"medplum"),i(this,"ws"),i(this,"masterSubEmitter"),i(this,"criteriaEntries"),i(this,"criteriaEntriesBySubscriptionId"),i(this,"wsClosed"),i(this,"pingTimer"),i(this,"pingIntervalMs"),i(this,"waitingForPong",!1),i(this,"currentProfile"),!(a instanceof bJ))throw new v(t("First arg of constructor should be a `MedplumClient`"));try{d=new URL(b).toString()}catch{throw new v(t("Not a valid URL"))}let e=c?.ReconnectingWebSocket?new c.ReconnectingWebSocket(d,void 0,{debug:c?.debug,debugLogger:c?.debugLogger}):new bA(d,void 0,{debug:c?.debug,debugLogger:c?.debugLogger});this.medplum=a,this.ws=e,this.masterSubEmitter=new bB,this.criteriaEntries=new Map,this.criteriaEntriesBySubscriptionId=new Map,this.wsClosed=!1,this.pingIntervalMs=c?.pingIntervalMs??5e3,this.currentProfile=a.getProfile(),this.setupListeners()}setupListeners(){let a=this.ws;a.addEventListener("message",a=>{try{let b=JSON.parse(a.data);if("pong"===b.type){this.waitingForPong=!1;return}let c=b?.entry?.[0]?.resource;if("heartbeat"===c.type)return void this.masterSubEmitter?.dispatchEvent({type:"heartbeat",payload:b});if("handshake"===c.type){let a=ae(c.subscription),b={type:"connect",payload:{subscriptionId:a}};this.masterSubEmitter?.dispatchEvent(b);let d=this.criteriaEntriesBySubscriptionId.get(a);if(!d)return void console.warn("Received handshake for criteria the SubscriptionManager is not listening for yet");d.connecting=!1,d.emitter.dispatchEvent({...b});return}this.masterSubEmitter?.dispatchEvent({type:"message",payload:b});let d=this.criteriaEntriesBySubscriptionId.get(ae(c.subscription));if(!d)return void console.warn("Received notification for criteria the SubscriptionManager is not listening for");d.emitter.dispatchEvent({type:"message",payload:b})}catch(b){console.error(b);let a={type:"error",payload:b};for(let b of(this.masterSubEmitter?.dispatchEvent(a),this.getAllCriteriaEmitters()))b.dispatchEvent({...a})}}),a.addEventListener("error",()=>{let a={type:"error",payload:new v({resourceType:"OperationOutcome",issue:[{severity:"error",code:"exception",details:{text:"Internal server error"},diagnostics:Error("WebSocket error").toString()}]})};for(let b of(this.masterSubEmitter?.dispatchEvent(a),this.getAllCriteriaEmitters()))b.dispatchEvent({...a})}),a.addEventListener("close",()=>{let a={type:"close"};for(let b of(this.masterSubEmitter?.dispatchEvent(a),this.getAllCriteriaEmitters()))b.dispatchEvent({...a});this.pingTimer&&(clearInterval(this.pingTimer),this.pingTimer=void 0,this.waitingForPong=!1),this.wsClosed&&(this.criteriaEntries.clear(),this.criteriaEntriesBySubscriptionId.clear(),this.masterSubEmitter?.removeAllListeners())}),a.addEventListener("open",()=>{let b={type:"open"};for(let a of(this.masterSubEmitter?.dispatchEvent(b),this.getAllCriteriaEmitters()))a.dispatchEvent({...b});this.refreshAllSubscriptions().catch(console.error),this.pingTimer||(this.pingTimer=setInterval(()=>{if(this.waitingForPong){this.waitingForPong=!1,a.reconnect();return}a.send(JSON.stringify({type:"ping"})),this.waitingForPong=!0},this.pingIntervalMs))}),this.medplum.addEventListener("change",()=>{let a=this.medplum.getProfile();this.currentProfile&&void 0===a?this.ws.close():a&&this.currentProfile?.id!==a.id&&this.ws.reconnect(),this.currentProfile=a})}emitError(a,b){let c={type:"error",payload:b};this.masterSubEmitter?.dispatchEvent(c),a.emitter.dispatchEvent({...c})}maybeEmitDisconnect(a){let{subscriptionId:b}=a;if(b){let c={type:"disconnect",payload:{subscriptionId:b}};this.masterSubEmitter?.dispatchEvent(c),a.emitter.dispatchEvent({...c})}else console.warn("Called disconnect for `CriteriaEntry` before `subscriptionId` was present.")}async getTokenForCriteria(a){let b=a?.subscriptionId;b||(b=(await this.medplum.createResource({...a.subscriptionProps,resourceType:"Subscription",status:"active",reason:`WebSocket subscription for ${ad(this.medplum.getProfile())}`,channel:{type:"websocket"},criteria:a.criteria})).id);let{parameter:c}=await this.medplum.get(`fhir/R4/Subscription/${b}/$get-ws-binding-token`),d=c?.find(a=>"token"===a.name)?.valueString,e=c?.find(a=>"websocket-url"===a.name)?.valueUrl;if(!d)throw new v(t("Failed to get token"));if(!e)throw new v(t("Failed to get URL from $get-ws-binding-token"));return[b,d]}maybeGetCriteriaEntry(a,b){let c=this.criteriaEntries.get(a);if(c){if(!b)return c.bareCriteria;for(let a of c.criteriaWithProps)if(ah(b,a.subscriptionProps))return a}}getAllCriteriaEmitters(){let a=[];for(let b of this.criteriaEntries.values())for(let c of(b.bareCriteria&&a.push(b.bareCriteria.emitter),b.criteriaWithProps))a.push(c.emitter);return a}addCriteriaEntry(a){let{criteria:b,subscriptionProps:c}=a,d;this.criteriaEntries.has(b)?d=this.criteriaEntries.get(b):(d={criteriaWithProps:[]},this.criteriaEntries.set(b,d)),c?d.criteriaWithProps.push(a):d.bareCriteria=a}removeCriteriaEntry(a){let{criteria:b,subscriptionProps:c,subscriptionId:d,token:e}=a;if(!this.criteriaEntries.has(b))return;let f=this.criteriaEntries.get(b);c?f.criteriaWithProps=f.criteriaWithProps.filter(a=>!ah(c,a.subscriptionProps)):f.bareCriteria=void 0,f.bareCriteria||0!==f.criteriaWithProps.length||(this.criteriaEntries.delete(b),this.masterSubEmitter?._removeCriteria(b)),d&&this.criteriaEntriesBySubscriptionId.delete(d),e&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({type:"unbind-from-token",payload:{token:e}}))}async subscribeToCriteria(a){if(!(this.ws.readyState!==WebSocket.OPEN||a.connecting)){a.connecting=!0;try{let[b,c]=await this.getTokenForCriteria(a);a.subscriptionId=b,a.token=c,this.criteriaEntriesBySubscriptionId.set(b,a),this.ws.send(JSON.stringify({type:"bind-with-token",payload:{token:c}}))}catch(b){console.error(x(b)),this.emitError(a,b),this.removeCriteriaEntry(a)}}}async refreshAllSubscriptions(){for(let a of(this.criteriaEntriesBySubscriptionId.clear(),this.criteriaEntries.values()))for(let b of[...a.bareCriteria?[a.bareCriteria]:[],...a.criteriaWithProps])b.clearAttachedSubscription(),await this.subscribeToCriteria(b)}addCriteria(a,b){this.masterSubEmitter&&this.masterSubEmitter._addCriteria(a);let c=this.maybeGetCriteriaEntry(a,b);if(c)return c.refCount+=1,c.emitter;let d=new bC(a,b);return this.addCriteriaEntry(d),this.subscribeToCriteria(d).catch(console.error),d.emitter}removeCriteria(a,b){let c=this.maybeGetCriteriaEntry(a,b);if(!c)return void console.warn("Criteria not known to `SubscriptionManager`. Possibly called remove too many times.");c.refCount-=1,c.refCount>0||(this.maybeEmitDisconnect(c),this.removeCriteriaEntry(c))}getWebSocket(){return this.ws}closeWebSocket(){this.wsClosed||(this.wsClosed=!0,this.ws.close())}reconnectWebSocket(){this.ws.reconnect(),this.wsClosed=!1}getCriteriaCount(){return this.getAllCriteriaEmitters().length}getMasterEmitter(){return this.masterSubEmitter||(this.masterSubEmitter=new bB(...Array.from(this.criteriaEntries.keys()))),this.masterSubEmitter}},bE=be.FHIR_JSON+", */*; q=0.1",bF={resourceType:"Device",id:"system",deviceName:[{type:"model-name",name:"System"}]},bG={ClientCredentials:"client_credentials",AuthorizationCode:"authorization_code",RefreshToken:"refresh_token",JwtBearer:"urn:ietf:params:oauth:grant-type:jwt-bearer",TokenExchange:"urn:ietf:params:oauth:grant-type:token-exchange"},bH={AccessToken:"urn:ietf:params:oauth:token-type:access_token"},bI={JwtBearer:"urn:ietf:params:oauth:client-assertion-type:jwt-bearer"},bJ=class extends bg{constructor(a){if(super(),i(this,"options"),i(this,"fetch"),i(this,"createPdfImpl"),i(this,"storage"),i(this,"requestCache"),i(this,"cacheTime"),i(this,"baseUrl"),i(this,"fhirBaseUrl"),i(this,"authorizeUrl"),i(this,"tokenUrl"),i(this,"logoutUrl"),i(this,"fhircastHubUrl"),i(this,"defaultHeaders"),i(this,"onUnauthenticated"),i(this,"autoBatchTime"),i(this,"autoBatchQueue"),i(this,"refreshGracePeriod"),i(this,"subscriptionManager"),i(this,"medplumServer"),i(this,"clientId"),i(this,"clientSecret"),i(this,"credentialsInHeader"),i(this,"autoBatchTimerId"),i(this,"accessToken"),i(this,"accessTokenExpires"),i(this,"refreshToken"),i(this,"refreshPromise"),i(this,"profilePromise"),i(this,"sessionDetails"),i(this,"currentRateLimits"),i(this,"basicAuth"),i(this,"initPromise"),i(this,"initComplete",!0),i(this,"keyValueClient"),a?.baseUrl&&!a.baseUrl.startsWith("http"))throw Error("Base URL must start with http or https");this.options=a??{},this.fetch=a?.fetch??function(){if(!globalThis.fetch)throw Error("Fetch not available in this environment");return globalThis.fetch.bind(globalThis)}(),this.storage=a?.storage??new bt(void 0,a?.storagePrefix),this.createPdfImpl=a?.createPdf,this.baseUrl=ap(a?.baseUrl??"https://api.medplum.com/"),this.fhirBaseUrl=aq(this.baseUrl,a?.fhirUrlPath??"fhir/R4"),this.authorizeUrl=aq(this.baseUrl,a?.authorizeUrl??"oauth2/authorize"),this.tokenUrl=aq(this.baseUrl,a?.tokenUrl??"oauth2/token"),this.logoutUrl=aq(this.baseUrl,a?.logoutUrl??"oauth2/logout"),this.fhircastHubUrl=aq(this.baseUrl,a?.fhircastHubUrl??"fhircast/STU3"),this.clientId=a?.clientId??"",this.clientSecret=a?.clientSecret??"",this.credentialsInHeader=a?.authCredentialsMethod==="header",this.defaultHeaders=a?.defaultHeaders??{},this.onUnauthenticated=a?.onUnauthenticated,this.refreshGracePeriod=a?.refreshGracePeriod??3e5,this.cacheTime=a?.cacheTime??0,this.cacheTime>0?this.requestCache=new n(a?.resourceCacheSize??1e3):this.requestCache=void 0,a?.autoBatchTime?(this.autoBatchTime=a.autoBatchTime,this.autoBatchQueue=[]):(this.autoBatchTime=0,this.autoBatchQueue=void 0),a?.accessToken&&this.setAccessToken(a.accessToken),void 0===this.storage.getInitPromise?(a?.accessToken||this.attemptResumeActiveLogin().catch(console.error),this.initPromise=Promise.resolve(),this.dispatchEvent({type:"storageInitialized"})):(this.initComplete=!1,this.initPromise=this.storage.getInitPromise(),this.initPromise.then(()=>{a?.accessToken||this.attemptResumeActiveLogin().catch(console.error),this.initComplete=!0,this.dispatchEvent({type:"storageInitialized"})}).catch(a=>{console.error(a),this.initComplete=!0,this.dispatchEvent({type:"storageInitFailed",payload:{error:a}})})),this.setupStorageListener()}get isInitialized(){return this.initComplete}getInitPromise(){return this.initPromise}async attemptResumeActiveLogin(){let a=this.getActiveLogin();a&&(this.setAccessToken(a.accessToken,a.refreshToken),await this.refreshProfile())}getBaseUrl(){return this.baseUrl}getAuthorizeUrl(){return this.authorizeUrl}getTokenUrl(){return this.tokenUrl}getLogoutUrl(){return this.logoutUrl}getFhircastHubUrl(){return this.fhircastHubUrl}getDefaultHeaders(){return this.defaultHeaders}clear(){this.storage.clear(),this.clearActiveLogin()}clearActiveLogin(){this.storage.setString("activeLogin",void 0),this.requestCache?.clear(),this.accessToken=void 0,this.refreshToken=void 0,this.refreshPromise=void 0,this.accessTokenExpires=void 0,this.sessionDetails=void 0,this.medplumServer=void 0,this.dispatchEvent({type:"change"})}invalidateUrl(a){a=a.toString(),this.requestCache?.delete(a)}invalidateAll(){this.requestCache?.clear()}invalidateSearches(a){let b=aq(this.fhirBaseUrl,a);if(this.requestCache)for(let a of this.requestCache.keys())(a.endsWith(b)||a.includes(b+"?"))&&this.requestCache.delete(a)}get(a,b={}){a=a.toString();let c=this.getCacheEntry(a,b);if(c)return c.value;let d=new bs(a.startsWith(this.fhirBaseUrl)&&this.autoBatchQueue&&!b.disableAutoBatch?new Promise((c,d)=>{this.autoBatchQueue.push({method:"GET",url:a.replace(this.fhirBaseUrl,""),options:b,resolve:c,reject:d}),this.autoBatchTimerId||(this.autoBatchTimerId=setTimeout(()=>this.executeAutoBatch(),this.autoBatchTime))}):this.request("GET",a,b));return this.setCacheEntry(a,d),d}post(a,b,c,d={}){return a=a.toString(),this.setRequestBody(d,b),c&&this.setRequestContentType(d,c),this.invalidateUrl(a),this.request("POST",a,d)}put(a,b,c,d={}){return a=a.toString(),this.setRequestBody(d,b),c&&this.setRequestContentType(d,c),this.invalidateUrl(a),this.request("PUT",a,d)}patch(a,b,c={}){return a=a.toString(),this.setRequestBody(c,b),this.setRequestContentType(c,be.JSON_PATCH),this.invalidateUrl(a),this.request("PATCH",a,c)}delete(a,b){return a=a.toString(),this.invalidateUrl(a),this.request("DELETE",a,b)}async startNewUser(a,b){let{codeChallengeMethod:c,codeChallenge:d}=await this.startPkce();return this.post("auth/newuser",{...a,clientId:a.clientId??this.clientId,codeChallengeMethod:c,codeChallenge:d},void 0,b)}async startNewProject(a,b){return this.post("auth/newproject",a,void 0,b)}async startNewPatient(a,b){return this.post("auth/newpatient",a,void 0,b)}async startLogin(a,b){return this.post("auth/login",{...await this.ensureCodeChallenge(a),clientId:a.clientId??this.clientId,scope:a.scope},void 0,b)}async startGoogleLogin(a,b){return this.post("auth/google",{...await this.ensureCodeChallenge(a),clientId:a.clientId??this.clientId,scope:a.scope},void 0,b)}async ensureCodeChallenge(a){return a.codeChallenge?a:{...a,...await this.startPkce()}}async signOut(){await this.post(this.logoutUrl,{}),this.clear()}async signInWithRedirect(a){let b=new URLSearchParams(ba.getSearch()).get("code");return b?this.processCode(b):void await this.requestAuthorization(a)}signOutWithRedirect(){ba.assign(this.logoutUrl)}async signInWithExternalAuth(a,b,c,d,e=!0){let f=d;e&&(f=await this.ensureCodeChallenge(d)),ba.assign(this.getExternalAuthRedirectUri(a,b,c,f,e))}async exchangeExternalAccessToken(a,b){if(!(b=b??this.clientId))throw Error("MedplumClient is missing clientId");return this.fetchTokens({grant_type:bG.TokenExchange,subject_token_type:bH.AccessToken,client_id:b,subject_token:a})}getExternalAuthRedirectUri(a,b,c,d,e=!0){let f=new URL(a);if(f.searchParams.set("response_type","code"),f.searchParams.set("client_id",b),f.searchParams.set("redirect_uri",c),f.searchParams.set("scope",d.scope??"openid profile email"),f.searchParams.set("state",JSON.stringify(d)),e){let{codeChallenge:a,codeChallengeMethod:b}=d;if(!b)throw Error("`LoginRequest` for external auth must include a `codeChallengeMethod`.");if(!a)throw Error("`LoginRequest` for external auth must include a `codeChallenge`.");f.searchParams.set("code_challenge_method",b),f.searchParams.set("code_challenge",a)}return f.toString()}fhirUrl(...a){return new URL(aq(this.fhirBaseUrl,a.join("/")))}fhirSearchUrl(a,b){var c;let d=this.fhirUrl(a);return b&&("object"!=typeof(c=b)||Array.isArray(c)||c instanceof URLSearchParams||(c=Object.fromEntries(Object.entries(c).filter(a=>void 0!==a[1]))),d.search=new URLSearchParams(c).toString()),d}search(a,b,c){let d=this.fhirSearchUrl(a,b),e="search-"+d.toString(),f=this.getCacheEntry(e,c);if(f)return f.value;let g=this.getBundle(d,c);return this.setCacheEntry(e,g),g}searchOne(a,b,c){let d=this.fhirSearchUrl(a,b);d.searchParams.set("_count","1"),d.searchParams.sort();let e="searchOne-"+d.toString(),f=this.getCacheEntry(e,c);if(f)return f.value;let g=new bs(this.search(a,d.searchParams,c).then(a=>a.entry?.[0]?.resource));return this.setCacheEntry(e,g),g}searchResources(a,b,c){let d="searchResources-"+this.fhirSearchUrl(a,b).toString(),e=this.getCacheEntry(d,c);if(e)return e.value;let f=new bs(this.search(a,b,c).then(bL));return this.setCacheEntry(d,f),f}async *searchResourcePages(a,b,c){let d=this.fhirSearchUrl(a,b);for(;d;){let b=new URL(d).searchParams;b.has("_count")||b.set("_count","1000");let e=await this.search(a,b,c),f=e.link?.find(a=>"next"===a.relation);if(!e.entry?.length&&!f)break;yield bL(e),d=f?.url?new URL(f.url):void 0}}valueSetExpand(a,b){let c=this.fhirUrl("ValueSet","$expand");return c.search=new URLSearchParams(a).toString(),this.get(c.toString(),b)}getCached(a,b){let c=this.requestCache?.get(this.fhirUrl(a,b).toString())?.value;return c?.isOk()?c.read():void 0}getCachedReference(a){let b=a.reference;if(!b)return;if("system"===b)return bF;let[c,d]=b.split("/");if(!(!c||!d))return this.getCached(c,d)}readResource(a,b,c){if(!b)throw Error('The "id" parameter cannot be null, undefined, or an empty string.');return this.get(this.fhirUrl(a,b),c)}readReference(a,b){let c=a.reference;if(!c)return new bs(Promise.reject(Error("Missing reference")));if("system"===c)return new bs(Promise.resolve(bF));let[d,e]=c.split("/");return d&&e?this.readResource(d,e,b):new bs(Promise.reject(Error("Invalid reference")))}requestSchema(a){if(A[a])return Promise.resolve();let b=a+"-requestSchema",c=this.getCacheEntry(b,void 0);if(c)return c.value;let d=new bs((async()=>{let b=`{
      StructureDefinitionList(_filter: "name eq ${a}") {
        resourceType,
        name,
        kind,
        description,
        type,
        url,
        snapshot {
          element {
            id,
            path,
            definition,
            min,
            max,
            base {
              path,
              min,
              max
            },
            contentReference,
            type {
              code,
              profile,
              targetProfile
            },
            binding {
              strength,
              valueSet
            }
          }
        }
      }
      SearchParameterList(base: "${a}", _count: 100) {
        base,
        code,
        type,
        expression,
        target
      }
    }`.replaceAll(/\s+/g," "),c=await this.graphql(b);for(let a of(F(c.data.StructureDefinitionList),c.data.SearchParameterList))for(let b of a.base??[]){let c=au(b);c.searchParams||(c.searchParams={}),c.searchParams[a.code]=a}})());return this.setCacheEntry(b,d),d}requestProfileSchema(a,b){if(!b?.expandProfile&&B[a])return Promise.resolve();let c=a+"-requestSchema"+(b?.expandProfile?"-nested":""),d=this.getCacheEntry(c,void 0);if(d)return d.value;let e=new bs((async()=>{if(b?.expandProfile){let b=this.fhirUrl("StructureDefinition","$expand-profile");b.search=new URLSearchParams({url:a}).toString(),F(await this.post(b.toString(),{}))}else{let b=await this.searchOne("StructureDefinition",{url:a,_sort:"-_lastUpdated"});if(!b)return void console.warn(`No StructureDefinition found for ${a}!`);G(b)}})());return this.setCacheEntry(c,e),e}readHistory(a,b,c,d){let e=this.fhirUrl(a,b,"_history");return c?.count&&e.searchParams.set("_count",c.count.toString()),c?.offset&&e.searchParams.set("_offset",c.offset.toString()),this.get(e.toString(),d)}readVersion(a,b,c,d){return this.get(this.fhirUrl(a,b,"_history",c),d)}readPatientEverything(a,b){return this.getBundle(this.fhirUrl("Patient",a,"$everything"),b)}readPatientSummary(a,b){return this.getBundle(this.fhirUrl("Patient",a,"$summary"),b)}createResource(a,b){if(!a.resourceType)throw Error("Missing resourceType");return this.invalidateSearches(a.resourceType),this.post(this.fhirUrl(a.resourceType),a,void 0,b)}async createResourceIfNoneExist(a,b,c={}){let d=this.fhirUrl(a.resourceType);this.setRequestHeader(c,"If-None-Exist",b);let e=await this.post(d,a,void 0,c);return this.cacheResource(e),this.invalidateUrl(this.fhirUrl(a.resourceType,a.id,"_history")),this.invalidateSearches(a.resourceType),e}async upsertResource(a,b,c){let d=this.fhirSearchUrl(a.resourceType,b),e=await this.put(d,a,void 0,c);return e||(e=a),this.cacheResource(e),this.invalidateUrl(this.fhirUrl(a.resourceType,a.id,"_history")),this.invalidateSearches(a.resourceType),e}async createAttachment(a,b,c,d,e){let f=bM(a,b,c,d);if(f.contentType===be.XML){let a=f.data,b;(b=a instanceof Blob?await new Promise((b,c)=>{let d=new FileReader;d.onload=()=>{if(!d.result)return void c(Error("Failed to load file"));b(d.result)},d.readAsText(a,"utf-8")}):ArrayBuffer.isView(a)?new TextDecoder().decode(a):a).includes("<ClinicalDocument")&&b.includes("urn:hl7-org:v3")&&(f={...f,contentType:be.CDA_XML})}let g=e??("object"==typeof b?b:{}),h=await this.createBinary(f,g);return{contentType:f.contentType,url:h.url,title:f.filename}}createBinary(a,b,c,d,e){let f=bM(a,b,c,d),g=e??("object"==typeof b?b:{}),{data:h,contentType:i,filename:j,securityContext:k,onProgress:l}=f,m=this.fhirUrl("Binary");return j&&m.searchParams.set("_filename",j),k?.reference&&this.setRequestHeader(g,"X-Security-Context",k.reference),l?this.uploadwithProgress(m,h,i,l,g):this.post(m,h,i,g)}uploadwithProgress(a,b,c,d,e){return new Promise((f,g)=>{let h=new XMLHttpRequest,i=()=>h.abort();e?.signal?.addEventListener("abort",i);let j=a=>{e?.signal?.removeEventListener("abort",i),a instanceof Error?g(a):f(a)};if(h.responseType="json",h.onabort=()=>j(new DOMException("Request aborted","AbortError")),h.onerror=()=>j(Error("Request error")),d&&(h.upload.onprogress=a=>d(a),h.upload.onload=a=>d(a)),h.onload=()=>{h.status>=200&&h.status<300?j(h.response):j(new v(w(h.response||h.statusText)))},h.open("POST",a),h.withCredentials=!0,h.setRequestHeader("Authorization","Bearer "+this.accessToken),h.setRequestHeader("Cache-Control","no-cache, no-store, max-age=0"),h.setRequestHeader("Content-Type",c),!1!==this.options.extendedMode&&h.setRequestHeader("X-Medplum","extended"),e?.headers)for(let[a,b]of Object.entries(e.headers))h.setRequestHeader(a,b);h.send(b)})}async createPdf(a,b,c,d){if(!this.createPdfImpl)throw Error("PDF creation not enabled");let e=function(a,b,c,d){return ai(a)&&"docDefinition"in a?a:{docDefinition:a,filename:b,tableLayouts:c,fonts:d}}(a,b,c,d),f="object"==typeof b?b:{},{docDefinition:g,tableLayouts:h,fonts:i,...j}=e,k=await this.createPdfImpl(g,h,i),l={...j,data:k,contentType:"application/pdf"};return this.createBinary(l,f)}createComment(a,b,c){let d=this.getProfile(),e,f;return"Encounter"===a.resourceType&&(e=ac(a),f=a.subject),"ServiceRequest"===a.resourceType&&(e=a.encounter,f=a.subject),"Patient"===a.resourceType&&(f=ac(a)),this.createResource({resourceType:"Communication",status:"completed",basedOn:[ac(a)],encounter:e,subject:f,sender:d?ac(d):void 0,sent:new Date().toISOString(),payload:[{contentString:b}]},c)}async updateResource(a,b){if(!a.resourceType)throw Error("Missing resourceType");if(!a.id)throw Error("Missing id");let c=await this.put(this.fhirUrl(a.resourceType,a.id),a,void 0,b);return c||(c=a),this.cacheResource(c),this.invalidateUrl(this.fhirUrl(a.resourceType,a.id,"_history")),this.invalidateSearches(a.resourceType),c}async patchResource(a,b,c,d){let e=await this.patch(this.fhirUrl(a,b),c,d);return this.cacheResource(e),this.invalidateUrl(this.fhirUrl(a,b,"_history")),this.invalidateSearches(a),e}deleteResource(a,b,c){return this.deleteCacheEntry(this.fhirUrl(a,b).toString()),this.invalidateSearches(a),this.delete(this.fhirUrl(a,b),c)}validateResource(a,b){return this.post(this.fhirUrl(a.resourceType,"$validate"),a,void 0,b)}executeBot(a,b,c,d){let e;return"string"==typeof a?e=this.fhirUrl("Bot",a,"$execute"):(e=this.fhirUrl("Bot","$execute")).searchParams.set("identifier",a.system+"|"+a.value),this.post(e,b,c,d)}executeBatch(a,b){return this.post(this.fhirBaseUrl,a,void 0,b)}sendEmail(a,b){return this.post("email/v1/send",a,be.JSON,b)}graphql(a,b,c,d){return this.post(this.fhirUrl("$graphql"),{query:a,operationName:b,variables:c},be.JSON,d)}readResourceGraph(a,b,c,d){return this.get(`${this.fhirUrl(a,b)}/$graph?graph=${c}`,d)}pushToAgent(a,b,c,d,e,f){let{waitTimeout:g,...h}=f??{};return this.post(this.fhirUrl("Agent",ae(a),"$push"),{destination:"string"==typeof b?b:ad(b),body:c,contentType:d,waitForResponse:e,...void 0!==g?{waitTimeout:g}:void 0},be.FHIR_JSON,h)}getActiveLogin(){return this.storage.getObject("activeLogin")}async setActiveLogin(a){this.sessionDetails?.profile&&ad(this.sessionDetails.profile)===a.profile?.reference||this.clearActiveLogin(),this.setAccessToken(a.accessToken,a.refreshToken),this.storage.setObject("activeLogin",a),this.addLogin(a),this.refreshPromise=void 0,await this.refreshProfile()}getAccessToken(){return this.accessToken}isAuthenticated(a){return void 0!==this.accessTokenExpires&&Date.now()<this.accessTokenExpires-(a??this.refreshGracePeriod)}setAccessToken(a,b){this.accessToken=a,this.refreshToken=b,this.accessTokenExpires=function(a){try{let b=bq(a).exp;return"number"==typeof b?1e3*b:void 0}catch{return}}(a),this.medplumServer=function(a){try{return"string"==typeof bq(a).login_id}catch{return!1}}(a)}getLogins(){return this.storage.getObject("logins")??[]}addLogin(a){let b=this.getLogins().filter(b=>b.profile?.reference!==a.profile?.reference);b.push(a),this.storage.setObject("logins",b)}async refreshProfile(){return this.medplumServer?(this.profilePromise=new Promise((a,b)=>{this.get("auth/me",{cache:"no-cache"}).then(b=>{this.profilePromise=void 0;let c=this.sessionDetails?.profile?.id!==b.profile.id;this.sessionDetails=b,c&&this.dispatchEvent({type:"change"}),a(b.profile),this.dispatchEvent({type:"profileRefreshed"})}).catch(b)}),this.dispatchEvent({type:"profileRefreshing"}),this.profilePromise):Promise.resolve(void 0)}isLoading(){return!this.isInitialized||!!this.profilePromise&&!this.sessionDetails?.profile}isSuperAdmin(){return!!this.sessionDetails?.project.superAdmin}isProjectAdmin(){return!!this.sessionDetails?.membership.admin}getProject(){return this.sessionDetails?.project}getProjectMembership(){return this.sessionDetails?.membership}getProfile(){return this.sessionDetails?.profile}async getProfileAsync(){return this.profilePromise?this.profilePromise:this.sessionDetails?this.sessionDetails.profile:this.refreshProfile()}getUserConfiguration(){return this.sessionDetails?.config}getAccessPolicy(){return this.sessionDetails?.accessPolicy}async download(a,b={}){this.refreshPromise&&await this.refreshPromise;let c=a.toString();c.startsWith("Binary/")&&(a=this.fhirUrl(c));let d=b.headers;return d||(b.headers=d={}),d.Accept||(d.Accept="*/*"),this.addFetchOptionsDefaults(b),(await this.fetchWithRetry(a.toString(),b)).blob()}async createMedia(a,b){let{additionalFields:c,...d}=a,e=await this.createResource({resourceType:"Media",status:"preparation",content:{contentType:a.contentType},...c});d.securityContext||(d.securityContext=ac(e));let f=await this.createAttachment(d,b);return this.updateResource({...e,status:"completed",content:f})}async uploadMedia(a,b,c,d,e){return this.createMedia({data:a,contentType:b,filename:c,additionalFields:d},e)}async createDocumentReference(a,b){let{additionalFields:c,...d}=a,e=await this.createResource({resourceType:"DocumentReference",status:"current",content:[{attachment:{contentType:a.contentType}}],...c});d.securityContext||(d.securityContext=ac(e));let f=await this.createAttachment(d,b);return this.updateResource({...e,content:[{attachment:f}]})}async bulkExport(a="",b,c,d){let e=a&&`${a}/`,f=this.fhirUrl(`${e}$export`);return b&&f.searchParams.set("_type",b),c&&f.searchParams.set("_since",c),this.startAsyncRequest(f.toString(),d)}async startAsyncRequest(a,b={}){return this.addFetchOptionsDefaults(b),b.headers.Prefer="respond-async",this.request("POST",a,b)}get keyValue(){return this.keyValueClient||(this.keyValueClient=new br(this)),this.keyValueClient}getBundle(a,b){return new bs((async()=>{let c=await this.get(a,b);if(c.entry)for(let a of c.entry)this.cacheResource(a.resource);return c})())}getCacheEntry(a,b){if(!this.requestCache||b?.cache==="no-cache"||b?.cache==="reload")return;let c=this.requestCache.get(a);if(!(!c||c.requestTime+this.cacheTime<Date.now()))return c}setCacheEntry(a,b){this.requestCache&&this.requestCache.set(a,{requestTime:Date.now(),value:b})}cacheResource(a){a?.id&&!a.meta?.tag?.some(a=>"SUBSETTED"===a.code)&&this.setCacheEntry(this.fhirUrl(a.resourceType,a.id).toString(),new bs(Promise.resolve(a)))}deleteCacheEntry(a){this.requestCache&&this.requestCache.delete(a)}async request(a,b,c={},d={}){await this.refreshIfExpired(),c.method=a,this.addFetchOptionsDefaults(c);let e=await this.fetchWithRetry(b,c);if(401===e.status)return this.handleUnauthenticated(a,b,c);if(204===e.status||304===e.status)return;let f=e.headers.get("content-type")?.includes("json");if(404===e.status&&!f)throw new v(o);let g=await this.parseBody(e,f);if(200===e.status&&c.followRedirectOnOk||201===e.status&&c.followRedirectOnCreated){let a=await bK(e,g);if(a)return this.request("GET",a,{...c,body:void 0})}if(202===e.status&&c.pollStatusOnAccepted){let a=await bK(e,g)??d.statusUrl;if(a)return this.pollStatus(a,c,d)}if(e.status>=400)throw new v(w(g));return g}async parseBody(a,b){let c;if("0"!==a.headers.get("content-length")){if(b)try{c=await a.json()}catch(b){throw console.error("Error parsing response",a.status,b),b}else c=await a.text();return c}}async fetchWithRetry(a,b){a.startsWith("http")||(a=aq(this.baseUrl,a));let c=b?.maxRetries??2;for(let e=0;e<=c;e++)try{var d;this.options.verbose&&this.logRequest(a,b);let f=await this.fetch(a,b);if(this.options.verbose&&this.logResponse(f),this.setCurrentRateLimit(f),e>=c||(d=f,429!==d.status&&!(d.status>=500)))return f;let g=this.getRetryDelay(e),h=b.maxRetryTime??2e3;if(g>h)return f;await ao(g)}catch(a){if("Failed to fetch"===a.message&&0===e&&this.dispatchEvent({type:"offline"}),"AbortError"===a.name||e===c)throw a}throw Error("Unreachable")}logRequest(a,b){if(console.log(`> ${b.method} ${a}`),b.headers){let a=b.headers;for(let b of Object.keys(a).sort((a,b)=>a.localeCompare(b)))console.log(`> ${b}: ${a[b]}`)}}logResponse(a){console.log(`< ${a.status} ${a.statusText}`),a.headers&&a.headers.forEach((a,b)=>console.log(`< ${b}: ${a}`))}setCurrentRateLimit(a){if(!a?.headers||"function"!=typeof a.headers.get)return;let b=a.headers.get("ratelimit");b&&(this.currentRateLimits=b)}rateLimitStatus(){if(!this.currentRateLimits)return[];let a=this.currentRateLimits;return a.split(/\s*;\s*/g).map(b=>{let c=b.split(/\s*,\s*/g);if(3!==c.length)throw Error("Could not parse RateLimit header: "+a);let d=c[0].substring(1,c[0].length-1),e=c.find(a=>a.startsWith("r=")),f=e?Number.parseInt(e.substring(2),10):NaN,g=c.find(a=>a.startsWith("t=")),h=g?Number.parseInt(g.substring(2),10):NaN;if(!d||Number.isNaN(f)||Number.isNaN(h))throw Error("Could not parse RateLimit header: "+a);return{name:d,remainingUnits:f,secondsUntilReset:h}})}getRetryDelay(a){let b=this.rateLimitStatus(),c=500*Math.pow(1.5,a);for(let a of b)a.remainingUnits||(c=Math.max(c,1e3*a.secondsUntilReset));return c}async pollStatus(a,b,c){let d={...b,method:"GET",body:void 0,redirect:"follow"};if(void 0===c.pollCount)b.headers&&"object"==typeof b.headers&&"Prefer"in b.headers&&(d.headers={...b.headers},delete d.headers.Prefer),c.statusUrl=a,c.pollCount=1;else{let a=b.pollStatusPeriod??1e3;await ao(a),c.pollCount++}return this.request("GET",a,d,c)}async executeAutoBatch(){if(void 0===this.autoBatchQueue)return;let a=[...this.autoBatchQueue];if(this.autoBatchQueue.length=0,this.autoBatchTimerId=void 0,1===a.length){let b=a[0];try{b.resolve(await this.request(b.method,aq(this.fhirBaseUrl,b.url),b.options))}catch(a){b.reject(new v(w(a)))}return}let b={resourceType:"Bundle",type:"batch",entry:a.map(a=>({request:{method:a.method,url:a.url},resource:a.options.body?JSON.parse(a.options.body):void 0}))},c=await this.post(this.fhirBaseUrl,b);for(let b=0;b<a.length;b++){var d;let e=a[b],f=c.entry?.[b];f?.response?.outcome&&"ok"!==(d=f.response.outcome).id&&"created"!==d.id&&"not-modified"!==d.id&&"accepted"!==d.id?e.reject(new v(f.response.outcome)):e.resolve(f?.resource)}}addFetchOptionsDefaults(a){Object.entries(this.defaultHeaders).forEach(([b,c])=>{this.setRequestHeader(a,b,c)}),this.setRequestHeader(a,"Accept",bE,!0),!1!==this.options.extendedMode&&this.setRequestHeader(a,"X-Medplum","extended"),a.body&&this.setRequestHeader(a,"Content-Type",be.FHIR_JSON,!0),this.accessToken?this.setRequestHeader(a,"Authorization","Bearer "+this.accessToken):this.basicAuth&&this.setRequestHeader(a,"Authorization","Basic "+this.basicAuth),a.cache||(a.cache="no-cache"),a.credentials||(a.credentials="include")}setRequestContentType(a,b){this.setRequestHeader(a,"Content-Type",b)}setRequestHeader(a,b,c,d=!1){let e=a.headers;e?Array.isArray(e)?d&&e.some(([a])=>a.toLowerCase()===b.toLowerCase())||e.push([b,c]):e instanceof Headers?d&&e.has(b)||e.set(b,c):!ai(e)||d&&e[b]||(e[b]=c):a.headers={[b]:c}}setRequestBody(a,b){"string"==typeof b||"u">typeof Blob&&(b instanceof Blob||b?.constructor.name==="Blob")||"u">typeof File&&(b instanceof File||b?.constructor.name==="File")||"u">typeof Uint8Array&&(b instanceof Uint8Array||b?.constructor.name==="Uint8Array")?a.body=b:b&&(a.body=JSON.stringify(b))}handleUnauthenticated(a,b,c){return this.refresh()?this.request(a,b,c):(this.clear(),this.onUnauthenticated&&this.onUnauthenticated(),Promise.reject(new v(p)))}async startPkce(){let a=bc();sessionStorage.setItem("pkceState",a);let b=bc().slice(0,128);sessionStorage.setItem("codeVerifier",b);try{let a=await bd(b);return{codeChallengeMethod:"S256",codeChallenge:(function(a){let b=new Uint8Array(am(a)),c=Array(b.length);for(let a=0;a<b.length;a++)c[a]=String.fromCharCode(b[a]);return window.btoa(c.join(""))})(a).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}}catch(a){return console.warn("Failed to hash code verifier. Falling back to 'plain' code challenge method",a),{codeChallengeMethod:"plain",codeChallenge:b}}}async requestAuthorization(a){let b=await this.ensureCodeChallenge(a??{}),c=new URL(this.authorizeUrl);c.searchParams.set("response_type","code"),c.searchParams.set("state",sessionStorage.getItem("pkceState")),c.searchParams.set("client_id",b.clientId??this.clientId),c.searchParams.set("redirect_uri",b.redirectUri??ba.getOrigin()),c.searchParams.set("code_challenge_method",b.codeChallengeMethod),c.searchParams.set("code_challenge",b.codeChallenge),c.searchParams.set("scope",b.scope??"openid profile"),ba.assign(c.toString())}processCode(a,b){let c={grant_type:bG.AuthorizationCode,code:a,client_id:b?.clientId??this.clientId??"",redirect_uri:b?.redirectUri??ba.getOrigin()};if("u">typeof sessionStorage){let a=sessionStorage.getItem("codeVerifier");a&&(c.code_verifier=a)}return this.fetchTokens(c)}refreshIfExpired(a){return this.refreshPromise||void 0===this.accessTokenExpires||this.isAuthenticated(a)||this.refresh(),this.refreshPromise??Promise.resolve()}refresh(){return this.refreshPromise?this.refreshPromise:this.refreshToken?(this.refreshPromise=this.fetchTokens({grant_type:bG.RefreshToken,client_id:this.clientId??"",refresh_token:this.refreshToken}),this.refreshPromise):this.clientId&&this.clientSecret?(this.refreshPromise=this.startClientLogin(this.clientId,this.clientSecret),this.refreshPromise):void 0}async startClientLogin(a,b){return this.clientId=a,this.clientSecret=b,this.fetchTokens({grant_type:bG.ClientCredentials,client_id:a,client_secret:b})}async startJwtBearerLogin(a,b,c){return this.clientId=a,this.fetchTokens({grant_type:bG.JwtBearer,client_id:a,assertion:b,scope:c})}async startJwtAssertionLogin(a){return this.fetchTokens({grant_type:bG.ClientCredentials,client_assertion_type:bI.JwtBearer,client_assertion:a})}setBasicAuth(a,b){this.clientId=a,this.clientSecret=b,this.basicAuth=bb(a+":"+b)}setVerbose(a){this.options.verbose=a}async fhircastSubscribe(a,b){if("string"!=typeof a||""===a)throw new v(t("Invalid topic provided. Topic must be a valid string."));if(!("object"==typeof b&&Array.isArray(b)&&b.length>0))throw new v(t("Invalid events provided. Events must be an array of event names containing at least one event."));let c={channelType:"websocket",mode:"subscribe",topic:a,events:b},d=(await this.post(this.fhircastHubUrl,bm(c),be.FORM_URL_ENCODED))["hub.channel.endpoint"];if(!d)throw Error("Invalid response!");return c.endpoint=d,c}async fhircastUnsubscribe(a){if(!bn(a))throw new v(t("Invalid topic or subscriptionRequest. SubscriptionRequest must be an object."));if(!(a.endpoint&&"string"==typeof a.endpoint&&a.endpoint.startsWith("ws")))throw new v(t("Provided subscription request must have an endpoint in order to unsubscribe."));a.mode="unsubscribe",await this.post(this.fhircastHubUrl,bm(a),be.FORM_URL_ENCODED)}fhircastConnect(a){return new bp(a)}async fhircastPublish(a,b,c,d){return bj.includes(b)?this.post(this.fhircastHubUrl,bo(a,b,c,d),be.JSON):(function(a){if(bj.includes(a))throw new v(t(`'context.version' is required for '${a}'.`))}(b),this.post(this.fhircastHubUrl,bo(a,b,c),be.JSON))}async fhircastGetContext(a){return this.get(`${this.fhircastHubUrl}/${a}`,{cache:"no-cache"})}async invite(a,b){return this.post("admin/projects/"+a+"/invite",b)}async fetchTokens(a){let b=new URLSearchParams(a),c={...this.defaultHeaders,"Content-Type":be.FORM_URL_ENCODED};this.basicAuth&&(c.Authorization=`Basic ${this.basicAuth}`),this.credentialsInHeader&&(b.delete("client_id"),b.delete("client_secret"),!this.basicAuth&&a.client_id&&a.client_secret&&(c.Authorization=`Basic ${bb(a.client_id+":"+a.client_secret)}`));let d={method:"POST",headers:c,body:b.toString(),credentials:"include"},e;try{e=await this.fetchWithRetry(this.tokenUrl,d)}catch(a){throw this.refreshPromise=void 0,a}if(!e.ok){this.clearActiveLogin();try{let a=await e.json();throw new v(s(a.error_description))}catch(a){throw new v(s("Failed to fetch tokens"),{cause:a})}}let f=await e.json();return await this.verifyTokens(f),this.getProfile()}async verifyTokens(a){let b=a.access_token;if(3===b.split(".").length){let a=bq(b);if(Date.now()>=1e3*a.exp)throw this.clearActiveLogin(),new v(q);if(a.cid){if(a.cid!==this.clientId)throw this.clearActiveLogin(),new v(r)}else if(this.clientId&&a.client_id!==this.clientId)throw this.clearActiveLogin(),new v(r)}return this.setActiveLogin({accessToken:b,refreshToken:a.refresh_token,project:a.project,profile:a.profile})}checkSessionDetailsMatchLogin(a){return!this.sessionDetails||!a||(a.profile?.reference?.endsWith(this.sessionDetails.profile.id)??!1)}setupStorageListener(){try{window.addEventListener("storage",a=>{if(null===a.key)ba.reload();else if(a.key===this.storage.makeKey("activeLogin")){let b=a.oldValue?JSON.parse(a.oldValue):void 0,c=a.newValue?JSON.parse(a.newValue):void 0;b?.profile.reference===c?.profile.reference&&this.checkSessionDetailsMatchLogin(c)?c?this.setAccessToken(c.accessToken,c.refreshToken):this.clear():ba.reload()}})}catch{}}getSubscriptionManager(){return this.subscriptionManager||(this.subscriptionManager=new bD(this,aq(this.baseUrl,"/ws/subscriptions-r4").toString().replace("http://","ws://").replace("https://","wss://"))),this.subscriptionManager}subscribeToCriteria(a,b){return this.getSubscriptionManager().addCriteria(a,b)}unsubscribeFromCriteria(a,b){this.subscriptionManager&&(this.subscriptionManager.removeCriteria(a,b),0===this.subscriptionManager.getCriteriaCount()&&this.subscriptionManager.closeWebSocket())}getMasterSubscriptionEmitter(){return this.getSubscriptionManager().getMasterEmitter()}};async function bK(a,b){let c=a.headers.get("content-location");if(c)return c;let d=a.headers.get("location");return d||(u(b)&&b.issue?.[0]?.diagnostics?b.issue[0].diagnostics:void 0)}function bL(a){return Object.assign(a.entry?.map(a=>a.resource)??[],{bundle:a})}function bM(a,b,c,d){return ai(a)&&"data"in a&&"contentType"in a?a:{data:a,filename:b,contentType:c,onProgress:d}}[...a1],a6().registerInfix("->",{precedence:a2.Arrow}).registerInfix(";",{precedence:a2.Semicolon})," ".repeat(2),[...a1],a7.EXACT,a7.NOT_EQUALS,a7.CONTAINS,a7.STARTS_WITH,a7.GREATER_THAN,a7.LESS_THAN,a7.GREATER_THAN_OR_EQUALS,a7.LESS_THAN_OR_EQUALS,a7.APPROXIMATELY,a7.STARTS_AFTER,a7.ENDS_BEFORE,a7.PRESENT,a7.IN,a7.NOT_IN,a7.EQUALS,a7.IDENTIFIER,a6();var bN=c(36512),bO=c(11110),bP=c(33435);let bQ={bg:"var(--mantine-color-blue-light)",mt:"md"};async function bR(){let a=await (0,bN.getServerSession)(bP.f),b=a?.accessToken,c={resourceType:"Bundle",type:"document"};try{let a=new bJ({accessToken:b});c=await a.search("Patient")}catch(a){console.log(a)}return(0,e.jsx)(bO.Suspense,{fallback:(0,e.jsx)("div",{children:"Loading..."}),children:(0,e.jsx)(g.Container,{size:"xs",...bQ,children:a?(0,e.jsx)(f.PatientTable,{patients:c}):(0,e.jsxs)("h2",{children:["Not signed in ",(0,e.jsx)("a",{href:"/api/auth/signin",children:"Sign in"})]})})})}},41025:a=>{"use strict";a.exports=require("next/dist/server/app-render/dynamic-access-async-storage.external.js")},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},68278:(a,b,c)=>{Promise.resolve().then(c.bind(c,98839)),Promise.resolve().then(c.bind(c,39281)),Promise.resolve().then(c.bind(c,4466)),Promise.resolve().then(c.bind(c,25942)),Promise.resolve().then(c.bind(c,29726)),Promise.resolve().then(c.bind(c,77064)),Promise.resolve().then(c.bind(c,20201)),Promise.resolve().then(c.bind(c,86993)),Promise.resolve().then(c.bind(c,78081)),Promise.resolve().then(c.bind(c,72297)),Promise.resolve().then(c.bind(c,44113)),Promise.resolve().then(c.bind(c,27525)),Promise.resolve().then(c.bind(c,18613)),Promise.resolve().then(c.bind(c,94105)),Promise.resolve().then(c.bind(c,13413)),Promise.resolve().then(c.bind(c,74935)),Promise.resolve().then(c.bind(c,13855)),Promise.resolve().then(c.bind(c,33647)),Promise.resolve().then(c.bind(c,29509)),Promise.resolve().then(c.bind(c,11209)),Promise.resolve().then(c.bind(c,43305)),Promise.resolve().then(c.bind(c,49655)),Promise.resolve().then(c.bind(c,93437)),Promise.resolve().then(c.bind(c,68183)),Promise.resolve().then(c.bind(c,60953)),Promise.resolve().then(c.bind(c,42153)),Promise.resolve().then(c.bind(c,95289)),Promise.resolve().then(c.bind(c,18977)),Promise.resolve().then(c.bind(c,87981)),Promise.resolve().then(c.bind(c,56771)),Promise.resolve().then(c.bind(c,70684)),Promise.resolve().then(c.bind(c,14242)),Promise.resolve().then(c.bind(c,46611)),Promise.resolve().then(c.bind(c,13926)),Promise.resolve().then(c.bind(c,68209)),Promise.resolve().then(c.bind(c,59745)),Promise.resolve().then(c.bind(c,53700)),Promise.resolve().then(c.bind(c,53347)),Promise.resolve().then(c.bind(c,21629)),Promise.resolve().then(c.bind(c,53279)),Promise.resolve().then(c.bind(c,43623)),Promise.resolve().then(c.bind(c,37897)),Promise.resolve().then(c.bind(c,91571)),Promise.resolve().then(c.bind(c,9934)),Promise.resolve().then(c.bind(c,96589)),Promise.resolve().then(c.bind(c,81010)),Promise.resolve().then(c.bind(c,37317)),Promise.resolve().then(c.bind(c,29825)),Promise.resolve().then(c.bind(c,96417)),Promise.resolve().then(c.bind(c,26987)),Promise.resolve().then(c.bind(c,78077)),Promise.resolve().then(c.bind(c,15635)),Promise.resolve().then(c.bind(c,1376)),Promise.resolve().then(c.bind(c,78467)),Promise.resolve().then(c.bind(c,85897)),Promise.resolve().then(c.bind(c,67649)),Promise.resolve().then(c.bind(c,31813)),Promise.resolve().then(c.bind(c,61517)),Promise.resolve().then(c.bind(c,1343)),Promise.resolve().then(c.bind(c,42949)),Promise.resolve().then(c.bind(c,62281)),Promise.resolve().then(c.bind(c,10805)),Promise.resolve().then(c.bind(c,42291)),Promise.resolve().then(c.bind(c,58865)),Promise.resolve().then(c.bind(c,8039)),Promise.resolve().then(c.bind(c,21085)),Promise.resolve().then(c.bind(c,64799)),Promise.resolve().then(c.bind(c,11429)),Promise.resolve().then(c.bind(c,51445)),Promise.resolve().then(c.bind(c,12159)),Promise.resolve().then(c.bind(c,54155)),Promise.resolve().then(c.bind(c,87437)),Promise.resolve().then(c.bind(c,80069)),Promise.resolve().then(c.bind(c,14607)),Promise.resolve().then(c.bind(c,80437)),Promise.resolve().then(c.bind(c,16009)),Promise.resolve().then(c.bind(c,66861)),Promise.resolve().then(c.bind(c,78233)),Promise.resolve().then(c.bind(c,92809)),Promise.resolve().then(c.bind(c,20857)),Promise.resolve().then(c.bind(c,66391)),Promise.resolve().then(c.bind(c,94057)),Promise.resolve().then(c.bind(c,82633)),Promise.resolve().then(c.bind(c,83225)),Promise.resolve().then(c.bind(c,26723)),Promise.resolve().then(c.bind(c,58320)),Promise.resolve().then(c.bind(c,7626)),Promise.resolve().then(c.bind(c,2955)),Promise.resolve().then(c.bind(c,7881)),Promise.resolve().then(c.bind(c,60151)),Promise.resolve().then(c.bind(c,55053)),Promise.resolve().then(c.bind(c,59247)),Promise.resolve().then(c.bind(c,58471)),Promise.resolve().then(c.bind(c,58817)),Promise.resolve().then(c.bind(c,6764)),Promise.resolve().then(c.bind(c,30457)),Promise.resolve().then(c.bind(c,81737)),Promise.resolve().then(c.bind(c,28617)),Promise.resolve().then(c.bind(c,62823)),Promise.resolve().then(c.bind(c,79008)),Promise.resolve().then(c.bind(c,10913)),Promise.resolve().then(c.bind(c,95241)),Promise.resolve().then(c.bind(c,64857)),Promise.resolve().then(c.bind(c,85348)),Promise.resolve().then(c.bind(c,45768)),Promise.resolve().then(c.bind(c,1400)),Promise.resolve().then(c.bind(c,93973)),Promise.resolve().then(c.bind(c,89417)),Promise.resolve().then(c.bind(c,91417)),Promise.resolve().then(c.bind(c,57232)),Promise.resolve().then(c.bind(c,55474)),Promise.resolve().then(c.bind(c,53794)),Promise.resolve().then(c.bind(c,26986)),Promise.resolve().then(c.bind(c,85984)),Promise.resolve().then(c.bind(c,29533)),Promise.resolve().then(c.bind(c,58908)),Promise.resolve().then(c.bind(c,75862)),Promise.resolve().then(c.bind(c,76245)),Promise.resolve().then(c.bind(c,73401)),Promise.resolve().then(c.bind(c,71777)),Promise.resolve().then(c.bind(c,85167)),Promise.resolve().then(c.bind(c,44064)),Promise.resolve().then(c.bind(c,79761)),Promise.resolve().then(c.bind(c,54983)),Promise.resolve().then(c.bind(c,72821)),Promise.resolve().then(c.bind(c,89969)),Promise.resolve().then(c.bind(c,51633)),Promise.resolve().then(c.bind(c,80251)),Promise.resolve().then(c.bind(c,66371)),Promise.resolve().then(c.bind(c,98013)),Promise.resolve().then(c.bind(c,83005)),Promise.resolve().then(c.bind(c,7073)),Promise.resolve().then(c.bind(c,4825)),Promise.resolve().then(c.bind(c,58717)),Promise.resolve().then(c.bind(c,2395)),Promise.resolve().then(c.bind(c,37421)),Promise.resolve().then(c.bind(c,9917)),Promise.resolve().then(c.bind(c,81759)),Promise.resolve().then(c.bind(c,63228)),Promise.resolve().then(c.bind(c,23542)),Promise.resolve().then(c.bind(c,38935)),Promise.resolve().then(c.bind(c,78501)),Promise.resolve().then(c.bind(c,95275)),Promise.resolve().then(c.bind(c,4009)),Promise.resolve().then(c.bind(c,35805)),Promise.resolve().then(c.bind(c,17033)),Promise.resolve().then(c.bind(c,33145)),Promise.resolve().then(c.bind(c,11363)),Promise.resolve().then(c.bind(c,65904)),Promise.resolve().then(c.bind(c,93738)),Promise.resolve().then(c.bind(c,76427)),Promise.resolve().then(c.bind(c,11117)),Promise.resolve().then(c.bind(c,19926)),Promise.resolve().then(c.bind(c,96201)),Promise.resolve().then(c.bind(c,33041)),Promise.resolve().then(c.bind(c,313)),Promise.resolve().then(c.bind(c,56329)),Promise.resolve().then(c.bind(c,83685)),Promise.resolve().then(c.bind(c,20657)),Promise.resolve().then(c.bind(c,11181)),Promise.resolve().then(c.bind(c,96055)),Promise.resolve().then(c.bind(c,360)),Promise.resolve().then(c.bind(c,15578)),Promise.resolve().then(c.bind(c,96500)),Promise.resolve().then(c.bind(c,32692)),Promise.resolve().then(c.bind(c,54046)),Promise.resolve().then(c.bind(c,77157)),Promise.resolve().then(c.bind(c,48041)),Promise.resolve().then(c.bind(c,23617)),Promise.resolve().then(c.bind(c,92277)),Promise.resolve().then(c.bind(c,56843)),Promise.resolve().then(c.bind(c,16844)),Promise.resolve().then(c.bind(c,86813)),Promise.resolve().then(c.bind(c,91033)),Promise.resolve().then(c.bind(c,90339)),Promise.resolve().then(c.bind(c,59395)),Promise.resolve().then(c.bind(c,43011)),Promise.resolve().then(c.bind(c,42319)),Promise.resolve().then(c.bind(c,49737)),Promise.resolve().then(c.bind(c,94341)),Promise.resolve().then(c.bind(c,91165)),Promise.resolve().then(c.bind(c,59841)),Promise.resolve().then(c.bind(c,82761)),Promise.resolve().then(c.bind(c,11634)),Promise.resolve().then(c.bind(c,23529)),Promise.resolve().then(c.bind(c,25483)),Promise.resolve().then(c.bind(c,75930)),Promise.resolve().then(c.bind(c,37515)),Promise.resolve().then(c.bind(c,76041)),Promise.resolve().then(c.bind(c,761)),Promise.resolve().then(c.bind(c,11579)),Promise.resolve().then(c.bind(c,43669)),Promise.resolve().then(c.bind(c,80195)),Promise.resolve().then(c.bind(c,54397)),Promise.resolve().then(c.bind(c,90255)),Promise.resolve().then(c.bind(c,65305)),Promise.resolve().then(c.bind(c,33047)),Promise.resolve().then(c.bind(c,33743)),Promise.resolve().then(c.bind(c,95369)),Promise.resolve().then(c.bind(c,78445)),Promise.resolve().then(c.bind(c,8521)),Promise.resolve().then(c.bind(c,51913)),Promise.resolve().then(c.bind(c,95297)),Promise.resolve().then(c.bind(c,59299)),Promise.resolve().then(c.bind(c,97459)),Promise.resolve().then(c.bind(c,6012)),Promise.resolve().then(c.bind(c,35453)),Promise.resolve().then(c.bind(c,10941)),Promise.resolve().then(c.bind(c,64372)),Promise.resolve().then(c.bind(c,25417)),Promise.resolve().then(c.bind(c,40471)),Promise.resolve().then(c.bind(c,9806)),Promise.resolve().then(c.bind(c,80696)),Promise.resolve().then(c.bind(c,19384)),Promise.resolve().then(c.bind(c,28585)),Promise.resolve().then(c.bind(c,16873)),Promise.resolve().then(c.bind(c,53671)),Promise.resolve().then(c.bind(c,48101)),Promise.resolve().then(c.bind(c,19193)),Promise.resolve().then(c.bind(c,17801)),Promise.resolve().then(c.bind(c,52535)),Promise.resolve().then(c.bind(c,97597)),Promise.resolve().then(c.bind(c,27145)),Promise.resolve().then(c.bind(c,76537)),Promise.resolve().then(c.bind(c,10511)),Promise.resolve().then(c.bind(c,33881)),Promise.resolve().then(c.bind(c,30473)),Promise.resolve().then(c.bind(c,16912)),Promise.resolve().then(c.bind(c,62611)),Promise.resolve().then(c.bind(c,33333)),Promise.resolve().then(c.bind(c,42302)),Promise.resolve().then(c.bind(c,83729)),Promise.resolve().then(c.bind(c,79)),Promise.resolve().then(c.bind(c,6761)),Promise.resolve().then(c.bind(c,94240)),Promise.resolve().then(c.bind(c,81936)),Promise.resolve().then(c.bind(c,35121)),Promise.resolve().then(c.bind(c,59625)),Promise.resolve().then(c.bind(c,335)),Promise.resolve().then(c.bind(c,71006)),Promise.resolve().then(c.bind(c,74680)),Promise.resolve().then(c.bind(c,97792)),Promise.resolve().then(c.bind(c,56503)),Promise.resolve().then(c.bind(c,14724)),Promise.resolve().then(c.bind(c,13592)),Promise.resolve().then(c.bind(c,56352)),Promise.resolve().then(c.bind(c,47280)),Promise.resolve().then(c.bind(c,47380)),Promise.resolve().then(c.bind(c,87900)),Promise.resolve().then(c.bind(c,32376)),Promise.resolve().then(c.bind(c,21276)),Promise.resolve().then(c.bind(c,11056)),Promise.resolve().then(c.bind(c,63197)),Promise.resolve().then(c.bind(c,11719)),Promise.resolve().then(c.bind(c,94072)),Promise.resolve().then(c.bind(c,62904)),Promise.resolve().then(c.bind(c,93244)),Promise.resolve().then(c.bind(c,32158)),Promise.resolve().then(c.bind(c,38674)),Promise.resolve().then(c.bind(c,98348)),Promise.resolve().then(c.bind(c,34384)),Promise.resolve().then(c.bind(c,27434)),Promise.resolve().then(c.bind(c,78736)),Promise.resolve().then(c.bind(c,45883)),Promise.resolve().then(c.bind(c,92418)),Promise.resolve().then(c.bind(c,39641)),Promise.resolve().then(c.bind(c,30968)),Promise.resolve().then(c.bind(c,31448)),Promise.resolve().then(c.bind(c,48376)),Promise.resolve().then(c.bind(c,41706)),Promise.resolve().then(c.bind(c,76983)),Promise.resolve().then(c.bind(c,82781)),Promise.resolve().then(c.bind(c,16944)),Promise.resolve().then(c.bind(c,50416)),Promise.resolve().then(c.bind(c,66458)),Promise.resolve().then(c.bind(c,50690)),Promise.resolve().then(c.bind(c,50080)),Promise.resolve().then(c.bind(c,15042)),Promise.resolve().then(c.bind(c,69158)),Promise.resolve().then(c.bind(c,18758)),Promise.resolve().then(c.bind(c,50312)),Promise.resolve().then(c.bind(c,61186)),Promise.resolve().then(c.bind(c,50150)),Promise.resolve().then(c.bind(c,2838)),Promise.resolve().then(c.bind(c,1952)),Promise.resolve().then(c.bind(c,47860)),Promise.resolve().then(c.bind(c,49650)),Promise.resolve().then(c.bind(c,28258)),Promise.resolve().then(c.bind(c,34994)),Promise.resolve().then(c.bind(c,17452)),Promise.resolve().then(c.bind(c,95518)),Promise.resolve().then(c.bind(c,84472)),Promise.resolve().then(c.bind(c,7214)),Promise.resolve().then(c.bind(c,45002)),Promise.resolve().then(c.bind(c,81968)),Promise.resolve().then(c.bind(c,79728)),Promise.resolve().then(c.bind(c,30498)),Promise.resolve().then(c.bind(c,81504)),Promise.resolve().then(c.bind(c,6962)),Promise.resolve().then(c.bind(c,55417)),Promise.resolve().then(c.bind(c,92137)),Promise.resolve().then(c.bind(c,8385)),Promise.resolve().then(c.bind(c,24545)),Promise.resolve().then(c.bind(c,56629)),Promise.resolve().then(c.bind(c,11861)),Promise.resolve().then(c.bind(c,25869)),Promise.resolve().then(c.bind(c,26917)),Promise.resolve().then(c.bind(c,29133)),Promise.resolve().then(c.bind(c,40797)),Promise.resolve().then(c.bind(c,80709)),Promise.resolve().then(c.bind(c,71373)),Promise.resolve().then(c.bind(c,95687)),Promise.resolve().then(c.bind(c,52229)),Promise.resolve().then(c.bind(c,13889)),Promise.resolve().then(c.bind(c,81049)),Promise.resolve().then(c.bind(c,91721)),Promise.resolve().then(c.bind(c,43873)),Promise.resolve().then(c.bind(c,24341)),Promise.resolve().then(c.bind(c,27661)),Promise.resolve().then(c.bind(c,40051)),Promise.resolve().then(c.bind(c,29723)),Promise.resolve().then(c.bind(c,58173)),Promise.resolve().then(c.bind(c,64589)),Promise.resolve().then(c.bind(c,51219)),Promise.resolve().then(c.bind(c,19661)),Promise.resolve().then(c.bind(c,97358)),Promise.resolve().then(c.bind(c,40389)),Promise.resolve().then(c.bind(c,97101)),Promise.resolve().then(c.bind(c,165)),Promise.resolve().then(c.bind(c,55199)),Promise.resolve().then(c.bind(c,52889)),Promise.resolve().then(c.bind(c,1161)),Promise.resolve().then(c.bind(c,79221)),Promise.resolve().then(c.bind(c,35549)),Promise.resolve().then(c.bind(c,2901)),Promise.resolve().then(c.bind(c,11245)),Promise.resolve().then(c.bind(c,82503)),Promise.resolve().then(c.bind(c,98113)),Promise.resolve().then(c.bind(c,58975)),Promise.resolve().then(c.bind(c,89887)),Promise.resolve().then(c.bind(c,39437)),Promise.resolve().then(c.bind(c,3709)),Promise.resolve().then(c.bind(c,21591)),Promise.resolve().then(c.bind(c,69925)),Promise.resolve().then(c.bind(c,65137)),Promise.resolve().then(c.bind(c,96365)),Promise.resolve().then(c.bind(c,22613)),Promise.resolve().then(c.bind(c,82273)),Promise.resolve().then(c.bind(c,58217)),Promise.resolve().then(c.bind(c,8043)),Promise.resolve().then(c.bind(c,91501)),Promise.resolve().then(c.bind(c,84959)),Promise.resolve().then(c.bind(c,47261)),Promise.resolve().then(c.bind(c,34537)),Promise.resolve().then(c.bind(c,43477)),Promise.resolve().then(c.bind(c,14321)),Promise.resolve().then(c.bind(c,74445)),Promise.resolve().then(c.bind(c,15391)),Promise.resolve().then(c.bind(c,6479)),Promise.resolve().then(c.bind(c,77097)),Promise.resolve().then(c.bind(c,31821)),Promise.resolve().then(c.bind(c,81469)),Promise.resolve().then(c.bind(c,3453)),Promise.resolve().then(c.bind(c,87967)),Promise.resolve().then(c.bind(c,45137)),Promise.resolve().then(c.bind(c,13415)),Promise.resolve().then(c.bind(c,76667)),Promise.resolve().then(c.bind(c,60377)),Promise.resolve().then(c.bind(c,32793)),Promise.resolve().then(c.bind(c,86605)),Promise.resolve().then(c.bind(c,32491)),Promise.resolve().then(c.bind(c,83565)),Promise.resolve().then(c.bind(c,98061)),Promise.resolve().then(c.bind(c,62293)),Promise.resolve().then(c.bind(c,51885)),Promise.resolve().then(c.bind(c,85993)),Promise.resolve().then(c.bind(c,96439)),Promise.resolve().then(c.bind(c,10723)),Promise.resolve().then(c.bind(c,33287)),Promise.resolve().then(c.bind(c,5123)),Promise.resolve().then(c.bind(c,18443)),Promise.resolve().then(c.bind(c,19191)),Promise.resolve().then(c.bind(c,83103))},74075:a=>{"use strict";a.exports=require("zlib")},79428:a=>{"use strict";a.exports=require("buffer")},79551:a=>{"use strict";a.exports=require("url")},79902:(a,b,c)=>{Promise.resolve().then(c.bind(c,91245)),Promise.resolve().then(c.bind(c,54391)),Promise.resolve().then(c.bind(c,34776)),Promise.resolve().then(c.bind(c,17872)),Promise.resolve().then(c.bind(c,82664)),Promise.resolve().then(c.bind(c,10570)),Promise.resolve().then(c.bind(c,35423)),Promise.resolve().then(c.bind(c,32679)),Promise.resolve().then(c.bind(c,96367)),Promise.resolve().then(c.bind(c,58620)),Promise.resolve().then(c.bind(c,76950)),Promise.resolve().then(c.bind(c,37353)),Promise.resolve().then(c.bind(c,59394)),Promise.resolve().then(c.bind(c,64898)),Promise.resolve().then(c.bind(c,18751)),Promise.resolve().then(c.bind(c,99953)),Promise.resolve().then(c.bind(c,38633)),Promise.resolve().then(c.bind(c,37337)),Promise.resolve().then(c.bind(c,43263)),Promise.resolve().then(c.bind(c,64603)),Promise.resolve().then(c.bind(c,22051)),Promise.resolve().then(c.bind(c,57333)),Promise.resolve().then(c.bind(c,68816)),Promise.resolve().then(c.bind(c,67821)),Promise.resolve().then(c.bind(c,50889)),Promise.resolve().then(c.bind(c,87564)),Promise.resolve().then(c.bind(c,94997)),Promise.resolve().then(c.bind(c,41792)),Promise.resolve().then(c.bind(c,27141)),Promise.resolve().then(c.bind(c,30825)),Promise.resolve().then(c.bind(c,60614)),Promise.resolve().then(c.bind(c,80716)),Promise.resolve().then(c.bind(c,60809)),Promise.resolve().then(c.bind(c,46076)),Promise.resolve().then(c.bind(c,10524)),Promise.resolve().then(c.bind(c,31954)),Promise.resolve().then(c.bind(c,63430)),Promise.resolve().then(c.bind(c,74690)),Promise.resolve().then(c.bind(c,24275)),Promise.resolve().then(c.bind(c,2297)),Promise.resolve().then(c.bind(c,75149)),Promise.resolve().then(c.bind(c,67447)),Promise.resolve().then(c.bind(c,16606)),Promise.resolve().then(c.bind(c,28504)),Promise.resolve().then(c.bind(c,13967)),Promise.resolve().then(c.bind(c,26376)),Promise.resolve().then(c.bind(c,59197)),Promise.resolve().then(c.bind(c,34934)),Promise.resolve().then(c.bind(c,54202)),Promise.resolve().then(c.bind(c,82321)),Promise.resolve().then(c.bind(c,1393)),Promise.resolve().then(c.bind(c,55081)),Promise.resolve().then(c.bind(c,32974)),Promise.resolve().then(c.bind(c,12545)),Promise.resolve().then(c.bind(c,69527)),Promise.resolve().then(c.bind(c,61863)),Promise.resolve().then(c.bind(c,25019)),Promise.resolve().then(c.bind(c,49891)),Promise.resolve().then(c.bind(c,12565)),Promise.resolve().then(c.bind(c,18587)),Promise.resolve().then(c.bind(c,13615)),Promise.resolve().then(c.bind(c,24387)),Promise.resolve().then(c.bind(c,53089)),Promise.resolve().then(c.bind(c,32287)),Promise.resolve().then(c.bind(c,16845)),Promise.resolve().then(c.bind(c,75227)),Promise.resolve().then(c.bind(c,53741)),Promise.resolve().then(c.bind(c,92419)),Promise.resolve().then(c.bind(c,75843)),Promise.resolve().then(c.bind(c,99285)),Promise.resolve().then(c.bind(c,18681)),Promise.resolve().then(c.bind(c,60955)),Promise.resolve().then(c.bind(c,48647)),Promise.resolve().then(c.bind(c,74365)),Promise.resolve().then(c.bind(c,2645)),Promise.resolve().then(c.bind(c,82799)),Promise.resolve().then(c.bind(c,24657)),Promise.resolve().then(c.bind(c,2204)),Promise.resolve().then(c.bind(c,49682)),Promise.resolve().then(c.bind(c,68591)),Promise.resolve().then(c.bind(c,163)),Promise.resolve().then(c.bind(c,79635)),Promise.resolve().then(c.bind(c,21935)),Promise.resolve().then(c.bind(c,66039)),Promise.resolve().then(c.bind(c,65669)),Promise.resolve().then(c.bind(c,49226)),Promise.resolve().then(c.bind(c,54676)),Promise.resolve().then(c.bind(c,11785)),Promise.resolve().then(c.bind(c,93379)),Promise.resolve().then(c.bind(c,97541)),Promise.resolve().then(c.bind(c,92535)),Promise.resolve().then(c.bind(c,68505)),Promise.resolve().then(c.bind(c,22757)),Promise.resolve().then(c.bind(c,53783)),Promise.resolve().then(c.bind(c,7246)),Promise.resolve().then(c.bind(c,8009)),Promise.resolve().then(c.bind(c,53727)),Promise.resolve().then(c.bind(c,40799)),Promise.resolve().then(c.bind(c,80153)),Promise.resolve().then(c.bind(c,14412)),Promise.resolve().then(c.bind(c,60691)),Promise.resolve().then(c.bind(c,93127)),Promise.resolve().then(c.bind(c,54837)),Promise.resolve().then(c.bind(c,21634)),Promise.resolve().then(c.bind(c,67950)),Promise.resolve().then(c.bind(c,45438)),Promise.resolve().then(c.bind(c,28706)),Promise.resolve().then(c.bind(c,20709)),Promise.resolve().then(c.bind(c,44600)),Promise.resolve().then(c.bind(c,25958)),Promise.resolve().then(c.bind(c,91320)),Promise.resolve().then(c.bind(c,62232)),Promise.resolve().then(c.bind(c,78928)),Promise.resolve().then(c.bind(c,73654)),Promise.resolve().then(c.bind(c,73715)),Promise.resolve().then(c.bind(c,77195)),Promise.resolve().then(c.bind(c,26452)),Promise.resolve().then(c.bind(c,85027)),Promise.resolve().then(c.bind(c,70532)),Promise.resolve().then(c.bind(c,12921)),Promise.resolve().then(c.bind(c,10373)),Promise.resolve().then(c.bind(c,74834)),Promise.resolve().then(c.bind(c,41547)),Promise.resolve().then(c.bind(c,50645)),Promise.resolve().then(c.bind(c,91539)),Promise.resolve().then(c.bind(c,12735)),Promise.resolve().then(c.bind(c,61339)),Promise.resolve().then(c.bind(c,5381)),Promise.resolve().then(c.bind(c,24357)),Promise.resolve().then(c.bind(c,85527)),Promise.resolve().then(c.bind(c,53247)),Promise.resolve().then(c.bind(c,85483)),Promise.resolve().then(c.bind(c,22027)),Promise.resolve().then(c.bind(c,27343)),Promise.resolve().then(c.bind(c,83957)),Promise.resolve().then(c.bind(c,16619)),Promise.resolve().then(c.bind(c,82243)),Promise.resolve().then(c.bind(c,73561)),Promise.resolve().then(c.bind(c,7486)),Promise.resolve().then(c.bind(c,26360)),Promise.resolve().then(c.bind(c,66877)),Promise.resolve().then(c.bind(c,5047)),Promise.resolve().then(c.bind(c,58369)),Promise.resolve().then(c.bind(c,50251)),Promise.resolve().then(c.bind(c,23323)),Promise.resolve().then(c.bind(c,71086)),Promise.resolve().then(c.bind(c,32836)),Promise.resolve().then(c.bind(c,98213)),Promise.resolve().then(c.bind(c,6858)),Promise.resolve().then(c.bind(c,96628)),Promise.resolve().then(c.bind(c,18592)),Promise.resolve().then(c.bind(c,15993)),Promise.resolve().then(c.bind(c,43128)),Promise.resolve().then(c.bind(c,72960)),Promise.resolve().then(c.bind(c,78079)),Promise.resolve().then(c.bind(c,16168)),Promise.resolve().then(c.bind(c,51494)),Promise.resolve().then(c.bind(c,21315)),Promise.resolve().then(c.bind(c,47764)),Promise.resolve().then(c.bind(c,59109)),Promise.resolve().then(c.bind(c,18861)),Promise.resolve().then(c.bind(c,85302)),Promise.resolve().then(c.bind(c,80744)),Promise.resolve().then(c.bind(c,47754)),Promise.resolve().then(c.bind(c,93978)),Promise.resolve().then(c.bind(c,11212)),Promise.resolve().then(c.bind(c,79809)),Promise.resolve().then(c.bind(c,44731)),Promise.resolve().then(c.bind(c,52871)),Promise.resolve().then(c.bind(c,61115)),Promise.resolve().then(c.bind(c,55537)),Promise.resolve().then(c.bind(c,73310)),Promise.resolve().then(c.bind(c,15796)),Promise.resolve().then(c.bind(c,59013)),Promise.resolve().then(c.bind(c,77645)),Promise.resolve().then(c.bind(c,48405)),Promise.resolve().then(c.bind(c,79757)),Promise.resolve().then(c.bind(c,11341)),Promise.resolve().then(c.bind(c,47855)),Promise.resolve().then(c.bind(c,14019)),Promise.resolve().then(c.bind(c,88403)),Promise.resolve().then(c.bind(c,64999)),Promise.resolve().then(c.bind(c,47499)),Promise.resolve().then(c.bind(c,36492)),Promise.resolve().then(c.bind(c,65852)),Promise.resolve().then(c.bind(c,45189)),Promise.resolve().then(c.bind(c,17644)),Promise.resolve().then(c.bind(c,52168)),Promise.resolve().then(c.bind(c,99977)),Promise.resolve().then(c.bind(c,265)),Promise.resolve().then(c.bind(c,99019)),Promise.resolve().then(c.bind(c,68408)),Promise.resolve().then(c.bind(c,48273)),Promise.resolve().then(c.bind(c,45320)),Promise.resolve().then(c.bind(c,35939)),Promise.resolve().then(c.bind(c,58741)),Promise.resolve().then(c.bind(c,78533)),Promise.resolve().then(c.bind(c,86501)),Promise.resolve().then(c.bind(c,98151)),Promise.resolve().then(c.bind(c,77680)),Promise.resolve().then(c.bind(c,56774)),Promise.resolve().then(c.bind(c,86175)),Promise.resolve().then(c.bind(c,16115)),Promise.resolve().then(c.bind(c,70701)),Promise.resolve().then(c.bind(c,48200)),Promise.resolve().then(c.bind(c,52958)),Promise.resolve().then(c.bind(c,35019)),Promise.resolve().then(c.bind(c,49575)),Promise.resolve().then(c.bind(c,80565)),Promise.resolve().then(c.bind(c,61449)),Promise.resolve().then(c.bind(c,41541)),Promise.resolve().then(c.bind(c,19852)),Promise.resolve().then(c.bind(c,61982)),Promise.resolve().then(c.bind(c,64086)),Promise.resolve().then(c.bind(c,77926)),Promise.resolve().then(c.bind(c,85600)),Promise.resolve().then(c.bind(c,93768)),Promise.resolve().then(c.bind(c,53475)),Promise.resolve().then(c.bind(c,94796)),Promise.resolve().then(c.bind(c,14679)),Promise.resolve().then(c.bind(c,84129)),Promise.resolve().then(c.bind(c,26939)),Promise.resolve().then(c.bind(c,66588)),Promise.resolve().then(c.bind(c,9544)),Promise.resolve().then(c.bind(c,25497)),Promise.resolve().then(c.bind(c,92947)),Promise.resolve().then(c.bind(c,18004)),Promise.resolve().then(c.bind(c,43494)),Promise.resolve().then(c.bind(c,75204)),Promise.resolve().then(c.bind(c,72306)),Promise.resolve().then(c.bind(c,11648)),Promise.resolve().then(c.bind(c,91092)),Promise.resolve().then(c.bind(c,4851)),Promise.resolve().then(c.bind(c,62317)),Promise.resolve().then(c.bind(c,87226)),Promise.resolve().then(c.bind(c,86846)),Promise.resolve().then(c.bind(c,40739)),Promise.resolve().then(c.bind(c,62911)),Promise.resolve().then(c.bind(c,36937)),Promise.resolve().then(c.bind(c,53044)),Promise.resolve().then(c.bind(c,92858)),Promise.resolve().then(c.bind(c,55250)),Promise.resolve().then(c.bind(c,1617)),Promise.resolve().then(c.bind(c,25966)),Promise.resolve().then(c.bind(c,36549)),Promise.resolve().then(c.bind(c,57834)),Promise.resolve().then(c.bind(c,82322)),Promise.resolve().then(c.bind(c,5094)),Promise.resolve().then(c.bind(c,534)),Promise.resolve().then(c.bind(c,33194)),Promise.resolve().then(c.bind(c,95894)),Promise.resolve().then(c.bind(c,36994)),Promise.resolve().then(c.bind(c,2303)),Promise.resolve().then(c.bind(c,75289)),Promise.resolve().then(c.bind(c,11782)),Promise.resolve().then(c.bind(c,32011)),Promise.resolve().then(c.bind(c,88246)),Promise.resolve().then(c.bind(c,42377)),Promise.resolve().then(c.bind(c,52548)),Promise.resolve().then(c.bind(c,30134)),Promise.resolve().then(c.bind(c,58931)),Promise.resolve().then(c.bind(c,23556)),Promise.resolve().then(c.bind(c,77118)),Promise.resolve().then(c.bind(c,77597)),Promise.resolve().then(c.bind(c,19608)),Promise.resolve().then(c.bind(c,1339)),Promise.resolve().then(c.bind(c,35446)),Promise.resolve().then(c.bind(c,91662)),Promise.resolve().then(c.bind(c,19786)),Promise.resolve().then(c.bind(c,58460)),Promise.resolve().then(c.bind(c,42225)),Promise.resolve().then(c.bind(c,34103)),Promise.resolve().then(c.bind(c,81338)),Promise.resolve().then(c.bind(c,30711)),Promise.resolve().then(c.bind(c,53876)),Promise.resolve().then(c.bind(c,37364)),Promise.resolve().then(c.bind(c,94834)),Promise.resolve().then(c.bind(c,5644)),Promise.resolve().then(c.bind(c,9880)),Promise.resolve().then(c.bind(c,55152)),Promise.resolve().then(c.bind(c,98362)),Promise.resolve().then(c.bind(c,11847)),Promise.resolve().then(c.bind(c,50336)),Promise.resolve().then(c.bind(c,41112)),Promise.resolve().then(c.bind(c,73842)),Promise.resolve().then(c.bind(c,2782)),Promise.resolve().then(c.bind(c,33244)),Promise.resolve().then(c.bind(c,1732)),Promise.resolve().then(c.bind(c,98172)),Promise.resolve().then(c.bind(c,96966)),Promise.resolve().then(c.bind(c,60624)),Promise.resolve().then(c.bind(c,14138)),Promise.resolve().then(c.bind(c,9216)),Promise.resolve().then(c.bind(c,40676)),Promise.resolve().then(c.bind(c,79530)),Promise.resolve().then(c.bind(c,74898)),Promise.resolve().then(c.bind(c,82004)),Promise.resolve().then(c.bind(c,33098)),Promise.resolve().then(c.bind(c,54348)),Promise.resolve().then(c.bind(c,89114)),Promise.resolve().then(c.bind(c,99367)),Promise.resolve().then(c.bind(c,89267)),Promise.resolve().then(c.bind(c,36487)),Promise.resolve().then(c.bind(c,78827)),Promise.resolve().then(c.bind(c,52611)),Promise.resolve().then(c.bind(c,18243)),Promise.resolve().then(c.bind(c,20107)),Promise.resolve().then(c.bind(c,14819)),Promise.resolve().then(c.bind(c,65947)),Promise.resolve().then(c.bind(c,63043)),Promise.resolve().then(c.bind(c,52851)),Promise.resolve().then(c.bind(c,74461)),Promise.resolve().then(c.bind(c,54011)),Promise.resolve().then(c.bind(c,57879)),Promise.resolve().then(c.bind(c,94743)),Promise.resolve().then(c.bind(c,40223)),Promise.resolve().then(c.bind(c,66399)),Promise.resolve().then(c.bind(c,94147)),Promise.resolve().then(c.bind(c,43555)),Promise.resolve().then(c.bind(c,59268)),Promise.resolve().then(c.bind(c,36017)),Promise.resolve().then(c.bind(c,67955)),Promise.resolve().then(c.bind(c,32579)),Promise.resolve().then(c.bind(c,60161)),Promise.resolve().then(c.bind(c,66339)),Promise.resolve().then(c.bind(c,41544)),Promise.resolve().then(c.bind(c,88603)),Promise.resolve().then(c.bind(c,18507)),Promise.resolve().then(c.bind(c,67245)),Promise.resolve().then(c.bind(c,19437)),Promise.resolve().then(c.bind(c,54623)),Promise.resolve().then(c.bind(c,58951)),Promise.resolve().then(c.bind(c,36179)),Promise.resolve().then(c.bind(c,74083)),Promise.resolve().then(c.bind(c,75883)),Promise.resolve().then(c.bind(c,27651)),Promise.resolve().then(c.bind(c,51957)),Promise.resolve().then(c.bind(c,97229)),Promise.resolve().then(c.bind(c,35709)),Promise.resolve().then(c.bind(c,30389)),Promise.resolve().then(c.bind(c,10643)),Promise.resolve().then(c.bind(c,51211)),Promise.resolve().then(c.bind(c,7093)),Promise.resolve().then(c.bind(c,92795)),Promise.resolve().then(c.bind(c,29991)),Promise.resolve().then(c.bind(c,37635)),Promise.resolve().then(c.bind(c,58947)),Promise.resolve().then(c.bind(c,47303)),Promise.resolve().then(c.bind(c,21023)),Promise.resolve().then(c.bind(c,78897)),Promise.resolve().then(c.bind(c,25851)),Promise.resolve().then(c.bind(c,36005)),Promise.resolve().then(c.bind(c,72611)),Promise.resolve().then(c.bind(c,91903)),Promise.resolve().then(c.bind(c,99739)),Promise.resolve().then(c.bind(c,76295)),Promise.resolve().then(c.bind(c,67811)),Promise.resolve().then(c.bind(c,96421)),Promise.resolve().then(c.bind(c,50029)),Promise.resolve().then(c.bind(c,85671)),Promise.resolve().then(c.bind(c,39323)),Promise.resolve().then(c.bind(c,22787)),Promise.resolve().then(c.bind(c,19883)),Promise.resolve().then(c.bind(c,99269)),Promise.resolve().then(c.bind(c,42415)),Promise.resolve().then(c.bind(c,93477)),Promise.resolve().then(c.bind(c,74937)),Promise.resolve().then(c.bind(c,84407)),Promise.resolve().then(c.bind(c,56431)),Promise.resolve().then(c.bind(c,2819)),Promise.resolve().then(c.bind(c,9105)),Promise.resolve().then(c.bind(c,24739)),Promise.resolve().then(c.bind(c,90627)),Promise.resolve().then(c.bind(c,29131)),Promise.resolve().then(c.bind(c,99291)),Promise.resolve().then(c.bind(c,58639)),Promise.resolve().then(c.bind(c,3285)),Promise.resolve().then(c.bind(c,78265)),Promise.resolve().then(c.bind(c,86997)),Promise.resolve().then(c.bind(c,39377)),Promise.resolve().then(c.bind(c,90849)),Promise.resolve().then(c.bind(c,56109)),Promise.resolve().then(c.bind(c,63293))},81630:a=>{"use strict";a.exports=require("http")},86439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},91245:(a,b,c)=>{"use strict";c.d(b,{PatientTable:()=>f});var d=c(78157),e=c(49575);c(31768);let f=({patients:a})=>{let b=a.entry?.map(a=>(0,d.jsxs)(e.Table.Tr,{children:[(0,d.jsx)(e.Table.Td,{children:a.resource?.id}),(0,d.jsx)(e.Table.Td,{children:a.resource?.name?.[0].given?.[0]}),(0,d.jsx)(e.Table.Td,{children:a.resource?.name?.[0].family})]},a.resource?.id));return(0,d.jsxs)(e.Table,{children:[(0,d.jsx)(e.Table.Thead,{children:(0,d.jsxs)(e.Table.Tr,{children:[(0,d.jsx)(e.Table.Th,{children:"ID"}),(0,d.jsx)(e.Table.Th,{children:"Name"}),(0,d.jsx)(e.Table.Th,{children:"Family"})]})}),(0,d.jsx)(e.Table.Tbody,{children:b})]})}},94735:a=>{"use strict";a.exports=require("events")},98839:(a,b,c)=>{"use strict";c.d(b,{PatientTable:()=>d});let d=(0,c(25459).registerClientReference)(function(){throw Error("Attempted to call PatientTable() from the server but PatientTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/david/Projects/medplum/examples/medplum-nextauth-demo/app/components/PatientTable.tsx","PatientTable")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[586,777,512,257],()=>b(b.s=30191));module.exports=c})();