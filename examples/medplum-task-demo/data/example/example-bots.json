{
  "resourceType": "Bundle",
  "type": "transaction",
  "entry": [
    {
      "fullUrl": "urn:uuid:146feddc-7915-4ab3-800d-c98e312116cd",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/typescript",
        "data": "aW1wb3J0IHsgQm90RXZlbnQsIGdldFJlZmVyZW5jZVN0cmluZywgTWVkcGx1bUNsaWVudCB9IGZyb20gJ0BtZWRwbHVtL2NvcmUnOwppbXBvcnQgeyBEaWFnbm9zdGljUmVwb3J0LCBUYXNrIH0gZnJvbSAnQG1lZHBsdW0vZmhpcnR5cGVzJzsKCmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKG1lZHBsdW06IE1lZHBsdW1DbGllbnQsIGV2ZW50OiBCb3RFdmVudDxEaWFnbm9zdGljUmVwb3J0Pik6IFByb21pc2U8Ym9vbGVhbj4gewogIGNvbnN0IHJlcG9ydCA9IGV2ZW50LmlucHV0IGFzIERpYWdub3N0aWNSZXBvcnQ7CgogIGlmIChyZXBvcnQuc3RhdHVzICE9PSAncHJlbGltaW5hcnknKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuZXhwZWN0ZWQgaW5wdXQuIERpYWdub3N0aWNSZXBvcnQgbm90IGluIHByZWxpbWluYXJ5IHN0YXR1cycpOwogIH0KCiAgY29uc3QgdGFzazogVGFzayA9IHsKICAgIHJlc291cmNlVHlwZTogJ1Rhc2snLAogICAgY29kZTogewogICAgICB0ZXh0OiAnUmV2aWV3IERpYWdub3N0aWMgUmVwb3J0JywKICAgIH0sCiAgICBzdGF0dXM6ICdyZWFkeScsCiAgICBpbnRlbnQ6ICdvcmRlcicsCiAgICBmb2N1czogewogICAgICAvLyBUaGUgZm9jdXMgb2YgdGhlIHJlc291cmNlIHdpbGwgYmUgdGhlIERpYWdub3N0aWNSZXBvcnQKICAgICAgcmVmZXJlbmNlOiBnZXRSZWZlcmVuY2VTdHJpbmcocmVwb3J0KSwKICAgIH0sCiAgICBmb3I6IHJlcG9ydC5zdWJqZWN0LAogICAgLy8gVGhlIHBlcmZvcm1lciB0eXBlIGlzIGEgbWVkaWNhbCBwcmFjdGl0aW9uZXIuIFRoaXMgd2lsbCBlbnN1cmUgaXQgaXMgYXNzaWduZWQgdG8gdGhlIGNvcnJlY3QgcXVldWUgc28gYSBkb2N0b3IgY2FuIHJldmlldyBpdC4KICAgIHBlcmZvcm1lclR5cGU6IFsKICAgICAgewogICAgICAgIGNvZGluZzogWwogICAgICAgICAgewogICAgICAgICAgICBzeXN0ZW06ICdodHRwOi8vc25vbWVkLmluZm8vc2N0JywKICAgICAgICAgICAgY29kZTogJzE1ODk2NTAwMCcsCiAgICAgICAgICAgIGRpc3BsYXk6ICdNZWRpY2FsIHByYWN0aXRpb25lciAob2NjdXBhdGlvbiknLAogICAgICAgICAgfSwKICAgICAgICBdLAogICAgICB9LAogICAgXSwKICB9OwoKICAvLyBDcmVhdGUgdGhlIHRhc2sgYW5kIHBlcnNpc3QgdG8gdGhlIHNlcnZlcgogIGF3YWl0IG1lZHBsdW0uY3JlYXRlUmVzb3VyY2UodGFzayk7CiAgcmV0dXJuIHRydWU7Cn0K"
      }
    },
    {
      "fullUrl": "urn:uuid:e038a143-8c66-4b27-b69c-5430aeff6053",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/javascript",
        "data": "InVzZSBzdHJpY3QiOwpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwpleHBvcnRzLmhhbmRsZXIgPSB2b2lkIDA7CmNvbnN0IGNvcmVfMSA9IHJlcXVpcmUoIkBtZWRwbHVtL2NvcmUiKTsKYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihtZWRwbHVtLCBldmVudCkgewogICAgY29uc3QgcmVwb3J0ID0gZXZlbnQuaW5wdXQ7CiAgICBpZiAocmVwb3J0LnN0YXR1cyAhPT0gJ3ByZWxpbWluYXJ5JykgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVW5leHBlY3RlZCBpbnB1dC4gRGlhZ25vc3RpY1JlcG9ydCBub3QgaW4gcHJlbGltaW5hcnkgc3RhdHVzJyk7CiAgICB9CiAgICBjb25zdCB0YXNrID0gewogICAgICAgIHJlc291cmNlVHlwZTogJ1Rhc2snLAogICAgICAgIGNvZGU6IHsKICAgICAgICAgICAgdGV4dDogJ1JldmlldyBEaWFnbm9zdGljIFJlcG9ydCcsCiAgICAgICAgfSwKICAgICAgICBzdGF0dXM6ICdyZWFkeScsCiAgICAgICAgaW50ZW50OiAnb3JkZXInLAogICAgICAgIGZvY3VzOiB7CiAgICAgICAgICAgIC8vIFRoZSBmb2N1cyBvZiB0aGUgcmVzb3VyY2Ugd2lsbCBiZSB0aGUgRGlhZ25vc3RpY1JlcG9ydAogICAgICAgICAgICByZWZlcmVuY2U6ICgwLCBjb3JlXzEuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXBvcnQpLAogICAgICAgIH0sCiAgICAgICAgZm9yOiByZXBvcnQuc3ViamVjdCwKICAgICAgICAvLyBUaGUgcGVyZm9ybWVyIHR5cGUgaXMgYSBtZWRpY2FsIHByYWN0aXRpb25lci4gVGhpcyB3aWxsIGVuc3VyZSBpdCBpcyBhc3NpZ25lZCB0byB0aGUgY29ycmVjdCBxdWV1ZSBzbyBhIGRvY3RvciBjYW4gcmV2aWV3IGl0LgogICAgICAgIHBlcmZvcm1lclR5cGU6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgICAgY29kaW5nOiBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBzeXN0ZW06ICdodHRwOi8vc25vbWVkLmluZm8vc2N0JywKICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogJzE1ODk2NTAwMCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdNZWRpY2FsIHByYWN0aXRpb25lciAob2NjdXBhdGlvbiknLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICB9LAogICAgICAgIF0sCiAgICB9OwogICAgLy8gQ3JlYXRlIHRoZSB0YXNrIGFuZCBwZXJzaXN0IHRvIHRoZSBzZXJ2ZXIKICAgIGF3YWl0IG1lZHBsdW0uY3JlYXRlUmVzb3VyY2UodGFzayk7CiAgICByZXR1cm4gdHJ1ZTsKfQpleHBvcnRzLmhhbmRsZXIgPSBoYW5kbGVyOwovLyMgc291cmNlTWFwcGluZ1VSTD1jcmVhdGUtcmV2aWV3LXJlcG9ydC10YXNrLmpzLm1hcA=="
      }
    },
    {
      "request": {
        "url": "$bot-create-review-report-task-reference",
        "method": "PUT"
      },
      "resource": {
        "resourceType": "Bot",
        "id": "$bot-create-review-report-task-id",
        "name": "create-review-report-task",
        "runtimeVersion": "awslambda",
        "sourceCode": {
          "contentType": "text/typescript",
          "url": "urn:uuid:146feddc-7915-4ab3-800d-c98e312116cd"
        },
        "executableCode": {
          "contentType": "text/javascript",
          "url": "urn:uuid:e038a143-8c66-4b27-b69c-5430aeff6053"
        }
      }
    },
    {
      "request": {
        "url": "Subscription",
        "method": "POST",
        "ifNoneExist": "url=$bot-create-review-report-task-reference"
      },
      "resource": {
        "resourceType": "Subscription",
        "status": "active",
        "reason": "create-review-report-task",
        "channel": {
          "endpoint": "$bot-create-review-report-task-reference",
          "type": "rest-hook"
        },
        "criteria": "DiagnosticReport"
      }
    },
    {
      "fullUrl": "urn:uuid:067a72c8-f24a-44c1-8145-cc6aa3049037",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/typescript",
        "data": "aW1wb3J0IHsgZ2V0UmVmZXJlbmNlU3RyaW5nLCBNZWRwbHVtQ2xpZW50LCBwYXJzZVJlZmVyZW5jZSB9IGZyb20gJ0BtZWRwbHVtL2NvcmUnOwppbXBvcnQgeyBCdW5kbGUsIEJ1bmRsZUVudHJ5LCBDb21tdW5pY2F0aW9uLCBQcmFjdGl0aW9uZXIsIFJlZmVyZW5jZSwgUmVzb3VyY2VUeXBlLCBUYXNrIH0gZnJvbSAnQG1lZHBsdW0vZmhpcnR5cGVzJzsKCi8qKgogKiBUaGlzIGJvdCBjcmVhdGVzIGEgdGFzayBmb3IgYW55IG1lc3NhZ2VzIHRoYXQgaGF2ZSBub3QgYmVlbiByZXNwb25kZWQgdG8gaW4gMzAgbWludXRlcy4gSXQgaXMgc2V0IHRvIHJ1biBldmVyeSAxNSBtaW51dGVzLCBhbmQKICogb25seSBjcmVhdGUgb25lIHRhc2sgcGVyIHRocmVhZC4gSWYgYW4gZW1wbG95ZWUgaGFzIGFscmVhZHkgcmVzcG9uZGVkIHRvIHRoZSB0aHJlYWQsIGl0IHdpbGwgYXV0b21hdGljYWxseSBiZSBhc3NpZ25lZCB0byB0aGF0CiAqIGVtcGxveWVlLCBvdGhlcndpc2UgaXQgd2lsbCBiZSBhc3NpZ25lZCB0byB0aGUgQ2FyZSBDb29yZGluYXRvciBxdWV1ZS4KICoKICogQHBhcmFtIG1lZHBsdW0gLSBUaGUgbWVkcGx1bSBjbGllbnQKICogQHJldHVybnMgUHJvbWlzZTxhbnk+CiAqLwpleHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihtZWRwbHVtOiBNZWRwbHVtQ2xpZW50KTogUHJvbWlzZTxib29sZWFuPiB7CiAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpOwogIGNvbnN0IHRoaXJ0eU1pbnV0ZXNBZ28gPSBuZXcgRGF0ZShjdXJyZW50RGF0ZS5nZXRUaW1lKCkgLSAzMCAqIDYwICogMTAwMCkudG9JU09TdHJpbmcoKTsKCiAgLy8gR2V0IGFsbCBtZXNzYWdlcyB0aGF0IGFyZSBwYXJ0IG9mIGFuIGFjdGl2ZSB0aHJlYWQgYW5kIG9sZGVyIHRoYW4gMzAgbWludXRlcy4gRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gaG93IHRocmVhZHMgd29yayBzZWUgaHR0cHM6Ly93d3cubWVkcGx1bS5jb20vZG9jcy9jb21tdW5pY2F0aW9ucy9vcmdhbml6aW5nLWNvbW11bmljYXRpb25zCiAgY29uc3QgbWVzc2FnZXM6IENvbW11bmljYXRpb25bXSA9IGF3YWl0IG1lZHBsdW0uc2VhcmNoUmVzb3VyY2VzKCdDb21tdW5pY2F0aW9uJywgewogICAgc2VudDogYGx0JHt0aGlydHlNaW51dGVzQWdvfWAsCiAgICAncGFydC1vZjpDb21tdW5pY2F0aW9uLnN0YXR1cyc6ICdpbi1wcm9ncmVzcycsCiAgfSk7CgogIC8vIEZpbHRlciBmb3IgbWVzc2FnZXMgc2VudCBieSBwYXRpZW50cwogIGNvbnN0IHBhdGllbnRNZXNzYWdlcyA9IG1lc3NhZ2VzLmZpbHRlcigobWVzc2FnZSkgPT4gZ2V0TWVzc2FnZVNlbmRlclR5cGUobWVzc2FnZSkgPT09ICdQYXRpZW50Jyk7CgogIC8vIElmIG5vIG1lc3NhZ2VzIGZyb20gcGF0aWVudHMsIHJldHVybgogIGlmIChwYXRpZW50TWVzc2FnZXMubGVuZ3RoID09PSAwKSB7CiAgICBjb25zb2xlLmxvZygnTm8gbWVzc2FnZXMgaW4gdGhlIGxhc3QgMzAgbWludXRlcyB0aGF0IHJlcXVpcmUgYSByZXNwb25zZS4nKTsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIC8vIENyZWF0ZSBhbmQgZXhlY3V0ZSBhIGJhdGNoIHNlYXJjaCBmb3IgZmV0Y2ggYWxsIHRocmVhZCBtZXNzYWdlcwogIGNvbnN0IHRocmVhZE1lc3NhZ2VzID0gYXdhaXQgZmV0Y2hNZXNzYWdlVGhyZWFkcyhwYXRpZW50TWVzc2FnZXMsIG1lZHBsdW0pOwoKICBpZiAoIXRocmVhZE1lc3NhZ2VzLmVudHJ5KSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICAvLyBHbyB0aHJvdWdoIGVhY2ggdGhyZWFkIGFuZCBjcmVhdGUgYSB0YXNrIGlmIG5lY2Vzc2FyeQogIGZvciAoY29uc3QgZW50cnkgb2YgdGhyZWFkTWVzc2FnZXMuZW50cnkpIHsKICAgIGNvbnN0IHRocmVhZEJ1bmRsZSA9IGVudHJ5LnJlc291cmNlIGFzIEJ1bmRsZTsKICAgIGNvbnN0IHRocmVhZCA9IHRocmVhZEJ1bmRsZS5lbnRyeTsKICAgIGNvbnN0IG1vc3RSZWNlbnRNZXNzYWdlID0gdGhyZWFkPy5bMF0ucmVzb3VyY2UgYXMgQ29tbXVuaWNhdGlvbjsKICAgIGNvbnN0IHRocmVhZEhlYWRlciA9IG1vc3RSZWNlbnRNZXNzYWdlLnBhcnRPZj8uWzBdLnJlZmVyZW5jZTsKCiAgICAvLyBJZiB0aGUgbW9zdCByZWNlbnQgbWVzc2FnZSBpcyBub3QgYnkgYSBwYXRpZW50LCB0aGUgdGhyZWFkIGhhcyBiZWVuIHJlc3BvbmRlZCB0bywgYW5kIG5vIHRhc2sgc2hvdWxkIGJlIGNyZWF0ZWQKICAgIGlmIChnZXRNZXNzYWdlU2VuZGVyVHlwZShtb3N0UmVjZW50TWVzc2FnZSkgIT09ICdQYXRpZW50JyB8fCAhdGhyZWFkSGVhZGVyKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIC8vIENoZWNrIGlmIHRoZXJlIGlzIGFscmVhZHkgYW4gZXhpc3RpbmcgdGFzayB0byByZXNwb25kIHRvIHRoaXMgbWVzc2FnZQogICAgaWYgKGF3YWl0IGNoZWNrTm9FeGlzdGluZ1Rhc2sobWVkcGx1bSwgdGhyZWFkSGVhZGVyKSkgewogICAgICAvLyBHZXQgdGhlIG1vc3QgcmVjZW50IGVtcGxveWVlIHRvIHJlc3BvbmQgdG8gdGhpcyB0aHJlYWQsIGlmIGFueW9uZSBoYXMKICAgICAgY29uc3Qgc2VuZGVyID0gZ2V0TW9zdFJlY2VudFJlc3BvbmRlcihtZXNzYWdlcykgYXMgUmVmZXJlbmNlPFByYWN0aXRpb25lcj4gfCB1bmRlZmluZWQ7CgogICAgICAvLyBEZWZpbmUgYSB0YXNrIHRvIHJlc3BvbmQgdG8gdGhlIG1lc3NhZ2UKICAgICAgY29uc3QgdGFzazogVGFzayA9IHsKICAgICAgICByZXNvdXJjZVR5cGU6ICdUYXNrJywKICAgICAgICBmb2N1czogewogICAgICAgICAgcmVmZXJlbmNlOiB0aHJlYWRIZWFkZXIsCiAgICAgICAgfSwKICAgICAgICBjb2RlOiB7CiAgICAgICAgICB0ZXh0OiAnUmVzcG9uZCB0byBNZXNzYWdlJywKICAgICAgICB9LAogICAgICAgIHN0YXR1czogJ3JlYWR5JywKICAgICAgICBpbnRlbnQ6ICdvcmRlcicsCiAgICAgIH07CgogICAgICAvLyBJZiBzb21lYm9keSBoYXMgYWxyZWFkeSByZXNwb25kZWQgdG8gdGhpcyB0aHJlYWQsIGFzc2lnbiB0aGUgdGFzayB0byB0aGVtLCBvdGhlcndpc2UgYXNzaWduIHRvIGNhcmUgY29vcmRpbmF0b3IgcXVldWUKICAgICAgaWYgKHNlbmRlcikgewogICAgICAgIHRhc2sub3duZXIgPSBzZW5kZXI7CiAgICAgICAgY29uc29sZS5sb2coJ0Fzc2lnbmVkIHRvIG1vc3QgcmVjZW50IHJlc3BvbmRlcicpOwogICAgICB9IGVsc2UgewogICAgICAgIHRhc2sucGVyZm9ybWVyVHlwZSA9IFsKICAgICAgICAgIHsKICAgICAgICAgICAgY29kaW5nOiBbCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc3lzdGVtOiAnaHR0cDovL3Nub21lZC5pbmZvL3NjdCcsCiAgICAgICAgICAgICAgICBjb2RlOiAnNzY4ODIwMDAzJywKICAgICAgICAgICAgICAgIGRpc3BsYXk6ICdDYXJlIENvb3JkaW5hdG9yJywKICAgICAgICAgICAgICB9LAogICAgICAgICAgICBdLAogICAgICAgICAgfSwKICAgICAgICBdOwogICAgICAgIGNvbnNvbGUubG9nKCdBc3NpZ25lZCB0byBjYXJlIGNvb3JkaW5hdG9yIHF1ZXVlJyk7CiAgICAgIH0KCiAgICAgIGF3YWl0IG1lZHBsdW0uY3JlYXRlUmVzb3VyY2UodGFzaykudGhlbigocmVzdWx0KSA9PiBjb25zb2xlLmxvZyhyZXN1bHQpKTsKICAgICAgY29uc29sZS5sb2coJ1Rhc2sgY3JlYXRlZCcpOwogICAgfSBlbHNlIHsKICAgICAgY29uc29sZS5sb2coJ1Rhc2sgYWxyZWFkeSBleGlzdHMgZm9yIHRoaXMgdGhyZWFkLicpOwogICAgfQogIH0KCiAgcmV0dXJuIHRydWU7Cn0KCi8vIEdldHMgdGhlIG1vc3QgcmVjZW50IHByYWN0aXRpb25lciB0byBoYXZlIHJlc3BvbmRlZCB0byBhIHRocmVhZApmdW5jdGlvbiBnZXRNb3N0UmVjZW50UmVzcG9uZGVyKHRocmVhZDogQ29tbXVuaWNhdGlvbltdKTogUmVmZXJlbmNlPFByYWN0aXRpb25lcj4gfCB1bmRlZmluZWQgewogIGZvciAoY29uc3QgbWVzc2FnZSBvZiB0aHJlYWQpIHsKICAgIGNvbnN0IHNlbmRlclR5cGUgPSBnZXRNZXNzYWdlU2VuZGVyVHlwZShtZXNzYWdlKTsKICAgIGlmIChzZW5kZXJUeXBlID09PSAnUHJhY3RpdGlvbmVyJykgewogICAgICByZXR1cm4gbWVzc2FnZS5zZW5kZXIgYXMgUmVmZXJlbmNlPFByYWN0aXRpb25lcj47CiAgICB9CiAgfQoKICByZXR1cm4gdW5kZWZpbmVkOwp9CgovLyBDaGVja3MgdGhhdCB0aGVyZSBpc24ndCBhbHJlYWR5IGEgdGFzayBhc3NpZ25lZCB0byB0aGUgdGhyZWFkCmFzeW5jIGZ1bmN0aW9uIGNoZWNrTm9FeGlzdGluZ1Rhc2sobWVkcGx1bTogTWVkcGx1bUNsaWVudCwgdGhyZWFkSGVhZGVyOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHsKICBjb25zdCBleGlzdGluZ1Rhc2tzID0gYXdhaXQgbWVkcGx1bS5zZWFyY2hSZXNvdXJjZXMoJ1Rhc2snLCB7CiAgICBmb2N1czogdGhyZWFkSGVhZGVyLAogICAgJ3N0YXR1czpub3QnOiAnY29tcGxldGUnLAogIH0pOwoKICBpZiAoZXhpc3RpbmdUYXNrcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB0cnVlOwogIH0gZWxzZSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9CgovLyBCdWlsZHMgYSBzZWFyY2ggYnVuZGxlIHRvIGdldCBhbGwgdGhlIG1lc3NhZ2VzIGZyb20gbXVsdGlwbGUgdGhyZWFkcyBpbiBvbmUgYmF0Y2ggcmVxdWVzdAphc3luYyBmdW5jdGlvbiBmZXRjaE1lc3NhZ2VUaHJlYWRzKG1lc3NhZ2VzOiBDb21tdW5pY2F0aW9uW10sIG1lZHBsdW06IE1lZHBsdW1DbGllbnQpOiBQcm9taXNlPEJ1bmRsZT4gewogIGNvbnN0IHJlcXVlc3RCdW5kbGU6IEJ1bmRsZSA9IHsKICAgIHJlc291cmNlVHlwZTogJ0J1bmRsZScsCiAgICB0eXBlOiAnYmF0Y2gnLAogIH07CgogIGNvbnN0IHRocmVhZHMgPSBuZXcgU2V0KCk7CgogIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlcykgewogICAgaWYgKCFtZXNzYWdlLnBhcnRPZikgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIC8vIEdldCB0aGUgcGFyZW50IGNvbW11bmljYXRpb24gcmVwcmVzZW50aW5nIHRoZSB0aHJlYWQKICAgIGNvbnN0IHBhcnRPZiA9IG1lc3NhZ2UucGFydE9mOwoKICAgIGNvbnN0IHRocmVhZEhlYWRlciA9IHBhcnRPZi5maWx0ZXIoKHJlZmVyZW5jZSkgPT4gcGFyc2VSZWZlcmVuY2UocmVmZXJlbmNlKT8uWzBdID09PSAnQ29tbXVuaWNhdGlvbicpWzBdOwoKICAgIGNvbnN0IHRocmVhZEhlYWRlclJlZmVyZW5jZSA9IGdldFJlZmVyZW5jZVN0cmluZyh0aHJlYWRIZWFkZXIpOwoKICAgIGlmICghdGhyZWFkcy5oYXModGhyZWFkSGVhZGVyUmVmZXJlbmNlKSkgewogICAgICB0aHJlYWRzLmFkZCh0aHJlYWRIZWFkZXJSZWZlcmVuY2UpOwogICAgICAvLyBRdWVyeSBmb3IgYWxsIG9mIHRoZSBtZXNzYWdlcyBpbiB0aGUgdGhyZWFkCiAgICAgIGNvbnN0IHNlYXJjaFF1ZXJ5ID0gYENvbW11bmljYXRpb24/cGFydC1vZj0ke3RocmVhZEhlYWRlclJlZmVyZW5jZX0mX3NvcnQ9LXNlbnRgOwoKICAgICAgLy8gQWRkIHRoZSBzZWFyY2ggdG8gYSBidW5kbGUgdG8gZXhlY3V0ZSBhIGJhdGNoIHJlcXVlc3QgdG8gZ2V0IGFsbCB0aHJlYWRzIHdpdGggbWVzc2FnZXMgdGhhdCBoYXZlbid0IGJlZW4gcmVzcG9uZGVkIHRvCiAgICAgIGNvbnN0IGVudHJ5OiBCdW5kbGVFbnRyeSA9IHsKICAgICAgICByZXF1ZXN0OiB7CiAgICAgICAgICBtZXRob2Q6ICdHRVQnLAogICAgICAgICAgdXJsOiBzZWFyY2hRdWVyeSwKICAgICAgICB9LAogICAgICB9OwoKICAgICAgaWYgKHJlcXVlc3RCdW5kbGUuZW50cnkpIHsKICAgICAgICByZXF1ZXN0QnVuZGxlLmVudHJ5LnB1c2goZW50cnkpOwogICAgICB9IGVsc2UgewogICAgICAgIHJlcXVlc3RCdW5kbGUuZW50cnkgPSBbZW50cnldOwogICAgICB9CiAgICB9CiAgfQoKICBjb25zdCBtZXNzYWdlVGhyZWFkcyA9IGF3YWl0IG1lZHBsdW0uZXhlY3V0ZUJhdGNoKHJlcXVlc3RCdW5kbGUpOwogIHJldHVybiBtZXNzYWdlVGhyZWFkczsKfQoKLy8gUmV0dXJucyB0aGUgUmVzb3VyY2VUeXBlIHRoYXQgc2VudCBhIG1lc3NhZ2UKZnVuY3Rpb24gZ2V0TWVzc2FnZVNlbmRlclR5cGUobWVzc2FnZTogQ29tbXVuaWNhdGlvbik6IFJlc291cmNlVHlwZSB8IHVuZGVmaW5lZCB7CiAgY29uc3Qgc2VuZGVyID0gbWVzc2FnZS5zZW5kZXI7CiAgaWYgKCFzZW5kZXIpIHsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQoKICBjb25zdCBzZW5kZXJSZWZlcmVuY2UgPSBwYXJzZVJlZmVyZW5jZShzZW5kZXIpOwoKICByZXR1cm4gc2VuZGVyUmVmZXJlbmNlPy5bMF07Cn0K"
      }
    },
    {
      "fullUrl": "urn:uuid:a97b0a11-3e9f-42cd-af63-c33a736145b8",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/javascript",
        "data": "InVzZSBzdHJpY3QiOwpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7IHZhbHVlOiB0cnVlIH0pOwpleHBvcnRzLmhhbmRsZXIgPSB2b2lkIDA7CmNvbnN0IGNvcmVfMSA9IHJlcXVpcmUoIkBtZWRwbHVtL2NvcmUiKTsKLyoqCiAqIFRoaXMgYm90IGNyZWF0ZXMgYSB0YXNrIGZvciBhbnkgbWVzc2FnZXMgdGhhdCBoYXZlIG5vdCBiZWVuIHJlc3BvbmRlZCB0byBpbiAzMCBtaW51dGVzLiBJdCBpcyBzZXQgdG8gcnVuIGV2ZXJ5IDE1IG1pbnV0ZXMsIGFuZAogKiBvbmx5IGNyZWF0ZSBvbmUgdGFzayBwZXIgdGhyZWFkLiBJZiBhbiBlbXBsb3llZSBoYXMgYWxyZWFkeSByZXNwb25kZWQgdG8gdGhlIHRocmVhZCwgaXQgd2lsbCBhdXRvbWF0aWNhbGx5IGJlIGFzc2lnbmVkIHRvIHRoYXQKICogZW1wbG95ZWUsIG90aGVyd2lzZSBpdCB3aWxsIGJlIGFzc2lnbmVkIHRvIHRoZSBDYXJlIENvb3JkaW5hdG9yIHF1ZXVlLgogKgogKiBAcGFyYW0gbWVkcGx1bSAtIFRoZSBtZWRwbHVtIGNsaWVudAogKiBAcmV0dXJucyBQcm9taXNlPGFueT4KICovCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIobWVkcGx1bSkgewogICAgdmFyIF9hOwogICAgY29uc3QgY3VycmVudERhdGUgPSBuZXcgRGF0ZSgpOwogICAgY29uc3QgdGhpcnR5TWludXRlc0FnbyA9IG5ldyBEYXRlKGN1cnJlbnREYXRlLmdldFRpbWUoKSAtIDMwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpOwogICAgLy8gR2V0IGFsbCBtZXNzYWdlcyB0aGF0IGFyZSBwYXJ0IG9mIGFuIGFjdGl2ZSB0aHJlYWQgYW5kIG9sZGVyIHRoYW4gMzAgbWludXRlcy4gRm9yIG1vcmUgaW5mb3JtYXRpb24gb24gaG93IHRocmVhZHMgd29yayBzZWUgaHR0cHM6Ly93d3cubWVkcGx1bS5jb20vZG9jcy9jb21tdW5pY2F0aW9ucy9vcmdhbml6aW5nLWNvbW11bmljYXRpb25zCiAgICBjb25zdCBtZXNzYWdlcyA9IGF3YWl0IG1lZHBsdW0uc2VhcmNoUmVzb3VyY2VzKCdDb21tdW5pY2F0aW9uJywgewogICAgICAgIHNlbnQ6IGBsdCR7dGhpcnR5TWludXRlc0Fnb31gLAogICAgICAgICdwYXJ0LW9mOkNvbW11bmljYXRpb24uc3RhdHVzJzogJ2luLXByb2dyZXNzJywKICAgIH0pOwogICAgLy8gRmlsdGVyIGZvciBtZXNzYWdlcyBzZW50IGJ5IHBhdGllbnRzCiAgICBjb25zdCBwYXRpZW50TWVzc2FnZXMgPSBtZXNzYWdlcy5maWx0ZXIoKG1lc3NhZ2UpID0+IGdldE1lc3NhZ2VTZW5kZXJUeXBlKG1lc3NhZ2UpID09PSAnUGF0aWVudCcpOwogICAgLy8gSWYgbm8gbWVzc2FnZXMgZnJvbSBwYXRpZW50cywgcmV0dXJuCiAgICBpZiAocGF0aWVudE1lc3NhZ2VzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNvbnNvbGUubG9nKCdObyBtZXNzYWdlcyBpbiB0aGUgbGFzdCAzMCBtaW51dGVzIHRoYXQgcmVxdWlyZSBhIHJlc3BvbnNlLicpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8vIENyZWF0ZSBhbmQgZXhlY3V0ZSBhIGJhdGNoIHNlYXJjaCBmb3IgZmV0Y2ggYWxsIHRocmVhZCBtZXNzYWdlcwogICAgY29uc3QgdGhyZWFkTWVzc2FnZXMgPSBhd2FpdCBmZXRjaE1lc3NhZ2VUaHJlYWRzKHBhdGllbnRNZXNzYWdlcywgbWVkcGx1bSk7CiAgICBpZiAoIXRocmVhZE1lc3NhZ2VzLmVudHJ5KSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLy8gR28gdGhyb3VnaCBlYWNoIHRocmVhZCBhbmQgY3JlYXRlIGEgdGFzayBpZiBuZWNlc3NhcnkKICAgIGZvciAoY29uc3QgZW50cnkgb2YgdGhyZWFkTWVzc2FnZXMuZW50cnkpIHsKICAgICAgICBjb25zdCB0aHJlYWRCdW5kbGUgPSBlbnRyeS5yZXNvdXJjZTsKICAgICAgICBjb25zdCB0aHJlYWQgPSB0aHJlYWRCdW5kbGUuZW50cnk7CiAgICAgICAgY29uc3QgbW9zdFJlY2VudE1lc3NhZ2UgPSB0aHJlYWQgPT09IG51bGwgfHwgdGhyZWFkID09PSB2b2lkIDAgPyB2b2lkIDAgOiB0aHJlYWRbMF0ucmVzb3VyY2U7CiAgICAgICAgY29uc3QgdGhyZWFkSGVhZGVyID0gKF9hID0gbW9zdFJlY2VudE1lc3NhZ2UucGFydE9mKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2FbMF0ucmVmZXJlbmNlOwogICAgICAgIC8vIElmIHRoZSBtb3N0IHJlY2VudCBtZXNzYWdlIGlzIG5vdCBieSBhIHBhdGllbnQsIHRoZSB0aHJlYWQgaGFzIGJlZW4gcmVzcG9uZGVkIHRvLCBhbmQgbm8gdGFzayBzaG91bGQgYmUgY3JlYXRlZAogICAgICAgIGlmIChnZXRNZXNzYWdlU2VuZGVyVHlwZShtb3N0UmVjZW50TWVzc2FnZSkgIT09ICdQYXRpZW50JyB8fCAhdGhyZWFkSGVhZGVyKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICAvLyBDaGVjayBpZiB0aGVyZSBpcyBhbHJlYWR5IGFuIGV4aXN0aW5nIHRhc2sgdG8gcmVzcG9uZCB0byB0aGlzIG1lc3NhZ2UKICAgICAgICBpZiAoYXdhaXQgY2hlY2tOb0V4aXN0aW5nVGFzayhtZWRwbHVtLCB0aHJlYWRIZWFkZXIpKSB7CiAgICAgICAgICAgIC8vIEdldCB0aGUgbW9zdCByZWNlbnQgZW1wbG95ZWUgdG8gcmVzcG9uZCB0byB0aGlzIHRocmVhZCwgaWYgYW55b25lIGhhcwogICAgICAgICAgICBjb25zdCBzZW5kZXIgPSBnZXRNb3N0UmVjZW50UmVzcG9uZGVyKG1lc3NhZ2VzKTsKICAgICAgICAgICAgLy8gRGVmaW5lIGEgdGFzayB0byByZXNwb25kIHRvIHRoZSBtZXNzYWdlCiAgICAgICAgICAgIGNvbnN0IHRhc2sgPSB7CiAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGU6ICdUYXNrJywKICAgICAgICAgICAgICAgIGZvY3VzOiB7CiAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlOiB0aHJlYWRIZWFkZXIsCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgY29kZTogewogICAgICAgICAgICAgICAgICAgIHRleHQ6ICdSZXNwb25kIHRvIE1lc3NhZ2UnLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIHN0YXR1czogJ3JlYWR5JywKICAgICAgICAgICAgICAgIGludGVudDogJ29yZGVyJywKICAgICAgICAgICAgfTsKICAgICAgICAgICAgLy8gSWYgc29tZWJvZHkgaGFzIGFscmVhZHkgcmVzcG9uZGVkIHRvIHRoaXMgdGhyZWFkLCBhc3NpZ24gdGhlIHRhc2sgdG8gdGhlbSwgb3RoZXJ3aXNlIGFzc2lnbiB0byBjYXJlIGNvb3JkaW5hdG9yIHF1ZXVlCiAgICAgICAgICAgIGlmIChzZW5kZXIpIHsKICAgICAgICAgICAgICAgIHRhc2sub3duZXIgPSBzZW5kZXI7CiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQXNzaWduZWQgdG8gbW9zdCByZWNlbnQgcmVzcG9uZGVyJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0YXNrLnBlcmZvcm1lclR5cGUgPSBbCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBjb2Rpbmc6IFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzeXN0ZW06ICdodHRwOi8vc25vbWVkLmluZm8vc2N0JywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2RlOiAnNzY4ODIwMDAzJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnQ2FyZSBDb29yZGluYXRvcicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBdOwogICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0Fzc2lnbmVkIHRvIGNhcmUgY29vcmRpbmF0b3IgcXVldWUnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBhd2FpdCBtZWRwbHVtLmNyZWF0ZVJlc291cmNlKHRhc2spLnRoZW4oKHJlc3VsdCkgPT4gY29uc29sZS5sb2cocmVzdWx0KSk7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUYXNrIGNyZWF0ZWQnKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdUYXNrIGFscmVhZHkgZXhpc3RzIGZvciB0aGlzIHRocmVhZC4nKTsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKfQpleHBvcnRzLmhhbmRsZXIgPSBoYW5kbGVyOwovLyBHZXRzIHRoZSBtb3N0IHJlY2VudCBwcmFjdGl0aW9uZXIgdG8gaGF2ZSByZXNwb25kZWQgdG8gYSB0aHJlYWQKZnVuY3Rpb24gZ2V0TW9zdFJlY2VudFJlc3BvbmRlcih0aHJlYWQpIHsKICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiB0aHJlYWQpIHsKICAgICAgICBjb25zdCBzZW5kZXJUeXBlID0gZ2V0TWVzc2FnZVNlbmRlclR5cGUobWVzc2FnZSk7CiAgICAgICAgaWYgKHNlbmRlclR5cGUgPT09ICdQcmFjdGl0aW9uZXInKSB7CiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlLnNlbmRlcjsKICAgICAgICB9CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwp9Ci8vIENoZWNrcyB0aGF0IHRoZXJlIGlzbid0IGFscmVhZHkgYSB0YXNrIGFzc2lnbmVkIHRvIHRoZSB0aHJlYWQKYXN5bmMgZnVuY3Rpb24gY2hlY2tOb0V4aXN0aW5nVGFzayhtZWRwbHVtLCB0aHJlYWRIZWFkZXIpIHsKICAgIGNvbnN0IGV4aXN0aW5nVGFza3MgPSBhd2FpdCBtZWRwbHVtLnNlYXJjaFJlc291cmNlcygnVGFzaycsIHsKICAgICAgICBmb2N1czogdGhyZWFkSGVhZGVyLAogICAgICAgICdzdGF0dXM6bm90JzogJ2NvbXBsZXRlJywKICAgIH0pOwogICAgaWYgKGV4aXN0aW5nVGFza3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9Cn0KLy8gQnVpbGRzIGEgc2VhcmNoIGJ1bmRsZSB0byBnZXQgYWxsIHRoZSBtZXNzYWdlcyBmcm9tIG11bHRpcGxlIHRocmVhZHMgaW4gb25lIGJhdGNoIHJlcXVlc3QKYXN5bmMgZnVuY3Rpb24gZmV0Y2hNZXNzYWdlVGhyZWFkcyhtZXNzYWdlcywgbWVkcGx1bSkgewogICAgY29uc3QgcmVxdWVzdEJ1bmRsZSA9IHsKICAgICAgICByZXNvdXJjZVR5cGU6ICdCdW5kbGUnLAogICAgICAgIHR5cGU6ICdiYXRjaCcsCiAgICB9OwogICAgY29uc3QgdGhyZWFkcyA9IG5ldyBTZXQoKTsKICAgIGZvciAoY29uc3QgbWVzc2FnZSBvZiBtZXNzYWdlcykgewogICAgICAgIGlmICghbWVzc2FnZS5wYXJ0T2YpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIC8vIEdldCB0aGUgcGFyZW50IGNvbW11bmljYXRpb24gcmVwcmVzZW50aW5nIHRoZSB0aHJlYWQKICAgICAgICBjb25zdCBwYXJ0T2YgPSBtZXNzYWdlLnBhcnRPZjsKICAgICAgICBjb25zdCB0aHJlYWRIZWFkZXIgPSBwYXJ0T2YuZmlsdGVyKChyZWZlcmVuY2UpID0+IHsgdmFyIF9hOyByZXR1cm4gKChfYSA9ICgwLCBjb3JlXzEucGFyc2VSZWZlcmVuY2UpKHJlZmVyZW5jZSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVswXSkgPT09ICdDb21tdW5pY2F0aW9uJzsgfSlbMF07CiAgICAgICAgY29uc3QgdGhyZWFkSGVhZGVyUmVmZXJlbmNlID0gKDAsIGNvcmVfMS5nZXRSZWZlcmVuY2VTdHJpbmcpKHRocmVhZEhlYWRlcik7CiAgICAgICAgaWYgKCF0aHJlYWRzLmhhcyh0aHJlYWRIZWFkZXJSZWZlcmVuY2UpKSB7CiAgICAgICAgICAgIHRocmVhZHMuYWRkKHRocmVhZEhlYWRlclJlZmVyZW5jZSk7CiAgICAgICAgICAgIC8vIFF1ZXJ5IGZvciBhbGwgb2YgdGhlIG1lc3NhZ2VzIGluIHRoZSB0aHJlYWQKICAgICAgICAgICAgY29uc3Qgc2VhcmNoUXVlcnkgPSBgQ29tbXVuaWNhdGlvbj9wYXJ0LW9mPSR7dGhyZWFkSGVhZGVyUmVmZXJlbmNlfSZfc29ydD0tc2VudGA7CiAgICAgICAgICAgIC8vIEFkZCB0aGUgc2VhcmNoIHRvIGEgYnVuZGxlIHRvIGV4ZWN1dGUgYSBiYXRjaCByZXF1ZXN0IHRvIGdldCBhbGwgdGhyZWFkcyB3aXRoIG1lc3NhZ2VzIHRoYXQgaGF2ZW4ndCBiZWVuIHJlc3BvbmRlZCB0bwogICAgICAgICAgICBjb25zdCBlbnRyeSA9IHsKICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHsKICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLAogICAgICAgICAgICAgICAgICAgIHVybDogc2VhcmNoUXVlcnksCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAocmVxdWVzdEJ1bmRsZS5lbnRyeSkgewogICAgICAgICAgICAgICAgcmVxdWVzdEJ1bmRsZS5lbnRyeS5wdXNoKGVudHJ5KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHJlcXVlc3RCdW5kbGUuZW50cnkgPSBbZW50cnldOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfQogICAgY29uc3QgbWVzc2FnZVRocmVhZHMgPSBhd2FpdCBtZWRwbHVtLmV4ZWN1dGVCYXRjaChyZXF1ZXN0QnVuZGxlKTsKICAgIHJldHVybiBtZXNzYWdlVGhyZWFkczsKfQovLyBSZXR1cm5zIHRoZSBSZXNvdXJjZVR5cGUgdGhhdCBzZW50IGEgbWVzc2FnZQpmdW5jdGlvbiBnZXRNZXNzYWdlU2VuZGVyVHlwZShtZXNzYWdlKSB7CiAgICBjb25zdCBzZW5kZXIgPSBtZXNzYWdlLnNlbmRlcjsKICAgIGlmICghc2VuZGVyKSB7CiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGNvbnN0IHNlbmRlclJlZmVyZW5jZSA9ICgwLCBjb3JlXzEucGFyc2VSZWZlcmVuY2UpKHNlbmRlcik7CiAgICByZXR1cm4gc2VuZGVyUmVmZXJlbmNlID09PSBudWxsIHx8IHNlbmRlclJlZmVyZW5jZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogc2VuZGVyUmVmZXJlbmNlWzBdOwp9Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWNyZWF0ZS1yZXNwb25kLXRvLW1lc3NhZ2UtdGFzay5qcy5tYXA="
      }
    },
    {
      "request": {
        "url": "$bot-create-respond-to-message-task-reference",
        "method": "PUT"
      },
      "resource": {
        "resourceType": "Bot",
        "id": "$bot-create-respond-to-message-task-id",
        "name": "create-respond-to-message-task",
        "runtimeVersion": "awslambda",
        "sourceCode": {
          "contentType": "text/typescript",
          "url": "urn:uuid:067a72c8-f24a-44c1-8145-cc6aa3049037"
        },
        "executableCode": {
          "contentType": "text/javascript",
          "url": "urn:uuid:a97b0a11-3e9f-42cd-af63-c33a736145b8"
        }
      }
    },
    {
      "request": {
        "url": "Subscription",
        "method": "POST",
        "ifNoneExist": "url=$bot-create-respond-to-message-task-reference"
      },
      "resource": {
        "resourceType": "Subscription",
        "status": "active",
        "reason": "create-respond-to-message-task",
        "channel": {
          "endpoint": "$bot-create-respond-to-message-task-reference",
          "type": "rest-hook"
        },
        "criteria": "Communication?part-of:missing=true"
      }
    }
  ]
}