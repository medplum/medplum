{
  "resourceType": "Bundle",
  "type": "transaction",
  "entry": [
    {
      "fullUrl": "urn:uuid:1b308ecb-22d0-425e-9891-1df976ac92de",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/typescript",
        "data": "aW1wb3J0IHsgQm90RXZlbnQsIGdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzLCBNZWRwbHVtQ2xpZW50IH0gZnJvbSAnQG1lZHBsdW0vY29yZSc7CmltcG9ydCB7CiAgQnVuZGxlLAogIENsaW5pY2FsSW1wcmVzc2lvbiwKICBDb2RlYWJsZUNvbmNlcHQsCiAgQ29uZGl0aW9uLAogIEVuY291bnRlciwKICBPYnNlcnZhdGlvbiwKICBQcmFjdGl0aW9uZXIsCiAgUXVlc3Rpb25uYWlyZVJlc3BvbnNlLAogIFJlZmVyZW5jZSwKfSBmcm9tICdAbWVkcGx1bS9maGlydHlwZXMnOwppbXBvcnQgewogIGNyZWF0ZUJ1bmRsZSwKICBjcmVhdGVDbGluaWNhbEltcHJlc3Npb25zLAogIGNyZWF0ZUNvbmRpdGlvbnMsCiAgY3JlYXRlT2JzZXJ2YXRpb25zLAogIE9ic2VydmF0aW9uRGF0YSwKfSBmcm9tICcuL2NoYXJ0aW5nLXV0aWxzJzsKaW1wb3J0IHsgY2FsY3VsYXRlQk1JIH0gZnJvbSAnLi9vYnNlcnZhdGlvbi11dGlscyc7CgpleHBvcnQgaW50ZXJmYWNlIEdlbmVyYWxPYnNlcnZhdGlvbkRhdGEgZXh0ZW5kcyBPYnNlcnZhdGlvbkRhdGEgewogIGhvdEZsYXNoPzogYm9vbGVhbjsKICBtb29kU3dpbmdzPzogYm9vbGVhbjsKICB2YWdpbmFsRHJ5bmVzcz86IGJvb2xlYW47CiAgc2xlZXBEaXN0dXJiYW5jZT86IGJvb2xlYW47CiAgc2VsZlJlcG9ydGVkSGlzdG9yeT86IHN0cmluZzsKfQoKZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoZXZlbnQ6IEJvdEV2ZW50PFF1ZXN0aW9ubmFpcmVSZXNwb25zZT4sIG1lZHBsdW06IE1lZHBsdW1DbGllbnQpOiBQcm9taXNlPEJ1bmRsZT4gewogIC8vIFBhcnNlIHRoZSBhbnN3ZXJzIGZyb20gdGhlIFF1ZXN0aW9ubmFpcmVSZXNwb25zZQogIGNvbnN0IHJlc3BvbnNlID0gZXZlbnQuaW5wdXQ7CiAgY29uc3QgYW5zd2VycyA9IGdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzKHJlc3BvbnNlKTsKICAvLyBHZXQgdGhlIGxpbmtlZCBlbmNvdW50ZXIgYW5kIHRoZSB1c2VyIHdobyBpbml0aWF0ZWQgdGhlIGJvdAogIGNvbnN0IGVuY291bnRlciA9IGF3YWl0IG1lZHBsdW0ucmVhZFJlZmVyZW5jZShyZXNwb25zZS5lbmNvdW50ZXIgYXMgUmVmZXJlbmNlPEVuY291bnRlcj4pOwogIGNvbnN0IHVzZXIgPSBtZWRwbHVtLmdldFByb2ZpbGUoKSBhcyBQcmFjdGl0aW9uZXI7CgogIC8vIFJlYXNvbiBmb3IgdmlzaXQgaXMgYSByZXF1aXJlZCBhbnN3ZXIsIHNvIGlmIGl0IGlzIG1pc3NpbmcgdGhyb3cgYW4gZXJyb3IKICBpZiAoIWFuc3dlcnNbJ3JlYXNvbi1mb3ItdmlzaXQnXT8udmFsdWVDb2RpbmcpIHsKICAgIHRocm93IG5ldyBFcnJvcignTXVzdCBwcm92aWRlIGEgcmVhc29uIGZvciB0aGUgdmlzaXQnKTsKICB9CgogIC8vIFBhcnNlIHRoZSBhbnN3ZXJzIGludG8gbW9yZSBlYXNpbHkgdXNhYmxlIG9iamVjdHMKICBjb25zdCBvYnNlcnZhdGlvbkRhdGE6IEdlbmVyYWxPYnNlcnZhdGlvbkRhdGEgPSB7CiAgICBibG9vZFByZXNzdXJlOiB7CiAgICAgIGRpYXN0b2xpYzogYW5zd2Vyc1snZGlhc3RvbGljJ10/LnZhbHVlSW50ZWdlciwKICAgICAgc3lzdG9saWM6IGFuc3dlcnNbJ3N5c3RvbGljJ10/LnZhbHVlSW50ZWdlciwKICAgIH0sCiAgICBoZWlnaHQ6IGFuc3dlcnNbJ2hlaWdodCddPy52YWx1ZVF1YW50aXR5LAogICAgd2VpZ2h0OiBhbnN3ZXJzWyd3ZWlnaHQnXT8udmFsdWVRdWFudGl0eSwKICAgIGhvdEZsYXNoOiBhbnN3ZXJzWydob3QtZmxhc2hlcyddPy52YWx1ZUJvb2xlYW4sCiAgICBtb29kU3dpbmdzOiBhbnN3ZXJzWydtb29kLXN3aW5ncyddPy52YWx1ZUJvb2xlYW4sCiAgICB2YWdpbmFsRHJ5bmVzczogYW5zd2Vyc1sndmFnaW5hbC1kcnluZXNzJ10/LnZhbHVlQm9vbGVhbiwKICAgIHNsZWVwRGlzdHVyYmFuY2U6IGFuc3dlcnNbJ3NsZWVwLWRpc3R1cmJhbmNlJ10/LnZhbHVlQm9vbGVhbiwKICAgIHNlbGZSZXBvcnRlZEhpc3Rvcnk6IGFuc3dlcnNbJ3NlbGYtcmVwb3J0ZWQtaGlzdG9yeSddPy52YWx1ZVN0cmluZywKICAgIGRhdGU6IGFuc3dlcnNbJ2RhdGUnXT8udmFsdWVEYXRlVGltZSwKICB9OwoKICBpZiAob2JzZXJ2YXRpb25EYXRhLmhlaWdodCAmJiBvYnNlcnZhdGlvbkRhdGEud2VpZ2h0KSB7CiAgICBvYnNlcnZhdGlvbkRhdGEuYm1pID0gY2FsY3VsYXRlQk1JKG9ic2VydmF0aW9uRGF0YS5oZWlnaHQsIG9ic2VydmF0aW9uRGF0YS53ZWlnaHQpOwogIH0KCiAgY29uc3QgcHJvYmxlbUxpc3QgPSBhbnN3ZXJzWydwcm9ibGVtLWxpc3QnXT8udmFsdWVCb29sZWFuID8/IGZhbHNlOwoKICBjb25zdCBwYXJ0aWFsQ29uZGl0aW9uOiBQYXJ0aWFsPENvbmRpdGlvbj4gPSB7CiAgICByZXNvdXJjZVR5cGU6ICdDb25kaXRpb24nLAogICAgY29kZTogYW5zd2Vyc1sncmVhc29uLWZvci12aXNpdCddLnZhbHVlQ29kaW5nLAogIH07CgogIGNvbnN0IG5vdGUgPSBhbnN3ZXJzWydhc3Nlc3NtZW50J10/LnZhbHVlU3RyaW5nOwoKICBjb25zdCBvYnNlcnZhdGlvblR5cGVzOiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB9ID0gewogICAgaGVpZ2h0OiAndmFsdWVRdWFudGl0eScsCiAgICB3ZWlnaHQ6ICd2YWx1ZVF1YW50aXR5JywKICAgIGJtaTogJ3ZhbHVlUXVhbnRpdHknLAogICAgaG90Rmxhc2g6ICd2YWx1ZUJvb2xlYW4nLAogICAgbW9vZFN3aW5nczogJ3ZhbHVlQm9vbGVhbicsCiAgICB2YWdpbmFsRHJ5bmVzczogJ3ZhbHVlQm9vbGVhbicsCiAgICBzbGVlcERpc3R1cmJhbmNlOiAndmFsdWVCb29sZWFuJywKICAgIHNlbGZSZXBvcnRlZEhpc3Rvcnk6ICd2YWx1ZVN0cmluZycsCiAgfTsKCiAgLy8gVGFrZSB0aGUgb2JqZWN0cyBhbmQgY3JlYXRlIGZ1bGwgcmVzb3VyY2VzIG9mIGVhY2ggdHlwZQogIC8vIGNvbnN0IHBhcnRpYWxPYnNlcnZhdGlvbnMgPSBjcmVhdGVQYXJ0aWFsR2VuZXJhbE9ic2VydmF0aW9ucyhvYnNlcnZhdGlvbkRhdGEsIGdlbmVyYWxDb2Rlcyk7CiAgY29uc3Qgb2JzZXJ2YXRpb25zID0gY3JlYXRlT2JzZXJ2YXRpb25zKG9ic2VydmF0aW9uRGF0YSwgZ2VuZXJhbENvZGVzLCBvYnNlcnZhdGlvblR5cGVzLCBlbmNvdW50ZXIsIHVzZXIsIHJlc3BvbnNlKTsKICBjb25zdCBjb25kaXRpb25zID0gY3JlYXRlQ29uZGl0aW9ucyhwYXJ0aWFsQ29uZGl0aW9uLCBlbmNvdW50ZXIsIHVzZXIsIHByb2JsZW1MaXN0KTsKICBjb25zdCBjbGluaWNhbEltcHJlc3Npb25zID0gY3JlYXRlQ2xpbmljYWxJbXByZXNzaW9ucyhlbmNvdW50ZXIsIHVzZXIsIG5vdGUpOwoKICAvLyBDcmVhdGUgYW4gYXJyYXkgb2YgYWxsIHJlc291cmNlcwogIGNvbnN0IHJlc291cmNlczogKENvbmRpdGlvbiB8IE9ic2VydmF0aW9uIHwgQ2xpbmljYWxJbXByZXNzaW9uKVtdID0gWy4uLm9ic2VydmF0aW9ucywgLi4uY29uZGl0aW9uc107CiAgaWYgKGNsaW5pY2FsSW1wcmVzc2lvbnMpIHsKICAgIHJlc291cmNlcy5wdXNoKGNsaW5pY2FsSW1wcmVzc2lvbnMpOwogIH0KCiAgY29uc3QgYnVuZGxlID0gY3JlYXRlQnVuZGxlKHJlc291cmNlcyk7CgogIC8vIEV4ZWN1dGUgdGhlIGJhdGNoIHRvIGNyZWF0ZSBhbGwgcmVzb3VyY2VzIGF0IG9uY2UKICBjb25zdCByZXNwb25zZUJ1bmRsZSA9IGF3YWl0IG1lZHBsdW0uZXhlY3V0ZUJhdGNoKGJ1bmRsZSk7CiAgcmV0dXJuIHJlc3BvbnNlQnVuZGxlOwp9CgpleHBvcnQgY29uc3QgZ2VuZXJhbENvZGVzOiBSZWNvcmQ8c3RyaW5nLCBDb2RlYWJsZUNvbmNlcHQ+ID0gewogIGhlaWdodDogewogICAgY29kaW5nOiBbeyBjb2RlOiAnODMwMi0yJywgc3lzdGVtOiAnaHR0cDovL2xvaW5jLm9yZycsIGRpc3BsYXk6ICdCb2R5IGhlaWdodCcgfV0sCiAgfSwKICB3ZWlnaHQ6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzI5NDYzLTcnLCBzeXN0ZW06ICdodHRwOi8vbG9pbmMub3JnJywgZGlzcGxheTogJ0JvZHkgd2VpZ2h0JyB9XSwKICB9LAogIGJsb29kUHJlc3N1cmU6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzM1MDk0LTInLCBzeXN0ZW06ICdodHRwOi8vbG9pbmMub3JnJywgZGlzcGxheTogJ0Jsb29kIHByZXNzdXJlIHBhbmVsJyB9XSwKICB9LAogIGJtaTogewogICAgY29kaW5nOiBbeyBjb2RlOiAnMzkxNTYtNScsIHN5c3RlbTogJ2h0dHA6Ly9sb2luYy5vcmcnLCBkaXNwbGF5OiAnQm9keSBNYXNzIEluZGV4IChCTUkpJyB9XSwKICB9LAogIGhvdEZsYXNoOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICc3MDM3Ni05Jywgc3lzdGVtOiAnaHR0cDovL2xvaW5jLm9yZycsIGRpc3BsYXk6ICdJIGhhdmUgaG90IGZsYXNoZXMgaW4gdGhlIGxhc3QgNyBkYXlzJyB9XSwKICB9LAogIG1vb2RTd2luZ3M6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzcwODA1LTcnLCBzeXN0ZW06ICdodHRwOi8vbG9pbmcub3JnJywgZGlzcGxheTogJ0kgaGF2ZSBtb29kIHN3aW5ncyBpbiB0aGUgbGFzdCA3IGRheXMnIH1dLAogIH0sCiAgdmFnaW5hbERyeW5lc3M6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzcwODAyLTQnLCBzeXN0ZW06ICdodHRwOi8vbG9pbmcub3JnJywgZGlzcGxheTogJ0kgaGF2ZSB2YWdpbmFsIGRyeW5lc3MgaW4gdGhlIGxhc3QgNyBkYXlzJyB9XSwKICB9LAogIHNsZWVwRGlzdHVyYmFuY2U6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzc3NzEyLTgnLCBzeXN0ZW06ICdodHRwOi8vbG9pbmcub3JnJywgZGlzcGxheTogJ1NsZWVwIGRpc3R1cmJhbmNlIGluZGljYXRvciBpbiB0aGUgbGFzdCB3ZWVrJyB9XSwKICB9LAp9Owo="
      }
    },
    {
      "fullUrl": "urn:uuid:a6364d5c-6792-40f3-b4a0-7287516dd3db",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/javascript",
        "data": "InVzZSBzdHJpY3QiOwp2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwp2YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIF9fZXhwb3J0ID0gKHRhcmdldCwgYWxsKSA9PiB7CiAgZm9yICh2YXIgbmFtZSBpbiBhbGwpCiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pOwp9Owp2YXIgX19jb3B5UHJvcHMgPSAodG8sIGZyb20sIGV4Y2VwdCwgZGVzYykgPT4gewogIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSAib2JqZWN0IiB8fCB0eXBlb2YgZnJvbSA9PT0gImZ1bmN0aW9uIikgewogICAgZm9yIChsZXQga2V5IG9mIF9fZ2V0T3duUHJvcE5hbWVzKGZyb20pKQogICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KQogICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTsKICB9CiAgcmV0dXJuIHRvOwp9Owp2YXIgX190b0NvbW1vbkpTID0gKG1vZCkgPT4gX19jb3B5UHJvcHMoX19kZWZQcm9wKHt9LCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIG1vZCk7CgovLyBzcmMvYm90cy9jb3JlL2dlbmVyYWwtZW5jb3VudGVyLW5vdGUudHMKdmFyIGdlbmVyYWxfZW5jb3VudGVyX25vdGVfZXhwb3J0cyA9IHt9OwpfX2V4cG9ydChnZW5lcmFsX2VuY291bnRlcl9ub3RlX2V4cG9ydHMsIHsKICBnZW5lcmFsQ29kZXM6ICgpID0+IGdlbmVyYWxDb2RlcywKICBoYW5kbGVyOiAoKSA9PiBoYW5kbGVyCn0pOwptb2R1bGUuZXhwb3J0cyA9IF9fdG9Db21tb25KUyhnZW5lcmFsX2VuY291bnRlcl9ub3RlX2V4cG9ydHMpOwp2YXIgaW1wb3J0X2NvcmUyID0gcmVxdWlyZSgiQG1lZHBsdW0vY29yZSIpOwoKLy8gc3JjL2JvdHMvY29yZS9jaGFydGluZy11dGlscy50cwp2YXIgaW1wb3J0X2NvcmUgPSByZXF1aXJlKCJAbWVkcGx1bS9jb3JlIik7CnZhciBpbXBvcnRfY3J5cHRvID0gcmVxdWlyZSgiY3J5cHRvIik7CmZ1bmN0aW9uIGNyZWF0ZU9ic2VydmF0aW9ucyhvYnNlcnZhdGlvbkRhdGEsIGNvZGVzLCBvYnNlcnZhdGlvblR5cGVzLCBlbmNvdW50ZXIsIHVzZXIsIHJlc3BvbnNlKSB7CiAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMob2JzZXJ2YXRpb25EYXRhKSkgewogICAgaWYgKCF2YWx1ZSB8fCBrZXkgPT09ICJibG9vZFByZXNzdXJlIiAmJiAhdmFsdWUuc3lzdG9saWMgJiYgIXZhbHVlLmRpYXN0b2xpYyB8fCBrZXkgPT09ICJkYXRlIikgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IGNvZGUgPSBrZXkgPT09ICJzZWxmUmVwb3J0ZWRIaXN0b3J5IiA/IGdldFNlbGZSZXBvcnRlZENvZGUob2JzZXJ2YXRpb25EYXRhWyJzZWxmUmVwb3J0ZWRIaXN0b3J5Il0pIDogY29kZXNba2V5XTsKICAgIGlmICghY29kZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGNvZGUgcHJvdmlkZWQiKTsKICAgIH0KICAgIGNvbnN0IG9ic0tleSA9IG9ic2VydmF0aW9uVHlwZXNba2V5XTsKICAgIGNvbnN0IHJlc291cmNlID0gewogICAgICBjb2RlCiAgICB9OwogICAgaWYgKGtleSAhPT0gImJsb29kUHJlc3N1cmUiKSB7CiAgICAgIHJlc291cmNlW29ic0tleV0gPSBvYnNlcnZhdGlvbkRhdGFba2V5XTsKICAgIH0KICAgIGlmIChrZXkgPT09ICJibG9vZFByZXNzdXJlIikgewogICAgICByZXNvdXJjZS5jb21wb25lbnQgPSBoYW5kbGVCbG9vZFByZXNzdXJlKAogICAgICAgIG9ic2VydmF0aW9uRGF0YS5ibG9vZFByZXNzdXJlLnN5c3RvbGljLAogICAgICAgIG9ic2VydmF0aW9uRGF0YS5ibG9vZFByZXNzdXJlLmRpYXN0b2xpYwogICAgICApOwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb24gPSB7CiAgICAgIC4uLnJlc291cmNlLAogICAgICByZXNvdXJjZVR5cGU6ICJPYnNlcnZhdGlvbiIsCiAgICAgIGNvZGU6IGtleSA9PT0gInNlbGZSZXBvcnRlZEhpc3RvcnkiID8gZ2V0U2VsZlJlcG9ydGVkQ29kZShvYnNlcnZhdGlvbkRhdGFbInNlbGZSZXBvcnRlZEhpc3RvcnkiXSkgOiBjb2Rlc1trZXldLAogICAgICBzdGF0dXM6ICJmaW5hbCIsCiAgICAgIHN1YmplY3Q6IGVuY291bnRlci5zdWJqZWN0LAogICAgICBwZXJmb3JtZXI6IFt7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfV0sCiAgICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgICAgZWZmZWN0aXZlRGF0ZVRpbWU6IG9ic2VydmF0aW9uRGF0YS5kYXRlLAogICAgICBkZXJpdmVkRnJvbTogW3sgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXNwb25zZSkgfV0KICAgIH07CiAgICBvYnNlcnZhdGlvbnMucHVzaChvYnNlcnZhdGlvbik7CiAgfQogIHJldHVybiBvYnNlcnZhdGlvbnM7Cn0KZnVuY3Rpb24gaGFuZGxlQmxvb2RQcmVzc3VyZShzeXN0b2xpYywgZGlhc3RvbGljKSB7CiAgY29uc3QgY29tcG9uZW50cyA9IFtdOwogIGlmIChkaWFzdG9saWMpIHsKICAgIGNvbXBvbmVudHMucHVzaCh7CiAgICAgIGNvZGU6IHsgY29kaW5nOiBbeyBjb2RlOiAiODQ2Mi00Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJEaWFzdG9saWMgYmxvb2QgcHJlc3N1cmUiIH1dIH0sCiAgICAgIHZhbHVlUXVhbnRpdHk6IHsKICAgICAgICB2YWx1ZTogZGlhc3RvbGljLAogICAgICAgIHVuaXQ6ICJtbVtIZ10iCiAgICAgIH0KICAgIH0pOwogIH0KICBpZiAoc3lzdG9saWMpIHsKICAgIGNvbXBvbmVudHMucHVzaCh7CiAgICAgIGNvZGU6IHsgY29kaW5nOiBbeyBjb2RlOiAiODQ4MC02Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSIgfV0gfSwKICAgICAgdmFsdWVRdWFudGl0eTogewogICAgICAgIHZhbHVlOiBzeXN0b2xpYywKICAgICAgICB1bml0OiAibW1bSGddIgogICAgICB9CiAgICB9KTsKICB9CiAgcmV0dXJuIGNvbXBvbmVudHM7Cn0KZnVuY3Rpb24gY3JlYXRlQ29uZGl0aW9ucyhwYXJ0aWFsQ29uZGl0aW9uLCBlbmNvdW50ZXIsIHVzZXIsIHByb2JsZW1MaXN0KSB7CiAgY29uc3QgY29uZGl0aW9ucyA9IFtdOwogIGNvbnN0IGVuY291bnRlckRpYWdub3NpcyA9IHsKICAgIC4uLnBhcnRpYWxDb25kaXRpb24sCiAgICByZXNvdXJjZVR5cGU6ICJDb25kaXRpb24iLAogICAgc3ViamVjdDogZW5jb3VudGVyLnN1YmplY3QsCiAgICBlbmNvdW50ZXI6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShlbmNvdW50ZXIpIH0sCiAgICByZWNvcmRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH0sCiAgICBhc3NlcnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH0sCiAgICBjYXRlZ29yeTogWwogICAgICB7CiAgICAgICAgY29kaW5nOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvVmFsdWVTZXQvY29uZGl0aW9uLWNhdGVnb3J5IiwKICAgICAgICAgICAgY29kZTogImVuY291bnRlci1kaWFnbm9zaXMiLAogICAgICAgICAgICBkaXNwbGF5OiAiRW5jb3VudGVyIERpYWdub3NpcyIKICAgICAgICAgIH0KICAgICAgICBdCiAgICAgIH0KICAgIF0KICB9OwogIGNvbmRpdGlvbnMucHVzaChlbmNvdW50ZXJEaWFnbm9zaXMpOwogIGlmIChwcm9ibGVtTGlzdCkgewogICAgY29uZGl0aW9ucy5wdXNoKHsKICAgICAgLi4ucGFydGlhbENvbmRpdGlvbiwKICAgICAgcmVzb3VyY2VUeXBlOiAiQ29uZGl0aW9uIiwKICAgICAgc3ViamVjdDogZW5jb3VudGVyLnN1YmplY3QsCiAgICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgICAgcmVjb3JkZXI6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9LAogICAgICBhc3NlcnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH0sCiAgICAgIGNhdGVnb3J5OiBbCiAgICAgICAgewogICAgICAgICAgY29kaW5nOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL1ZhbHVlU2V0L2NvbmRpdGlvbi1jYXRlZ29yeSIsCiAgICAgICAgICAgICAgY29kZTogInByb2JsZW0tbGlzdC1pdGVtIiwKICAgICAgICAgICAgICBkaXNwbGF5OiAiUHJvYmxlbSBMaXN0IEl0ZW0iCiAgICAgICAgICAgIH0KICAgICAgICAgIF0KICAgICAgICB9CiAgICAgIF0KICAgIH0pOwogIH0KICByZXR1cm4gY29uZGl0aW9uczsKfQpmdW5jdGlvbiBjcmVhdGVDbGluaWNhbEltcHJlc3Npb25zKGVuY291bnRlciwgdXNlciwgbm90ZSkgewogIGlmICghbm90ZSkgewogICAgcmV0dXJuIHZvaWQgMDsKICB9CiAgY29uc3QgY2xpbmljYWxJbXByZXNzaW9uID0gewogICAgcmVzb3VyY2VUeXBlOiAiQ2xpbmljYWxJbXByZXNzaW9uIiwKICAgIHN0YXR1czogImluLXByb2dyZXNzIiwKICAgIHN1YmplY3Q6IGVuY291bnRlci5zdWJqZWN0LAogICAgZW5jb3VudGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykoZW5jb3VudGVyKSB9LAogICAgYXNzZXNzb3I6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9LAogICAgbm90ZTogW3sgdGV4dDogbm90ZSB9XQogIH07CiAgcmV0dXJuIGNsaW5pY2FsSW1wcmVzc2lvbjsKfQpmdW5jdGlvbiBjcmVhdGVCdW5kbGUocmVzb3VyY2VzKSB7CiAgY29uc3QgYnVuZGxlID0gewogICAgcmVzb3VyY2VUeXBlOiAiQnVuZGxlIiwKICAgIHR5cGU6ICJ0cmFuc2FjdGlvbiIKICB9OwogIGNvbnN0IGVudHJpZXMgPSByZXNvdXJjZXMubWFwKChyZXNvdXJjZSkgPT4gewogICAgY29uc3QgZW50cnkgPSB7CiAgICAgIGZ1bGxVcmw6IGB1cm46dXVpZDokeygwLCBpbXBvcnRfY3J5cHRvLnJhbmRvbVVVSUQpKCl9YCwKICAgICAgcmVxdWVzdDogeyBtZXRob2Q6ICJQVVQiLCB1cmw6IGdldFVwc2VydFVybChyZXNvdXJjZSkgfSwKICAgICAgcmVzb3VyY2UKICAgIH07CiAgICByZXR1cm4gZW50cnk7CiAgfSk7CiAgYnVuZGxlLmVudHJ5ID0gZW50cmllczsKICByZXR1cm4gYnVuZGxlOwp9CmZ1bmN0aW9uIGdldFVwc2VydFVybChyZXNvdXJjZSkgewogIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICJPYnNlcnZhdGlvbiIpIHsKICAgIGNvbnN0IGNvZGUgPSByZXNvdXJjZS5jb2RlOwogICAgaWYgKCFjb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gY29kZSBwcm92aWRlZCIpOwogICAgfQogICAgaWYgKCFyZXNvdXJjZS5lbmNvdW50ZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBsaW5rZWQgZW5jb3VudGVyIik7CiAgICB9CiAgICBjb25zdCB1cmwgPSBjb2RlLmNvZGluZz8uWzBdLmNvZGUgPyBgT2JzZXJ2YXRpb24/ZW5jb3VudGVyPSR7KDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzb3VyY2UuZW5jb3VudGVyKX0mY29kZT0ke2NvZGUuY29kaW5nPy5bMF0uY29kZX1gIDogYE9ic2VydmF0aW9uP2VuY291bnRlcj0keygwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHJlc291cmNlLmVuY291bnRlcil9YDsKICAgIHJldHVybiB1cmw7CiAgfSBlbHNlIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICJDb25kaXRpb24iKSB7CiAgICBjb25zdCBjb2RlID0gcmVzb3VyY2UuY29kZTsKICAgIGlmICghY29kZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGNvZGUgcHJvdmlkZWQiKTsKICAgIH0KICAgIGlmICghcmVzb3VyY2UuZW5jb3VudGVyKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gbGlua2VkIGVuY291bnRlciIpOwogICAgfQogICAgcmV0dXJuIGBDb25kaXRpb24/ZW5jb3VudGVyPSR7KDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzb3VyY2UuZW5jb3VudGVyKX0mY29kZT0ke2NvZGUuY29kaW5nPy5bMF0uY29kZX1gOwogIH0gZWxzZSBpZiAocmVzb3VyY2UucmVzb3VyY2VUeXBlID09PSAiQ2xpbmljYWxJbXByZXNzaW9uIikgewogICAgaWYgKCFyZXNvdXJjZS5lbmNvdW50ZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBsaW5rZWQgZW5jb3VudGVyIik7CiAgICB9CiAgICByZXR1cm4gYENsaW5pY2FsSW1wcmVzc2lvbj9lbmNvdW50ZXI9JHsoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXNvdXJjZS5lbmNvdW50ZXIpfWA7CiAgfSBlbHNlIHsKICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCByZXNvdXJjZSB0eXBlIik7CiAgfQp9CmZ1bmN0aW9uIGdldFNlbGZSZXBvcnRlZENvZGUocmVwb3J0ZWRIaXN0b3J5KSB7CiAgY29uc3QgY29kZSA9IHsKICAgIGNvZGluZzogW10KICB9OwogIHN3aXRjaCAocmVwb3J0ZWRIaXN0b3J5KSB7CiAgICBjYXNlICJCbG9vZCBjbG90cyI6CiAgICAgIGNvZGUuY29kaW5nPy5wdXNoKHsKICAgICAgICBjb2RlOiAiSTc0LjkiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIkVtYm9saXNtIGFuZCB0aHJvbWJvc2lzIG9mIHVuc3BlY2lmaWVkIGFydGVyeSIKICAgICAgfSk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAiU3Ryb2tlIjoKICAgICAgY29kZS5jb2Rpbmc/LnB1c2goewogICAgICAgIGNvZGU6ICJJNjMuOSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiQ2VyZWJyYWwgaW5mYXJjdGlvbiwgdW5zcGVjaWZpZWQiCiAgICAgIH0pOwogICAgICBicmVhazsKICAgIGNhc2UgIkJyZWFzdCBjYW5jZXIiOgogICAgICBjb2RlLmNvZGluZz8ucHVzaCh7CiAgICAgICAgY29kZTogIkQwNS4xMCIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiSW50cmFkdWN0YWwgY2FyY2lub21hIGluIHNpdHUgb2YgdW5zcGVjaWZpZWQgYnJlYXN0IgogICAgICB9KTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJFbmRvbWV0cmlhbCBjYW5jZXIiOgogICAgICBjb2RlLmNvZGluZz8ucHVzaCh7CiAgICAgICAgY29kZTogIkM1NC4xIiwKICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAiLAogICAgICAgIGRpc3BsYXk6ICJNYWxpZ25hbnQgbmVvcGxhc20gb2YgZW5kb21ldHJpdW0iCiAgICAgIH0pOwogICAgICBicmVhazsKICAgIGNhc2UgIklycmVndWxhciBibGVlZGluZyI6CiAgICAgIGNvZGUuY29kaW5nPy5wdXNoKHsKICAgICAgICBjb2RlOiAiTjkyLjEiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIkV4Y2Vzc2l2ZSBhbmQgZnJlcXVlbnQgbWVuc3RydWF0aW9uIHdpdGggaXJyZWd1bGFyIGN5Y2xlIgogICAgICB9KTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJCTUkgPiAzMCI6CiAgICAgIGNvZGUuY29kaW5nPy5wdXNoKHsKICAgICAgICBjb2RlOiAiRTY2LjkiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIk9iZXNpdHksIHVuc3BlY2lmaWVkIgogICAgICB9KTsKICAgICAgYnJlYWs7CiAgfQogIHJldHVybiBjb2RlOwp9CgovLyBzcmMvYm90cy9jb3JlL29ic2VydmF0aW9uLXV0aWxzLnRzCmZ1bmN0aW9uIGNhbGN1bGF0ZUJNSShoZWlnaHQsIHdlaWdodCkgewogIGlmICghaGVpZ2h0Py52YWx1ZSB8fCAhd2VpZ2h0Py52YWx1ZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJBbGwgdmFsdWVzIG11c3QgYmUgcHJvdmlkZWQiKTsKICB9CiAgY29uc3QgaGVpZ2h0TSA9IGdldEhlaWdodEluTWV0ZXJzKGhlaWdodCk7CiAgY29uc3Qgd2VpZ2h0S2cgPSBnZXRXZWlnaHRJbktpbG9ncmFtcyh3ZWlnaHQpOwogIGNvbnN0IGJtaSA9IE1hdGgucm91bmQod2VpZ2h0S2cgLyBoZWlnaHRNICoqIDIgKiAxMCkgLyAxMDsKICByZXR1cm4gewogICAgdmFsdWU6IGJtaSwKICAgIHVuaXQ6ICJrZy9tXjIiCiAgfTsKfQpmdW5jdGlvbiBnZXRXZWlnaHRJbktpbG9ncmFtcyh3ZWlnaHQpIHsKICBpZiAoIXdlaWdodC51bml0KSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHVuaXQgZGVmaW5lZCIpOwogIH0KICBjb25zdCB1bml0ID0gd2VpZ2h0LnVuaXQ7CiAgY29uc3Qgd2VpZ2h0VmFsID0gd2VpZ2h0LnZhbHVlOwogIHN3aXRjaCAodW5pdCkgewogICAgY2FzZSAibGIiOgogICAgICByZXR1cm4gd2VpZ2h0VmFsIC8gMi4yOwogICAgY2FzZSAia2ciOgogICAgICByZXR1cm4gd2VpZ2h0VmFsOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIHVuaXQuIFBsZWFzZSBwcm92aWRlIHdlaWdodCBpbiBvbmUgb2YgdGhlIGZvbGxvd2luZyB1bml0czogUG91bmRzIG9yIGtpbG9ncmFtcy4iKTsKICB9Cn0KZnVuY3Rpb24gZ2V0SGVpZ2h0SW5NZXRlcnMoaGVpZ2h0KSB7CiAgaWYgKCFoZWlnaHQudW5pdCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJObyB1bml0IGRlZmluZWQiKTsKICB9CiAgY29uc3QgdW5pdCA9IGhlaWdodC51bml0OwogIGNvbnN0IGhlaWdodFZhbCA9IGhlaWdodC52YWx1ZTsKICBzd2l0Y2ggKHVuaXQpIHsKICAgIGNhc2UgImluIjoKICAgICAgcmV0dXJuIGhlaWdodFZhbCAqIDIuNTQgLyAxMDA7CiAgICBjYXNlICJmdCI6CiAgICAgIHJldHVybiBoZWlnaHRWYWwgKiAxMiAqIDIuNTQgLyAxMDA7CiAgICBjYXNlICJjbSI6CiAgICAgIHJldHVybiBoZWlnaHRWYWwgLyAxMDA7CiAgICBjYXNlICJtIjoKICAgICAgcmV0dXJuIGhlaWdodFZhbDsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAiVW5rbm93biB1bml0LiBQbGVhc2UgcHJvdmlkZSBoZWlnaHQgaW4gb25lIG9mIHRoZSBmb2xsb3dpbmcgdW5pdHM6IEluY2hlcywgZmVldCwgY2VudGltZXRlcnMsIG9yIG1ldGVycy4iCiAgICAgICk7CiAgfQp9CgovLyBzcmMvYm90cy9jb3JlL2dlbmVyYWwtZW5jb3VudGVyLW5vdGUudHMKYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihldmVudCwgbWVkcGx1bSkgewogIGNvbnN0IHJlc3BvbnNlID0gZXZlbnQuaW5wdXQ7CiAgY29uc3QgYW5zd2VycyA9ICgwLCBpbXBvcnRfY29yZTIuZ2V0UXVlc3Rpb25uYWlyZUFuc3dlcnMpKHJlc3BvbnNlKTsKICBjb25zdCBlbmNvdW50ZXIgPSBhd2FpdCBtZWRwbHVtLnJlYWRSZWZlcmVuY2UocmVzcG9uc2UuZW5jb3VudGVyKTsKICBjb25zdCB1c2VyID0gbWVkcGx1bS5nZXRQcm9maWxlKCk7CiAgaWYgKCFhbnN3ZXJzWyJyZWFzb24tZm9yLXZpc2l0Il0/LnZhbHVlQ29kaW5nKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk11c3QgcHJvdmlkZSBhIHJlYXNvbiBmb3IgdGhlIHZpc2l0Iik7CiAgfQogIGNvbnN0IG9ic2VydmF0aW9uRGF0YSA9IHsKICAgIGJsb29kUHJlc3N1cmU6IHsKICAgICAgZGlhc3RvbGljOiBhbnN3ZXJzWyJkaWFzdG9saWMiXT8udmFsdWVJbnRlZ2VyLAogICAgICBzeXN0b2xpYzogYW5zd2Vyc1sic3lzdG9saWMiXT8udmFsdWVJbnRlZ2VyCiAgICB9LAogICAgaGVpZ2h0OiBhbnN3ZXJzWyJoZWlnaHQiXT8udmFsdWVRdWFudGl0eSwKICAgIHdlaWdodDogYW5zd2Vyc1sid2VpZ2h0Il0/LnZhbHVlUXVhbnRpdHksCiAgICBob3RGbGFzaDogYW5zd2Vyc1siaG90LWZsYXNoZXMiXT8udmFsdWVCb29sZWFuLAogICAgbW9vZFN3aW5nczogYW5zd2Vyc1sibW9vZC1zd2luZ3MiXT8udmFsdWVCb29sZWFuLAogICAgdmFnaW5hbERyeW5lc3M6IGFuc3dlcnNbInZhZ2luYWwtZHJ5bmVzcyJdPy52YWx1ZUJvb2xlYW4sCiAgICBzbGVlcERpc3R1cmJhbmNlOiBhbnN3ZXJzWyJzbGVlcC1kaXN0dXJiYW5jZSJdPy52YWx1ZUJvb2xlYW4sCiAgICBzZWxmUmVwb3J0ZWRIaXN0b3J5OiBhbnN3ZXJzWyJzZWxmLXJlcG9ydGVkLWhpc3RvcnkiXT8udmFsdWVTdHJpbmcsCiAgICBkYXRlOiBhbnN3ZXJzWyJkYXRlIl0/LnZhbHVlRGF0ZVRpbWUKICB9OwogIGlmIChvYnNlcnZhdGlvbkRhdGEuaGVpZ2h0ICYmIG9ic2VydmF0aW9uRGF0YS53ZWlnaHQpIHsKICAgIG9ic2VydmF0aW9uRGF0YS5ibWkgPSBjYWxjdWxhdGVCTUkob2JzZXJ2YXRpb25EYXRhLmhlaWdodCwgb2JzZXJ2YXRpb25EYXRhLndlaWdodCk7CiAgfQogIGNvbnN0IHByb2JsZW1MaXN0ID0gYW5zd2Vyc1sicHJvYmxlbS1saXN0Il0/LnZhbHVlQm9vbGVhbiA/PyBmYWxzZTsKICBjb25zdCBwYXJ0aWFsQ29uZGl0aW9uID0gewogICAgcmVzb3VyY2VUeXBlOiAiQ29uZGl0aW9uIiwKICAgIGNvZGU6IGFuc3dlcnNbInJlYXNvbi1mb3ItdmlzaXQiXS52YWx1ZUNvZGluZwogIH07CiAgY29uc3Qgbm90ZSA9IGFuc3dlcnNbImFzc2Vzc21lbnQiXT8udmFsdWVTdHJpbmc7CiAgY29uc3Qgb2JzZXJ2YXRpb25UeXBlcyA9IHsKICAgIGhlaWdodDogInZhbHVlUXVhbnRpdHkiLAogICAgd2VpZ2h0OiAidmFsdWVRdWFudGl0eSIsCiAgICBibWk6ICJ2YWx1ZVF1YW50aXR5IiwKICAgIGhvdEZsYXNoOiAidmFsdWVCb29sZWFuIiwKICAgIG1vb2RTd2luZ3M6ICJ2YWx1ZUJvb2xlYW4iLAogICAgdmFnaW5hbERyeW5lc3M6ICJ2YWx1ZUJvb2xlYW4iLAogICAgc2xlZXBEaXN0dXJiYW5jZTogInZhbHVlQm9vbGVhbiIsCiAgICBzZWxmUmVwb3J0ZWRIaXN0b3J5OiAidmFsdWVTdHJpbmciCiAgfTsKICBjb25zdCBvYnNlcnZhdGlvbnMgPSBjcmVhdGVPYnNlcnZhdGlvbnMob2JzZXJ2YXRpb25EYXRhLCBnZW5lcmFsQ29kZXMsIG9ic2VydmF0aW9uVHlwZXMsIGVuY291bnRlciwgdXNlciwgcmVzcG9uc2UpOwogIGNvbnN0IGNvbmRpdGlvbnMgPSBjcmVhdGVDb25kaXRpb25zKHBhcnRpYWxDb25kaXRpb24sIGVuY291bnRlciwgdXNlciwgcHJvYmxlbUxpc3QpOwogIGNvbnN0IGNsaW5pY2FsSW1wcmVzc2lvbnMgPSBjcmVhdGVDbGluaWNhbEltcHJlc3Npb25zKGVuY291bnRlciwgdXNlciwgbm90ZSk7CiAgY29uc3QgcmVzb3VyY2VzID0gWy4uLm9ic2VydmF0aW9ucywgLi4uY29uZGl0aW9uc107CiAgaWYgKGNsaW5pY2FsSW1wcmVzc2lvbnMpIHsKICAgIHJlc291cmNlcy5wdXNoKGNsaW5pY2FsSW1wcmVzc2lvbnMpOwogIH0KICBjb25zdCBidW5kbGUgPSBjcmVhdGVCdW5kbGUocmVzb3VyY2VzKTsKICBjb25zdCByZXNwb25zZUJ1bmRsZSA9IGF3YWl0IG1lZHBsdW0uZXhlY3V0ZUJhdGNoKGJ1bmRsZSk7CiAgcmV0dXJuIHJlc3BvbnNlQnVuZGxlOwp9CnZhciBnZW5lcmFsQ29kZXMgPSB7CiAgaGVpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI4MzAyLTIiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIkJvZHkgaGVpZ2h0IiB9XQogIH0sCiAgd2VpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIyOTQ2My03Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJCb2R5IHdlaWdodCIgfV0KICB9LAogIGJsb29kUHJlc3N1cmU6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjM1MDk0LTIiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIkJsb29kIHByZXNzdXJlIHBhbmVsIiB9XQogIH0sCiAgYm1pOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIzOTE1Ni01Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJCb2R5IE1hc3MgSW5kZXggKEJNSSkiIH1dCiAgfSwKICBob3RGbGFzaDogewogICAgY29kaW5nOiBbeyBjb2RlOiAiNzAzNzYtOSIsIHN5c3RlbTogImh0dHA6Ly9sb2luYy5vcmciLCBkaXNwbGF5OiAiSSBoYXZlIGhvdCBmbGFzaGVzIGluIHRoZSBsYXN0IDcgZGF5cyIgfV0KICB9LAogIG1vb2RTd2luZ3M6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjcwODA1LTciLCBzeXN0ZW06ICJodHRwOi8vbG9pbmcub3JnIiwgZGlzcGxheTogIkkgaGF2ZSBtb29kIHN3aW5ncyBpbiB0aGUgbGFzdCA3IGRheXMiIH1dCiAgfSwKICB2YWdpbmFsRHJ5bmVzczogewogICAgY29kaW5nOiBbeyBjb2RlOiAiNzA4MDItNCIsIHN5c3RlbTogImh0dHA6Ly9sb2luZy5vcmciLCBkaXNwbGF5OiAiSSBoYXZlIHZhZ2luYWwgZHJ5bmVzcyBpbiB0aGUgbGFzdCA3IGRheXMiIH1dCiAgfSwKICBzbGVlcERpc3R1cmJhbmNlOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI3NzcxMi04Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5nLm9yZyIsIGRpc3BsYXk6ICJTbGVlcCBkaXN0dXJiYW5jZSBpbmRpY2F0b3IgaW4gdGhlIGxhc3Qgd2VlayIgfV0KICB9Cn07Ci8vIEFubm90YXRlIHRoZSBDb21tb25KUyBleHBvcnQgbmFtZXMgZm9yIEVTTSBpbXBvcnQgaW4gbm9kZToKMCAmJiAobW9kdWxlLmV4cG9ydHMgPSB7CiAgZ2VuZXJhbENvZGVzLAogIGhhbmRsZXIKfSk7Ck9iamVjdC5hc3NpZ24oZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMpOwo="
      }
    },
    {
      "request": {
        "method": "PUT",
        "url": "$bot-general-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Bot",
        "id": "$bot-general-encounter-note-id",
        "name": "general-encounter-note",
        "runtimeVersion": "awslambda",
        "sourceCode": {
          "contentType": "text/typescript",
          "url": "urn:uuid:1b308ecb-22d0-425e-9891-1df976ac92de"
        },
        "executableCode": {
          "contentType": "text/javascript",
          "url": "urn:uuid:a6364d5c-6792-40f3-b4a0-7287516dd3db"
        }
      }
    },
    {
      "request": {
        "url": "Subscription",
        "method": "POST",
        "ifNoneExist": "url=$bot-general-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Subscription",
        "status": "active",
        "reason": "general-encounter-note",
        "channel": {
          "endpoint": "$bot-general-encounter-note-reference",
          "type": "rest-hook"
        },
        "criteria": "QuestionnaireResponse?questionnaire=$encounter-note"
      }
    },
    {
      "fullUrl": "urn:uuid:72416bca-c551-4034-9db4-c85d9378be60",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/typescript",
        "data": "aW1wb3J0IHsgQm90RXZlbnQsIGdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzLCBNZWRwbHVtQ2xpZW50IH0gZnJvbSAnQG1lZHBsdW0vY29yZSc7CmltcG9ydCB7CiAgQnVuZGxlLAogIENsaW5pY2FsSW1wcmVzc2lvbiwKICBDb2RlYWJsZUNvbmNlcHQsCiAgQ29uZGl0aW9uLAogIEVuY291bnRlciwKICBPYnNlcnZhdGlvbiwKICBQcmFjdGl0aW9uZXIsCiAgUXVhbnRpdHksCiAgUXVlc3Rpb25uYWlyZVJlc3BvbnNlLAogIFJlZmVyZW5jZSwKfSBmcm9tICdAbWVkcGx1bS9maGlydHlwZXMnOwppbXBvcnQgewogIGNyZWF0ZUJ1bmRsZSwKICBjcmVhdGVDbGluaWNhbEltcHJlc3Npb25zLAogIGNyZWF0ZUNvbmRpdGlvbnMsCiAgY3JlYXRlT2JzZXJ2YXRpb25zLAogIE9ic2VydmF0aW9uRGF0YSwKfSBmcm9tICcuL2NoYXJ0aW5nLXV0aWxzJzsKaW1wb3J0IHsgY2FsY3VsYXRlQk1JIH0gZnJvbSAnLi9vYnNlcnZhdGlvbi11dGlscyc7CgpleHBvcnQgaW50ZXJmYWNlIE9ic3RldHJpY09ic2VydmF0aW9uRGF0YSBleHRlbmRzIE9ic2VydmF0aW9uRGF0YSB7CiAgZ3JhdmlkYT86IG51bWJlcjsKICBwYXJhPzogbnVtYmVyOwogIGdlc3RhdGlvbmFsRGF5cz86IG51bWJlcjsKICBnZXN0YXRpb25hbFdlZWtzPzogbnVtYmVyOwogIHRvdGFsV2VpZ2h0R2Fpbj86IFF1YW50aXR5Owp9CgpleHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihldmVudDogQm90RXZlbnQ8UXVlc3Rpb25uYWlyZVJlc3BvbnNlPiwgbWVkcGx1bTogTWVkcGx1bUNsaWVudCk6IFByb21pc2U8QnVuZGxlPiB7CiAgLy8gUGFyc2UgdGhlIGFuc3dlcnMgZnJvbSB0aGUgUXVlc3Rpb25uYWlyZVJlc3BvbnNlCiAgY29uc3QgcmVzcG9uc2UgPSBldmVudC5pbnB1dDsKICBjb25zdCBhbnN3ZXJzID0gZ2V0UXVlc3Rpb25uYWlyZUFuc3dlcnMocmVzcG9uc2UpOwogIC8vIEdldCB0aGUgbGlua2VkIGVuY291bnRlciBhbmQgdGhlIHVzZXIgd2hvIGluaXRpYXRlZCB0aGUgYm90CiAgY29uc3QgZW5jb3VudGVyID0gYXdhaXQgbWVkcGx1bS5yZWFkUmVmZXJlbmNlKHJlc3BvbnNlLmVuY291bnRlciBhcyBSZWZlcmVuY2U8RW5jb3VudGVyPik7CiAgY29uc3QgdXNlciA9IG1lZHBsdW0uZ2V0UHJvZmlsZSgpIGFzIFByYWN0aXRpb25lcjsKCiAgLy8gVGhlIHJlYXNvbiBmb3IgdmlzaXQgcXVlc3Rpb24gaXMgcmVxdWlyZWQuIElmIGl0IGlzIG5vdCBpbmNsdWRlZCwgd2UgdGhyb3cgYW4gZXJyb3IKICBpZiAoIWFuc3dlcnNbJ3JlYXNvbi1mb3ItdmlzaXQnXSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdNdXN0IHByb3ZpZGUgYSByZWFzb24gZm9yIHRoZSB2aXNpdCcpOwogIH0KCiAgLy8gUGFyc2UgdGhlIGFuc3dlcnMgaW50byBtb3JlIGVhc2lseSB1c2FibGUgb2JqZWN0cwogIGNvbnN0IG9ic2VydmF0aW9uRGF0YTogT2JzdGV0cmljT2JzZXJ2YXRpb25EYXRhID0gewogICAgZ3JhdmlkYTogYW5zd2Vyc1snZ3JhdmlkYSddPy52YWx1ZUludGVnZXIsCiAgICBwYXJhOiBhbnN3ZXJzWydwYXJhJ10/LnZhbHVlSW50ZWdlciwKICAgIGdlc3RhdGlvbmFsRGF5czogYW5zd2Vyc1snZ2VzdGF0aW9uYWwtYWdlLWRheXMnXT8udmFsdWVJbnRlZ2VyLAogICAgZ2VzdGF0aW9uYWxXZWVrczogYW5zd2Vyc1snZ2VzdGF0aW9uYWwtYWdlLXdlZWtzJ10/LnZhbHVlSW50ZWdlciwKICAgIGhlaWdodDogYW5zd2Vyc1snaGVpZ2h0J10/LnZhbHVlUXVhbnRpdHksCiAgICB3ZWlnaHQ6IGFuc3dlcnNbJ3dlaWdodCddPy52YWx1ZVF1YW50aXR5LAogICAgdG90YWxXZWlnaHRHYWluOiBhbnN3ZXJzWyd0b3RhbC13ZWlnaHQtZ2FpbiddPy52YWx1ZVF1YW50aXR5LAogICAgYmxvb2RQcmVzc3VyZTogewogICAgICBzeXN0b2xpYzogYW5zd2Vyc1snc3lzdG9saWMnXT8udmFsdWVJbnRlZ2VyLAogICAgICBkaWFzdG9saWM6IGFuc3dlcnNbJ2RpYXN0b2xpYyddPy52YWx1ZUludGVnZXIsCiAgICB9LAogICAgZGF0ZTogYW5zd2Vyc1snZGF0ZSddPy52YWx1ZURhdGVUaW1lLAogIH07CgogIGlmIChvYnNlcnZhdGlvbkRhdGEuaGVpZ2h0ICYmIG9ic2VydmF0aW9uRGF0YS53ZWlnaHQpIHsKICAgIG9ic2VydmF0aW9uRGF0YS5ibWkgPSBjYWxjdWxhdGVCTUkob2JzZXJ2YXRpb25EYXRhLmhlaWdodCwgb2JzZXJ2YXRpb25EYXRhLndlaWdodCk7CiAgfQoKICBjb25zdCBwcm9ibGVtTGlzdCA9IGFuc3dlcnNbJ3Byb2JsZW0tbGlzdCddPy52YWx1ZUJvb2xlYW4gPz8gZmFsc2U7CgogIGNvbnN0IHBhcnRpYWxDb25kaXRpb246IFBhcnRpYWw8Q29uZGl0aW9uPiA9IHsKICAgIHJlc291cmNlVHlwZTogJ0NvbmRpdGlvbicsCiAgICBjb2RlOiBhbnN3ZXJzWydyZWFzb24tZm9yLXZpc2l0J10udmFsdWVDb2RpbmcsCiAgfTsKCiAgY29uc3Qgbm90ZSA9IGFuc3dlcnNbJ2Fzc2Vzc21lbnQnXT8udmFsdWVTdHJpbmc7CgogIGNvbnN0IG9ic2VydmF0aW9uVHlwZXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7CiAgICBoZWlnaHQ6ICd2YWx1ZVF1YW50aXR5JywKICAgIHdlaWdodDogJ3ZhbHVlUXVhbnRpdHknLAogICAgYm1pOiAndmFsdWVRdWFudGl0eScsCiAgICBncmF2aWRhOiAndmFsdWVJbnRlZ2VyJywKICAgIHBhcmE6ICd2YWx1ZUludGVnZXInLAogICAgZ2VzdGF0aW9uYWxEYXlzOiAndmFsdWVJbnRlZ2VyJywKICAgIGdlc3RhdGlvbmFsV2Vla3M6ICd2YWx1ZUludGVnZXInLAogICAgdG90YWxXZWlnaHRHYWluOiAndmFsdWVRdWFudGl0eScsCiAgfTsKCiAgLy8gVGFrZSB0aGUgYWJvdmUgb2JqZWN0cyBhbmQgY3JlYXRlIHJlc291cmNlcyBmb3IgZWFjaCB0eXBlCiAgY29uc3Qgb2JzZXJ2YXRpb25zID0gY3JlYXRlT2JzZXJ2YXRpb25zKG9ic2VydmF0aW9uRGF0YSwgb2JzdGV0cmljQ29kZXMsIG9ic2VydmF0aW9uVHlwZXMsIGVuY291bnRlciwgdXNlciwgcmVzcG9uc2UpOwogIGNvbnN0IGNvbmRpdGlvbnMgPSBjcmVhdGVDb25kaXRpb25zKHBhcnRpYWxDb25kaXRpb24sIGVuY291bnRlciwgdXNlciwgcHJvYmxlbUxpc3QpOwogIGNvbnN0IGNsaW5pY2FsSW1wcmVzc2lvbnMgPSBjcmVhdGVDbGluaWNhbEltcHJlc3Npb25zKGVuY291bnRlciwgdXNlciwgbm90ZSk7CgogIC8vIENyZWF0ZSBhbiBlbnRyeSBhcnJheSBvZiBhbGwgdGhlIGJ1bmRsZSBlbnRyaWVzCiAgY29uc3QgcmVzb3VyY2VzOiAoT2JzZXJ2YXRpb24gfCBDb25kaXRpb24gfCBDbGluaWNhbEltcHJlc3Npb24pW10gPSBbLi4ub2JzZXJ2YXRpb25zLCAuLi5jb25kaXRpb25zXTsKICBpZiAoY2xpbmljYWxJbXByZXNzaW9ucykgewogICAgcmVzb3VyY2VzLnB1c2goY2xpbmljYWxJbXByZXNzaW9ucyk7CiAgfQoKICAvLyBCdWlsZCB0aGUgYnVuZGxlCiAgY29uc3QgYnVuZGxlID0gY3JlYXRlQnVuZGxlKHJlc291cmNlcyk7CgogIC8vIEV4ZWN1dGUgdGhlIGJ1bmRsZSBhcyBhIGJhdGNoIHRvIGNyZWF0ZSBhbGwgb2YgdGhlIE9ic2VydmF0aW9uLCBDb25kaXRpb24sIGFuZCBDbGluaWNhbEltcHJlc3Npb24gcmVzb3VyY2VzIGF0IG9uY2UKICBjb25zdCByZXNwb25zZUJ1bmRsZSA9IGF3YWl0IG1lZHBsdW0uZXhlY3V0ZUJhdGNoKGJ1bmRsZSk7CiAgcmV0dXJuIHJlc3BvbnNlQnVuZGxlOwp9Cgpjb25zdCBvYnN0ZXRyaWNDb2RlczogUmVjb3JkPHN0cmluZywgQ29kZWFibGVDb25jZXB0PiA9IHsKICBoZWlnaHQ6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzgzMDItMicsIHN5c3RlbTogJ2h0dHA6Ly9sb2luYy5vcmcnLCBkaXNwbGF5OiAnQm9keSBoZWlnaHQnIH1dLAogIH0sCiAgd2VpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICcyOTQ2My03Jywgc3lzdGVtOiAnaHR0cDovL2xvaW5jLm9yZycsIGRpc3BsYXk6ICdCb2R5IHdlaWdodCcgfV0sCiAgfSwKICBibG9vZFByZXNzdXJlOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICczNTA5NC0yJywgc3lzdGVtOiAnaHR0cDovL2xvaW5jLm9yZycsIGRpc3BsYXk6ICdCbG9vZCBwcmVzc3VyZSBwYW5lbCcgfV0sCiAgfSwKICBibWk6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzM5MTU2LTUnLCBzeXN0ZW06ICdodHRwOi8vbG9pbmMub3JnJywgZGlzcGxheTogJ0JvZHkgTWFzcyBJbmRleCAoQk1JKScgfV0sCiAgfSwKICBncmF2aWRhOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICcxNjE3MzIwMDYnLCBzeXN0ZW06ICdodHRwOi8vc25vbWVkLmluZm8vc2N0JywgZGlzcGxheTogJ0dyYXZpZGEnIH1dLAogIH0sCiAgcGFyYTogewogICAgY29kaW5nOiBbeyBjb2RlOiAnMTE4MjEyMDAwJywgc3lzdGVtOiAnaHR0cDovL3Nub21lZC5pbmZvL3NjdCcsIGRpc3BsYXk6ICdQYXJpdHkgZmluZGluZycgfV0sCiAgfSwKICBnZXN0YXRpb25hbERheXM6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzQ5MDUyLTQnLCBzeXN0ZW06ICdodHRwOi8vbG9pbmMub3JnJywgZGlzcGxheTogJ0dlc3RhdGlvbmFsIGFnZSBpbiBkYXlzJyB9XSwKICB9LAogIGdlc3RhdGlvbmFsV2Vla3M6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzQ5MDUxLTYnLCBzeXN0ZW06ICdodHRwOi8vbG9pbmMub3JnJywgZGlzcGxheTogJ0dlc3RhdGlvbmFsIGFnZSBpbiB3ZWVrcycgfV0sCiAgfSwKICB0b3RhbFdlaWdodEdhaW46IHsKICAgIGNvZGluZzogW3sgY29kZTogJzU2MDc4LTknLCBzeXN0ZW06ICdodHRwOi8vbG9pbmMub3JnJywgZGlzcGxheTogJ1dlaWdodCBnYWluIFtNYXNzXSAtLWR1cmluZyBjdXJyZW50IHByZWduYW5jeScgfV0sCiAgfSwKfTsK"
      }
    },
    {
      "fullUrl": "urn:uuid:226d3775-bade-4565-a0bf-b986c2637011",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/javascript",
        "data": "InVzZSBzdHJpY3QiOwp2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwp2YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIF9fZXhwb3J0ID0gKHRhcmdldCwgYWxsKSA9PiB7CiAgZm9yICh2YXIgbmFtZSBpbiBhbGwpCiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pOwp9Owp2YXIgX19jb3B5UHJvcHMgPSAodG8sIGZyb20sIGV4Y2VwdCwgZGVzYykgPT4gewogIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSAib2JqZWN0IiB8fCB0eXBlb2YgZnJvbSA9PT0gImZ1bmN0aW9uIikgewogICAgZm9yIChsZXQga2V5IG9mIF9fZ2V0T3duUHJvcE5hbWVzKGZyb20pKQogICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KQogICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTsKICB9CiAgcmV0dXJuIHRvOwp9Owp2YXIgX190b0NvbW1vbkpTID0gKG1vZCkgPT4gX19jb3B5UHJvcHMoX19kZWZQcm9wKHt9LCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIG1vZCk7CgovLyBzcmMvYm90cy9jb3JlL29ic3RldHJpYy1lbmNvdW50ZXItbm90ZS50cwp2YXIgb2JzdGV0cmljX2VuY291bnRlcl9ub3RlX2V4cG9ydHMgPSB7fTsKX19leHBvcnQob2JzdGV0cmljX2VuY291bnRlcl9ub3RlX2V4cG9ydHMsIHsKICBoYW5kbGVyOiAoKSA9PiBoYW5kbGVyCn0pOwptb2R1bGUuZXhwb3J0cyA9IF9fdG9Db21tb25KUyhvYnN0ZXRyaWNfZW5jb3VudGVyX25vdGVfZXhwb3J0cyk7CnZhciBpbXBvcnRfY29yZTIgPSByZXF1aXJlKCJAbWVkcGx1bS9jb3JlIik7CgovLyBzcmMvYm90cy9jb3JlL2NoYXJ0aW5nLXV0aWxzLnRzCnZhciBpbXBvcnRfY29yZSA9IHJlcXVpcmUoIkBtZWRwbHVtL2NvcmUiKTsKdmFyIGltcG9ydF9jcnlwdG8gPSByZXF1aXJlKCJjcnlwdG8iKTsKZnVuY3Rpb24gY3JlYXRlT2JzZXJ2YXRpb25zKG9ic2VydmF0aW9uRGF0YSwgY29kZXMsIG9ic2VydmF0aW9uVHlwZXMsIGVuY291bnRlciwgdXNlciwgcmVzcG9uc2UpIHsKICBjb25zdCBvYnNlcnZhdGlvbnMgPSBbXTsKICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhvYnNlcnZhdGlvbkRhdGEpKSB7CiAgICBpZiAoIXZhbHVlIHx8IGtleSA9PT0gImJsb29kUHJlc3N1cmUiICYmICF2YWx1ZS5zeXN0b2xpYyAmJiAhdmFsdWUuZGlhc3RvbGljIHx8IGtleSA9PT0gImRhdGUiKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgY29uc3QgY29kZSA9IGtleSA9PT0gInNlbGZSZXBvcnRlZEhpc3RvcnkiID8gZ2V0U2VsZlJlcG9ydGVkQ29kZShvYnNlcnZhdGlvbkRhdGFbInNlbGZSZXBvcnRlZEhpc3RvcnkiXSkgOiBjb2Rlc1trZXldOwogICAgaWYgKCFjb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gY29kZSBwcm92aWRlZCIpOwogICAgfQogICAgY29uc3Qgb2JzS2V5ID0gb2JzZXJ2YXRpb25UeXBlc1trZXldOwogICAgY29uc3QgcmVzb3VyY2UgPSB7CiAgICAgIGNvZGUKICAgIH07CiAgICBpZiAoa2V5ICE9PSAiYmxvb2RQcmVzc3VyZSIpIHsKICAgICAgcmVzb3VyY2Vbb2JzS2V5XSA9IG9ic2VydmF0aW9uRGF0YVtrZXldOwogICAgfQogICAgaWYgKGtleSA9PT0gImJsb29kUHJlc3N1cmUiKSB7CiAgICAgIHJlc291cmNlLmNvbXBvbmVudCA9IGhhbmRsZUJsb29kUHJlc3N1cmUoCiAgICAgICAgb2JzZXJ2YXRpb25EYXRhLmJsb29kUHJlc3N1cmUuc3lzdG9saWMsCiAgICAgICAgb2JzZXJ2YXRpb25EYXRhLmJsb29kUHJlc3N1cmUuZGlhc3RvbGljCiAgICAgICk7CiAgICB9CiAgICBjb25zdCBvYnNlcnZhdGlvbiA9IHsKICAgICAgLi4ucmVzb3VyY2UsCiAgICAgIHJlc291cmNlVHlwZTogIk9ic2VydmF0aW9uIiwKICAgICAgY29kZToga2V5ID09PSAic2VsZlJlcG9ydGVkSGlzdG9yeSIgPyBnZXRTZWxmUmVwb3J0ZWRDb2RlKG9ic2VydmF0aW9uRGF0YVsic2VsZlJlcG9ydGVkSGlzdG9yeSJdKSA6IGNvZGVzW2tleV0sCiAgICAgIHN0YXR1czogImZpbmFsIiwKICAgICAgc3ViamVjdDogZW5jb3VudGVyLnN1YmplY3QsCiAgICAgIHBlcmZvcm1lcjogW3sgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9XSwKICAgICAgZW5jb3VudGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykoZW5jb3VudGVyKSB9LAogICAgICBlZmZlY3RpdmVEYXRlVGltZTogb2JzZXJ2YXRpb25EYXRhLmRhdGUsCiAgICAgIGRlcml2ZWRGcm9tOiBbeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHJlc3BvbnNlKSB9XQogICAgfTsKICAgIG9ic2VydmF0aW9ucy5wdXNoKG9ic2VydmF0aW9uKTsKICB9CiAgcmV0dXJuIG9ic2VydmF0aW9uczsKfQpmdW5jdGlvbiBoYW5kbGVCbG9vZFByZXNzdXJlKHN5c3RvbGljLCBkaWFzdG9saWMpIHsKICBjb25zdCBjb21wb25lbnRzID0gW107CiAgaWYgKGRpYXN0b2xpYykgewogICAgY29tcG9uZW50cy5wdXNoKHsKICAgICAgY29kZTogeyBjb2Rpbmc6IFt7IGNvZGU6ICI4NDYyLTQiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIkRpYXN0b2xpYyBibG9vZCBwcmVzc3VyZSIgfV0gfSwKICAgICAgdmFsdWVRdWFudGl0eTogewogICAgICAgIHZhbHVlOiBkaWFzdG9saWMsCiAgICAgICAgdW5pdDogIm1tW0hnXSIKICAgICAgfQogICAgfSk7CiAgfQogIGlmIChzeXN0b2xpYykgewogICAgY29tcG9uZW50cy5wdXNoKHsKICAgICAgY29kZTogeyBjb2Rpbmc6IFt7IGNvZGU6ICI4NDgwLTYiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIlN5c3RvbGljIGJsb29kIHByZXNzdXJlIiB9XSB9LAogICAgICB2YWx1ZVF1YW50aXR5OiB7CiAgICAgICAgdmFsdWU6IHN5c3RvbGljLAogICAgICAgIHVuaXQ6ICJtbVtIZ10iCiAgICAgIH0KICAgIH0pOwogIH0KICByZXR1cm4gY29tcG9uZW50czsKfQpmdW5jdGlvbiBjcmVhdGVDb25kaXRpb25zKHBhcnRpYWxDb25kaXRpb24sIGVuY291bnRlciwgdXNlciwgcHJvYmxlbUxpc3QpIHsKICBjb25zdCBjb25kaXRpb25zID0gW107CiAgY29uc3QgZW5jb3VudGVyRGlhZ25vc2lzID0gewogICAgLi4ucGFydGlhbENvbmRpdGlvbiwKICAgIHJlc291cmNlVHlwZTogIkNvbmRpdGlvbiIsCiAgICBzdWJqZWN0OiBlbmNvdW50ZXIuc3ViamVjdCwKICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgIHJlY29yZGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgIGFzc2VydGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgIGNhdGVnb3J5OiBbCiAgICAgIHsKICAgICAgICBjb2Rpbmc6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9WYWx1ZVNldC9jb25kaXRpb24tY2F0ZWdvcnkiLAogICAgICAgICAgICBjb2RlOiAiZW5jb3VudGVyLWRpYWdub3NpcyIsCiAgICAgICAgICAgIGRpc3BsYXk6ICJFbmNvdW50ZXIgRGlhZ25vc2lzIgogICAgICAgICAgfQogICAgICAgIF0KICAgICAgfQogICAgXQogIH07CiAgY29uZGl0aW9ucy5wdXNoKGVuY291bnRlckRpYWdub3Npcyk7CiAgaWYgKHByb2JsZW1MaXN0KSB7CiAgICBjb25kaXRpb25zLnB1c2goewogICAgICAuLi5wYXJ0aWFsQ29uZGl0aW9uLAogICAgICByZXNvdXJjZVR5cGU6ICJDb25kaXRpb24iLAogICAgICBzdWJqZWN0OiBlbmNvdW50ZXIuc3ViamVjdCwKICAgICAgZW5jb3VudGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykoZW5jb3VudGVyKSB9LAogICAgICByZWNvcmRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH0sCiAgICAgIGFzc2VydGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfSwKICAgICAgY2F0ZWdvcnk6IFsKICAgICAgICB7CiAgICAgICAgICBjb2Rpbmc6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvVmFsdWVTZXQvY29uZGl0aW9uLWNhdGVnb3J5IiwKICAgICAgICAgICAgICBjb2RlOiAicHJvYmxlbS1saXN0LWl0ZW0iLAogICAgICAgICAgICAgIGRpc3BsYXk6ICJQcm9ibGVtIExpc3QgSXRlbSIKICAgICAgICAgICAgfQogICAgICAgICAgXQogICAgICAgIH0KICAgICAgXQogICAgfSk7CiAgfQogIHJldHVybiBjb25kaXRpb25zOwp9CmZ1bmN0aW9uIGNyZWF0ZUNsaW5pY2FsSW1wcmVzc2lvbnMoZW5jb3VudGVyLCB1c2VyLCBub3RlKSB7CiAgaWYgKCFub3RlKSB7CiAgICByZXR1cm4gdm9pZCAwOwogIH0KICBjb25zdCBjbGluaWNhbEltcHJlc3Npb24gPSB7CiAgICByZXNvdXJjZVR5cGU6ICJDbGluaWNhbEltcHJlc3Npb24iLAogICAgc3RhdHVzOiAiaW4tcHJvZ3Jlc3MiLAogICAgc3ViamVjdDogZW5jb3VudGVyLnN1YmplY3QsCiAgICBlbmNvdW50ZXI6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShlbmNvdW50ZXIpIH0sCiAgICBhc3Nlc3NvcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH0sCiAgICBub3RlOiBbeyB0ZXh0OiBub3RlIH1dCiAgfTsKICByZXR1cm4gY2xpbmljYWxJbXByZXNzaW9uOwp9CmZ1bmN0aW9uIGNyZWF0ZUJ1bmRsZShyZXNvdXJjZXMpIHsKICBjb25zdCBidW5kbGUgPSB7CiAgICByZXNvdXJjZVR5cGU6ICJCdW5kbGUiLAogICAgdHlwZTogInRyYW5zYWN0aW9uIgogIH07CiAgY29uc3QgZW50cmllcyA9IHJlc291cmNlcy5tYXAoKHJlc291cmNlKSA9PiB7CiAgICBjb25zdCBlbnRyeSA9IHsKICAgICAgZnVsbFVybDogYHVybjp1dWlkOiR7KDAsIGltcG9ydF9jcnlwdG8ucmFuZG9tVVVJRCkoKX1gLAogICAgICByZXF1ZXN0OiB7IG1ldGhvZDogIlBVVCIsIHVybDogZ2V0VXBzZXJ0VXJsKHJlc291cmNlKSB9LAogICAgICByZXNvdXJjZQogICAgfTsKICAgIHJldHVybiBlbnRyeTsKICB9KTsKICBidW5kbGUuZW50cnkgPSBlbnRyaWVzOwogIHJldHVybiBidW5kbGU7Cn0KZnVuY3Rpb24gZ2V0VXBzZXJ0VXJsKHJlc291cmNlKSB7CiAgaWYgKHJlc291cmNlLnJlc291cmNlVHlwZSA9PT0gIk9ic2VydmF0aW9uIikgewogICAgY29uc3QgY29kZSA9IHJlc291cmNlLmNvZGU7CiAgICBpZiAoIWNvZGUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBjb2RlIHByb3ZpZGVkIik7CiAgICB9CiAgICBpZiAoIXJlc291cmNlLmVuY291bnRlcikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGxpbmtlZCBlbmNvdW50ZXIiKTsKICAgIH0KICAgIGNvbnN0IHVybCA9IGNvZGUuY29kaW5nPy5bMF0uY29kZSA/IGBPYnNlcnZhdGlvbj9lbmNvdW50ZXI9JHsoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXNvdXJjZS5lbmNvdW50ZXIpfSZjb2RlPSR7Y29kZS5jb2Rpbmc/LlswXS5jb2RlfWAgOiBgT2JzZXJ2YXRpb24/ZW5jb3VudGVyPSR7KDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzb3VyY2UuZW5jb3VudGVyKX1gOwogICAgcmV0dXJuIHVybDsKICB9IGVsc2UgaWYgKHJlc291cmNlLnJlc291cmNlVHlwZSA9PT0gIkNvbmRpdGlvbiIpIHsKICAgIGNvbnN0IGNvZGUgPSByZXNvdXJjZS5jb2RlOwogICAgaWYgKCFjb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gY29kZSBwcm92aWRlZCIpOwogICAgfQogICAgaWYgKCFyZXNvdXJjZS5lbmNvdW50ZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBsaW5rZWQgZW5jb3VudGVyIik7CiAgICB9CiAgICByZXR1cm4gYENvbmRpdGlvbj9lbmNvdW50ZXI9JHsoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXNvdXJjZS5lbmNvdW50ZXIpfSZjb2RlPSR7Y29kZS5jb2Rpbmc/LlswXS5jb2RlfWA7CiAgfSBlbHNlIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICJDbGluaWNhbEltcHJlc3Npb24iKSB7CiAgICBpZiAoIXJlc291cmNlLmVuY291bnRlcikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGxpbmtlZCBlbmNvdW50ZXIiKTsKICAgIH0KICAgIHJldHVybiBgQ2xpbmljYWxJbXByZXNzaW9uP2VuY291bnRlcj0keygwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHJlc291cmNlLmVuY291bnRlcil9YDsKICB9IGVsc2UgewogICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJlc291cmNlIHR5cGUiKTsKICB9Cn0KZnVuY3Rpb24gZ2V0U2VsZlJlcG9ydGVkQ29kZShyZXBvcnRlZEhpc3RvcnkpIHsKICBjb25zdCBjb2RlID0gewogICAgY29kaW5nOiBbXQogIH07CiAgc3dpdGNoIChyZXBvcnRlZEhpc3RvcnkpIHsKICAgIGNhc2UgIkJsb29kIGNsb3RzIjoKICAgICAgY29kZS5jb2Rpbmc/LnB1c2goewogICAgICAgIGNvZGU6ICJJNzQuOSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiRW1ib2xpc20gYW5kIHRocm9tYm9zaXMgb2YgdW5zcGVjaWZpZWQgYXJ0ZXJ5IgogICAgICB9KTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJTdHJva2UiOgogICAgICBjb2RlLmNvZGluZz8ucHVzaCh7CiAgICAgICAgY29kZTogIkk2My45IiwKICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAiLAogICAgICAgIGRpc3BsYXk6ICJDZXJlYnJhbCBpbmZhcmN0aW9uLCB1bnNwZWNpZmllZCIKICAgICAgfSk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAiQnJlYXN0IGNhbmNlciI6CiAgICAgIGNvZGUuY29kaW5nPy5wdXNoKHsKICAgICAgICBjb2RlOiAiRDA1LjEwIiwKICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAiLAogICAgICAgIGRpc3BsYXk6ICJJbnRyYWR1Y3RhbCBjYXJjaW5vbWEgaW4gc2l0dSBvZiB1bnNwZWNpZmllZCBicmVhc3QiCiAgICAgIH0pOwogICAgICBicmVhazsKICAgIGNhc2UgIkVuZG9tZXRyaWFsIGNhbmNlciI6CiAgICAgIGNvZGUuY29kaW5nPy5wdXNoKHsKICAgICAgICBjb2RlOiAiQzU0LjEiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIk1hbGlnbmFudCBuZW9wbGFzbSBvZiBlbmRvbWV0cml1bSIKICAgICAgfSk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAiSXJyZWd1bGFyIGJsZWVkaW5nIjoKICAgICAgY29kZS5jb2Rpbmc/LnB1c2goewogICAgICAgIGNvZGU6ICJOOTIuMSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiRXhjZXNzaXZlIGFuZCBmcmVxdWVudCBtZW5zdHJ1YXRpb24gd2l0aCBpcnJlZ3VsYXIgY3ljbGUiCiAgICAgIH0pOwogICAgICBicmVhazsKICAgIGNhc2UgIkJNSSA+IDMwIjoKICAgICAgY29kZS5jb2Rpbmc/LnB1c2goewogICAgICAgIGNvZGU6ICJFNjYuOSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiT2Jlc2l0eSwgdW5zcGVjaWZpZWQiCiAgICAgIH0pOwogICAgICBicmVhazsKICB9CiAgcmV0dXJuIGNvZGU7Cn0KCi8vIHNyYy9ib3RzL2NvcmUvb2JzZXJ2YXRpb24tdXRpbHMudHMKZnVuY3Rpb24gY2FsY3VsYXRlQk1JKGhlaWdodCwgd2VpZ2h0KSB7CiAgaWYgKCFoZWlnaHQ/LnZhbHVlIHx8ICF3ZWlnaHQ/LnZhbHVlKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkFsbCB2YWx1ZXMgbXVzdCBiZSBwcm92aWRlZCIpOwogIH0KICBjb25zdCBoZWlnaHRNID0gZ2V0SGVpZ2h0SW5NZXRlcnMoaGVpZ2h0KTsKICBjb25zdCB3ZWlnaHRLZyA9IGdldFdlaWdodEluS2lsb2dyYW1zKHdlaWdodCk7CiAgY29uc3QgYm1pID0gTWF0aC5yb3VuZCh3ZWlnaHRLZyAvIGhlaWdodE0gKiogMiAqIDEwKSAvIDEwOwogIHJldHVybiB7CiAgICB2YWx1ZTogYm1pLAogICAgdW5pdDogImtnL21eMiIKICB9Owp9CmZ1bmN0aW9uIGdldFdlaWdodEluS2lsb2dyYW1zKHdlaWdodCkgewogIGlmICghd2VpZ2h0LnVuaXQpIHsKICAgIHRocm93IG5ldyBFcnJvcigiTm8gdW5pdCBkZWZpbmVkIik7CiAgfQogIGNvbnN0IHVuaXQgPSB3ZWlnaHQudW5pdDsKICBjb25zdCB3ZWlnaHRWYWwgPSB3ZWlnaHQudmFsdWU7CiAgc3dpdGNoICh1bml0KSB7CiAgICBjYXNlICJsYiI6CiAgICAgIHJldHVybiB3ZWlnaHRWYWwgLyAyLjI7CiAgICBjYXNlICJrZyI6CiAgICAgIHJldHVybiB3ZWlnaHRWYWw7CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gdW5pdC4gUGxlYXNlIHByb3ZpZGUgd2VpZ2h0IGluIG9uZSBvZiB0aGUgZm9sbG93aW5nIHVuaXRzOiBQb3VuZHMgb3Iga2lsb2dyYW1zLiIpOwogIH0KfQpmdW5jdGlvbiBnZXRIZWlnaHRJbk1ldGVycyhoZWlnaHQpIHsKICBpZiAoIWhlaWdodC51bml0KSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHVuaXQgZGVmaW5lZCIpOwogIH0KICBjb25zdCB1bml0ID0gaGVpZ2h0LnVuaXQ7CiAgY29uc3QgaGVpZ2h0VmFsID0gaGVpZ2h0LnZhbHVlOwogIHN3aXRjaCAodW5pdCkgewogICAgY2FzZSAiaW4iOgogICAgICByZXR1cm4gaGVpZ2h0VmFsICogMi41NCAvIDEwMDsKICAgIGNhc2UgImZ0IjoKICAgICAgcmV0dXJuIGhlaWdodFZhbCAqIDEyICogMi41NCAvIDEwMDsKICAgIGNhc2UgImNtIjoKICAgICAgcmV0dXJuIGhlaWdodFZhbCAvIDEwMDsKICAgIGNhc2UgIm0iOgogICAgICByZXR1cm4gaGVpZ2h0VmFsOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICJVbmtub3duIHVuaXQuIFBsZWFzZSBwcm92aWRlIGhlaWdodCBpbiBvbmUgb2YgdGhlIGZvbGxvd2luZyB1bml0czogSW5jaGVzLCBmZWV0LCBjZW50aW1ldGVycywgb3IgbWV0ZXJzLiIKICAgICAgKTsKICB9Cn0KCi8vIHNyYy9ib3RzL2NvcmUvb2JzdGV0cmljLWVuY291bnRlci1ub3RlLnRzCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoZXZlbnQsIG1lZHBsdW0pIHsKICBjb25zdCByZXNwb25zZSA9IGV2ZW50LmlucHV0OwogIGNvbnN0IGFuc3dlcnMgPSAoMCwgaW1wb3J0X2NvcmUyLmdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzKShyZXNwb25zZSk7CiAgY29uc3QgZW5jb3VudGVyID0gYXdhaXQgbWVkcGx1bS5yZWFkUmVmZXJlbmNlKHJlc3BvbnNlLmVuY291bnRlcik7CiAgY29uc3QgdXNlciA9IG1lZHBsdW0uZ2V0UHJvZmlsZSgpOwogIGlmICghYW5zd2Vyc1sicmVhc29uLWZvci12aXNpdCJdKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk11c3QgcHJvdmlkZSBhIHJlYXNvbiBmb3IgdGhlIHZpc2l0Iik7CiAgfQogIGNvbnN0IG9ic2VydmF0aW9uRGF0YSA9IHsKICAgIGdyYXZpZGE6IGFuc3dlcnNbImdyYXZpZGEiXT8udmFsdWVJbnRlZ2VyLAogICAgcGFyYTogYW5zd2Vyc1sicGFyYSJdPy52YWx1ZUludGVnZXIsCiAgICBnZXN0YXRpb25hbERheXM6IGFuc3dlcnNbImdlc3RhdGlvbmFsLWFnZS1kYXlzIl0/LnZhbHVlSW50ZWdlciwKICAgIGdlc3RhdGlvbmFsV2Vla3M6IGFuc3dlcnNbImdlc3RhdGlvbmFsLWFnZS13ZWVrcyJdPy52YWx1ZUludGVnZXIsCiAgICBoZWlnaHQ6IGFuc3dlcnNbImhlaWdodCJdPy52YWx1ZVF1YW50aXR5LAogICAgd2VpZ2h0OiBhbnN3ZXJzWyJ3ZWlnaHQiXT8udmFsdWVRdWFudGl0eSwKICAgIHRvdGFsV2VpZ2h0R2FpbjogYW5zd2Vyc1sidG90YWwtd2VpZ2h0LWdhaW4iXT8udmFsdWVRdWFudGl0eSwKICAgIGJsb29kUHJlc3N1cmU6IHsKICAgICAgc3lzdG9saWM6IGFuc3dlcnNbInN5c3RvbGljIl0/LnZhbHVlSW50ZWdlciwKICAgICAgZGlhc3RvbGljOiBhbnN3ZXJzWyJkaWFzdG9saWMiXT8udmFsdWVJbnRlZ2VyCiAgICB9LAogICAgZGF0ZTogYW5zd2Vyc1siZGF0ZSJdPy52YWx1ZURhdGVUaW1lCiAgfTsKICBpZiAob2JzZXJ2YXRpb25EYXRhLmhlaWdodCAmJiBvYnNlcnZhdGlvbkRhdGEud2VpZ2h0KSB7CiAgICBvYnNlcnZhdGlvbkRhdGEuYm1pID0gY2FsY3VsYXRlQk1JKG9ic2VydmF0aW9uRGF0YS5oZWlnaHQsIG9ic2VydmF0aW9uRGF0YS53ZWlnaHQpOwogIH0KICBjb25zdCBwcm9ibGVtTGlzdCA9IGFuc3dlcnNbInByb2JsZW0tbGlzdCJdPy52YWx1ZUJvb2xlYW4gPz8gZmFsc2U7CiAgY29uc3QgcGFydGlhbENvbmRpdGlvbiA9IHsKICAgIHJlc291cmNlVHlwZTogIkNvbmRpdGlvbiIsCiAgICBjb2RlOiBhbnN3ZXJzWyJyZWFzb24tZm9yLXZpc2l0Il0udmFsdWVDb2RpbmcKICB9OwogIGNvbnN0IG5vdGUgPSBhbnN3ZXJzWyJhc3Nlc3NtZW50Il0/LnZhbHVlU3RyaW5nOwogIGNvbnN0IG9ic2VydmF0aW9uVHlwZXMgPSB7CiAgICBoZWlnaHQ6ICJ2YWx1ZVF1YW50aXR5IiwKICAgIHdlaWdodDogInZhbHVlUXVhbnRpdHkiLAogICAgYm1pOiAidmFsdWVRdWFudGl0eSIsCiAgICBncmF2aWRhOiAidmFsdWVJbnRlZ2VyIiwKICAgIHBhcmE6ICJ2YWx1ZUludGVnZXIiLAogICAgZ2VzdGF0aW9uYWxEYXlzOiAidmFsdWVJbnRlZ2VyIiwKICAgIGdlc3RhdGlvbmFsV2Vla3M6ICJ2YWx1ZUludGVnZXIiLAogICAgdG90YWxXZWlnaHRHYWluOiAidmFsdWVRdWFudGl0eSIKICB9OwogIGNvbnN0IG9ic2VydmF0aW9ucyA9IGNyZWF0ZU9ic2VydmF0aW9ucyhvYnNlcnZhdGlvbkRhdGEsIG9ic3RldHJpY0NvZGVzLCBvYnNlcnZhdGlvblR5cGVzLCBlbmNvdW50ZXIsIHVzZXIsIHJlc3BvbnNlKTsKICBjb25zdCBjb25kaXRpb25zID0gY3JlYXRlQ29uZGl0aW9ucyhwYXJ0aWFsQ29uZGl0aW9uLCBlbmNvdW50ZXIsIHVzZXIsIHByb2JsZW1MaXN0KTsKICBjb25zdCBjbGluaWNhbEltcHJlc3Npb25zID0gY3JlYXRlQ2xpbmljYWxJbXByZXNzaW9ucyhlbmNvdW50ZXIsIHVzZXIsIG5vdGUpOwogIGNvbnN0IHJlc291cmNlcyA9IFsuLi5vYnNlcnZhdGlvbnMsIC4uLmNvbmRpdGlvbnNdOwogIGlmIChjbGluaWNhbEltcHJlc3Npb25zKSB7CiAgICByZXNvdXJjZXMucHVzaChjbGluaWNhbEltcHJlc3Npb25zKTsKICB9CiAgY29uc3QgYnVuZGxlID0gY3JlYXRlQnVuZGxlKHJlc291cmNlcyk7CiAgY29uc3QgcmVzcG9uc2VCdW5kbGUgPSBhd2FpdCBtZWRwbHVtLmV4ZWN1dGVCYXRjaChidW5kbGUpOwogIHJldHVybiByZXNwb25zZUJ1bmRsZTsKfQp2YXIgb2JzdGV0cmljQ29kZXMgPSB7CiAgaGVpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI4MzAyLTIiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIkJvZHkgaGVpZ2h0IiB9XQogIH0sCiAgd2VpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIyOTQ2My03Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJCb2R5IHdlaWdodCIgfV0KICB9LAogIGJsb29kUHJlc3N1cmU6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjM1MDk0LTIiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIkJsb29kIHByZXNzdXJlIHBhbmVsIiB9XQogIH0sCiAgYm1pOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIzOTE1Ni01Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJCb2R5IE1hc3MgSW5kZXggKEJNSSkiIH1dCiAgfSwKICBncmF2aWRhOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIxNjE3MzIwMDYiLCBzeXN0ZW06ICJodHRwOi8vc25vbWVkLmluZm8vc2N0IiwgZGlzcGxheTogIkdyYXZpZGEiIH1dCiAgfSwKICBwYXJhOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIxMTgyMTIwMDAiLCBzeXN0ZW06ICJodHRwOi8vc25vbWVkLmluZm8vc2N0IiwgZGlzcGxheTogIlBhcml0eSBmaW5kaW5nIiB9XQogIH0sCiAgZ2VzdGF0aW9uYWxEYXlzOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI0OTA1Mi00Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJHZXN0YXRpb25hbCBhZ2UgaW4gZGF5cyIgfV0KICB9LAogIGdlc3RhdGlvbmFsV2Vla3M6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjQ5MDUxLTYiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIkdlc3RhdGlvbmFsIGFnZSBpbiB3ZWVrcyIgfV0KICB9LAogIHRvdGFsV2VpZ2h0R2FpbjogewogICAgY29kaW5nOiBbeyBjb2RlOiAiNTYwNzgtOSIsIHN5c3RlbTogImh0dHA6Ly9sb2luYy5vcmciLCBkaXNwbGF5OiAiV2VpZ2h0IGdhaW4gW01hc3NdIC0tZHVyaW5nIGN1cnJlbnQgcHJlZ25hbmN5IiB9XQogIH0KfTsKLy8gQW5ub3RhdGUgdGhlIENvbW1vbkpTIGV4cG9ydCBuYW1lcyBmb3IgRVNNIGltcG9ydCBpbiBub2RlOgowICYmIChtb2R1bGUuZXhwb3J0cyA9IHsKICBoYW5kbGVyCn0pOwpPYmplY3QuYXNzaWduKGV4cG9ydHMsIG1vZHVsZS5leHBvcnRzKTsK"
      }
    },
    {
      "request": {
        "method": "PUT",
        "url": "$bot-obstetric-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Bot",
        "id": "$bot-obstetric-encounter-note-id",
        "name": "obstetric-encounter-note",
        "runtimeVersion": "awslambda",
        "sourceCode": {
          "contentType": "text/typescript",
          "url": "urn:uuid:72416bca-c551-4034-9db4-c85d9378be60"
        },
        "executableCode": {
          "contentType": "text/javascript",
          "url": "urn:uuid:226d3775-bade-4565-a0bf-b986c2637011"
        }
      }
    },
    {
      "request": {
        "url": "Subscription",
        "method": "POST",
        "ifNoneExist": "url=$bot-obstetric-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Subscription",
        "status": "active",
        "reason": "obstetric-encounter-note",
        "channel": {
          "endpoint": "$bot-obstetric-encounter-note-reference",
          "type": "rest-hook"
        },
        "criteria": "QuestionnaireResponse?questionnaire=$obstetric-visit"
      }
    },
    {
      "fullUrl": "urn:uuid:c6e597f1-5c64-4b0c-9ea8-113a08450bac",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/typescript",
        "data": "aW1wb3J0IHsgQm90RXZlbnQsIGdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzLCBNZWRwbHVtQ2xpZW50IH0gZnJvbSAnQG1lZHBsdW0vY29yZSc7CmltcG9ydCB7CiAgQnVuZGxlLAogIENsaW5pY2FsSW1wcmVzc2lvbiwKICBDb2RlYWJsZUNvbmNlcHQsCiAgQ29kaW5nLAogIENvbmRpdGlvbiwKICBFbmNvdW50ZXIsCiAgT2JzZXJ2YXRpb24sCiAgUHJhY3RpdGlvbmVyLAogIFF1ZXN0aW9ubmFpcmVSZXNwb25zZSwKICBSZWZlcmVuY2UsCn0gZnJvbSAnQG1lZHBsdW0vZmhpcnR5cGVzJzsKaW1wb3J0IHsKICBjcmVhdGVCdW5kbGUsCiAgY3JlYXRlQ2xpbmljYWxJbXByZXNzaW9ucywKICBjcmVhdGVDb25kaXRpb25zLAogIGNyZWF0ZU9ic2VydmF0aW9ucywKICBPYnNlcnZhdGlvbkRhdGEsCn0gZnJvbSAnLi9jaGFydGluZy11dGlscyc7CmltcG9ydCB7IGNhbGN1bGF0ZUJNSSB9IGZyb20gJy4vb2JzZXJ2YXRpb24tdXRpbHMnOwoKZXhwb3J0IGludGVyZmFjZSBHeW5lY29sb2d5T2JzZXJ2YXRpb25EYXRhIGV4dGVuZHMgT2JzZXJ2YXRpb25EYXRhIHsKICBsYXN0UGVyaW9kPzogc3RyaW5nOwogIGNvbnRyYWNlcHRpb24/OiBDb2Rpbmc7CiAgbGFzdE1hbW1vZ3JhbT86IHN0cmluZzsKICBzbW9raW5nU3RhdHVzPzogQ29kaW5nOwogIGRydWdVc2U/OiBDb2Rpbmc7CiAgaG91c2luZ1N0YXR1cz86IENvZGluZzsKfQoKZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIoZXZlbnQ6IEJvdEV2ZW50PFF1ZXN0aW9ubmFpcmVSZXNwb25zZT4sIG1lZHBsdW06IE1lZHBsdW1DbGllbnQpOiBQcm9taXNlPEJ1bmRsZT4gewogIC8vIFBhcnNlIHRoZSBhbnN3ZXJzIGZyb20gdGhlIFF1ZXN0aW9ubmFpcmVSZXNwb25zZQogIGNvbnN0IHJlc3BvbnNlID0gZXZlbnQuaW5wdXQ7CiAgY29uc3QgYW5zd2VycyA9IGdldFF1ZXN0aW9ubmFpcmVBbnN3ZXJzKHJlc3BvbnNlKTsKICAvLyBHZXQgdGhlIGxpbmtlZCBlbmNvdW50ZXIgYW5kIHVzZXIgd2hvIGluaXRpYXRlZCB0aGUgYm90CiAgY29uc3QgZW5jb3VudGVyID0gYXdhaXQgbWVkcGx1bS5yZWFkUmVmZXJlbmNlKHJlc3BvbnNlLmVuY291bnRlciBhcyBSZWZlcmVuY2U8RW5jb3VudGVyPik7CiAgY29uc3QgdXNlciA9IG1lZHBsdW0uZ2V0UHJvZmlsZSgpIGFzIFByYWN0aXRpb25lcjsKCiAgLy8gUmVhc29uIGZvciB2aXNpdCBpcyByZXF1aXJlZCB0byBoYXZlIGFuIGFuc3dlciwgc28gYW4gZXJyb3IgaXMgdGhyb3duIGlmIHRoZXJlIGlzbid0IG9uZQogIGlmICghYW5zd2Vyc1sncmVhc29uLWZvci12aXNpdCddPy52YWx1ZUNvZGluZykgewogICAgdGhyb3cgbmV3IEVycm9yKCdNdXN0IHByb3ZpZGUgYSByZWFzb24gZm9yIHRoZSB2aXNpdCcpOwogIH0KCiAgLy8gUGFyc2UgdGhlIGFuc3dlcnMgaW50byBtb3JlIGVhc2lseSB1c2FibGUgb2JqZWN0cwogIGNvbnN0IG9ic2VydmF0aW9uRGF0YTogR3luZWNvbG9neU9ic2VydmF0aW9uRGF0YSA9IHsKICAgIGxhc3RQZXJpb2Q6IGFuc3dlcnNbJ2xhc3QtcGVyaW9kJ10/LnZhbHVlRGF0ZSwKICAgIGNvbnRyYWNlcHRpb246IGFuc3dlcnNbJ2NvbnRyYWNlcHRpb24nXT8udmFsdWVDb2RpbmcsCiAgICBsYXN0TWFtbW9ncmFtOiBhbnN3ZXJzWydtYW1tb2dyYW0nXT8udmFsdWVEYXRlLAogICAgc21va2luZ1N0YXR1czogYW5zd2Vyc1snc21va2luZyddPy52YWx1ZUNvZGluZywKICAgIGRydWdVc2U6IGFuc3dlcnNbJ2RydWdzJ10/LnZhbHVlQ29kaW5nLAogICAgaG91c2luZ1N0YXR1czogYW5zd2Vyc1snaG91c2luZyddPy52YWx1ZUNvZGluZywKICAgIGJsb29kUHJlc3N1cmU6IHsKICAgICAgc3lzdG9saWM6IGFuc3dlcnNbJ3N5c3RvbGljJ10/LnZhbHVlSW50ZWdlciwKICAgICAgZGlhc3RvbGljOiBhbnN3ZXJzWydkaWFzdG9saWMnXT8udmFsdWVJbnRlZ2VyLAogICAgfSwKICAgIGhlaWdodDogYW5zd2Vyc1snaGVpZ2h0J10/LnZhbHVlUXVhbnRpdHksCiAgICB3ZWlnaHQ6IGFuc3dlcnNbJ3dlaWdodCddPy52YWx1ZVF1YW50aXR5LAogICAgZGF0ZTogYW5zd2Vyc1snZGF0ZSddPy52YWx1ZURhdGVUaW1lLAogIH07CgogIGlmIChvYnNlcnZhdGlvbkRhdGEuaGVpZ2h0ICYmIG9ic2VydmF0aW9uRGF0YS53ZWlnaHQpIHsKICAgIG9ic2VydmF0aW9uRGF0YS5ibWkgPSBjYWxjdWxhdGVCTUkob2JzZXJ2YXRpb25EYXRhLmhlaWdodCwgb2JzZXJ2YXRpb25EYXRhLndlaWdodCk7CiAgfQoKICBjb25zdCBwcm9ibGVtTGlzdCA9IGFuc3dlcnNbJ3Byb2JsZW0tbGlzdCddPy52YWx1ZUJvb2xlYW4gPz8gZmFsc2U7CgogIGNvbnN0IHBhcnRpYWxDb25kaXRpb246IFBhcnRpYWw8Q29uZGl0aW9uPiA9IHsKICAgIHJlc291cmNlVHlwZTogJ0NvbmRpdGlvbicsCiAgICBjb2RlOiBhbnN3ZXJzWydyZWFzb24tZm9yLXZpc2l0J10udmFsdWVDb2RpbmcsCiAgfTsKCiAgY29uc3Qgbm90ZSA9IGFuc3dlcnNbJ2Fzc2Vzc21lbnQnXT8udmFsdWVTdHJpbmc7CgogIGNvbnN0IG9ic2VydmF0aW9uVHlwZXM6IHsgW2tleTogc3RyaW5nXTogc3RyaW5nIH0gPSB7CiAgICBoZWlnaHQ6ICd2YWx1ZVF1YW50aXR5JywKICAgIHdlaWdodDogJ3ZhbHVlUXVhbnRpdHknLAogICAgYm1pOiAndmFsdWVRdWFudGl0eScsCiAgICBsYXN0UGVyaW9kOiAndmFsdWVEYXRlVGltZScsCiAgICBjb250cmFjZXB0aW9uOiAndmFsdWVDb2RlYWJsZUNvbmNlcHQnLAogICAgbGFzdE1hbW1vZ3JhbTogJ3ZhbHVlRGF0ZVRpbWUnLAogICAgc21va2luZ1N0YXR1czogJ3ZhbHVlQ29kZWFibGVDb25jZXB0JywKICAgIGRydWdVc2U6ICd2YWx1ZUNvZGVhYmxlQ29uY2VwdCcsCiAgICBob3VzaW5nU3RhdHVzOiAndmFsdWVDb2RlYWJsZUNvbmNlcHQnLAogIH07CgogIC8vIENyZWF0ZSBidW5kbGUgZW50cmllcyBmcm9tIHRoZSBhYm92ZSBvYmplY3RzCiAgLy8gY29uc3QgcGFydGlhbE9ic2VydmF0aW9ucyA9IGNyZWF0ZVBhcnRpYWxHeW5lY29sb2d5T2JzZXJ2YXRpb25zKG9ic2VydmF0aW9uRGF0YSwgZ3luZWNvbG9neUNvZGVzKTsKICBjb25zdCBvYnNlcnZhdGlvbnMgPSBjcmVhdGVPYnNlcnZhdGlvbnMoCiAgICBvYnNlcnZhdGlvbkRhdGEsCiAgICBneW5lY29sb2d5Q29kZXMsCiAgICBvYnNlcnZhdGlvblR5cGVzLAogICAgZW5jb3VudGVyLAogICAgdXNlciwKICAgIHJlc3BvbnNlCiAgKTsKICBjb25zdCBjb25kaXRpb25zID0gY3JlYXRlQ29uZGl0aW9ucyhwYXJ0aWFsQ29uZGl0aW9uLCBlbmNvdW50ZXIsIHVzZXIsIHByb2JsZW1MaXN0KTsKICBjb25zdCBjbGluaWNhbEltcHJlc3Npb25zID0gY3JlYXRlQ2xpbmljYWxJbXByZXNzaW9ucyhlbmNvdW50ZXIsIHVzZXIsIG5vdGUpOwoKICAvLyBDcmVhdGUgYW4gYXJyYXkgb2YgYnVuZGxlIGVudHJpZXMgZm9yIGFsbCByZXNvdXJjZSB0eXBlcwogIGNvbnN0IHJlc291cmNlczogKE9ic2VydmF0aW9uIHwgQ29uZGl0aW9uIHwgQ2xpbmljYWxJbXByZXNzaW9uKVtdID0gWy4uLm9ic2VydmF0aW9ucywgLi4uY29uZGl0aW9uc107CiAgaWYgKGNsaW5pY2FsSW1wcmVzc2lvbnMpIHsKICAgIHJlc291cmNlcy5wdXNoKGNsaW5pY2FsSW1wcmVzc2lvbnMpOwogIH0KCiAgY29uc3QgYnVuZGxlID0gY3JlYXRlQnVuZGxlKHJlc291cmNlcyk7CgogIC8vIEV4ZWN1dGUgdGhlIGJhdGNoIHRvIGNyZWF0ZSBhbGwgcmVzb3VyY2VzIGF0IG9uY2UKICBjb25zdCByZXNwb25zZUJ1bmRsZSA9IGF3YWl0IG1lZHBsdW0uZXhlY3V0ZUJhdGNoKGJ1bmRsZSk7CiAgcmV0dXJuIHJlc3BvbnNlQnVuZGxlOwp9Cgpjb25zdCBneW5lY29sb2d5Q29kZXM6IFJlY29yZDxzdHJpbmcsIENvZGVhYmxlQ29uY2VwdD4gPSB7CiAgbGFzdFBlcmlvZDogewogICAgY29kaW5nOiBbeyBjb2RlOiAnODY2NS0yJywgc3lzdGVtOiAnaHR0cDovL2xvaW5jLm9yZycsIGRpc3BsYXk6ICdMYXN0IG1lbnN0cnVhbCBwZXJpb2Qgc3RhcnQgZGF0ZScgfV0sCiAgfSwKICBjb250cmFjZXB0aW9uOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICc4NjU5LTUnLCBzeXN0ZW06ICdodHRwOi8vbG9pbmMub3JnJywgZGlzcGxheTogJ0JpcnRoIGNvbnRyb2wgbWV0aG9kIC0gUmVwb3J0ZWQnIH1dLAogIH0sCiAgbGFzdE1hbW1vZ3JhbTogewogICAgY29kaW5nOiBbeyBjb2RlOiAnNDI5NzM2MDA4Jywgc3lzdGVtOiAnaHR0cDovL3Nub21lZC5pbmZvL3NjdCcsIGRpc3BsYXk6ICdEYXRlIG9mIGxhc3QgbWFtbW9ncmFtJyB9XSwKICB9LAogIHNtb2tpbmdTdGF0dXM6IHsKICAgIGNvZGluZzogW3sgY29kZTogJzcyMTY2LTInLCBzeXN0ZW06ICdodHRwOi8vbG9pbmMub3JnJywgZGlzcGxheTogJ1RvYmFjY28gc21va2luZyBzdGF0dXMnIH1dLAogIH0sCiAgZHJ1Z1VzZTogewogICAgY29kaW5nOiBbeyBjb2RlOiAnNzQyMDQtOScsIHN5c3RlbTogJ2h0dHA6Ly9sb2luYy5vcmcnLCBkaXNwbGF5OiAnRHJ1ZyB1c2UnIH1dLAogIH0sCiAgaG91c2luZ1N0YXR1czogewogICAgY29kaW5nOiBbeyBjb2RlOiAnNzE4MDItMycsIHN5c3RlbTogJ2h0dHA6Ly9sb2luYy5vcmcnLCBkaXNwbGF5OiAnSG91c2luZyBzdGF0dXMnIH1dLAogIH0sCiAgaGVpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICc4MzAyLTInLCBzeXN0ZW06ICdodHRwOi8vbG9pbmMub3JnJywgZGlzcGxheTogJ0JvZHkgaGVpZ2h0JyB9XSwKICB9LAogIHdlaWdodDogewogICAgY29kaW5nOiBbeyBjb2RlOiAnMjk0NjMtNycsIHN5c3RlbTogJ2h0dHA6Ly9sb2luYy5vcmcnLCBkaXNwbGF5OiAnQm9keSB3ZWlnaHQnIH1dLAogIH0sCiAgYmxvb2RQcmVzc3VyZTogewogICAgY29kaW5nOiBbeyBjb2RlOiAnMzUwOTQtMicsIHN5c3RlbTogJ2h0dHA6Ly9sb2luYy5vcmcnLCBkaXNwbGF5OiAnQmxvb2QgcHJlc3N1cmUgcGFuZWwnIH1dLAogIH0sCiAgYm1pOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICczOTE1Ni01Jywgc3lzdGVtOiAnaHR0cDovL2xvaW5jLm9yZycsIGRpc3BsYXk6ICdCb2R5IE1hc3MgSW5kZXggKEJNSSknIH1dLAogIH0sCn07Cg=="
      }
    },
    {
      "fullUrl": "urn:uuid:a364eece-2e4d-4679-9205-0a7f96bdfce6",
      "request": {
        "method": "POST",
        "url": "Binary"
      },
      "resource": {
        "resourceType": "Binary",
        "contentType": "text/javascript",
        "data": "InVzZSBzdHJpY3QiOwp2YXIgX19kZWZQcm9wID0gT2JqZWN0LmRlZmluZVByb3BlcnR5Owp2YXIgX19nZXRPd25Qcm9wRGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CnZhciBfX2dldE93blByb3BOYW1lcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzOwp2YXIgX19oYXNPd25Qcm9wID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eTsKdmFyIF9fZXhwb3J0ID0gKHRhcmdldCwgYWxsKSA9PiB7CiAgZm9yICh2YXIgbmFtZSBpbiBhbGwpCiAgICBfX2RlZlByb3AodGFyZ2V0LCBuYW1lLCB7IGdldDogYWxsW25hbWVdLCBlbnVtZXJhYmxlOiB0cnVlIH0pOwp9Owp2YXIgX19jb3B5UHJvcHMgPSAodG8sIGZyb20sIGV4Y2VwdCwgZGVzYykgPT4gewogIGlmIChmcm9tICYmIHR5cGVvZiBmcm9tID09PSAib2JqZWN0IiB8fCB0eXBlb2YgZnJvbSA9PT0gImZ1bmN0aW9uIikgewogICAgZm9yIChsZXQga2V5IG9mIF9fZ2V0T3duUHJvcE5hbWVzKGZyb20pKQogICAgICBpZiAoIV9faGFzT3duUHJvcC5jYWxsKHRvLCBrZXkpICYmIGtleSAhPT0gZXhjZXB0KQogICAgICAgIF9fZGVmUHJvcCh0bywga2V5LCB7IGdldDogKCkgPT4gZnJvbVtrZXldLCBlbnVtZXJhYmxlOiAhKGRlc2MgPSBfX2dldE93blByb3BEZXNjKGZyb20sIGtleSkpIHx8IGRlc2MuZW51bWVyYWJsZSB9KTsKICB9CiAgcmV0dXJuIHRvOwp9Owp2YXIgX190b0NvbW1vbkpTID0gKG1vZCkgPT4gX19jb3B5UHJvcHMoX19kZWZQcm9wKHt9LCAiX19lc01vZHVsZSIsIHsgdmFsdWU6IHRydWUgfSksIG1vZCk7CgovLyBzcmMvYm90cy9jb3JlL2d5bmVjb2xvZ3ktZW5jb3VudGVyLW5vdGUudHMKdmFyIGd5bmVjb2xvZ3lfZW5jb3VudGVyX25vdGVfZXhwb3J0cyA9IHt9OwpfX2V4cG9ydChneW5lY29sb2d5X2VuY291bnRlcl9ub3RlX2V4cG9ydHMsIHsKICBoYW5kbGVyOiAoKSA9PiBoYW5kbGVyCn0pOwptb2R1bGUuZXhwb3J0cyA9IF9fdG9Db21tb25KUyhneW5lY29sb2d5X2VuY291bnRlcl9ub3RlX2V4cG9ydHMpOwp2YXIgaW1wb3J0X2NvcmUyID0gcmVxdWlyZSgiQG1lZHBsdW0vY29yZSIpOwoKLy8gc3JjL2JvdHMvY29yZS9jaGFydGluZy11dGlscy50cwp2YXIgaW1wb3J0X2NvcmUgPSByZXF1aXJlKCJAbWVkcGx1bS9jb3JlIik7CnZhciBpbXBvcnRfY3J5cHRvID0gcmVxdWlyZSgiY3J5cHRvIik7CmZ1bmN0aW9uIGNyZWF0ZU9ic2VydmF0aW9ucyhvYnNlcnZhdGlvbkRhdGEsIGNvZGVzLCBvYnNlcnZhdGlvblR5cGVzLCBlbmNvdW50ZXIsIHVzZXIsIHJlc3BvbnNlKSB7CiAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMob2JzZXJ2YXRpb25EYXRhKSkgewogICAgaWYgKCF2YWx1ZSB8fCBrZXkgPT09ICJibG9vZFByZXNzdXJlIiAmJiAhdmFsdWUuc3lzdG9saWMgJiYgIXZhbHVlLmRpYXN0b2xpYyB8fCBrZXkgPT09ICJkYXRlIikgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IGNvZGUgPSBrZXkgPT09ICJzZWxmUmVwb3J0ZWRIaXN0b3J5IiA/IGdldFNlbGZSZXBvcnRlZENvZGUob2JzZXJ2YXRpb25EYXRhWyJzZWxmUmVwb3J0ZWRIaXN0b3J5Il0pIDogY29kZXNba2V5XTsKICAgIGlmICghY29kZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGNvZGUgcHJvdmlkZWQiKTsKICAgIH0KICAgIGNvbnN0IG9ic0tleSA9IG9ic2VydmF0aW9uVHlwZXNba2V5XTsKICAgIGNvbnN0IHJlc291cmNlID0gewogICAgICBjb2RlCiAgICB9OwogICAgaWYgKGtleSAhPT0gImJsb29kUHJlc3N1cmUiKSB7CiAgICAgIHJlc291cmNlW29ic0tleV0gPSBvYnNlcnZhdGlvbkRhdGFba2V5XTsKICAgIH0KICAgIGlmIChrZXkgPT09ICJibG9vZFByZXNzdXJlIikgewogICAgICByZXNvdXJjZS5jb21wb25lbnQgPSBoYW5kbGVCbG9vZFByZXNzdXJlKAogICAgICAgIG9ic2VydmF0aW9uRGF0YS5ibG9vZFByZXNzdXJlLnN5c3RvbGljLAogICAgICAgIG9ic2VydmF0aW9uRGF0YS5ibG9vZFByZXNzdXJlLmRpYXN0b2xpYwogICAgICApOwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb24gPSB7CiAgICAgIC4uLnJlc291cmNlLAogICAgICByZXNvdXJjZVR5cGU6ICJPYnNlcnZhdGlvbiIsCiAgICAgIGNvZGU6IGtleSA9PT0gInNlbGZSZXBvcnRlZEhpc3RvcnkiID8gZ2V0U2VsZlJlcG9ydGVkQ29kZShvYnNlcnZhdGlvbkRhdGFbInNlbGZSZXBvcnRlZEhpc3RvcnkiXSkgOiBjb2Rlc1trZXldLAogICAgICBzdGF0dXM6ICJmaW5hbCIsCiAgICAgIHN1YmplY3Q6IGVuY291bnRlci5zdWJqZWN0LAogICAgICBwZXJmb3JtZXI6IFt7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykodXNlcikgfV0sCiAgICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgICAgZWZmZWN0aXZlRGF0ZVRpbWU6IG9ic2VydmF0aW9uRGF0YS5kYXRlLAogICAgICBkZXJpdmVkRnJvbTogW3sgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXNwb25zZSkgfV0KICAgIH07CiAgICBvYnNlcnZhdGlvbnMucHVzaChvYnNlcnZhdGlvbik7CiAgfQogIHJldHVybiBvYnNlcnZhdGlvbnM7Cn0KZnVuY3Rpb24gaGFuZGxlQmxvb2RQcmVzc3VyZShzeXN0b2xpYywgZGlhc3RvbGljKSB7CiAgY29uc3QgY29tcG9uZW50cyA9IFtdOwogIGlmIChkaWFzdG9saWMpIHsKICAgIGNvbXBvbmVudHMucHVzaCh7CiAgICAgIGNvZGU6IHsgY29kaW5nOiBbeyBjb2RlOiAiODQ2Mi00Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJEaWFzdG9saWMgYmxvb2QgcHJlc3N1cmUiIH1dIH0sCiAgICAgIHZhbHVlUXVhbnRpdHk6IHsKICAgICAgICB2YWx1ZTogZGlhc3RvbGljLAogICAgICAgIHVuaXQ6ICJtbVtIZ10iCiAgICAgIH0KICAgIH0pOwogIH0KICBpZiAoc3lzdG9saWMpIHsKICAgIGNvbXBvbmVudHMucHVzaCh7CiAgICAgIGNvZGU6IHsgY29kaW5nOiBbeyBjb2RlOiAiODQ4MC02Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJTeXN0b2xpYyBibG9vZCBwcmVzc3VyZSIgfV0gfSwKICAgICAgdmFsdWVRdWFudGl0eTogewogICAgICAgIHZhbHVlOiBzeXN0b2xpYywKICAgICAgICB1bml0OiAibW1bSGddIgogICAgICB9CiAgICB9KTsKICB9CiAgcmV0dXJuIGNvbXBvbmVudHM7Cn0KZnVuY3Rpb24gY3JlYXRlQ29uZGl0aW9ucyhwYXJ0aWFsQ29uZGl0aW9uLCBlbmNvdW50ZXIsIHVzZXIsIHByb2JsZW1MaXN0KSB7CiAgY29uc3QgY29uZGl0aW9ucyA9IFtdOwogIGNvbnN0IGVuY291bnRlckRpYWdub3NpcyA9IHsKICAgIC4uLnBhcnRpYWxDb25kaXRpb24sCiAgICByZXNvdXJjZVR5cGU6ICJDb25kaXRpb24iLAogICAgc3ViamVjdDogZW5jb3VudGVyLnN1YmplY3QsCiAgICBlbmNvdW50ZXI6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShlbmNvdW50ZXIpIH0sCiAgICByZWNvcmRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH0sCiAgICBhc3NlcnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH0sCiAgICBjYXRlZ29yeTogWwogICAgICB7CiAgICAgICAgY29kaW5nOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvVmFsdWVTZXQvY29uZGl0aW9uLWNhdGVnb3J5IiwKICAgICAgICAgICAgY29kZTogImVuY291bnRlci1kaWFnbm9zaXMiLAogICAgICAgICAgICBkaXNwbGF5OiAiRW5jb3VudGVyIERpYWdub3NpcyIKICAgICAgICAgIH0KICAgICAgICBdCiAgICAgIH0KICAgIF0KICB9OwogIGNvbmRpdGlvbnMucHVzaChlbmNvdW50ZXJEaWFnbm9zaXMpOwogIGlmIChwcm9ibGVtTGlzdCkgewogICAgY29uZGl0aW9ucy5wdXNoKHsKICAgICAgLi4ucGFydGlhbENvbmRpdGlvbiwKICAgICAgcmVzb3VyY2VUeXBlOiAiQ29uZGl0aW9uIiwKICAgICAgc3ViamVjdDogZW5jb3VudGVyLnN1YmplY3QsCiAgICAgIGVuY291bnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKGVuY291bnRlcikgfSwKICAgICAgcmVjb3JkZXI6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9LAogICAgICBhc3NlcnRlcjogeyByZWZlcmVuY2U6ICgwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHVzZXIpIH0sCiAgICAgIGNhdGVnb3J5OiBbCiAgICAgICAgewogICAgICAgICAgY29kaW5nOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL1ZhbHVlU2V0L2NvbmRpdGlvbi1jYXRlZ29yeSIsCiAgICAgICAgICAgICAgY29kZTogInByb2JsZW0tbGlzdC1pdGVtIiwKICAgICAgICAgICAgICBkaXNwbGF5OiAiUHJvYmxlbSBMaXN0IEl0ZW0iCiAgICAgICAgICAgIH0KICAgICAgICAgIF0KICAgICAgICB9CiAgICAgIF0KICAgIH0pOwogIH0KICByZXR1cm4gY29uZGl0aW9uczsKfQpmdW5jdGlvbiBjcmVhdGVDbGluaWNhbEltcHJlc3Npb25zKGVuY291bnRlciwgdXNlciwgbm90ZSkgewogIGlmICghbm90ZSkgewogICAgcmV0dXJuIHZvaWQgMDsKICB9CiAgY29uc3QgY2xpbmljYWxJbXByZXNzaW9uID0gewogICAgcmVzb3VyY2VUeXBlOiAiQ2xpbmljYWxJbXByZXNzaW9uIiwKICAgIHN0YXR1czogImluLXByb2dyZXNzIiwKICAgIHN1YmplY3Q6IGVuY291bnRlci5zdWJqZWN0LAogICAgZW5jb3VudGVyOiB7IHJlZmVyZW5jZTogKDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykoZW5jb3VudGVyKSB9LAogICAgYXNzZXNzb3I6IHsgcmVmZXJlbmNlOiAoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKSh1c2VyKSB9LAogICAgbm90ZTogW3sgdGV4dDogbm90ZSB9XQogIH07CiAgcmV0dXJuIGNsaW5pY2FsSW1wcmVzc2lvbjsKfQpmdW5jdGlvbiBjcmVhdGVCdW5kbGUocmVzb3VyY2VzKSB7CiAgY29uc3QgYnVuZGxlID0gewogICAgcmVzb3VyY2VUeXBlOiAiQnVuZGxlIiwKICAgIHR5cGU6ICJ0cmFuc2FjdGlvbiIKICB9OwogIGNvbnN0IGVudHJpZXMgPSByZXNvdXJjZXMubWFwKChyZXNvdXJjZSkgPT4gewogICAgY29uc3QgZW50cnkgPSB7CiAgICAgIGZ1bGxVcmw6IGB1cm46dXVpZDokeygwLCBpbXBvcnRfY3J5cHRvLnJhbmRvbVVVSUQpKCl9YCwKICAgICAgcmVxdWVzdDogeyBtZXRob2Q6ICJQVVQiLCB1cmw6IGdldFVwc2VydFVybChyZXNvdXJjZSkgfSwKICAgICAgcmVzb3VyY2UKICAgIH07CiAgICByZXR1cm4gZW50cnk7CiAgfSk7CiAgYnVuZGxlLmVudHJ5ID0gZW50cmllczsKICByZXR1cm4gYnVuZGxlOwp9CmZ1bmN0aW9uIGdldFVwc2VydFVybChyZXNvdXJjZSkgewogIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICJPYnNlcnZhdGlvbiIpIHsKICAgIGNvbnN0IGNvZGUgPSByZXNvdXJjZS5jb2RlOwogICAgaWYgKCFjb2RlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gY29kZSBwcm92aWRlZCIpOwogICAgfQogICAgaWYgKCFyZXNvdXJjZS5lbmNvdW50ZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBsaW5rZWQgZW5jb3VudGVyIik7CiAgICB9CiAgICBjb25zdCB1cmwgPSBjb2RlLmNvZGluZz8uWzBdLmNvZGUgPyBgT2JzZXJ2YXRpb24/ZW5jb3VudGVyPSR7KDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzb3VyY2UuZW5jb3VudGVyKX0mY29kZT0ke2NvZGUuY29kaW5nPy5bMF0uY29kZX1gIDogYE9ic2VydmF0aW9uP2VuY291bnRlcj0keygwLCBpbXBvcnRfY29yZS5nZXRSZWZlcmVuY2VTdHJpbmcpKHJlc291cmNlLmVuY291bnRlcil9YDsKICAgIHJldHVybiB1cmw7CiAgfSBlbHNlIGlmIChyZXNvdXJjZS5yZXNvdXJjZVR5cGUgPT09ICJDb25kaXRpb24iKSB7CiAgICBjb25zdCBjb2RlID0gcmVzb3VyY2UuY29kZTsKICAgIGlmICghY29kZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIGNvZGUgcHJvdmlkZWQiKTsKICAgIH0KICAgIGlmICghcmVzb3VyY2UuZW5jb3VudGVyKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiTm8gbGlua2VkIGVuY291bnRlciIpOwogICAgfQogICAgcmV0dXJuIGBDb25kaXRpb24/ZW5jb3VudGVyPSR7KDAsIGltcG9ydF9jb3JlLmdldFJlZmVyZW5jZVN0cmluZykocmVzb3VyY2UuZW5jb3VudGVyKX0mY29kZT0ke2NvZGUuY29kaW5nPy5bMF0uY29kZX1gOwogIH0gZWxzZSBpZiAocmVzb3VyY2UucmVzb3VyY2VUeXBlID09PSAiQ2xpbmljYWxJbXByZXNzaW9uIikgewogICAgaWYgKCFyZXNvdXJjZS5lbmNvdW50ZXIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJObyBsaW5rZWQgZW5jb3VudGVyIik7CiAgICB9CiAgICByZXR1cm4gYENsaW5pY2FsSW1wcmVzc2lvbj9lbmNvdW50ZXI9JHsoMCwgaW1wb3J0X2NvcmUuZ2V0UmVmZXJlbmNlU3RyaW5nKShyZXNvdXJjZS5lbmNvdW50ZXIpfWA7CiAgfSBlbHNlIHsKICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCByZXNvdXJjZSB0eXBlIik7CiAgfQp9CmZ1bmN0aW9uIGdldFNlbGZSZXBvcnRlZENvZGUocmVwb3J0ZWRIaXN0b3J5KSB7CiAgY29uc3QgY29kZSA9IHsKICAgIGNvZGluZzogW10KICB9OwogIHN3aXRjaCAocmVwb3J0ZWRIaXN0b3J5KSB7CiAgICBjYXNlICJCbG9vZCBjbG90cyI6CiAgICAgIGNvZGUuY29kaW5nPy5wdXNoKHsKICAgICAgICBjb2RlOiAiSTc0LjkiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIkVtYm9saXNtIGFuZCB0aHJvbWJvc2lzIG9mIHVuc3BlY2lmaWVkIGFydGVyeSIKICAgICAgfSk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAiU3Ryb2tlIjoKICAgICAgY29kZS5jb2Rpbmc/LnB1c2goewogICAgICAgIGNvZGU6ICJJNjMuOSIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiQ2VyZWJyYWwgaW5mYXJjdGlvbiwgdW5zcGVjaWZpZWQiCiAgICAgIH0pOwogICAgICBicmVhazsKICAgIGNhc2UgIkJyZWFzdCBjYW5jZXIiOgogICAgICBjb2RlLmNvZGluZz8ucHVzaCh7CiAgICAgICAgY29kZTogIkQwNS4xMCIsCiAgICAgICAgc3lzdGVtOiAiaHR0cDovL2hsNy5vcmcvZmhpci9zaWQvaWNkLTEwIiwKICAgICAgICBkaXNwbGF5OiAiSW50cmFkdWN0YWwgY2FyY2lub21hIGluIHNpdHUgb2YgdW5zcGVjaWZpZWQgYnJlYXN0IgogICAgICB9KTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJFbmRvbWV0cmlhbCBjYW5jZXIiOgogICAgICBjb2RlLmNvZGluZz8ucHVzaCh7CiAgICAgICAgY29kZTogIkM1NC4xIiwKICAgICAgICBzeXN0ZW06ICJodHRwOi8vaGw3Lm9yZy9maGlyL3NpZC9pY2QtMTAiLAogICAgICAgIGRpc3BsYXk6ICJNYWxpZ25hbnQgbmVvcGxhc20gb2YgZW5kb21ldHJpdW0iCiAgICAgIH0pOwogICAgICBicmVhazsKICAgIGNhc2UgIklycmVndWxhciBibGVlZGluZyI6CiAgICAgIGNvZGUuY29kaW5nPy5wdXNoKHsKICAgICAgICBjb2RlOiAiTjkyLjEiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIkV4Y2Vzc2l2ZSBhbmQgZnJlcXVlbnQgbWVuc3RydWF0aW9uIHdpdGggaXJyZWd1bGFyIGN5Y2xlIgogICAgICB9KTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJCTUkgPiAzMCI6CiAgICAgIGNvZGUuY29kaW5nPy5wdXNoKHsKICAgICAgICBjb2RlOiAiRTY2LjkiLAogICAgICAgIHN5c3RlbTogImh0dHA6Ly9obDcub3JnL2ZoaXIvc2lkL2ljZC0xMCIsCiAgICAgICAgZGlzcGxheTogIk9iZXNpdHksIHVuc3BlY2lmaWVkIgogICAgICB9KTsKICAgICAgYnJlYWs7CiAgfQogIHJldHVybiBjb2RlOwp9CgovLyBzcmMvYm90cy9jb3JlL29ic2VydmF0aW9uLXV0aWxzLnRzCmZ1bmN0aW9uIGNhbGN1bGF0ZUJNSShoZWlnaHQsIHdlaWdodCkgewogIGlmICghaGVpZ2h0Py52YWx1ZSB8fCAhd2VpZ2h0Py52YWx1ZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCJBbGwgdmFsdWVzIG11c3QgYmUgcHJvdmlkZWQiKTsKICB9CiAgY29uc3QgaGVpZ2h0TSA9IGdldEhlaWdodEluTWV0ZXJzKGhlaWdodCk7CiAgY29uc3Qgd2VpZ2h0S2cgPSBnZXRXZWlnaHRJbktpbG9ncmFtcyh3ZWlnaHQpOwogIGNvbnN0IGJtaSA9IE1hdGgucm91bmQod2VpZ2h0S2cgLyBoZWlnaHRNICoqIDIgKiAxMCkgLyAxMDsKICByZXR1cm4gewogICAgdmFsdWU6IGJtaSwKICAgIHVuaXQ6ICJrZy9tXjIiCiAgfTsKfQpmdW5jdGlvbiBnZXRXZWlnaHRJbktpbG9ncmFtcyh3ZWlnaHQpIHsKICBpZiAoIXdlaWdodC51bml0KSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vIHVuaXQgZGVmaW5lZCIpOwogIH0KICBjb25zdCB1bml0ID0gd2VpZ2h0LnVuaXQ7CiAgY29uc3Qgd2VpZ2h0VmFsID0gd2VpZ2h0LnZhbHVlOwogIHN3aXRjaCAodW5pdCkgewogICAgY2FzZSAibGIiOgogICAgICByZXR1cm4gd2VpZ2h0VmFsIC8gMi4yOwogICAgY2FzZSAia2ciOgogICAgICByZXR1cm4gd2VpZ2h0VmFsOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIHVuaXQuIFBsZWFzZSBwcm92aWRlIHdlaWdodCBpbiBvbmUgb2YgdGhlIGZvbGxvd2luZyB1bml0czogUG91bmRzIG9yIGtpbG9ncmFtcy4iKTsKICB9Cn0KZnVuY3Rpb24gZ2V0SGVpZ2h0SW5NZXRlcnMoaGVpZ2h0KSB7CiAgaWYgKCFoZWlnaHQudW5pdCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJObyB1bml0IGRlZmluZWQiKTsKICB9CiAgY29uc3QgdW5pdCA9IGhlaWdodC51bml0OwogIGNvbnN0IGhlaWdodFZhbCA9IGhlaWdodC52YWx1ZTsKICBzd2l0Y2ggKHVuaXQpIHsKICAgIGNhc2UgImluIjoKICAgICAgcmV0dXJuIGhlaWdodFZhbCAqIDIuNTQgLyAxMDA7CiAgICBjYXNlICJmdCI6CiAgICAgIHJldHVybiBoZWlnaHRWYWwgKiAxMiAqIDIuNTQgLyAxMDA7CiAgICBjYXNlICJjbSI6CiAgICAgIHJldHVybiBoZWlnaHRWYWwgLyAxMDA7CiAgICBjYXNlICJtIjoKICAgICAgcmV0dXJuIGhlaWdodFZhbDsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgICAiVW5rbm93biB1bml0LiBQbGVhc2UgcHJvdmlkZSBoZWlnaHQgaW4gb25lIG9mIHRoZSBmb2xsb3dpbmcgdW5pdHM6IEluY2hlcywgZmVldCwgY2VudGltZXRlcnMsIG9yIG1ldGVycy4iCiAgICAgICk7CiAgfQp9CgovLyBzcmMvYm90cy9jb3JlL2d5bmVjb2xvZ3ktZW5jb3VudGVyLW5vdGUudHMKYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihldmVudCwgbWVkcGx1bSkgewogIGNvbnN0IHJlc3BvbnNlID0gZXZlbnQuaW5wdXQ7CiAgY29uc3QgYW5zd2VycyA9ICgwLCBpbXBvcnRfY29yZTIuZ2V0UXVlc3Rpb25uYWlyZUFuc3dlcnMpKHJlc3BvbnNlKTsKICBjb25zdCBlbmNvdW50ZXIgPSBhd2FpdCBtZWRwbHVtLnJlYWRSZWZlcmVuY2UocmVzcG9uc2UuZW5jb3VudGVyKTsKICBjb25zdCB1c2VyID0gbWVkcGx1bS5nZXRQcm9maWxlKCk7CiAgaWYgKCFhbnN3ZXJzWyJyZWFzb24tZm9yLXZpc2l0Il0/LnZhbHVlQ29kaW5nKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk11c3QgcHJvdmlkZSBhIHJlYXNvbiBmb3IgdGhlIHZpc2l0Iik7CiAgfQogIGNvbnN0IG9ic2VydmF0aW9uRGF0YSA9IHsKICAgIGxhc3RQZXJpb2Q6IGFuc3dlcnNbImxhc3QtcGVyaW9kIl0/LnZhbHVlRGF0ZSwKICAgIGNvbnRyYWNlcHRpb246IGFuc3dlcnNbImNvbnRyYWNlcHRpb24iXT8udmFsdWVDb2RpbmcsCiAgICBsYXN0TWFtbW9ncmFtOiBhbnN3ZXJzWyJtYW1tb2dyYW0iXT8udmFsdWVEYXRlLAogICAgc21va2luZ1N0YXR1czogYW5zd2Vyc1sic21va2luZyJdPy52YWx1ZUNvZGluZywKICAgIGRydWdVc2U6IGFuc3dlcnNbImRydWdzIl0/LnZhbHVlQ29kaW5nLAogICAgaG91c2luZ1N0YXR1czogYW5zd2Vyc1siaG91c2luZyJdPy52YWx1ZUNvZGluZywKICAgIGJsb29kUHJlc3N1cmU6IHsKICAgICAgc3lzdG9saWM6IGFuc3dlcnNbInN5c3RvbGljIl0/LnZhbHVlSW50ZWdlciwKICAgICAgZGlhc3RvbGljOiBhbnN3ZXJzWyJkaWFzdG9saWMiXT8udmFsdWVJbnRlZ2VyCiAgICB9LAogICAgaGVpZ2h0OiBhbnN3ZXJzWyJoZWlnaHQiXT8udmFsdWVRdWFudGl0eSwKICAgIHdlaWdodDogYW5zd2Vyc1sid2VpZ2h0Il0/LnZhbHVlUXVhbnRpdHksCiAgICBkYXRlOiBhbnN3ZXJzWyJkYXRlIl0/LnZhbHVlRGF0ZVRpbWUKICB9OwogIGlmIChvYnNlcnZhdGlvbkRhdGEuaGVpZ2h0ICYmIG9ic2VydmF0aW9uRGF0YS53ZWlnaHQpIHsKICAgIG9ic2VydmF0aW9uRGF0YS5ibWkgPSBjYWxjdWxhdGVCTUkob2JzZXJ2YXRpb25EYXRhLmhlaWdodCwgb2JzZXJ2YXRpb25EYXRhLndlaWdodCk7CiAgfQogIGNvbnN0IHByb2JsZW1MaXN0ID0gYW5zd2Vyc1sicHJvYmxlbS1saXN0Il0/LnZhbHVlQm9vbGVhbiA/PyBmYWxzZTsKICBjb25zdCBwYXJ0aWFsQ29uZGl0aW9uID0gewogICAgcmVzb3VyY2VUeXBlOiAiQ29uZGl0aW9uIiwKICAgIGNvZGU6IGFuc3dlcnNbInJlYXNvbi1mb3ItdmlzaXQiXS52YWx1ZUNvZGluZwogIH07CiAgY29uc3Qgbm90ZSA9IGFuc3dlcnNbImFzc2Vzc21lbnQiXT8udmFsdWVTdHJpbmc7CiAgY29uc3Qgb2JzZXJ2YXRpb25UeXBlcyA9IHsKICAgIGhlaWdodDogInZhbHVlUXVhbnRpdHkiLAogICAgd2VpZ2h0OiAidmFsdWVRdWFudGl0eSIsCiAgICBibWk6ICJ2YWx1ZVF1YW50aXR5IiwKICAgIGxhc3RQZXJpb2Q6ICJ2YWx1ZURhdGVUaW1lIiwKICAgIGNvbnRyYWNlcHRpb246ICJ2YWx1ZUNvZGVhYmxlQ29uY2VwdCIsCiAgICBsYXN0TWFtbW9ncmFtOiAidmFsdWVEYXRlVGltZSIsCiAgICBzbW9raW5nU3RhdHVzOiAidmFsdWVDb2RlYWJsZUNvbmNlcHQiLAogICAgZHJ1Z1VzZTogInZhbHVlQ29kZWFibGVDb25jZXB0IiwKICAgIGhvdXNpbmdTdGF0dXM6ICJ2YWx1ZUNvZGVhYmxlQ29uY2VwdCIKICB9OwogIGNvbnN0IG9ic2VydmF0aW9ucyA9IGNyZWF0ZU9ic2VydmF0aW9ucygKICAgIG9ic2VydmF0aW9uRGF0YSwKICAgIGd5bmVjb2xvZ3lDb2RlcywKICAgIG9ic2VydmF0aW9uVHlwZXMsCiAgICBlbmNvdW50ZXIsCiAgICB1c2VyLAogICAgcmVzcG9uc2UKICApOwogIGNvbnN0IGNvbmRpdGlvbnMgPSBjcmVhdGVDb25kaXRpb25zKHBhcnRpYWxDb25kaXRpb24sIGVuY291bnRlciwgdXNlciwgcHJvYmxlbUxpc3QpOwogIGNvbnN0IGNsaW5pY2FsSW1wcmVzc2lvbnMgPSBjcmVhdGVDbGluaWNhbEltcHJlc3Npb25zKGVuY291bnRlciwgdXNlciwgbm90ZSk7CiAgY29uc3QgcmVzb3VyY2VzID0gWy4uLm9ic2VydmF0aW9ucywgLi4uY29uZGl0aW9uc107CiAgaWYgKGNsaW5pY2FsSW1wcmVzc2lvbnMpIHsKICAgIHJlc291cmNlcy5wdXNoKGNsaW5pY2FsSW1wcmVzc2lvbnMpOwogIH0KICBjb25zdCBidW5kbGUgPSBjcmVhdGVCdW5kbGUocmVzb3VyY2VzKTsKICBjb25zdCByZXNwb25zZUJ1bmRsZSA9IGF3YWl0IG1lZHBsdW0uZXhlY3V0ZUJhdGNoKGJ1bmRsZSk7CiAgcmV0dXJuIHJlc3BvbnNlQnVuZGxlOwp9CnZhciBneW5lY29sb2d5Q29kZXMgPSB7CiAgbGFzdFBlcmlvZDogewogICAgY29kaW5nOiBbeyBjb2RlOiAiODY2NS0yIiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJMYXN0IG1lbnN0cnVhbCBwZXJpb2Qgc3RhcnQgZGF0ZSIgfV0KICB9LAogIGNvbnRyYWNlcHRpb246IHsKICAgIGNvZGluZzogW3sgY29kZTogIjg2NTktNSIsIHN5c3RlbTogImh0dHA6Ly9sb2luYy5vcmciLCBkaXNwbGF5OiAiQmlydGggY29udHJvbCBtZXRob2QgLSBSZXBvcnRlZCIgfV0KICB9LAogIGxhc3RNYW1tb2dyYW06IHsKICAgIGNvZGluZzogW3sgY29kZTogIjQyOTczNjAwOCIsIHN5c3RlbTogImh0dHA6Ly9zbm9tZWQuaW5mby9zY3QiLCBkaXNwbGF5OiAiRGF0ZSBvZiBsYXN0IG1hbW1vZ3JhbSIgfV0KICB9LAogIHNtb2tpbmdTdGF0dXM6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjcyMTY2LTIiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIlRvYmFjY28gc21va2luZyBzdGF0dXMiIH1dCiAgfSwKICBkcnVnVXNlOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI3NDIwNC05Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJEcnVnIHVzZSIgfV0KICB9LAogIGhvdXNpbmdTdGF0dXM6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjcxODAyLTMiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIkhvdXNpbmcgc3RhdHVzIiB9XQogIH0sCiAgaGVpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICI4MzAyLTIiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIkJvZHkgaGVpZ2h0IiB9XQogIH0sCiAgd2VpZ2h0OiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIyOTQ2My03Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJCb2R5IHdlaWdodCIgfV0KICB9LAogIGJsb29kUHJlc3N1cmU6IHsKICAgIGNvZGluZzogW3sgY29kZTogIjM1MDk0LTIiLCBzeXN0ZW06ICJodHRwOi8vbG9pbmMub3JnIiwgZGlzcGxheTogIkJsb29kIHByZXNzdXJlIHBhbmVsIiB9XQogIH0sCiAgYm1pOiB7CiAgICBjb2Rpbmc6IFt7IGNvZGU6ICIzOTE1Ni01Iiwgc3lzdGVtOiAiaHR0cDovL2xvaW5jLm9yZyIsIGRpc3BsYXk6ICJCb2R5IE1hc3MgSW5kZXggKEJNSSkiIH1dCiAgfQp9OwovLyBBbm5vdGF0ZSB0aGUgQ29tbW9uSlMgZXhwb3J0IG5hbWVzIGZvciBFU00gaW1wb3J0IGluIG5vZGU6CjAgJiYgKG1vZHVsZS5leHBvcnRzID0gewogIGhhbmRsZXIKfSk7Ck9iamVjdC5hc3NpZ24oZXhwb3J0cywgbW9kdWxlLmV4cG9ydHMpOwo="
      }
    },
    {
      "request": {
        "method": "PUT",
        "url": "$bot-gynecology-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Bot",
        "id": "$bot-gynecology-encounter-note-id",
        "name": "gynecology-encounter-note",
        "runtimeVersion": "awslambda",
        "sourceCode": {
          "contentType": "text/typescript",
          "url": "urn:uuid:c6e597f1-5c64-4b0c-9ea8-113a08450bac"
        },
        "executableCode": {
          "contentType": "text/javascript",
          "url": "urn:uuid:a364eece-2e4d-4679-9205-0a7f96bdfce6"
        }
      }
    },
    {
      "request": {
        "url": "Subscription",
        "method": "POST",
        "ifNoneExist": "url=$bot-gynecology-encounter-note-reference"
      },
      "resource": {
        "resourceType": "Subscription",
        "status": "active",
        "reason": "gynecology-encounter-note",
        "channel": {
          "endpoint": "$bot-gynecology-encounter-note-reference",
          "type": "rest-hook"
        },
        "criteria": "QuestionnaireResponse?questionnaire=$gynecology-visit"
      }
    }
  ]
}
