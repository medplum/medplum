/*
 * Generated by @medplum/generator
 * Do not edit manually.
 */

import { PoolClient } from 'pg';

export async function run(client: PoolClient): Promise<void> {
  await client.query(`CREATE TABLE IF NOT EXISTS "AsyncJob" (
    "id" UUID NOT NULL PRIMARY KEY,
    "content" TEXT NOT NULL,
    "lastUpdated" TIMESTAMP WITH TIME ZONE NOT NULL,
    "deleted" BOOLEAN NOT NULL DEFAULT FALSE,
    "compartments" UUID[] NOT NULL,
    "status" TEXT,
    "user" TEXT,
    "_profile" TEXT[],
    "_security" TEXT[],
    "_source" TEXT,
    "_tag" TEXT[]
  )`);

  await client.query(`CREATE TABLE IF NOT EXISTS "AsyncJob_History" (
    "versionId" UUID NOT NULL PRIMARY KEY,
    "id" UUID NOT NULL,
    "content" TEXT NOT NULL,
    "lastUpdated" TIMESTAMP WITH TIME ZONE NOT NULL
  )`);

  await client.query('CREATE INDEX ON "AsyncJob" ("lastUpdated")');
  await client.query('CREATE INDEX ON "AsyncJob" USING GIN("compartments")');
  await client.query('CREATE INDEX ON "AsyncJob" USING GIN("_profile")');
  await client.query('CREATE INDEX ON "AsyncJob" USING GIN("_security")');
  await client.query('CREATE INDEX ON "AsyncJob" ("_source")');
  await client.query('CREATE INDEX ON "AsyncJob" USING GIN("_tag")');
  await client.query('CREATE INDEX ON "AsyncJob_History" ("id")');
  await client.query('CREATE INDEX ON "AsyncJob_History" ("lastUpdated")');

  await client.query(`CREATE TABLE IF NOT EXISTS "AsyncJob_Token" (
    "resourceId" UUID NOT NULL,
    "index" INTEGER NOT NULL,
    "code" TEXT NOT NULL,
    "system" TEXT,
    "value" TEXT
  )`);

  await client.query('CREATE INDEX ON "AsyncJob_Token" ("resourceId")');
  await client.query('CREATE INDEX ON "AsyncJob_Token" ("code")');
  await client.query('CREATE INDEX ON "AsyncJob_Token" ("system")');
  await client.query('CREATE INDEX ON "AsyncJob_Token" ("value")');
}
