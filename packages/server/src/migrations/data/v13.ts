// SPDX-FileCopyrightText: Copyright Orangebot, Inc. and Medplum contributors
// SPDX-License-Identifier: Apache-2.0
import { PoolClient } from 'pg';
import { prepareCustomMigrationJobData, runCustomMigration } from '../../workers/post-deploy-migration';
import * as fns from '../migrate-functions';
import { withLongRunningDatabaseClient } from '../migration-utils';
import { MigrationActionResult } from '../types';
import { CustomPostDeployMigration } from './types';

export const migration: CustomPostDeployMigration = {
  type: 'custom',
  prepareJobData: (asyncJob) => prepareCustomMigrationJobData(asyncJob),
  run: async (repo, job, jobData) => {
    return runCustomMigration(repo, job, jobData, async () => {
      return withLongRunningDatabaseClient(async (client) => {
        const results: MigrationActionResult[] = [];
        await run(client, results);
        return results;
      });
    });
  },
};

// prettier-ignore
async function run(client: PoolClient, results: MigrationActionResult[]): Promise<void> {
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Account" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Account" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ActivityDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ActivityDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AdverseEvent" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AdverseEvent" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AllergyIntolerance" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AllergyIntolerance" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Appointment" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Appointment" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AppointmentResponse" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AppointmentResponse" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AuditEvent" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AuditEvent" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Basic" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Basic" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "BiologicallyDerivedProduct" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "BiologicallyDerivedProduct" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "BodyStructure" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "BodyStructure" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Bundle" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Bundle" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CapabilityStatement" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CapabilityStatement" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CarePlan" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CarePlan" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CareTeam" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CareTeam" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CatalogEntry" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CatalogEntry" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ChargeItem" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ChargeItem" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ChargeItemDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ChargeItemDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Claim" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Claim" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ClaimResponse" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ClaimResponse" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ClinicalImpression" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ClinicalImpression" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CodeSystem" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CodeSystem" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Communication" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Communication" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CommunicationRequest" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CommunicationRequest" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CompartmentDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CompartmentDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Composition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Composition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ConceptMap" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ConceptMap" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Condition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Condition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Consent" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Consent" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Contract" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Contract" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Coverage" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Coverage" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CoverageEligibilityRequest" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CoverageEligibilityRequest" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CoverageEligibilityResponse" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "CoverageEligibilityResponse" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DetectedIssue" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DetectedIssue" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Device" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Device" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DeviceDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DeviceDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DeviceMetric" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DeviceMetric" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DeviceRequest" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DeviceRequest" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DeviceUseStatement" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DeviceUseStatement" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DiagnosticReport" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DiagnosticReport" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DocumentManifest" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DocumentManifest" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DocumentReference" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DocumentReference" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EffectEvidenceSynthesis" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EffectEvidenceSynthesis" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Encounter" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Encounter" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Endpoint" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Endpoint" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EnrollmentRequest" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EnrollmentRequest" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EnrollmentResponse" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EnrollmentResponse" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EpisodeOfCare" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EpisodeOfCare" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EventDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EventDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Evidence" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Evidence" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EvidenceVariable" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "EvidenceVariable" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ExampleScenario" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ExampleScenario" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ExplanationOfBenefit" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ExplanationOfBenefit" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "FamilyMemberHistory" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "FamilyMemberHistory" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Flag" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Flag" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Goal" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Goal" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "GraphDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "GraphDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Group" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Group" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "GuidanceResponse" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "GuidanceResponse" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "HealthcareService" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "HealthcareService" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ImagingStudy" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ImagingStudy" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Immunization" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Immunization" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ImmunizationEvaluation" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ImmunizationEvaluation" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ImmunizationRecommendation" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ImmunizationRecommendation" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ImplementationGuide" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ImplementationGuide" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "InsurancePlan" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "InsurancePlan" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Invoice" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Invoice" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Library" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Library" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Linkage" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Linkage" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "List" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "List" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Location" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Location" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Measure" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Measure" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MeasureReport" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MeasureReport" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Media" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Media" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Medication" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Medication" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicationAdministration" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicationAdministration" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicationDispense" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicationDispense" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicationKnowledge" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicationKnowledge" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicationRequest" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicationRequest" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicationStatement" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicationStatement" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProduct" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProduct" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductAuthorization" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductAuthorization" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductContraindication" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductContraindication" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductIndication" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductIndication" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductIngredient" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductIngredient" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductInteraction" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductInteraction" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductManufactured" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductManufactured" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductPackaged" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductPackaged" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductPharmaceutical" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductPharmaceutical" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductUndesirableEffect" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MedicinalProductUndesirableEffect" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MessageDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MessageDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MessageHeader" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MessageHeader" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MolecularSequence" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "MolecularSequence" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "NamingSystem" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "NamingSystem" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "NutritionOrder" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "NutritionOrder" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Observation" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Observation" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ObservationDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ObservationDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "OperationDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "OperationDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "OperationOutcome" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "OperationOutcome" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Organization" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Organization" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "OrganizationAffiliation" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "OrganizationAffiliation" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Parameters" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Parameters" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Patient" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Patient" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "PaymentNotice" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "PaymentNotice" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "PaymentReconciliation" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "PaymentReconciliation" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Person" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Person" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "PlanDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "PlanDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Practitioner" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Practitioner" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "PractitionerRole" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "PractitionerRole" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Procedure" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Procedure" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Provenance" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Provenance" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Questionnaire" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Questionnaire" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "QuestionnaireResponse" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "QuestionnaireResponse" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "RelatedPerson" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "RelatedPerson" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "RequestGroup" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "RequestGroup" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ResearchDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ResearchDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ResearchElementDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ResearchElementDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ResearchStudy" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ResearchStudy" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ResearchSubject" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ResearchSubject" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "RiskAssessment" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "RiskAssessment" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "RiskEvidenceSynthesis" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "RiskEvidenceSynthesis" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Schedule" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Schedule" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SearchParameter" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SearchParameter" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ServiceRequest" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ServiceRequest" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Slot" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Slot" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Specimen" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Specimen" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SpecimenDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SpecimenDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "StructureDefinition" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "StructureDefinition" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "StructureMap" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "StructureMap" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Subscription" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Subscription" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubscriptionStatus" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubscriptionStatus" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Substance" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Substance" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstanceNucleicAcid" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstanceNucleicAcid" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstancePolymer" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstancePolymer" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstanceProtein" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstanceProtein" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstanceReferenceInformation" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstanceReferenceInformation" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstanceSourceMaterial" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstanceSourceMaterial" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstanceSpecification" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SubstanceSpecification" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SupplyDelivery" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SupplyDelivery" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SupplyRequest" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SupplyRequest" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Task" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Task" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "TerminologyCapabilities" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "TerminologyCapabilities" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "TestReport" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "TestReport" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "TestScript" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "TestScript" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ValueSet" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ValueSet" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "VerificationResult" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "VerificationResult" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "VisionPrescription" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "VisionPrescription" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Project" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Project" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ClientApplication" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ClientApplication" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "User" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "User" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ProjectMembership" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "ProjectMembership" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Bot" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Bot" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Login" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Login" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "PasswordChangeRequest" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "PasswordChangeRequest" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "UserSecurityRequest" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "UserSecurityRequest" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "JsonWebKey" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "JsonWebKey" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AccessPolicy" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AccessPolicy" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "UserConfiguration" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "UserConfiguration" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "BulkDataExport" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "BulkDataExport" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SmartAppLaunch" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "SmartAppLaunch" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DomainConfiguration" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "DomainConfiguration" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AsyncJob" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "AsyncJob" DROP COLUMN IF EXISTS "__tokensText"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Agent" DROP COLUMN IF EXISTS "__tokens"`);
  await fns.query(client, results, `ALTER TABLE IF EXISTS "Agent" DROP COLUMN IF EXISTS "__tokensText"`);
}
