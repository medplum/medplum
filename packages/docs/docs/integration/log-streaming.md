import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Log Streaming

:::info

These instructions primarily apply to self-hosted users. To set up log streaming on the Medplum Hosted instance, please reach out to [info@medplum.com](mailto:info@medplum.com)

:::

Medplum can be configured to stream service logs to your existing log management tools, like [SumoLogic](https://www.sumologic.com/), [DataDog](https://www.datadoghq.com/), or [Splunk](https://www.splunk.com/). Centralizing log management allows for better observability and auditability, and offers real-time analytics capabilities.

## Medplum Logs

Medplum server can stream the following to `STDOUT` 
- Login Attempts
- Other troubleshooting information
- All RESTful interactions with FHIR resources, which are recorded as [FHIR AuditEvent resources](/docs/api/fhir/resources/auditevent)

:::warning
To capture [AuditEvent](/docs/api/fhir/resources/auditevent) resources for any RESTful interactions you __*must*__ set the server configuration for [`logAuditEvents`](/docs/self-hosting/config-settings#logauditevents)

:::


For [batch requests](/docs/fhir-datastore/fhir-batch-requests) and [GraphQL queries](/docs/graphql), each individual read/search operation executed by the query generates its own log line. While these operations are logged separately, they all share the same [request ID / trace ID](/docs/integration/log-streaming#log-correlation) for easy correlation and tracing.

## Forwarding Logs via AWS Lambda

To forward logs from CloudWatch to external platforms, AWS Lambda functions are utilized. This involves creating Lambda functions that are triggered by new log entries in CloudWatch and are configured to push these logs to the chosen external logging system.

- For SumoLogic: [Setup Guide](https://help.sumologic.com/docs/send-data/collect-from-other-data-sources/amazon-cloudwatch-logs/)
- For DataDog: [Setup Guide](https://docs.datadoghq.com/logs/guide/send-aws-services-logs-with-the-datadog-lambda-function/?tab=awsconsole)
- For Splunk: [Setup Guide](https://www.splunk.com/en_us/blog/tips-and-tricks/how-to-easily-stream-aws-cloudwatch-logs-to-splunk.html)

## Log Correlation

Medplum uses includes both request IDs and trace IDs to aid in log correlation, enhancing debugging and monitoring capabilities.

The request ID is automatically generated by the Medplum server for each unique HTTP request.

Clients can pass in their own trace id in their request headers. Medplum supports both the headers `X-TRACE-ID` or [`traceparent`](https://www.w3.org/TR/trace-context/#traceparent-header).

<details>
<summary>
  Example: Adding a trace id to a medplum GET request
</summary>

<Tabs groupId="language">
  <TabItem value="ts" label="Typescript">

```ts
await medplum.readResource('Patient', 'homer-simpson', {
  headers: {
    'X-TRACE-ID': 'MY-TRACE-ID',
  },
});
```

  </TabItem>

  <TabItem value="curl" label="cURL">

```bash
curl https://api.medplum.com/fhir/R4/Patient/homer-simpson \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/fhir+json" \
  -H "X-TRACE-ID: "MY-TRACE-ID
```

  </TabItem>
</Tabs>
</details>
