import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Log Streaming

:::warning

These instructions primarily apply to self-hosted users. To set up log streaming on the Medplum Hosted instance, please reach out to [info@medplum.com](mailto:info@medplum.com)

:::

Streaming logs from Medplum to external systems like SumoLogic, DataDog, or Splunk enhances monitoring and analysis. It allows for better security oversight, troubleshooting, and data-driven decision-making. Centralizing log management streamlines the process of dealing with large volumes of log data and offers real-time analytics capabilities.

## Medplum Logs

Medplum uses AWS CloudWatch to store logs produced by the Medplum Server.

Specifically, Medplum logs:

- All RESTful interactions with FHIR resources
- Login Attempts
- Other troubleshooting information

## Using Trace IDs

Medplum uses includes both request IDs and trace IDs in its logs for better tracking and correlation of requests in the logs, enhancing debugging and monitoring capabilities.

The `requestId` is automatically generated by the Medplum server for each unique HTTP request.

Clients can pass in their own trace id in their request headers. Medplum supports both the headers `X-TRACE-ID` or `traceParent`.

<details>
<summary>
  Example: Adding a trace id to a medplum GET request
</summary>

<Tabs groupId="language">
  <TabItem value="ts" label="Typescript">

```ts
await medplum.readResource('Patient', 'homer-simpson', {
  headers: {
    'X-TRACE-ID'
  }
});
```

  </TabItem>
  <TabItem value="cli" label="CLI">

```bash
medplum post admin/projects/:projectId/client \
'{
  "name": "Hello World Client",
  "description": "Client App for Medplum Hello World",
  "redirectUri": "https://example.com/redirect"
  "accessPolicy": {
    "reference": "AccessPolicy/access-policy-id"
  }
}'
```

  </TabItem>
  <TabItem value="curl" label="cURL">

```bash
curl https://api.medplum.com/admin/projects/:projectId/client \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
  "name": "Hello World Client",
  "description": "Hello world",
  "redirectUri": "https://example.com/redirect"
  "accessPolicy": {
    "reference": "AccessPolicy/:access-policy-id"
  }'
```

  </TabItem>
</Tabs>

</details>

## Forwarding Logs via AWS Lambda

To forward logs from CloudWatch to external platforms, AWS Lambda functions are utilized. This involves creating Lambda functions that are triggered by new log entries in CloudWatch and are configured to push these logs to the chosen external logging system.

- For SumoLogic: [Setup Guide](https://help.sumologic.com/docs/send-data/collect-from-other-data-sources/amazon-cloudwatch-logs/)
- For DataDog: [Setup Guide](https://docs.datadoghq.com/logs/guide/send-aws-services-logs-with-the-datadog-lambda-function/?tab=awsconsole)
- For Splunk: [Setup Guide](https://www.splunk.com/en_us/blog/tips-and-tricks/how-to-easily-stream-aws-cloudwatch-logs-to-splunk.html)
